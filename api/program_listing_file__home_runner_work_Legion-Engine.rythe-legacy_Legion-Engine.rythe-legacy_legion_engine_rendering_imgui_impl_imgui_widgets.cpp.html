
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Program Listing for File imgui_widgets.cpp &#8212; LegionEngine v 0.2 alpha documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nameko.css" />
    <link rel="stylesheet" type="text/css" href="../_static/collapsible-lists/css/tree_view.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
    <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Lora:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">LegionEngine v 0.2 alpha documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Program Listing for File imgui_widgets.cpp</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="program-listing-for-file-imgui-widgets-cpp">
<span id="program-listing-file-home-runner-work-legion-engine-rythe-legacy-legion-engine-rythe-legacy-legion-engine-rendering-imgui-impl-imgui-widgets-cpp"></span><h1>Program Listing for File imgui_widgets.cpp<a class="headerlink" href="#program-listing-for-file-imgui-widgets-cpp" title="Permalink to this headline">¶</a></h1>
<p>↰ <a class="reference internal" href="file__home_runner_work_Legion-Engine.rythe-legacy_Legion-Engine.rythe-legacy_legion_engine_rendering_imgui_impl_imgui_widgets.cpp.html#file-home-runner-work-legion-engine-rythe-legacy-legion-engine-rythe-legacy-legion-engine-rendering-imgui-impl-imgui-widgets-cpp"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">/home/runner/work/Legion-Engine.rythe-legacy/Legion-Engine.rythe-legacy/legion/engine/rendering/imgui_impl/imgui_widgets.cpp</span></code>)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// dear imgui, v1.80 WIP</span>
<span class="c1">// (widgets code)</span>

<span class="cm">/*</span>

<span class="cm">Index of this file:</span>

<span class="cm">// [SECTION] Forward Declarations</span>
<span class="cm">// [SECTION] Widgets: Text, etc.</span>
<span class="cm">// [SECTION] Widgets: Main (Button, Image, Checkbox, RadioButton, ProgressBar, Bullet, etc.)</span>
<span class="cm">// [SECTION] Widgets: Low-level Layout helpers (Spacing, Dummy, NewLine, Separator, etc.)</span>
<span class="cm">// [SECTION] Widgets: ComboBox</span>
<span class="cm">// [SECTION] Data Type and Data Formatting Helpers</span>
<span class="cm">// [SECTION] Widgets: DragScalar, DragFloat, DragInt, etc.</span>
<span class="cm">// [SECTION] Widgets: SliderScalar, SliderFloat, SliderInt, etc.</span>
<span class="cm">// [SECTION] Widgets: InputScalar, InputFloat, InputInt, etc.</span>
<span class="cm">// [SECTION] Widgets: InputText, InputTextMultiline</span>
<span class="cm">// [SECTION] Widgets: ColorEdit, ColorPicker, ColorButton, etc.</span>
<span class="cm">// [SECTION] Widgets: TreeNode, CollapsingHeader, etc.</span>
<span class="cm">// [SECTION] Widgets: Selectable</span>
<span class="cm">// [SECTION] Widgets: ListBox</span>
<span class="cm">// [SECTION] Widgets: PlotLines, PlotHistogram</span>
<span class="cm">// [SECTION] Widgets: Value helpers</span>
<span class="cm">// [SECTION] Widgets: MenuItem, BeginMenu, EndMenu, etc.</span>
<span class="cm">// [SECTION] Widgets: BeginTabBar, EndTabBar, etc.</span>
<span class="cm">// [SECTION] Widgets: BeginTabItem, EndTabItem, etc.</span>
<span class="cm">// [SECTION] Widgets: Columns, BeginColumns, EndColumns, etc.</span>

<span class="cm">*/</span>

<span class="cp">#if defined(_MSC_VER) &amp;&amp; !defined(_CRT_SECURE_NO_WARNINGS)</span>
<span class="cp">#define _CRT_SECURE_NO_WARNINGS</span>
<span class="cp">#endif</span>

<span class="cp">#include</span> <span class="cpf">&lt;imgui/imgui.h&gt;</span><span class="cp"></span>
<span class="cp">#ifndef IMGUI_DISABLE</span>

<span class="cp">#ifndef IMGUI_DEFINE_MATH_OPERATORS</span>
<span class="cp">#define IMGUI_DEFINE_MATH_OPERATORS</span>
<span class="cp">#endif</span>
<span class="cp">#include</span> <span class="cpf">&lt;imgui/imgui_internal.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;ctype.h&gt;</span><span class="c1">      // toupper</span><span class="cp"></span>
<span class="cp">#if defined(_MSC_VER) &amp;&amp; _MSC_VER &lt;= 1500 </span><span class="c1">// MSVC 2008 or earlier</span>
<span class="cp">#include</span> <span class="cpf">&lt;stddef.h&gt;</span><span class="c1">     // intptr_t</span><span class="cp"></span>
<span class="cp">#else</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="c1">     // intptr_t</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="c1">// Visual Studio warnings</span>
<span class="cp">#ifdef _MSC_VER</span>
<span class="cp">#pragma warning (disable: 4127)     </span><span class="c1">// condition expression is constant</span>
<span class="cp">#pragma warning (disable: 4996)     </span><span class="c1">// &#39;This function or variable may be unsafe&#39;: strcpy, strdup, sprintf, vsnprintf, sscanf, fopen</span>
<span class="cp">#if defined(_MSC_VER) &amp;&amp; _MSC_VER &gt;= 1922 </span><span class="c1">// MSVC 2019 16.2 or later</span>
<span class="cp">#pragma warning (disable: 5054)     </span><span class="c1">// operator &#39;|&#39;: deprecated between enumerations of different types</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="c1">// Clang/GCC warnings with -Weverything</span>
<span class="cp">#if defined(__clang__)</span>
<span class="cp">#if __has_warning(&quot;-Wunknown-warning-option&quot;)</span>
<span class="cp">#pragma clang diagnostic ignored &quot;-Wunknown-warning-option&quot;         </span><span class="c1">// warning: unknown warning group &#39;xxx&#39;                      // not all warnings are known by all Clang versions and they tend to be rename-happy.. so ignoring warnings triggers new warnings on some configuration. Great!</span>
<span class="cp">#endif</span>
<span class="cp">#pragma clang diagnostic ignored &quot;-Wunknown-pragmas&quot;                </span><span class="c1">// warning: unknown warning group &#39;xxx&#39;</span>
<span class="cp">#pragma clang diagnostic ignored &quot;-Wold-style-cast&quot;                 </span><span class="c1">// warning: use of old-style cast                            // yes, they are more terse.</span>
<span class="cp">#pragma clang diagnostic ignored &quot;-Wfloat-equal&quot;                    </span><span class="c1">// warning: comparing floating point with == or != is unsafe // storing and comparing against same constants (typically 0.0f) is ok.</span>
<span class="cp">#pragma clang diagnostic ignored &quot;-Wformat-nonliteral&quot;              </span><span class="c1">// warning: format string is not a string literal            // passing non-literal to vsnformat(). yes, user passing incorrect format strings can crash the code.</span>
<span class="cp">#pragma clang diagnostic ignored &quot;-Wsign-conversion&quot;                </span><span class="c1">// warning: implicit conversion changes signedness</span>
<span class="cp">#pragma clang diagnostic ignored &quot;-Wzero-as-null-pointer-constant&quot;  </span><span class="c1">// warning: zero as null pointer constant                    // some standard header variations use #define NULL 0</span>
<span class="cp">#pragma clang diagnostic ignored &quot;-Wdouble-promotion&quot;               </span><span class="c1">// warning: implicit conversion from &#39;float&#39; to &#39;double&#39; when passing argument to function  // using printf() is a misery with this as C++ va_arg ellipsis changes float to double.</span>
<span class="cp">#pragma clang diagnostic ignored &quot;-Wenum-enum-conversion&quot;           </span><span class="c1">// warning: bitwise operation between different enumeration types (&#39;XXXFlags_&#39; and &#39;XXXFlagsPrivate_&#39;)</span>
<span class="cp">#pragma clang diagnostic ignored &quot;-Wdeprecated-enum-enum-conversion&quot;</span><span class="c1">// warning: bitwise operation between different enumeration types (&#39;XXXFlags_&#39; and &#39;XXXFlagsPrivate_&#39;) is deprecated</span>
<span class="cp">#pragma clang diagnostic ignored &quot;-Wimplicit-int-float-conversion&quot;  </span><span class="c1">// warning: implicit conversion from &#39;xxx&#39; to &#39;float&#39; may lose precision</span>
<span class="cp">#elif defined(__GNUC__)</span>
<span class="cp">#pragma GCC diagnostic ignored &quot;-Wpragmas&quot;                  </span><span class="c1">// warning: unknown option after &#39;#pragma GCC diagnostic&#39; kind</span>
<span class="cp">#pragma GCC diagnostic ignored &quot;-Wformat-nonliteral&quot;        </span><span class="c1">// warning: format not a string literal, format string not checked</span>
<span class="cp">#pragma GCC diagnostic ignored &quot;-Wclass-memaccess&quot;          </span><span class="c1">// [__GNUC__ &gt;= 8] warning: &#39;memset/memcpy&#39; clearing/writing an object of type &#39;xxxx&#39; with no trivial copy-assignment; use assignment or value-initialization instead</span>
<span class="cp">#endif</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// Data</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="c1">// Those MIN/MAX values are not define because we need to point to them</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">signed</span> <span class="kt">char</span>    <span class="n">IM_S8_MIN</span>  <span class="o">=</span> <span class="mi">-128</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">signed</span> <span class="kt">char</span>    <span class="n">IM_S8_MAX</span>  <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">IM_U8_MIN</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">IM_U8_MAX</span>  <span class="o">=</span> <span class="mh">0xFF</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">signed</span> <span class="kt">short</span>   <span class="n">IM_S16_MIN</span> <span class="o">=</span> <span class="mi">-32768</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">signed</span> <span class="kt">short</span>   <span class="n">IM_S16_MAX</span> <span class="o">=</span> <span class="mi">32767</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">IM_U16_MIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">IM_U16_MAX</span> <span class="o">=</span> <span class="mh">0xFFFF</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">ImS32</span>          <span class="n">IM_S32_MIN</span> <span class="o">=</span> <span class="n">INT_MIN</span><span class="p">;</span>    <span class="c1">// (-2147483647 - 1), (0x80000000);</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">ImS32</span>          <span class="n">IM_S32_MAX</span> <span class="o">=</span> <span class="n">INT_MAX</span><span class="p">;</span>    <span class="c1">// (2147483647), (0x7FFFFFFF)</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">ImU32</span>          <span class="n">IM_U32_MIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">ImU32</span>          <span class="n">IM_U32_MAX</span> <span class="o">=</span> <span class="n">UINT_MAX</span><span class="p">;</span>   <span class="c1">// (0xFFFFFFFF)</span>
<span class="cp">#ifdef LLONG_MIN</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">ImS64</span>          <span class="n">IM_S64_MIN</span> <span class="o">=</span> <span class="n">LLONG_MIN</span><span class="p">;</span>  <span class="c1">// (-9223372036854775807ll - 1ll);</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">ImS64</span>          <span class="n">IM_S64_MAX</span> <span class="o">=</span> <span class="n">LLONG_MAX</span><span class="p">;</span>  <span class="c1">// (9223372036854775807ll);</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">ImS64</span>          <span class="n">IM_S64_MIN</span> <span class="o">=</span> <span class="mi">-9223372036854775807LL</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">ImS64</span>          <span class="n">IM_S64_MAX</span> <span class="o">=</span> <span class="mf">9223372036854775807L</span><span class="n">L</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">ImU64</span>          <span class="n">IM_U64_MIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#ifdef ULLONG_MAX</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">ImU64</span>          <span class="n">IM_U64_MAX</span> <span class="o">=</span> <span class="n">ULLONG_MAX</span><span class="p">;</span> <span class="c1">// (0xFFFFFFFFFFFFFFFFull);</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">ImU64</span>          <span class="n">IM_U64_MAX</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2ULL</span> <span class="o">*</span> <span class="mf">9223372036854775807L</span><span class="n">L</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Forward Declarations</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="c1">// For InputTextEx()</span>
<span class="k">static</span> <span class="kt">bool</span>             <span class="nf">InputTextFilterCharacter</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">*</span> <span class="n">p_char</span><span class="p">,</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="n">ImGuiInputTextCallback</span> <span class="n">callback</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">user_data</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>              <span class="nf">InputTextCalcTextLenAndLineCount</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text_begin</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">**</span> <span class="n">out_text_end</span><span class="p">);</span>
<span class="k">static</span> <span class="n">ImVec2</span>           <span class="nf">InputTextCalcTextSizeW</span><span class="p">(</span><span class="k">const</span> <span class="n">ImWchar</span><span class="o">*</span> <span class="n">text_begin</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImWchar</span><span class="o">*</span> <span class="n">text_end</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImWchar</span><span class="o">**</span> <span class="n">remaining</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">ImVec2</span><span class="o">*</span> <span class="n">out_offset</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">stop_on_new_line</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: Text, etc.</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - TextEx() [Internal]</span>
<span class="c1">// - TextUnformatted()</span>
<span class="c1">// - Text()</span>
<span class="c1">// - TextV()</span>
<span class="c1">// - TextColored()</span>
<span class="c1">// - TextColoredV()</span>
<span class="c1">// - TextDisabled()</span>
<span class="c1">// - TextDisabledV()</span>
<span class="c1">// - TextWrapped()</span>
<span class="c1">// - TextWrappedV()</span>
<span class="c1">// - LabelText()</span>
<span class="c1">// - LabelTextV()</span>
<span class="c1">// - BulletText()</span>
<span class="c1">// - BulletTextV()</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="kt">void</span> <span class="nf">ImGui::TextEx</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text_end</span><span class="p">,</span> <span class="n">ImGuiTextFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">text</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text_begin</span> <span class="o">=</span> <span class="n">text</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">text_end</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="n">text_end</span> <span class="o">=</span> <span class="n">text</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">text</span><span class="p">);</span> <span class="c1">// FIXME-OPT</span>

    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">text_pos</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineTextBaseOffset</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">wrap_pos_x</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">TextWrapPos</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">wrap_enabled</span> <span class="o">=</span> <span class="p">(</span><span class="n">wrap_pos_x</span> <span class="o">&gt;=</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">text_end</span> <span class="o">-</span> <span class="n">text</span> <span class="o">&gt;</span> <span class="mi">2000</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">wrap_enabled</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Long text!</span>
        <span class="c1">// Perform manual coarse clipping to optimize for long multi-line text</span>
        <span class="c1">// - From this point we will only compute the width of lines that are visible. Optimization only available when word-wrapping is disabled.</span>
        <span class="c1">// - We also don&#39;t vertically center the text within the line full height, which is unlikely to matter because we are likely the biggest and only item on the line.</span>
        <span class="c1">// - We use memchr(), pay attention that well optimized versions of those str/mem functions are much faster than a casually written loop.</span>
        <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">line</span> <span class="o">=</span> <span class="n">text</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">line_height</span> <span class="o">=</span> <span class="n">GetTextLineHeight</span><span class="p">();</span>
        <span class="n">ImVec2</span> <span class="n">text_size</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

        <span class="c1">// Lines to skip (can&#39;t skip when logging text)</span>
        <span class="n">ImVec2</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">text_pos</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">LogEnabled</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">lines_skippable</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">text_pos</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">line_height</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lines_skippable</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">int</span> <span class="n">lines_skipped</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">line</span> <span class="o">&lt;</span> <span class="n">text_end</span> <span class="o">&amp;&amp;</span> <span class="n">lines_skipped</span> <span class="o">&lt;</span> <span class="n">lines_skippable</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">line_end</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">memchr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="sc">&#39;\n&#39;</span><span class="p">,</span> <span class="n">text_end</span> <span class="o">-</span> <span class="n">line</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">line_end</span><span class="p">)</span>
                        <span class="n">line_end</span> <span class="o">=</span> <span class="n">text_end</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTextFlags_NoWidthForLargeClippedText</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="n">text_size</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">text_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">line_end</span><span class="p">).</span><span class="n">x</span><span class="p">);</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">lines_skipped</span><span class="o">++</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">lines_skipped</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Lines to render</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="o">&lt;</span> <span class="n">text_end</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ImRect</span> <span class="n">line_rect</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">FLT_MAX</span><span class="p">,</span> <span class="n">line_height</span><span class="p">));</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">line</span> <span class="o">&lt;</span> <span class="n">text_end</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">IsClippedEx</span><span class="p">(</span><span class="n">line_rect</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">false</span><span class="p">))</span>
                    <span class="k">break</span><span class="p">;</span>

                <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">line_end</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">memchr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="sc">&#39;\n&#39;</span><span class="p">,</span> <span class="n">text_end</span> <span class="o">-</span> <span class="n">line</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">line_end</span><span class="p">)</span>
                    <span class="n">line_end</span> <span class="o">=</span> <span class="n">text_end</span><span class="p">;</span>
                <span class="n">text_size</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">text_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">line_end</span><span class="p">).</span><span class="n">x</span><span class="p">);</span>
                <span class="n">RenderText</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">line_end</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">line_rect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">line_height</span><span class="p">;</span>
                <span class="n">line_rect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">line_height</span><span class="p">;</span>
                <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">line_height</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// Count remaining lines</span>
            <span class="kt">int</span> <span class="n">lines_skipped</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">line</span> <span class="o">&lt;</span> <span class="n">text_end</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">line_end</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">memchr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="sc">&#39;\n&#39;</span><span class="p">,</span> <span class="n">text_end</span> <span class="o">-</span> <span class="n">line</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">line_end</span><span class="p">)</span>
                    <span class="n">line_end</span> <span class="o">=</span> <span class="n">text_end</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTextFlags_NoWidthForLargeClippedText</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">text_size</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">text_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">line_end</span><span class="p">).</span><span class="n">x</span><span class="p">);</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">lines_skipped</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">lines_skipped</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">text_size</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="n">text_pos</span><span class="p">).</span><span class="n">y</span><span class="p">;</span>

        <span class="n">ImRect</span> <span class="n">bb</span><span class="p">(</span><span class="n">text_pos</span><span class="p">,</span> <span class="n">text_pos</span> <span class="o">+</span> <span class="n">text_size</span><span class="p">);</span>
        <span class="n">ItemSize</span><span class="p">(</span><span class="n">text_size</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">wrap_width</span> <span class="o">=</span> <span class="n">wrap_enabled</span> <span class="o">?</span> <span class="n">CalcWrapWidthForPos</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">wrap_pos_x</span><span class="p">)</span> <span class="o">:</span> <span class="mf">0.0f</span><span class="p">;</span>
        <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">text_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">text_begin</span><span class="p">,</span> <span class="n">text_end</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="n">wrap_width</span><span class="p">);</span>

        <span class="n">ImRect</span> <span class="n">bb</span><span class="p">(</span><span class="n">text_pos</span><span class="p">,</span> <span class="n">text_pos</span> <span class="o">+</span> <span class="n">text_size</span><span class="p">);</span>
        <span class="n">ItemSize</span><span class="p">(</span><span class="n">text_size</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="k">return</span><span class="p">;</span>

        <span class="c1">// Render (we don&#39;t hide text after ## in this end-user function)</span>
        <span class="n">RenderTextWrapped</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">text_begin</span><span class="p">,</span> <span class="n">text_end</span><span class="p">,</span> <span class="n">wrap_width</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::TextUnformatted</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text_end</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">TextEx</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">text_end</span><span class="p">,</span> <span class="n">ImGuiTextFlags_NoWidthForLargeClippedText</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::Text</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
    <span class="kt">va_list</span> <span class="n">args</span><span class="p">;</span>
    <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>
    <span class="n">TextV</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::TextV</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="kt">va_list</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text_end</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span> <span class="o">+</span> <span class="n">ImFormatStringV</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">TextEx</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">,</span> <span class="n">text_end</span><span class="p">,</span> <span class="n">ImGuiTextFlags_NoWidthForLargeClippedText</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::TextColored</span><span class="p">(</span><span class="k">const</span> <span class="n">ImVec4</span><span class="o">&amp;</span> <span class="n">col</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
    <span class="kt">va_list</span> <span class="n">args</span><span class="p">;</span>
    <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>
    <span class="n">TextColoredV</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::TextColoredV</span><span class="p">(</span><span class="k">const</span> <span class="n">ImVec4</span><span class="o">&amp;</span> <span class="n">col</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="kt">va_list</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">PushStyleColor</span><span class="p">(</span><span class="n">ImGuiCol_Text</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;%&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;s&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">TextEx</span><span class="p">(</span><span class="n">va_arg</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">ImGuiTextFlags_NoWidthForLargeClippedText</span><span class="p">);</span> <span class="c1">// Skip formatting</span>
    <span class="k">else</span>
        <span class="n">TextV</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">PopStyleColor</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::TextDisabled</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
    <span class="kt">va_list</span> <span class="n">args</span><span class="p">;</span>
    <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>
    <span class="n">TextDisabledV</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::TextDisabledV</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="kt">va_list</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">PushStyleColor</span><span class="p">(</span><span class="n">ImGuiCol_Text</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">Colors</span><span class="p">[</span><span class="n">ImGuiCol_TextDisabled</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;%&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;s&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">TextEx</span><span class="p">(</span><span class="n">va_arg</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">ImGuiTextFlags_NoWidthForLargeClippedText</span><span class="p">);</span> <span class="c1">// Skip formatting</span>
    <span class="k">else</span>
        <span class="n">TextV</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">PopStyleColor</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::TextWrapped</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
    <span class="kt">va_list</span> <span class="n">args</span><span class="p">;</span>
    <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>
    <span class="n">TextWrappedV</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::TextWrappedV</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="kt">va_list</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">need_backup</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">TextWrapPos</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">);</span>  <span class="c1">// Keep existing wrap position if one is already set</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">need_backup</span><span class="p">)</span>
        <span class="n">PushTextWrapPos</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;%&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;s&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">TextEx</span><span class="p">(</span><span class="n">va_arg</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">ImGuiTextFlags_NoWidthForLargeClippedText</span><span class="p">);</span> <span class="c1">// Skip formatting</span>
    <span class="k">else</span>
        <span class="n">TextV</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">need_backup</span><span class="p">)</span>
        <span class="n">PopTextWrapPos</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::LabelText</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
    <span class="kt">va_list</span> <span class="n">args</span><span class="p">;</span>
    <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>
    <span class="n">LabelTextV</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Add a label+text combo aligned to other label+value widgets</span>
<span class="kt">void</span> <span class="nf">ImGui::LabelTextV</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="kt">va_list</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">w</span> <span class="o">=</span> <span class="n">CalcItemWidth</span><span class="p">();</span>

    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="n">value_bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">label_size</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">));</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="n">total_bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">w</span> <span class="o">+</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">),</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">label_size</span><span class="p">);</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="c1">// Render</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">value_text_begin</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">value_text_end</span> <span class="o">=</span> <span class="n">value_text_begin</span> <span class="o">+</span> <span class="n">ImFormatStringV</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">RenderTextClipped</span><span class="p">(</span><span class="n">value_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">value_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">value_text_begin</span><span class="p">,</span> <span class="n">value_text_end</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="n">RenderText</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">value_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">value_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">label</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::BulletText</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
    <span class="kt">va_list</span> <span class="n">args</span><span class="p">;</span>
    <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>
    <span class="n">BulletTextV</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Text with a little bullet aligned to the typical tree node.</span>
<span class="kt">void</span> <span class="nf">ImGui::BulletTextV</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="kt">va_list</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text_begin</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text_end</span> <span class="o">=</span> <span class="n">text_begin</span> <span class="o">+</span> <span class="n">ImFormatStringV</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">text_begin</span><span class="p">,</span> <span class="n">text_end</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">total_size</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">:</span> <span class="mf">0.0f</span><span class="p">),</span> <span class="n">label_size</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>  <span class="c1">// Empty text doesn&#39;t add padding</span>
    <span class="n">ImVec2</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">;</span>
    <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineTextBaseOffset</span><span class="p">;</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">total_size</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="n">bb</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">total_size</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="c1">// Render</span>
    <span class="n">ImU32</span> <span class="n">text_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_Text</span><span class="p">);</span>
    <span class="n">RenderBullet</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">),</span> <span class="n">text_col</span><span class="p">);</span>
    <span class="n">RenderText</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">),</span> <span class="n">text_begin</span><span class="p">,</span> <span class="n">text_end</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: Main</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - ButtonBehavior() [Internal]</span>
<span class="c1">// - Button()</span>
<span class="c1">// - SmallButton()</span>
<span class="c1">// - InvisibleButton()</span>
<span class="c1">// - ArrowButton()</span>
<span class="c1">// - CloseButton() [Internal]</span>
<span class="c1">// - CollapseButton() [Internal]</span>
<span class="c1">// - GetWindowScrollbarID() [Internal]</span>
<span class="c1">// - GetWindowScrollbarRect() [Internal]</span>
<span class="c1">// - Scrollbar() [Internal]</span>
<span class="c1">// - ScrollbarEx() [Internal]</span>
<span class="c1">// - Image()</span>
<span class="c1">// - ImageButton()</span>
<span class="c1">// - Checkbox()</span>
<span class="c1">// - CheckboxFlagsT() [Internal]</span>
<span class="c1">// - CheckboxFlags()</span>
<span class="c1">// - RadioButton()</span>
<span class="c1">// - ProgressBar()</span>
<span class="c1">// - Bullet()</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="c1">// The ButtonBehavior() function is key to many interactions and used by many/most widgets.</span>
<span class="c1">// Because we handle so many cases (keyboard/gamepad navigation, drag and drop) and many specific behavior (via ImGuiButtonFlags_),</span>
<span class="c1">// this code is a little complex.</span>
<span class="c1">// By far the most common path is interacting with the Mouse using the default ImGuiButtonFlags_PressedOnClickRelease button behavior.</span>
<span class="c1">// See the series of events below and the corresponding state reported by dear imgui:</span>
<span class="c1">//------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="c1">// with PressedOnClickRelease:             return-value  IsItemHovered()  IsItemActive()  IsItemActivated()  IsItemDeactivated()  IsItemClicked()</span>
<span class="c1">//   Frame N+0 (mouse is outside bb)        -             -                -               -                  -                    -</span>
<span class="c1">//   Frame N+1 (mouse moves inside bb)      -             true             -               -                  -                    -</span>
<span class="c1">//   Frame N+2 (mouse button is down)       -             true             true            true               -                    true</span>
<span class="c1">//   Frame N+3 (mouse button is down)       -             true             true            -                  -                    -</span>
<span class="c1">//   Frame N+4 (mouse moves outside bb)     -             -                true            -                  -                    -</span>
<span class="c1">//   Frame N+5 (mouse moves inside bb)      -             true             true            -                  -                    -</span>
<span class="c1">//   Frame N+6 (mouse button is released)   true          true             -               -                  true                 -</span>
<span class="c1">//   Frame N+7 (mouse button is released)   -             true             -               -                  -                    -</span>
<span class="c1">//   Frame N+8 (mouse moves outside bb)     -             -                -               -                  -                    -</span>
<span class="c1">//------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="c1">// with PressedOnClick:                    return-value  IsItemHovered()  IsItemActive()  IsItemActivated()  IsItemDeactivated()  IsItemClicked()</span>
<span class="c1">//   Frame N+2 (mouse button is down)       true          true             true            true               -                    true</span>
<span class="c1">//   Frame N+3 (mouse button is down)       -             true             true            -                  -                    -</span>
<span class="c1">//   Frame N+6 (mouse button is released)   -             true             -               -                  true                 -</span>
<span class="c1">//   Frame N+7 (mouse button is released)   -             true             -               -                  -                    -</span>
<span class="c1">//------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="c1">// with PressedOnRelease:                  return-value  IsItemHovered()  IsItemActive()  IsItemActivated()  IsItemDeactivated()  IsItemClicked()</span>
<span class="c1">//   Frame N+2 (mouse button is down)       -             true             -               -                  -                    true</span>
<span class="c1">//   Frame N+3 (mouse button is down)       -             true             -               -                  -                    -</span>
<span class="c1">//   Frame N+6 (mouse button is released)   true          true             -               -                  -                    -</span>
<span class="c1">//   Frame N+7 (mouse button is released)   -             true             -               -                  -                    -</span>
<span class="c1">//------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="c1">// with PressedOnDoubleClick:              return-value  IsItemHovered()  IsItemActive()  IsItemActivated()  IsItemDeactivated()  IsItemClicked()</span>
<span class="c1">//   Frame N+0 (mouse button is down)       -             true             -               -                  -                    true</span>
<span class="c1">//   Frame N+1 (mouse button is down)       -             true             -               -                  -                    -</span>
<span class="c1">//   Frame N+2 (mouse button is released)   -             true             -               -                  -                    -</span>
<span class="c1">//   Frame N+3 (mouse button is released)   -             true             -               -                  -                    -</span>
<span class="c1">//   Frame N+4 (mouse button is down)       true          true             true            true               -                    true</span>
<span class="c1">//   Frame N+5 (mouse button is down)       -             true             true            -                  -                    -</span>
<span class="c1">//   Frame N+6 (mouse button is released)   -             true             -               -                  true                 -</span>
<span class="c1">//   Frame N+7 (mouse button is released)   -             true             -               -                  -                    -</span>
<span class="c1">//------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="c1">// Note that some combinations are supported,</span>
<span class="c1">// - PressedOnDragDropHold can generally be associated with any flag.</span>
<span class="c1">// - PressedOnDoubleClick can be associated by PressedOnClickRelease/PressedOnRelease, in which case the second release event won&#39;t be reported.</span>
<span class="c1">//------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="c1">// The behavior of the return-value changes when ImGuiButtonFlags_Repeat is set:</span>
<span class="c1">//                                         Repeat+                  Repeat+           Repeat+             Repeat+</span>
<span class="c1">//                                         PressedOnClickRelease    PressedOnClick    PressedOnRelease    PressedOnDoubleClick</span>
<span class="c1">//-------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="c1">//   Frame N+0 (mouse button is down)       -                        true              -                   true</span>
<span class="c1">//   ...                                    -                        -                 -                   -</span>
<span class="c1">//   Frame N + RepeatDelay                  true                     true              -                   true</span>
<span class="c1">//   ...                                    -                        -                 -                   -</span>
<span class="c1">//   Frame N + RepeatDelay + RepeatRate*N   true                     true              -                   true</span>
<span class="c1">//-------------------------------------------------------------------------------------------------------------------------------------------------</span>

<span class="kt">bool</span> <span class="nf">ImGui::ButtonBehavior</span><span class="p">(</span><span class="k">const</span> <span class="n">ImRect</span><span class="o">&amp;</span> <span class="n">bb</span><span class="p">,</span> <span class="n">ImGuiID</span> <span class="n">id</span><span class="p">,</span> <span class="kt">bool</span><span class="o">*</span> <span class="n">out_hovered</span><span class="p">,</span> <span class="kt">bool</span><span class="o">*</span> <span class="n">out_held</span><span class="p">,</span> <span class="n">ImGuiButtonFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_Disabled</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">out_hovered</span><span class="p">)</span> <span class="o">*</span><span class="n">out_hovered</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">out_held</span><span class="p">)</span> <span class="o">*</span><span class="n">out_held</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span> <span class="n">ClearActiveID</span><span class="p">();</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Default only reacts to left mouse button</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_MouseButtonMask_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_MouseButtonDefault_</span><span class="p">;</span>

    <span class="c1">// Default behavior requires click + release inside bounding box</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_PressedOnMask_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_PressedOnDefault_</span><span class="p">;</span>

    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">backup_hovered_window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredWindow</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">flatten_hovered_children</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_FlattenChildren</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredRootWindow</span> <span class="o">==</span> <span class="n">window</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flatten_hovered_children</span><span class="p">)</span>
        <span class="n">g</span><span class="p">.</span><span class="n">HoveredWindow</span> <span class="o">=</span> <span class="n">window</span><span class="p">;</span>

<span class="cp">#ifdef IMGUI_ENABLE_TEST_ENGINE</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemId</span> <span class="o">!=</span> <span class="n">id</span><span class="p">)</span>
        <span class="n">IMGUI_TEST_ENGINE_ITEM_ADD</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
<span class="cp">#endif</span>

    <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">hovered</span> <span class="o">=</span> <span class="n">ItemHoverable</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>

    <span class="c1">// Drag source doesn&#39;t report as hovered</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">DragDropActive</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">DragDropPayload</span><span class="p">.</span><span class="n">SourceId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">DragDropSourceFlags</span> <span class="o">&amp;</span> <span class="n">ImGuiDragDropFlags_SourceNoDisableHover</span><span class="p">))</span>
        <span class="n">hovered</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Special mode for Drag and Drop where holding button pressed for a long time while dragging another item triggers the button</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">DragDropActive</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_PressedOnDragDropHold</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">DragDropSourceFlags</span> <span class="o">&amp;</span> <span class="n">ImGuiDragDropFlags_SourceNoHoldToOpenOthers</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">IsItemHovered</span><span class="p">(</span><span class="n">ImGuiHoveredFlags_AllowWhenBlockedByActiveItem</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">DRAG_DROP_HOLD_TIMER</span> <span class="o">=</span> <span class="mf">0.70f</span><span class="p">;</span>
            <span class="n">hovered</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="n">SetHoveredID</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">CalcTypematicRepeatAmount</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">HoveredIdTimer</span> <span class="o">+</span> <span class="mf">0.0001f</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">DeltaTime</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredIdTimer</span> <span class="o">+</span> <span class="mf">0.0001f</span><span class="p">,</span> <span class="n">DRAG_DROP_HOLD_TIMER</span><span class="p">,</span> <span class="mf">0.00f</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">pressed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                <span class="n">g</span><span class="p">.</span><span class="n">DragDropHoldJustPressedId</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
                <span class="n">FocusWindow</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">flatten_hovered_children</span><span class="p">)</span>
        <span class="n">g</span><span class="p">.</span><span class="n">HoveredWindow</span> <span class="o">=</span> <span class="n">backup_hovered_window</span><span class="p">;</span>

    <span class="c1">// AllowOverlap mode (rarely used) requires previous frame HoveredId to be null or to match. This allows using patterns where a later submitted widget overlaps a previous one.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_AllowItemOverlap</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">HoveredIdPreviousFrame</span> <span class="o">!=</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredIdPreviousFrame</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">hovered</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Mouse handling</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">hovered</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_NoKeyModifiers</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyCtrl</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyShift</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyAlt</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// Poll buttons</span>
            <span class="kt">int</span> <span class="n">mouse_button_clicked</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">mouse_button_released</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_MouseButtonLeft</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseClicked</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>         <span class="p">{</span> <span class="n">mouse_button_clicked</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_MouseButtonRight</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseClicked</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>   <span class="p">{</span> <span class="n">mouse_button_clicked</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_MouseButtonMiddle</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseClicked</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>  <span class="p">{</span> <span class="n">mouse_button_clicked</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_MouseButtonLeft</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseReleased</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>        <span class="p">{</span> <span class="n">mouse_button_released</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_MouseButtonRight</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseReleased</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="p">{</span> <span class="n">mouse_button_released</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_MouseButtonMiddle</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseReleased</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span> <span class="n">mouse_button_released</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">mouse_button_clicked</span> <span class="o">!=</span> <span class="mi">-1</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">!=</span> <span class="n">id</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiButtonFlags_PressedOnClickRelease</span> <span class="o">|</span> <span class="n">ImGuiButtonFlags_PressedOnClickReleaseAnywhere</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">SetActiveID</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">window</span><span class="p">);</span>
                    <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdMouseButton</span> <span class="o">=</span> <span class="n">mouse_button_clicked</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_NoNavFocus</span><span class="p">))</span>
                        <span class="n">SetFocusID</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">window</span><span class="p">);</span>
                    <span class="n">FocusWindow</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_PressedOnClick</span><span class="p">)</span> <span class="o">||</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_PressedOnDoubleClick</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseDoubleClicked</span><span class="p">[</span><span class="n">mouse_button_clicked</span><span class="p">]))</span>
                <span class="p">{</span>
                    <span class="n">pressed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_NoHoldingActiveId</span><span class="p">)</span>
                        <span class="n">ClearActiveID</span><span class="p">();</span>
                    <span class="k">else</span>
                        <span class="n">SetActiveID</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">window</span><span class="p">);</span> <span class="c1">// Hold on ID</span>
                    <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdMouseButton</span> <span class="o">=</span> <span class="n">mouse_button_clicked</span><span class="p">;</span>
                    <span class="n">FocusWindow</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_PressedOnRelease</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">mouse_button_released</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// Repeat mode trumps on release behavior</span>
                <span class="k">const</span> <span class="kt">bool</span> <span class="n">has_repeated_at_least_once</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_Repeat</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseDownDurationPrev</span><span class="p">[</span><span class="n">mouse_button_released</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyRepeatDelay</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">has_repeated_at_least_once</span><span class="p">)</span>
                    <span class="n">pressed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                <span class="n">ClearActiveID</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="c1">// &#39;Repeat&#39; mode acts when held regardless of _PressedOn flags (see table above).</span>
            <span class="c1">// Relies on repeat logic of IsMouseClicked() but we may as well do it ourselves if we end up exposing finer RepeatDelay/RepeatRate settings.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_Repeat</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseDownDuration</span><span class="p">[</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdMouseButton</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">&amp;&amp;</span> <span class="n">IsMouseClicked</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdMouseButton</span><span class="p">,</span> <span class="nb">true</span><span class="p">))</span>
                    <span class="n">pressed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">pressed</span><span class="p">)</span>
            <span class="n">g</span><span class="p">.</span><span class="n">NavDisableHighlight</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Gamepad/Keyboard navigation</span>
    <span class="c1">// We report navigated item as hovered but we don&#39;t set g.HoveredId to not interfere with mouse.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">NavDisableHighlight</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavDisableMouseHover</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">MoveId</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_NoHoveredOnFocus</span><span class="p">))</span>
            <span class="n">hovered</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavActivateDownId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">nav_activated_by_code</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavActivateId</span> <span class="o">==</span> <span class="n">id</span><span class="p">);</span>
        <span class="kt">bool</span> <span class="n">nav_activated_by_inputs</span> <span class="o">=</span> <span class="n">IsNavInputTest</span><span class="p">(</span><span class="n">ImGuiNavInput_Activate</span><span class="p">,</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_Repeat</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiInputReadMode_Repeat</span> <span class="p">:</span> <span class="n">ImGuiInputReadMode_Pressed</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nav_activated_by_code</span> <span class="o">||</span> <span class="n">nav_activated_by_inputs</span><span class="p">)</span>
            <span class="n">pressed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nav_activated_by_code</span> <span class="o">||</span> <span class="n">nav_activated_by_inputs</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Set active id so it can be queried by user via IsItemActive(), equivalent of holding the mouse button.</span>
            <span class="n">g</span><span class="p">.</span><span class="n">NavActivateId</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span> <span class="c1">// This is so SetActiveId assign a Nav source</span>
            <span class="n">SetActiveID</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">window</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">nav_activated_by_code</span> <span class="o">||</span> <span class="n">nav_activated_by_inputs</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_NoNavFocus</span><span class="p">))</span>
                <span class="n">SetFocusID</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">window</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Process while held</span>
    <span class="kt">bool</span> <span class="n">held</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdSource</span> <span class="o">==</span> <span class="n">ImGuiInputSource_Mouse</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdIsJustActivated</span><span class="p">)</span>
                <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdClickOffset</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MousePos</span> <span class="o">-</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">;</span>

            <span class="k">const</span> <span class="kt">int</span> <span class="n">mouse_button</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdMouseButton</span><span class="p">;</span>
            <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">mouse_button</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">mouse_button</span> <span class="o">&lt;</span> <span class="n">ImGuiMouseButton_COUNT</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">[</span><span class="n">mouse_button</span><span class="p">])</span>
            <span class="p">{</span>
                <span class="n">held</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="kt">bool</span> <span class="n">release_in</span> <span class="o">=</span> <span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_PressedOnClickRelease</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="kt">bool</span> <span class="n">release_anywhere</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_PressedOnClickReleaseAnywhere</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">release_in</span> <span class="o">||</span> <span class="n">release_anywhere</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">DragDropActive</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// Report as pressed when releasing the mouse (this is the most common path)</span>
                    <span class="kt">bool</span> <span class="n">is_double_click_release</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_PressedOnDoubleClick</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseDownWasDoubleClick</span><span class="p">[</span><span class="n">mouse_button</span><span class="p">];</span>
                    <span class="kt">bool</span> <span class="n">is_repeating_already</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_Repeat</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseDownDurationPrev</span><span class="p">[</span><span class="n">mouse_button</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyRepeatDelay</span><span class="p">;</span> <span class="c1">// Repeat mode trumps &lt;on release&gt;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_double_click_release</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_repeating_already</span><span class="p">)</span>
                        <span class="n">pressed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">ClearActiveID</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_NoNavFocus</span><span class="p">))</span>
                <span class="n">g</span><span class="p">.</span><span class="n">NavDisableHighlight</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdSource</span> <span class="o">==</span> <span class="n">ImGuiInputSource_Nav</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// When activated using Nav, we hold on the ActiveID until activation button is released</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavActivateDownId</span> <span class="o">!=</span> <span class="n">id</span><span class="p">)</span>
                <span class="n">ClearActiveID</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pressed</span><span class="p">)</span>
            <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdHasBeenPressedBefore</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">out_hovered</span><span class="p">)</span> <span class="o">*</span><span class="n">out_hovered</span> <span class="o">=</span> <span class="n">hovered</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">out_held</span><span class="p">)</span> <span class="o">*</span><span class="n">out_held</span> <span class="o">=</span> <span class="n">held</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">ImGui::ButtonEx</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size_arg</span><span class="p">,</span> <span class="n">ImGuiButtonFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

    <span class="n">ImVec2</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_AlignTextBaseLine</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineTextBaseOffset</span><span class="p">)</span> <span class="c1">// Try to vertically align buttons that are smaller/have no padding so that text baseline matches (bit hacky, since it shouldn&#39;t be a flag)</span>
        <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineTextBaseOffset</span> <span class="o">-</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="n">ImVec2</span> <span class="n">size</span> <span class="o">=</span> <span class="n">CalcItemSize</span><span class="p">(</span><span class="n">size_arg</span><span class="p">,</span> <span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">,</span> <span class="n">label_size</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">);</span>

    <span class="k">const</span> <span class="n">ImRect</span> <span class="n">bb</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">size</span><span class="p">);</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">&amp;</span> <span class="n">ImGuiItemFlags_ButtonRepeat</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_Repeat</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">hovered</span><span class="p">,</span> <span class="n">held</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

    <span class="c1">// Render</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">((</span><span class="n">held</span> <span class="o">&amp;&amp;</span> <span class="n">hovered</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiCol_ButtonActive</span> <span class="p">:</span> <span class="n">hovered</span> <span class="o">?</span> <span class="nl">ImGuiCol_ButtonHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_Button</span><span class="p">);</span>
    <span class="n">RenderNavHighlight</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="n">RenderFrame</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">);</span>
    <span class="n">RenderTextClipped</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span> <span class="o">-</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">label_size</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">ButtonTextAlign</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bb</span><span class="p">);</span>

    <span class="c1">// Automatically close popups</span>
    <span class="c1">//if (pressed &amp;&amp; !(flags &amp; ImGuiButtonFlags_DontClosePopups) &amp;&amp; (window-&gt;Flags &amp; ImGuiWindowFlags_Popup))</span>
    <span class="c1">//    CloseCurrentPopup();</span>

    <span class="n">IMGUI_TEST_ENGINE_ITEM_INFO</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemStatusFlags</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">ImGui::Button</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size_arg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">ButtonEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">size_arg</span><span class="p">,</span> <span class="n">ImGuiButtonFlags_None</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Small buttons fits within text without additional vertical spacing.</span>
<span class="kt">bool</span> <span class="nf">ImGui::SmallButton</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">backup_padding_y</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="n">ButtonEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">ImGuiButtonFlags_AlignTextBaseLine</span><span class="p">);</span>
    <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">backup_padding_y</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Tip: use ImGui::PushID()/PopID() to push indices or pointers in the ID stack.</span>
<span class="c1">// Then you can keep &#39;str_id&#39; empty or the same for all your buttons (instead of creating a string based on a non-string id)</span>
<span class="kt">bool</span> <span class="nf">ImGui::InvisibleButton</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str_id</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size_arg</span><span class="p">,</span> <span class="n">ImGuiButtonFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Cannot use zero-size for InvisibleButton(). Unlike Button() there is not way to fallback using the label size.</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">size_arg</span><span class="p">.</span><span class="n">x</span> <span class="o">!=</span> <span class="mf">0.0f</span> <span class="o">&amp;&amp;</span> <span class="n">size_arg</span><span class="p">.</span><span class="n">y</span> <span class="o">!=</span> <span class="mf">0.0f</span><span class="p">);</span>

    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">str_id</span><span class="p">);</span>
    <span class="n">ImVec2</span> <span class="n">size</span> <span class="o">=</span> <span class="n">CalcItemSize</span><span class="p">(</span><span class="n">size_arg</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="n">bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">size</span><span class="p">);</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">hovered</span><span class="p">,</span> <span class="n">held</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">ImGui::ArrowButtonEx</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str_id</span><span class="p">,</span> <span class="n">ImGuiDir</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ImVec2</span> <span class="n">size</span><span class="p">,</span> <span class="n">ImGuiButtonFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">str_id</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="n">bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">size</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">default_size</span> <span class="o">=</span> <span class="n">GetFrameHeight</span><span class="p">();</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">default_size</span><span class="p">)</span> <span class="o">?</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="nl">y</span> <span class="p">:</span> <span class="mf">-1.0f</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">&amp;</span> <span class="n">ImGuiItemFlags_ButtonRepeat</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_Repeat</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">hovered</span><span class="p">,</span> <span class="n">held</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

    <span class="c1">// Render</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">bg_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">((</span><span class="n">held</span> <span class="o">&amp;&amp;</span> <span class="n">hovered</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiCol_ButtonActive</span> <span class="p">:</span> <span class="n">hovered</span> <span class="o">?</span> <span class="nl">ImGuiCol_ButtonHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_Button</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">text_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_Text</span><span class="p">);</span>
    <span class="n">RenderNavHighlight</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="n">RenderFrame</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">bg_col</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">);</span>
    <span class="n">RenderArrow</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">ImMax</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">),</span> <span class="n">ImMax</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">)),</span> <span class="n">text_col</span><span class="p">,</span> <span class="n">dir</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">ImGui::ArrowButton</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str_id</span><span class="p">,</span> <span class="n">ImGuiDir</span> <span class="n">dir</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">GetFrameHeight</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">ArrowButtonEx</span><span class="p">(</span><span class="n">str_id</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">sz</span><span class="p">,</span> <span class="n">sz</span><span class="p">),</span> <span class="n">ImGuiButtonFlags_None</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Button to close a window</span>
<span class="kt">bool</span> <span class="nf">ImGui::CloseButton</span><span class="p">(</span><span class="n">ImGuiID</span> <span class="n">id</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">pos</span><span class="p">)</span><span class="c1">//, float size)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>

    <span class="c1">// We intentionally allow interaction when clipped so that a mechanical Alt,Right,Validate sequence close a window.</span>
    <span class="c1">// (this isn&#39;t the regular behavior of buttons, but it doesn&#39;t affect the user much because navigation tends to keep items visible).</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="n">bb</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">)</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">is_clipped</span> <span class="o">=</span> <span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>

    <span class="kt">bool</span> <span class="n">hovered</span><span class="p">,</span> <span class="n">held</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_clipped</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>

    <span class="c1">// Render</span>
    <span class="n">ImU32</span> <span class="n">col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">held</span> <span class="o">?</span> <span class="nl">ImGuiCol_ButtonActive</span> <span class="p">:</span> <span class="n">ImGuiCol_ButtonHovered</span><span class="p">);</span>
    <span class="n">ImVec2</span> <span class="n">center</span> <span class="o">=</span> <span class="n">bb</span><span class="p">.</span><span class="n">GetCenter</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">hovered</span><span class="p">)</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddCircleFilled</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">ImMax</span><span class="p">(</span><span class="mf">2.0f</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">0.5f</span> <span class="o">+</span> <span class="mf">1.0f</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">cross_extent</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">0.5f</span> <span class="o">*</span> <span class="mf">0.7071f</span> <span class="o">-</span> <span class="mf">1.0f</span><span class="p">;</span>
    <span class="n">ImU32</span> <span class="n">cross_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_Text</span><span class="p">);</span>
    <span class="n">center</span> <span class="o">-=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddLine</span><span class="p">(</span><span class="n">center</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="o">+</span><span class="n">cross_extent</span><span class="p">,</span> <span class="o">+</span><span class="n">cross_extent</span><span class="p">),</span> <span class="n">center</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="o">-</span><span class="n">cross_extent</span><span class="p">,</span> <span class="o">-</span><span class="n">cross_extent</span><span class="p">),</span> <span class="n">cross_col</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddLine</span><span class="p">(</span><span class="n">center</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="o">+</span><span class="n">cross_extent</span><span class="p">,</span> <span class="o">-</span><span class="n">cross_extent</span><span class="p">),</span> <span class="n">center</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="o">-</span><span class="n">cross_extent</span><span class="p">,</span> <span class="o">+</span><span class="n">cross_extent</span><span class="p">),</span> <span class="n">cross_col</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">ImGui::CollapseButton</span><span class="p">(</span><span class="n">ImGuiID</span> <span class="n">id</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">pos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>

    <span class="n">ImRect</span> <span class="n">bb</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">)</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">);</span>
    <span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">hovered</span><span class="p">,</span> <span class="n">held</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">,</span> <span class="n">ImGuiButtonFlags_None</span><span class="p">);</span>

    <span class="c1">// Render</span>
    <span class="n">ImU32</span> <span class="n">bg_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">((</span><span class="n">held</span> <span class="o">&amp;&amp;</span> <span class="n">hovered</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiCol_ButtonActive</span> <span class="p">:</span> <span class="n">hovered</span> <span class="o">?</span> <span class="nl">ImGuiCol_ButtonHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_Button</span><span class="p">);</span>
    <span class="n">ImU32</span> <span class="n">text_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_Text</span><span class="p">);</span>
    <span class="n">ImVec2</span> <span class="n">center</span> <span class="o">=</span> <span class="n">bb</span><span class="p">.</span><span class="n">GetCenter</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">hovered</span> <span class="o">||</span> <span class="n">held</span><span class="p">)</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddCircleFilled</span><span class="p">(</span><span class="n">center</span><span class="cm">/*+ ImVec2(0.0f, -0.5f)*/</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">0.5f</span> <span class="o">+</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="n">bg_col</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
    <span class="n">RenderArrow</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">,</span> <span class="n">text_col</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">Collapsed</span> <span class="o">?</span> <span class="nl">ImGuiDir_Right</span> <span class="p">:</span> <span class="n">ImGuiDir_Down</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>

    <span class="c1">// Switch to moving the window after mouse is moved beyond the initial drag threshold</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">IsItemActive</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">IsMouseDragging</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">StartMouseMovingWindow</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ImGuiID</span> <span class="nf">ImGui::GetWindowScrollbarID</span><span class="p">(</span><span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span><span class="p">,</span> <span class="n">ImGuiAxis</span> <span class="n">axis</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetIDNoKeepAlive</span><span class="p">(</span><span class="n">axis</span> <span class="o">==</span> <span class="n">ImGuiAxis_X</span> <span class="o">?</span> <span class="s">&quot;#SCROLLX&quot;</span> <span class="o">:</span> <span class="s">&quot;#SCROLLY&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Return scrollbar rectangle, must only be called for corresponding axis if window-&gt;ScrollbarX/Y is set.</span>
<span class="n">ImRect</span> <span class="nf">ImGui::GetWindowScrollbarRect</span><span class="p">(</span><span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span><span class="p">,</span> <span class="n">ImGuiAxis</span> <span class="n">axis</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="n">outer_rect</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">Rect</span><span class="p">();</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="n">inner_rect</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">InnerRect</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">border_size</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowBorderSize</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">scrollbar_size</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ScrollbarSizes</span><span class="p">[</span><span class="n">axis</span> <span class="o">^</span> <span class="mi">1</span><span class="p">];</span> <span class="c1">// (ScrollbarSizes.x = width of Y scrollbar; ScrollbarSizes.y = height of X scrollbar)</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">scrollbar_size</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">axis</span> <span class="o">==</span> <span class="n">ImGuiAxis_X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ImRect</span><span class="p">(</span><span class="n">inner_rect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">outer_rect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">outer_rect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">border_size</span> <span class="o">-</span> <span class="n">scrollbar_size</span><span class="p">),</span> <span class="n">inner_rect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">outer_rect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="n">ImRect</span><span class="p">(</span><span class="n">ImMax</span><span class="p">(</span><span class="n">outer_rect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">outer_rect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">border_size</span> <span class="o">-</span> <span class="n">scrollbar_size</span><span class="p">),</span> <span class="n">inner_rect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">outer_rect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">inner_rect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::Scrollbar</span><span class="p">(</span><span class="n">ImGuiAxis</span> <span class="n">axis</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">GetWindowScrollbarID</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">axis</span><span class="p">);</span>
    <span class="n">KeepAliveID</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

    <span class="c1">// Calculate scrollbar bounding box</span>
    <span class="n">ImRect</span> <span class="n">bb</span> <span class="o">=</span> <span class="n">GetWindowScrollbarRect</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">axis</span><span class="p">);</span>
    <span class="n">ImDrawCornerFlags</span> <span class="n">rounding_corners</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">axis</span> <span class="o">==</span> <span class="n">ImGuiAxis_X</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">rounding_corners</span> <span class="o">|=</span> <span class="n">ImDrawCornerFlags_BotLeft</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">ScrollbarY</span><span class="p">)</span>
            <span class="n">rounding_corners</span> <span class="o">|=</span> <span class="n">ImDrawCornerFlags_BotRight</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiWindowFlags_NoTitleBar</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiWindowFlags_MenuBar</span><span class="p">))</span>
            <span class="n">rounding_corners</span> <span class="o">|=</span> <span class="n">ImDrawCornerFlags_TopRight</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">ScrollbarX</span><span class="p">)</span>
            <span class="n">rounding_corners</span> <span class="o">|=</span> <span class="n">ImDrawCornerFlags_BotRight</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">float</span> <span class="n">size_avail</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">InnerRect</span><span class="p">.</span><span class="n">Max</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">-</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">InnerRect</span><span class="p">.</span><span class="n">Min</span><span class="p">[</span><span class="n">axis</span><span class="p">];</span>
    <span class="kt">float</span> <span class="n">size_contents</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ContentSize</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowPadding</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">;</span>
    <span class="n">ScrollbarEx</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Scroll</span><span class="p">[</span><span class="n">axis</span><span class="p">],</span> <span class="n">size_avail</span><span class="p">,</span> <span class="n">size_contents</span><span class="p">,</span> <span class="n">rounding_corners</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Vertical/Horizontal scrollbar</span>
<span class="c1">// The entire piece of code below is rather confusing because:</span>
<span class="c1">// - We handle absolute seeking (when first clicking outside the grab) and relative manipulation (afterward or when clicking inside the grab)</span>
<span class="c1">// - We store values as normalized ratio and in a form that allows the window content to change while we are holding on a scrollbar</span>
<span class="c1">// - We handle both horizontal and vertical scrollbars, which makes the terminology not ideal.</span>
<span class="c1">// Still, the code should probably be made simpler..</span>
<span class="kt">bool</span> <span class="nf">ImGui::ScrollbarEx</span><span class="p">(</span><span class="k">const</span> <span class="n">ImRect</span><span class="o">&amp;</span> <span class="n">bb_frame</span><span class="p">,</span> <span class="n">ImGuiID</span> <span class="n">id</span><span class="p">,</span> <span class="n">ImGuiAxis</span> <span class="n">axis</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">p_scroll_v</span><span class="p">,</span> <span class="kt">float</span> <span class="n">size_avail_v</span><span class="p">,</span> <span class="kt">float</span> <span class="n">size_contents_v</span><span class="p">,</span> <span class="n">ImDrawCornerFlags</span> <span class="n">rounding_corners</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">float</span> <span class="n">bb_frame_width</span> <span class="o">=</span> <span class="n">bb_frame</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">();</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">bb_frame_height</span> <span class="o">=</span> <span class="n">bb_frame</span><span class="p">.</span><span class="n">GetHeight</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bb_frame_width</span> <span class="o">&lt;=</span> <span class="mf">0.0f</span> <span class="o">||</span> <span class="n">bb_frame_height</span> <span class="o">&lt;=</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// When we are too small, start hiding and disabling the grab (this reduce visual noise on very small window and facilitate using the window resize grab)</span>
    <span class="kt">float</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">axis</span> <span class="o">==</span> <span class="n">ImGuiAxis_Y</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">bb_frame_height</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">)</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">ImSaturate</span><span class="p">((</span><span class="n">bb_frame_height</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">&lt;=</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">allow_interaction</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">&gt;=</span> <span class="mf">1.0f</span><span class="p">);</span>

    <span class="n">ImRect</span> <span class="n">bb</span> <span class="o">=</span> <span class="n">bb_frame</span><span class="p">;</span>
    <span class="n">bb</span><span class="p">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="o">-</span><span class="n">ImClamp</span><span class="p">(</span><span class="n">IM_FLOOR</span><span class="p">((</span><span class="n">bb_frame_width</span> <span class="o">-</span> <span class="mf">2.0f</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">),</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">3.0f</span><span class="p">),</span> <span class="o">-</span><span class="n">ImClamp</span><span class="p">(</span><span class="n">IM_FLOOR</span><span class="p">((</span><span class="n">bb_frame_height</span> <span class="o">-</span> <span class="mf">2.0f</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">),</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">3.0f</span><span class="p">)));</span>

    <span class="c1">// V denote the main, longer axis of the scrollbar (= height for a vertical scrollbar)</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">scrollbar_size_v</span> <span class="o">=</span> <span class="p">(</span><span class="n">axis</span> <span class="o">==</span> <span class="n">ImGuiAxis_X</span><span class="p">)</span> <span class="o">?</span> <span class="n">bb</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">()</span> <span class="o">:</span> <span class="n">bb</span><span class="p">.</span><span class="n">GetHeight</span><span class="p">();</span>

    <span class="c1">// Calculate the height of our grabbable box. It generally represent the amount visible (vs the total scrollable amount)</span>
    <span class="c1">// But we maintain a minimum size in pixel to allow for the user to still aim inside.</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">ImMax</span><span class="p">(</span><span class="n">size_contents_v</span><span class="p">,</span> <span class="n">size_avail_v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">);</span> <span class="c1">// Adding this assert to check if the ImMax(XXX,1.0f) is still needed. PLEASE CONTACT ME if this triggers.</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">win_size_v</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">ImMax</span><span class="p">(</span><span class="n">size_contents_v</span><span class="p">,</span> <span class="n">size_avail_v</span><span class="p">),</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">grab_h_pixels</span> <span class="o">=</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">scrollbar_size_v</span> <span class="o">*</span> <span class="p">(</span><span class="n">size_avail_v</span> <span class="o">/</span> <span class="n">win_size_v</span><span class="p">),</span> <span class="n">style</span><span class="p">.</span><span class="n">GrabMinSize</span><span class="p">,</span> <span class="n">scrollbar_size_v</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">grab_h_norm</span> <span class="o">=</span> <span class="n">grab_h_pixels</span> <span class="o">/</span> <span class="n">scrollbar_size_v</span><span class="p">;</span>

    <span class="c1">// Handle input right away. None of the code of Begin() is relying on scrolling position before calling Scrollbar().</span>
    <span class="kt">bool</span> <span class="n">held</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">hovered</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">,</span> <span class="n">ImGuiButtonFlags_NoNavFocus</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">scroll_max</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">size_contents_v</span> <span class="o">-</span> <span class="n">size_avail_v</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">scroll_ratio</span> <span class="o">=</span> <span class="n">ImSaturate</span><span class="p">(</span><span class="o">*</span><span class="n">p_scroll_v</span> <span class="o">/</span> <span class="n">scroll_max</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">grab_v_norm</span> <span class="o">=</span> <span class="n">scroll_ratio</span> <span class="o">*</span> <span class="p">(</span><span class="n">scrollbar_size_v</span> <span class="o">-</span> <span class="n">grab_h_pixels</span><span class="p">)</span> <span class="o">/</span> <span class="n">scrollbar_size_v</span><span class="p">;</span> <span class="c1">// Grab position in normalized space</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">held</span> <span class="o">&amp;&amp;</span> <span class="n">allow_interaction</span> <span class="o">&amp;&amp;</span> <span class="n">grab_h_norm</span> <span class="o">&lt;</span> <span class="mf">1.0f</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">float</span> <span class="n">scrollbar_pos_v</span> <span class="o">=</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">[</span><span class="n">axis</span><span class="p">];</span>
        <span class="kt">float</span> <span class="n">mouse_pos_v</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MousePos</span><span class="p">[</span><span class="n">axis</span><span class="p">];</span>

        <span class="c1">// Click position in scrollbar normalized space (0.0f-&gt;1.0f)</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">clicked_v_norm</span> <span class="o">=</span> <span class="n">ImSaturate</span><span class="p">((</span><span class="n">mouse_pos_v</span> <span class="o">-</span> <span class="n">scrollbar_pos_v</span><span class="p">)</span> <span class="o">/</span> <span class="n">scrollbar_size_v</span><span class="p">);</span>
        <span class="n">SetHoveredID</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

        <span class="kt">bool</span> <span class="n">seek_absolute</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdIsJustActivated</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// On initial click calculate the distance between mouse and the center of the grab</span>
            <span class="n">seek_absolute</span> <span class="o">=</span> <span class="p">(</span><span class="n">clicked_v_norm</span> <span class="o">&lt;</span> <span class="n">grab_v_norm</span> <span class="o">||</span> <span class="n">clicked_v_norm</span> <span class="o">&gt;</span> <span class="n">grab_v_norm</span> <span class="o">+</span> <span class="n">grab_h_norm</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">seek_absolute</span><span class="p">)</span>
                <span class="n">g</span><span class="p">.</span><span class="n">ScrollbarClickDeltaToGrabCenter</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
            <span class="k">else</span>
                <span class="n">g</span><span class="p">.</span><span class="n">ScrollbarClickDeltaToGrabCenter</span> <span class="o">=</span> <span class="n">clicked_v_norm</span> <span class="o">-</span> <span class="n">grab_v_norm</span> <span class="o">-</span> <span class="n">grab_h_norm</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Apply scroll (p_scroll_v will generally point on one member of window-&gt;Scroll)</span>
        <span class="c1">// It is ok to modify Scroll here because we are being called in Begin() after the calculation of ContentSize and before setting up our starting position</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">scroll_v_norm</span> <span class="o">=</span> <span class="n">ImSaturate</span><span class="p">((</span><span class="n">clicked_v_norm</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">ScrollbarClickDeltaToGrabCenter</span> <span class="o">-</span> <span class="n">grab_h_norm</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0f</span> <span class="o">-</span> <span class="n">grab_h_norm</span><span class="p">));</span>
        <span class="o">*</span><span class="n">p_scroll_v</span> <span class="o">=</span> <span class="n">IM_ROUND</span><span class="p">(</span><span class="n">scroll_v_norm</span> <span class="o">*</span> <span class="n">scroll_max</span><span class="p">);</span><span class="c1">//(win_size_contents_v - win_size_v));</span>

        <span class="c1">// Update values for rendering</span>
        <span class="n">scroll_ratio</span> <span class="o">=</span> <span class="n">ImSaturate</span><span class="p">(</span><span class="o">*</span><span class="n">p_scroll_v</span> <span class="o">/</span> <span class="n">scroll_max</span><span class="p">);</span>
        <span class="n">grab_v_norm</span> <span class="o">=</span> <span class="n">scroll_ratio</span> <span class="o">*</span> <span class="p">(</span><span class="n">scrollbar_size_v</span> <span class="o">-</span> <span class="n">grab_h_pixels</span><span class="p">)</span> <span class="o">/</span> <span class="n">scrollbar_size_v</span><span class="p">;</span>

        <span class="c1">// Update distance to grab now that we have seeked and saturated</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">seek_absolute</span><span class="p">)</span>
            <span class="n">g</span><span class="p">.</span><span class="n">ScrollbarClickDeltaToGrabCenter</span> <span class="o">=</span> <span class="n">clicked_v_norm</span> <span class="o">-</span> <span class="n">grab_v_norm</span> <span class="o">-</span> <span class="n">grab_h_norm</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Render</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">bg_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_ScrollbarBg</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">grab_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">held</span> <span class="o">?</span> <span class="nl">ImGuiCol_ScrollbarGrabActive</span> <span class="p">:</span> <span class="n">hovered</span> <span class="o">?</span> <span class="nl">ImGuiCol_ScrollbarGrabHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_ScrollbarGrab</span><span class="p">,</span> <span class="n">alpha</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">bb_frame</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bb_frame</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">bg_col</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowRounding</span><span class="p">,</span> <span class="n">rounding_corners</span><span class="p">);</span>
    <span class="n">ImRect</span> <span class="n">grab_rect</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">axis</span> <span class="o">==</span> <span class="n">ImGuiAxis_X</span><span class="p">)</span>
        <span class="n">grab_rect</span> <span class="o">=</span> <span class="n">ImRect</span><span class="p">(</span><span class="n">ImLerp</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">grab_v_norm</span><span class="p">),</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ImLerp</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">grab_v_norm</span><span class="p">)</span> <span class="o">+</span> <span class="n">grab_h_pixels</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="n">grab_rect</span> <span class="o">=</span> <span class="n">ImRect</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ImLerp</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">grab_v_norm</span><span class="p">),</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ImLerp</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">grab_v_norm</span><span class="p">)</span> <span class="o">+</span> <span class="n">grab_h_pixels</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">grab_rect</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">grab_rect</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">grab_col</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">ScrollbarRounding</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">held</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::Image</span><span class="p">(</span><span class="n">ImTextureID</span> <span class="n">user_texture_id</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">uv0</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">uv1</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec4</span><span class="o">&amp;</span> <span class="n">tint_col</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec4</span><span class="o">&amp;</span> <span class="n">border_col</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">ImRect</span> <span class="n">bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">size</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">border_col</span><span class="p">.</span><span class="n">w</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="n">bb</span><span class="p">.</span><span class="n">Max</span> <span class="o">+=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">bb</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">border_col</span><span class="p">.</span><span class="n">w</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddRect</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">border_col</span><span class="p">),</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddImage</span><span class="p">(</span><span class="n">user_texture_id</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span> <span class="o">-</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">uv0</span><span class="p">,</span> <span class="n">uv1</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">tint_col</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddImage</span><span class="p">(</span><span class="n">user_texture_id</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">uv0</span><span class="p">,</span> <span class="n">uv1</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">tint_col</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ImageButton() is flawed as &#39;id&#39; is always derived from &#39;texture_id&#39; (see #2464 #1390)</span>
<span class="c1">// We provide this internal helper to write your own variant while we figure out how to redesign the public ImageButton() API.</span>
<span class="kt">bool</span> <span class="nf">ImGui::ImageButtonEx</span><span class="p">(</span><span class="n">ImGuiID</span> <span class="n">id</span><span class="p">,</span> <span class="n">ImTextureID</span> <span class="n">texture_id</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">uv0</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">uv1</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">padding</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec4</span><span class="o">&amp;</span> <span class="n">bg_col</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec4</span><span class="o">&amp;</span> <span class="n">tint_col</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">ImRect</span> <span class="n">bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">size</span> <span class="o">+</span> <span class="n">padding</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">bb</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">hovered</span><span class="p">,</span> <span class="n">held</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">);</span>

    <span class="c1">// Render</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">((</span><span class="n">held</span> <span class="o">&amp;&amp;</span> <span class="n">hovered</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiCol_ButtonActive</span> <span class="p">:</span> <span class="n">hovered</span> <span class="o">?</span> <span class="nl">ImGuiCol_ButtonHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_Button</span><span class="p">);</span>
    <span class="n">RenderNavHighlight</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="n">RenderFrame</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="n">ImClamp</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">ImMin</span><span class="p">(</span><span class="n">padding</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">padding</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bg_col</span><span class="p">.</span><span class="n">w</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">padding</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span> <span class="o">-</span> <span class="n">padding</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">bg_col</span><span class="p">));</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddImage</span><span class="p">(</span><span class="n">texture_id</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">padding</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span> <span class="o">-</span> <span class="n">padding</span><span class="p">,</span> <span class="n">uv0</span><span class="p">,</span> <span class="n">uv1</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">tint_col</span><span class="p">));</span>

    <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// frame_padding &lt; 0: uses FramePadding from style (default)</span>
<span class="c1">// frame_padding = 0: no framing</span>
<span class="c1">// frame_padding &gt; 0: set framing size</span>
<span class="kt">bool</span> <span class="nf">ImGui::ImageButton</span><span class="p">(</span><span class="n">ImTextureID</span> <span class="n">user_texture_id</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">uv0</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">uv1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">frame_padding</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec4</span><span class="o">&amp;</span> <span class="n">bg_col</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec4</span><span class="o">&amp;</span> <span class="n">tint_col</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Default to using texture ID as ID. User can still push string/integer prefixes.</span>
    <span class="n">PushID</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="kt">intptr_t</span><span class="p">)</span><span class="n">user_texture_id</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="s">&quot;#image&quot;</span><span class="p">);</span>
    <span class="n">PopID</span><span class="p">();</span>

    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">padding</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_padding</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="n">ImVec2</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">frame_padding</span><span class="p">,</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">frame_padding</span><span class="p">)</span> <span class="o">:</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">ImageButtonEx</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">user_texture_id</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">uv0</span><span class="p">,</span> <span class="n">uv1</span><span class="p">,</span> <span class="n">padding</span><span class="p">,</span> <span class="n">bg_col</span><span class="p">,</span> <span class="n">tint_col</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">ImGui::Checkbox</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">bool</span><span class="o">*</span> <span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

    <span class="k">const</span> <span class="kt">float</span> <span class="n">square_sz</span> <span class="o">=</span> <span class="n">GetFrameHeight</span><span class="p">();</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="n">total_bb</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">square_sz</span> <span class="o">+</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">label_size</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">),</span> <span class="n">label_size</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">));</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">hovered</span><span class="p">,</span> <span class="n">held</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pressed</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">);</span>
        <span class="n">MarkItemEdited</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="n">ImRect</span> <span class="n">check_bb</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">square_sz</span><span class="p">,</span> <span class="n">square_sz</span><span class="p">));</span>
    <span class="n">RenderNavHighlight</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="n">RenderFrame</span><span class="p">(</span><span class="n">check_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">check_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">((</span><span class="n">held</span> <span class="o">&amp;&amp;</span> <span class="n">hovered</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiCol_FrameBgActive</span> <span class="p">:</span> <span class="n">hovered</span> <span class="o">?</span> <span class="nl">ImGuiCol_FrameBgHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_FrameBg</span><span class="p">),</span> <span class="nb">true</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">);</span>
    <span class="n">ImU32</span> <span class="n">check_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_CheckMark</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">mixed_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">&amp;</span> <span class="n">ImGuiItemFlags_MixedValue</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mixed_value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Undocumented tristate/mixed/indeterminate checkbox (#2644)</span>
        <span class="c1">// This may seem awkwardly designed because the aim is to make ImGuiItemFlags_MixedValue supported by all widgets (not just checkbox)</span>
        <span class="n">ImVec2</span> <span class="n">pad</span><span class="p">(</span><span class="n">ImMax</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">square_sz</span> <span class="o">/</span> <span class="mf">3.6f</span><span class="p">)),</span> <span class="n">ImMax</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">square_sz</span> <span class="o">/</span> <span class="mf">3.6f</span><span class="p">)));</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">check_bb</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">pad</span><span class="p">,</span> <span class="n">check_bb</span><span class="p">.</span><span class="n">Max</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span> <span class="n">check_col</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">pad</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">square_sz</span> <span class="o">/</span> <span class="mf">6.0f</span><span class="p">));</span>
        <span class="n">RenderCheckMark</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">check_bb</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">pad</span><span class="p">,</span> <span class="n">pad</span><span class="p">),</span> <span class="n">check_col</span><span class="p">,</span> <span class="n">square_sz</span> <span class="o">-</span> <span class="n">pad</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">LogEnabled</span><span class="p">)</span>
        <span class="n">LogRenderedText</span><span class="p">(</span><span class="o">&amp;</span><span class="n">total_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">mixed_value</span> <span class="o">?</span> <span class="s">&quot;[~]&quot;</span> <span class="o">:</span> <span class="o">*</span><span class="n">v</span> <span class="o">?</span> <span class="s">&quot;[x]&quot;</span> <span class="o">:</span> <span class="s">&quot;[ ]&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="n">RenderText</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">check_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">check_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">label</span><span class="p">);</span>

    <span class="n">IMGUI_TEST_ENGINE_ITEM_INFO</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">|</span> <span class="n">ImGuiItemStatusFlags_Checkable</span> <span class="o">|</span> <span class="p">(</span><span class="o">*</span><span class="n">v</span> <span class="o">?</span> <span class="nl">ImGuiItemStatusFlags_Checked</span> <span class="p">:</span> <span class="mi">0</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">CheckboxFlagsT</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">T</span><span class="o">*</span> <span class="n">flags</span><span class="p">,</span> <span class="n">T</span> <span class="n">flags_value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">bool</span> <span class="n">all_on</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">flags_value</span><span class="p">)</span> <span class="o">==</span> <span class="n">flags_value</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">any_on</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">flags_value</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">pressed</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">all_on</span> <span class="o">&amp;&amp;</span> <span class="n">any_on</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
        <span class="n">ImGuiItemFlags</span> <span class="n">backup_item_flags</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span><span class="p">;</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">|=</span> <span class="n">ImGuiItemFlags_MixedValue</span><span class="p">;</span>
        <span class="n">pressed</span> <span class="o">=</span> <span class="n">Checkbox</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">all_on</span><span class="p">);</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">=</span> <span class="n">backup_item_flags</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">pressed</span> <span class="o">=</span> <span class="n">Checkbox</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">all_on</span><span class="p">);</span>

    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pressed</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">all_on</span><span class="p">)</span>
            <span class="o">*</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">flags_value</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="o">*</span><span class="n">flags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">flags_value</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">CheckboxFlags</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">flags</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags_value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">CheckboxFlagsT</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">flags_value</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">CheckboxFlags</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="o">*</span> <span class="n">flags</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">flags_value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">CheckboxFlagsT</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">flags_value</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">RadioButton</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">active</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

    <span class="k">const</span> <span class="kt">float</span> <span class="n">square_sz</span> <span class="o">=</span> <span class="n">GetFrameHeight</span><span class="p">();</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">check_bb</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">square_sz</span><span class="p">,</span> <span class="n">square_sz</span><span class="p">));</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">total_bb</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">square_sz</span> <span class="o">+</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">label_size</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">),</span> <span class="n">label_size</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">));</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImVec2</span> <span class="n">center</span> <span class="o">=</span> <span class="n">check_bb</span><span class="p">.</span><span class="n">GetCenter</span><span class="p">();</span>
    <span class="n">center</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">IM_ROUND</span><span class="p">(</span><span class="n">center</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
    <span class="n">center</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">IM_ROUND</span><span class="p">(</span><span class="n">center</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">square_sz</span> <span class="o">-</span> <span class="mf">1.0f</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">hovered</span><span class="p">,</span> <span class="n">held</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pressed</span><span class="p">)</span>
        <span class="n">MarkItemEdited</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

    <span class="n">RenderNavHighlight</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddCircleFilled</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">((</span><span class="n">held</span> <span class="o">&amp;&amp;</span> <span class="n">hovered</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiCol_FrameBgActive</span> <span class="p">:</span> <span class="n">hovered</span> <span class="o">?</span> <span class="nl">ImGuiCol_FrameBgHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_FrameBg</span><span class="p">),</span> <span class="mi">16</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">active</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">pad</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">square_sz</span> <span class="o">/</span> <span class="mf">6.0f</span><span class="p">));</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddCircleFilled</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">radius</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_CheckMark</span><span class="p">),</span> <span class="mi">16</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">FrameBorderSize</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddCircle</span><span class="p">(</span><span class="n">center</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_BorderShadow</span><span class="p">),</span> <span class="mi">16</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameBorderSize</span><span class="p">);</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddCircle</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_Border</span><span class="p">),</span> <span class="mi">16</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameBorderSize</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">LogEnabled</span><span class="p">)</span>
        <span class="n">LogRenderedText</span><span class="p">(</span><span class="o">&amp;</span><span class="n">total_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">active</span> <span class="o">?</span> <span class="s">&quot;(x)&quot;</span> <span class="o">:</span> <span class="s">&quot;( )&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="n">RenderText</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">check_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">check_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">label</span><span class="p">);</span>

    <span class="n">IMGUI_TEST_ENGINE_ITEM_INFO</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// FIXME: This would work nicely if it was a public template, e.g. &#39;template&lt;T&gt; RadioButton(const char* label, T* v, T v_button)&#39;, but I&#39;m not sure how we would expose it..</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">RadioButton</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_button</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="n">RadioButton</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="o">*</span><span class="n">v</span> <span class="o">==</span> <span class="n">v_button</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pressed</span><span class="p">)</span>
        <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="n">v_button</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// size_arg (for each axis) &lt; 0.0f: align to end, 0.0f: auto, &gt; 0.0f: specified size</span>
<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ProgressBar</span><span class="p">(</span><span class="kt">float</span> <span class="n">fraction</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size_arg</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">overlay</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>

    <span class="n">ImVec2</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">;</span>
    <span class="n">ImVec2</span> <span class="n">size</span> <span class="o">=</span> <span class="n">CalcItemSize</span><span class="p">(</span><span class="n">size_arg</span><span class="p">,</span> <span class="n">CalcItemWidth</span><span class="p">(),</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">);</span>
    <span class="n">ImRect</span> <span class="nf">bb</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">size</span><span class="p">);</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="c1">// Render</span>
    <span class="n">fraction</span> <span class="o">=</span> <span class="n">ImSaturate</span><span class="p">(</span><span class="n">fraction</span><span class="p">);</span>
    <span class="n">RenderFrame</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_FrameBg</span><span class="p">),</span> <span class="nb">true</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">);</span>
    <span class="n">bb</span><span class="p">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="o">-</span><span class="n">style</span><span class="p">.</span><span class="n">FrameBorderSize</span><span class="p">,</span> <span class="o">-</span><span class="n">style</span><span class="p">.</span><span class="n">FrameBorderSize</span><span class="p">));</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">fill_br</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">ImLerp</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">fraction</span><span class="p">),</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">RenderRectFilledRangeH</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_PlotHistogram</span><span class="p">),</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="n">fraction</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">);</span>

    <span class="c1">// Default displaying the fraction as percentage string, but user can override it</span>
    <span class="kt">char</span> <span class="n">overlay_buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">overlay</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ImFormatString</span><span class="p">(</span><span class="n">overlay_buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">overlay_buf</span><span class="p">),</span> <span class="s">&quot;%.0f%%&quot;</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mf">0.01f</span><span class="p">);</span>
        <span class="n">overlay</span> <span class="o">=</span> <span class="n">overlay_buf</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">ImVec2</span> <span class="n">overlay_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">overlay_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="n">RenderTextClipped</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">ImClamp</span><span class="p">(</span><span class="n">fill_br</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">overlay_size</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">overlay</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">overlay_size</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">bb</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">Bullet</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">line_height</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">ImMin</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineSize</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">,</span> <span class="n">line_height</span><span class="p">));</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">bb</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Render and stay on same line</span>
    <span class="n">ImU32</span> <span class="n">text_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_Text</span><span class="p">);</span>
    <span class="n">RenderBullet</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="n">line_height</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">),</span> <span class="n">text_col</span><span class="p">);</span>
    <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: Low-level Layout helpers</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - Spacing()</span>
<span class="c1">// - Dummy()</span>
<span class="c1">// - NewLine()</span>
<span class="c1">// - AlignTextToFramePadding()</span>
<span class="c1">// - SeparatorEx() [Internal]</span>
<span class="c1">// - Separator()</span>
<span class="c1">// - SplitterBehavior() [Internal]</span>
<span class="c1">// - ShrinkWidths() [Internal]</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">Spacing</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">Dummy</span><span class="p">(</span><span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">size</span><span class="p">);</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
    <span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">NewLine</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiLayoutType</span> <span class="n">backup_layout_type</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LayoutType</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LayoutType</span> <span class="o">=</span> <span class="n">ImGuiLayoutType_Vertical</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineSize</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>     <span class="c1">// In the event that we are on a line with items that is smaller that FontSize high, we will preserve its height.</span>
        <span class="n">ItemSize</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
    <span class="k">else</span>
        <span class="n">ItemSize</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">));</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LayoutType</span> <span class="o">=</span> <span class="n">backup_layout_type</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">AlignTextToFramePadding</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineSize</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineSize</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineTextBaseOffset</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineTextBaseOffset</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Horizontal/vertical separating line</span>
<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SeparatorEx</span><span class="p">(</span><span class="n">ImGuiSeparatorFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">ImIsPowerOfTwo</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiSeparatorFlags_Horizontal</span> <span class="o">|</span> <span class="n">ImGuiSeparatorFlags_Vertical</span><span class="p">)));</span>   <span class="c1">// Check that only 1 option is selected</span>

    <span class="kt">float</span> <span class="n">thickness_draw</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">thickness_layout</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSeparatorFlags_Vertical</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Vertical separator, for menu bars (use current line height). Not exposed because it is misleading and it doesn&#39;t have an effect on regular layout.</span>
        <span class="kt">float</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineSize</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
        <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">bb</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">thickness_draw</span><span class="p">,</span> <span class="n">y2</span><span class="p">));</span>
        <span class="n">ItemSize</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">thickness_layout</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="k">return</span><span class="p">;</span>

        <span class="c1">// Draw</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddLine</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_Separator</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">LogEnabled</span><span class="p">)</span>
            <span class="n">LogText</span><span class="p">(</span><span class="s">&quot; |&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSeparatorFlags_Horizontal</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Horizontal Separator</span>
        <span class="kt">float</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">Size</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>

        <span class="c1">// FIXME-WORKRECT: old hack (#205) until we decide of consistent behavior with WorkRect/Indent and Separator</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">GroupStack</span><span class="p">.</span><span class="n">Size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">GroupStack</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">WindowID</span> <span class="o">==</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">)</span>
            <span class="n">x1</span> <span class="o">+=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">Indent</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>

        <span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSeparatorFlags_SpanAllColumns</span><span class="p">)</span> <span class="o">?</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="nl">CurrentColumns</span> <span class="p">:</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">PushColumnsBackground</span><span class="p">();</span>

        <span class="c1">// We don&#39;t provide our width to the layout so that it doesn&#39;t get feed back into AutoFit</span>
        <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">bb</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">thickness_draw</span><span class="p">));</span>
        <span class="n">ItemSize</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="n">thickness_layout</span><span class="p">));</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">item_visible</span> <span class="o">=</span> <span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">item_visible</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Draw</span>
            <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddLine</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_Separator</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">LogEnabled</span><span class="p">)</span>
                <span class="n">LogRenderedText</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="s">&quot;--------------------------------&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">columns</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">PopColumnsBackground</span><span class="p">();</span>
            <span class="n">columns</span><span class="o">-&gt;</span><span class="n">LineMinY</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">Separator</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="c1">// Those flags should eventually be overridable by the user</span>
    <span class="n">ImGuiSeparatorFlags</span> <span class="n">flags</span> <span class="o">=</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LayoutType</span> <span class="o">==</span> <span class="n">ImGuiLayoutType_Horizontal</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiSeparatorFlags_Vertical</span> <span class="p">:</span> <span class="n">ImGuiSeparatorFlags_Horizontal</span><span class="p">;</span>
    <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiSeparatorFlags_SpanAllColumns</span><span class="p">;</span>
    <span class="n">SeparatorEx</span><span class="p">(</span><span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Using &#39;hover_visibility_delay&#39; allows us to hide the highlight and mouse cursor for a short time, which can be convenient to reduce visual noise.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SplitterBehavior</span><span class="p">(</span><span class="k">const</span> <span class="n">ImRect</span><span class="o">&amp;</span> <span class="n">bb</span><span class="p">,</span> <span class="n">ImGuiID</span> <span class="n">id</span><span class="p">,</span> <span class="n">ImGuiAxis</span> <span class="n">axis</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">size1</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">size2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">min_size1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">min_size2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">hover_extend</span><span class="p">,</span> <span class="kt">float</span> <span class="n">hover_visibility_delay</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">ImGuiItemFlags</span> <span class="n">item_flags_backup</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">|=</span> <span class="n">ImGuiItemFlags_NoNav</span> <span class="o">|</span> <span class="n">ImGuiItemFlags_NoNavDefaultFocus</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">item_add</span> <span class="o">=</span> <span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">=</span> <span class="n">item_flags_backup</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">item_add</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">hovered</span><span class="p">,</span> <span class="n">held</span><span class="p">;</span>
    <span class="n">ImRect</span> <span class="n">bb_interact</span> <span class="o">=</span> <span class="n">bb</span><span class="p">;</span>
    <span class="n">bb_interact</span><span class="p">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">axis</span> <span class="o">==</span> <span class="n">ImGuiAxis_Y</span> <span class="o">?</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="n">hover_extend</span><span class="p">)</span> <span class="o">:</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">hover_extend</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
    <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">bb_interact</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">,</span> <span class="n">ImGuiButtonFlags_FlattenChildren</span> <span class="o">|</span> <span class="n">ImGuiButtonFlags_AllowItemOverlap</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">!=</span> <span class="n">id</span><span class="p">)</span>
        <span class="n">SetItemAllowOverlap</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">held</span> <span class="o">||</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">HoveredId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredIdPreviousFrame</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredIdTimer</span> <span class="o">&gt;=</span> <span class="n">hover_visibility_delay</span><span class="p">))</span>
        <span class="n">SetMouseCursor</span><span class="p">(</span><span class="n">axis</span> <span class="o">==</span> <span class="n">ImGuiAxis_Y</span> <span class="o">?</span> <span class="nl">ImGuiMouseCursor_ResizeNS</span> <span class="p">:</span> <span class="n">ImGuiMouseCursor_ResizeEW</span><span class="p">);</span>

    <span class="n">ImRect</span> <span class="n">bb_render</span> <span class="o">=</span> <span class="n">bb</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">held</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ImVec2</span> <span class="n">mouse_delta_2d</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MousePos</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdClickOffset</span> <span class="o">-</span> <span class="n">bb_interact</span><span class="p">.</span><span class="n">Min</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">mouse_delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">axis</span> <span class="o">==</span> <span class="n">ImGuiAxis_Y</span><span class="p">)</span> <span class="o">?</span> <span class="n">mouse_delta_2d</span><span class="p">.</span><span class="nl">y</span> <span class="p">:</span> <span class="n">mouse_delta_2d</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>

        <span class="c1">// Minimum pane size</span>
        <span class="kt">float</span> <span class="n">size_1_maximum_delta</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="o">*</span><span class="n">size1</span> <span class="o">-</span> <span class="n">min_size1</span><span class="p">);</span>
        <span class="kt">float</span> <span class="n">size_2_maximum_delta</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="o">*</span><span class="n">size2</span> <span class="o">-</span> <span class="n">min_size2</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mouse_delta</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">size_1_maximum_delta</span><span class="p">)</span>
            <span class="n">mouse_delta</span> <span class="o">=</span> <span class="o">-</span><span class="n">size_1_maximum_delta</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mouse_delta</span> <span class="o">&gt;</span> <span class="n">size_2_maximum_delta</span><span class="p">)</span>
            <span class="n">mouse_delta</span> <span class="o">=</span> <span class="n">size_2_maximum_delta</span><span class="p">;</span>

        <span class="c1">// Apply resize</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mouse_delta</span> <span class="o">!=</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mouse_delta</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">)</span>
                <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">*</span><span class="n">size1</span> <span class="o">+</span> <span class="n">mouse_delta</span> <span class="o">&gt;=</span> <span class="n">min_size1</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mouse_delta</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
                <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">*</span><span class="n">size2</span> <span class="o">-</span> <span class="n">mouse_delta</span> <span class="o">&gt;=</span> <span class="n">min_size2</span><span class="p">);</span>
            <span class="o">*</span><span class="n">size1</span> <span class="o">+=</span> <span class="n">mouse_delta</span><span class="p">;</span>
            <span class="o">*</span><span class="n">size2</span> <span class="o">-=</span> <span class="n">mouse_delta</span><span class="p">;</span>
            <span class="n">bb_render</span><span class="p">.</span><span class="n">Translate</span><span class="p">((</span><span class="n">axis</span> <span class="o">==</span> <span class="n">ImGuiAxis_X</span><span class="p">)</span> <span class="o">?</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">mouse_delta</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">:</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="n">mouse_delta</span><span class="p">));</span>
            <span class="n">MarkItemEdited</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Render</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">held</span> <span class="o">?</span> <span class="nl">ImGuiCol_SeparatorActive</span> <span class="p">:</span> <span class="p">(</span><span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredIdTimer</span> <span class="o">&gt;=</span> <span class="n">hover_visibility_delay</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiCol_SeparatorHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_Separator</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">bb_render</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bb_render</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">held</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">IMGUI_CDECL</span> <span class="n">ShrinkWidthItemComparer</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="n">ImGuiShrinkWidthItem</span><span class="o">*</span> <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImGuiShrinkWidthItem</span><span class="o">*</span><span class="p">)</span><span class="n">lhs</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiShrinkWidthItem</span><span class="o">*</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImGuiShrinkWidthItem</span><span class="o">*</span><span class="p">)</span><span class="n">rhs</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Width</span> <span class="o">-</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Index</span> <span class="o">-</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Shrink excess width from a set of item, by removing width from the larger items first.</span>
<span class="c1">// Set items Width to -1.0f to disable shrinking this item.</span>
<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ShrinkWidths</span><span class="p">(</span><span class="n">ImGuiShrinkWidthItem</span><span class="o">*</span> <span class="n">items</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">,</span> <span class="kt">float</span> <span class="n">width_excess</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Width</span> <span class="o">&gt;=</span> <span class="mf">0.0f</span><span class="p">)</span>
            <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Width</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Width</span> <span class="o">-</span> <span class="n">width_excess</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">ImQsort</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ImGuiShrinkWidthItem</span><span class="p">),</span> <span class="n">ShrinkWidthItemComparer</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">count_same_width</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">width_excess</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">&amp;&amp;</span> <span class="n">count_same_width</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">count_same_width</span> <span class="o">&lt;</span> <span class="n">count</span> <span class="o">&amp;&amp;</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Width</span> <span class="o">&lt;=</span> <span class="n">items</span><span class="p">[</span><span class="n">count_same_width</span><span class="p">].</span><span class="n">Width</span><span class="p">)</span>
            <span class="n">count_same_width</span><span class="o">++</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">max_width_to_remove_per_item</span> <span class="o">=</span> <span class="p">(</span><span class="n">count_same_width</span> <span class="o">&lt;</span> <span class="n">count</span> <span class="o">&amp;&amp;</span> <span class="n">items</span><span class="p">[</span><span class="n">count_same_width</span><span class="p">].</span><span class="n">Width</span> <span class="o">&gt;=</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Width</span> <span class="o">-</span> <span class="n">items</span><span class="p">[</span><span class="n">count_same_width</span><span class="p">].</span><span class="n">Width</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Width</span> <span class="o">-</span> <span class="mf">1.0f</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">max_width_to_remove_per_item</span> <span class="o">&lt;=</span> <span class="mf">0.0f</span><span class="p">)</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">width_to_remove_per_item</span> <span class="o">=</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">width_excess</span> <span class="o">/</span> <span class="n">count_same_width</span><span class="p">,</span> <span class="n">max_width_to_remove_per_item</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">item_n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">item_n</span> <span class="o">&lt;</span> <span class="n">count_same_width</span><span class="p">;</span> <span class="n">item_n</span><span class="o">++</span><span class="p">)</span>
            <span class="n">items</span><span class="p">[</span><span class="n">item_n</span><span class="p">].</span><span class="n">Width</span> <span class="o">-=</span> <span class="n">width_to_remove_per_item</span><span class="p">;</span>
        <span class="n">width_excess</span> <span class="o">-=</span> <span class="n">width_to_remove_per_item</span> <span class="o">*</span> <span class="n">count_same_width</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Round width and redistribute remainder left-to-right (could make it an option of the function?)</span>
    <span class="c1">// Ensure that e.g. the right-most tab of a shrunk tab-bar always reaches exactly at the same distance from the right-most edge of the tab bar separator.</span>
    <span class="n">width_excess</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">float</span> <span class="n">width_rounded</span> <span class="o">=</span> <span class="n">ImFloor</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">Width</span><span class="p">);</span>
        <span class="n">width_excess</span> <span class="o">+=</span> <span class="n">items</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">Width</span> <span class="o">-</span> <span class="n">width_rounded</span><span class="p">;</span>
        <span class="n">items</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">Width</span> <span class="o">=</span> <span class="n">width_rounded</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">width_excess</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">Index</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">width_excess</span> <span class="o">+</span> <span class="mf">0.01f</span><span class="p">))</span>
                <span class="n">items</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">Width</span> <span class="o">+=</span> <span class="mf">1.0f</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: ComboBox</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - BeginCombo()</span>
<span class="c1">// - EndCombo()</span>
<span class="c1">// - Combo()</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="k">static</span> <span class="kt">float</span> <span class="n">CalcMaxPopupHeightFromItemCount</span><span class="p">(</span><span class="kt">int</span> <span class="n">items_count</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">items_count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FLT_MAX</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">items_count</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">WindowPadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">BeginCombo</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">preview_value</span><span class="p">,</span> <span class="n">ImGuiComboFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Always consume the SetNextWindowSizeConstraint() call in our early return paths</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">has_window_size_constraint</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NextWindowData</span><span class="p">.</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiNextWindowDataFlags_HasSizeConstraint</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">g</span><span class="p">.</span><span class="n">NextWindowData</span><span class="p">.</span><span class="n">Flags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">ImGuiNextWindowDataFlags_HasSizeConstraint</span><span class="p">;</span>

    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">IM_ASSERT</span><span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiComboFlags_NoArrowButton</span> <span class="o">|</span> <span class="n">ImGuiComboFlags_NoPreview</span><span class="p">))</span> <span class="o">!=</span> <span class="p">(</span><span class="n">ImGuiComboFlags_NoArrowButton</span> <span class="o">|</span> <span class="n">ImGuiComboFlags_NoPreview</span><span class="p">));</span> <span class="c1">// Can&#39;t use both flags together</span>

    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>

    <span class="k">const</span> <span class="kt">float</span> <span class="n">arrow_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiComboFlags_NoArrowButton</span><span class="p">)</span> <span class="o">?</span> <span class="mf">0.0f</span> <span class="o">:</span> <span class="n">GetFrameHeight</span><span class="p">();</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">expected_w</span> <span class="o">=</span> <span class="n">CalcItemWidth</span><span class="p">();</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiComboFlags_NoPreview</span><span class="p">)</span> <span class="o">?</span> <span class="nl">arrow_size</span> <span class="p">:</span> <span class="n">expected_w</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">frame_bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">label_size</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">));</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">total_bb</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">label_size</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">frame_bb</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">hovered</span><span class="p">,</span> <span class="n">held</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">popup_open</span> <span class="o">=</span> <span class="n">IsPopupOpen</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">ImGuiPopupFlags_None</span><span class="p">);</span>

    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">frame_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">hovered</span> <span class="o">?</span> <span class="nl">ImGuiCol_FrameBgHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_FrameBg</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">value_x2</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">arrow_size</span><span class="p">);</span>
    <span class="n">RenderNavHighlight</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiComboFlags_NoPreview</span><span class="p">))</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">value_x2</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">frame_col</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">,</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiComboFlags_NoArrowButton</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImDrawCornerFlags_All</span> <span class="p">:</span> <span class="n">ImDrawCornerFlags_Left</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiComboFlags_NoArrowButton</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">ImU32</span> <span class="n">bg_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">((</span><span class="n">popup_open</span> <span class="o">||</span> <span class="n">hovered</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiCol_ButtonHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_Button</span><span class="p">);</span>
        <span class="n">ImU32</span> <span class="n">text_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_Text</span><span class="p">);</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">value_x2</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">bg_col</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;=</span> <span class="n">arrow_size</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImDrawCornerFlags_All</span> <span class="p">:</span> <span class="n">ImDrawCornerFlags_Right</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">value_x2</span> <span class="o">+</span> <span class="n">arrow_size</span> <span class="o">-</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">RenderArrow</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">value_x2</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">text_col</span><span class="p">,</span> <span class="n">ImGuiDir_Down</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">RenderFrameBorder</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">preview_value</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiComboFlags_NoPreview</span><span class="p">))</span>
        <span class="n">RenderTextClipped</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">value_x2</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">preview_value</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">RenderText</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">label</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">pressed</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">NavActivateId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">popup_open</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">NavLayerCurrent</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">window</span><span class="o">-&gt;</span><span class="n">NavLastIds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
        <span class="n">OpenPopupEx</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">ImGuiPopupFlags_None</span><span class="p">);</span>
        <span class="n">popup_open</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">popup_open</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">has_window_size_constraint</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">g</span><span class="p">.</span><span class="n">NextWindowData</span><span class="p">.</span><span class="n">Flags</span> <span class="o">|=</span> <span class="n">ImGuiNextWindowDataFlags_HasSizeConstraint</span><span class="p">;</span>
        <span class="n">g</span><span class="p">.</span><span class="n">NextWindowData</span><span class="p">.</span><span class="n">SizeConstraintRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NextWindowData</span><span class="p">.</span><span class="n">SizeConstraintRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiComboFlags_HeightMask_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiComboFlags_HeightRegular</span><span class="p">;</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">ImIsPowerOfTwo</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiComboFlags_HeightMask_</span><span class="p">));</span>    <span class="c1">// Only one</span>
        <span class="kt">int</span> <span class="n">popup_max_height_in_items</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiComboFlags_HeightRegular</span><span class="p">)</span>     <span class="n">popup_max_height_in_items</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiComboFlags_HeightSmall</span><span class="p">)</span>  <span class="n">popup_max_height_in_items</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiComboFlags_HeightLarge</span><span class="p">)</span>  <span class="n">popup_max_height_in_items</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
        <span class="n">SetNextWindowSizeConstraints</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">FLT_MAX</span><span class="p">,</span> <span class="n">CalcMaxPopupHeightFromItemCount</span><span class="p">(</span><span class="n">popup_max_height_in_items</span><span class="p">)));</span>
    <span class="p">}</span>

    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="n">ImFormatString</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="s">&quot;##Combo_%02d&quot;</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">BeginPopupStack</span><span class="p">.</span><span class="n">Size</span><span class="p">);</span> <span class="c1">// Recycle windows based on depth</span>

    <span class="c1">// Position the window given a custom constraint (peak into expected window size so we can position it)</span>
    <span class="c1">// This might be easier to express with an hypothetical SetNextWindowPosConstraints() function.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">popup_window</span> <span class="o">=</span> <span class="n">FindWindowByName</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">popup_window</span><span class="o">-&gt;</span><span class="n">WasActive</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Always override &#39;AutoPosLastDirection&#39; to not leave a chance for a past value to affect us.</span>
            <span class="n">ImVec2</span> <span class="n">size_expected</span> <span class="o">=</span> <span class="n">CalcWindowExpectedSize</span><span class="p">(</span><span class="n">popup_window</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiComboFlags_PopupAlignLeft</span><span class="p">)</span>
                <span class="n">popup_window</span><span class="o">-&gt;</span><span class="n">AutoPosLastDirection</span> <span class="o">=</span> <span class="n">ImGuiDir_Left</span><span class="p">;</span> <span class="c1">// &quot;Below, Toward Left&quot;</span>
            <span class="k">else</span>
                <span class="n">popup_window</span><span class="o">-&gt;</span><span class="n">AutoPosLastDirection</span> <span class="o">=</span> <span class="n">ImGuiDir_Down</span><span class="p">;</span> <span class="c1">// &quot;Below, Toward Right (default)&quot;</span>
            <span class="n">ImRect</span> <span class="n">r_outer</span> <span class="o">=</span> <span class="n">GetWindowAllowedExtentRect</span><span class="p">(</span><span class="n">popup_window</span><span class="p">);</span>
            <span class="n">ImVec2</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">FindBestWindowPosForPopupEx</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">GetBL</span><span class="p">(),</span> <span class="n">size_expected</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">popup_window</span><span class="o">-&gt;</span><span class="n">AutoPosLastDirection</span><span class="p">,</span> <span class="n">r_outer</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">,</span> <span class="n">ImGuiPopupPositionPolicy_ComboBox</span><span class="p">);</span>
            <span class="n">SetNextWindowPos</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="c1">// We don&#39;t use BeginPopupEx() solely because we have a custom name string, which we could make an argument to BeginPopupEx()</span>
    <span class="n">ImGuiWindowFlags</span> <span class="n">window_flags</span> <span class="o">=</span> <span class="n">ImGuiWindowFlags_AlwaysAutoResize</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_Popup</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_NoTitleBar</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_NoResize</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_NoSavedSettings</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_NoMove</span><span class="p">;</span>

    <span class="c1">// Horizontally align ourselves with the framed text</span>
    <span class="n">PushStyleVar</span><span class="p">(</span><span class="n">ImGuiStyleVar_WindowPadding</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">WindowPadding</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
    <span class="kt">bool</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">Begin</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">window_flags</span><span class="p">);</span>
    <span class="n">PopStyleVar</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ret</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">EndPopup</span><span class="p">();</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>   <span class="c1">// This should never happen as we tested for IsPopupOpen() above</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">EndCombo</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">EndPopup</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Getter for the old Combo() API: const char*[]</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="n">Items_ArrayGetter</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">**</span> <span class="n">out_text</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="k">const</span><span class="o">*</span> <span class="n">items</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="k">const</span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">out_text</span><span class="p">)</span>
        <span class="o">*</span><span class="n">out_text</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Getter for the old Combo() API: &quot;item1\0item2\0item3\0&quot;</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="n">Items_SingleStringGetter</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">**</span> <span class="n">out_text</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// FIXME-OPT: we could pre-compute the indices to fasten this. But only 1 active combo means the waste is limited.</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">items_separated_by_zeros</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">items_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">items_separated_by_zeros</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">==</span> <span class="n">items_count</span><span class="p">)</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="n">p</span> <span class="o">+=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">items_count</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!*</span><span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">out_text</span><span class="p">)</span>
        <span class="o">*</span><span class="n">out_text</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Old API, prefer using BeginCombo() nowadays if you can.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">Combo</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">current_item</span><span class="p">,</span> <span class="kt">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">items_getter</span><span class="p">)(</span><span class="kt">void</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">**</span><span class="p">),</span> <span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">items_count</span><span class="p">,</span> <span class="kt">int</span> <span class="n">popup_max_height_in_items</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>

    <span class="c1">// Call the getter to obtain the preview string which is a parameter to BeginCombo()</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">preview_value</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">current_item</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">current_item</span> <span class="o">&lt;</span> <span class="n">items_count</span><span class="p">)</span>
        <span class="n">items_getter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">current_item</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">preview_value</span><span class="p">);</span>

    <span class="c1">// The old Combo() API exposed &quot;popup_max_height_in_items&quot;. The new more general BeginCombo() API doesn&#39;t have/need it, but we emulate it here.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">popup_max_height_in_items</span> <span class="o">!=</span> <span class="mi">-1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NextWindowData</span><span class="p">.</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiNextWindowDataFlags_HasSizeConstraint</span><span class="p">))</span>
        <span class="n">SetNextWindowSizeConstraints</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">FLT_MAX</span><span class="p">,</span> <span class="n">CalcMaxPopupHeightFromItemCount</span><span class="p">(</span><span class="n">popup_max_height_in_items</span><span class="p">)));</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">BeginCombo</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">preview_value</span><span class="p">,</span> <span class="n">ImGuiComboFlags_None</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Display items</span>
    <span class="c1">// FIXME-OPT: Use clipper (but we need to disable it on the appearing frame to make sure our call to SetItemDefaultFocus() is processed)</span>
    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">items_count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">PushID</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="kt">intptr_t</span><span class="p">)</span><span class="n">i</span><span class="p">);</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">item_selected</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="o">*</span><span class="n">current_item</span><span class="p">);</span>
        <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">item_text</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">items_getter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">item_text</span><span class="p">))</span>
            <span class="n">item_text</span> <span class="o">=</span> <span class="s">&quot;*Unknown item*&quot;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Selectable</span><span class="p">(</span><span class="n">item_text</span><span class="p">,</span> <span class="n">item_selected</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="o">*</span><span class="n">current_item</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">item_selected</span><span class="p">)</span>
            <span class="n">SetItemDefaultFocus</span><span class="p">();</span>
        <span class="n">PopID</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">EndCombo</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Combo box helper allowing to pass an array of strings.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">Combo</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">current_item</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="k">const</span> <span class="n">items</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">items_count</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height_in_items</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="n">Combo</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">current_item</span><span class="p">,</span> <span class="n">Items_ArrayGetter</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">items</span><span class="p">,</span> <span class="n">items_count</span><span class="p">,</span> <span class="n">height_in_items</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Combo box helper allowing to pass all items in a single string literal holding multiple zero-terminated items &quot;item1\0item2\0&quot;</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">Combo</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">current_item</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">items_separated_by_zeros</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height_in_items</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">items_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">items_separated_by_zeros</span><span class="p">;</span>       <span class="c1">// FIXME-OPT: Avoid computing this, or at least only when combo is open</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">p</span> <span class="o">+=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">items_count</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="n">Combo</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">current_item</span><span class="p">,</span> <span class="n">Items_SingleStringGetter</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">items_separated_by_zeros</span><span class="p">,</span> <span class="n">items_count</span><span class="p">,</span> <span class="n">height_in_items</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Data Type and Data Formatting Helpers [Internal]</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - PatchFormatStringFloatToInt()</span>
<span class="c1">// - DataTypeGetInfo()</span>
<span class="c1">// - DataTypeFormatString()</span>
<span class="c1">// - DataTypeApplyOp()</span>
<span class="c1">// - DataTypeApplyOpFromText()</span>
<span class="c1">// - DataTypeClamp()</span>
<span class="c1">// - GetMinimumStepAtDecimalPrecision</span>
<span class="c1">// - RoundScalarWithFormat&lt;&gt;()</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">ImGuiDataTypeInfo</span> <span class="n">GDataTypeInfo</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
    <span class="p">{</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">),</span>             <span class="s">&quot;S8&quot;</span><span class="p">,</span>   <span class="s">&quot;%d&quot;</span><span class="p">,</span>   <span class="s">&quot;%d&quot;</span>    <span class="p">},</span>  <span class="c1">// ImGuiDataType_S8</span>
    <span class="p">{</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">),</span>    <span class="s">&quot;U8&quot;</span><span class="p">,</span>   <span class="s">&quot;%u&quot;</span><span class="p">,</span>   <span class="s">&quot;%u&quot;</span>    <span class="p">},</span>
    <span class="p">{</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">short</span><span class="p">),</span>            <span class="s">&quot;S16&quot;</span><span class="p">,</span>  <span class="s">&quot;%d&quot;</span><span class="p">,</span>   <span class="s">&quot;%d&quot;</span>    <span class="p">},</span>  <span class="c1">// ImGuiDataType_S16</span>
    <span class="p">{</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">),</span>   <span class="s">&quot;U16&quot;</span><span class="p">,</span>  <span class="s">&quot;%u&quot;</span><span class="p">,</span>   <span class="s">&quot;%u&quot;</span>    <span class="p">},</span>
    <span class="p">{</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span>              <span class="s">&quot;S32&quot;</span><span class="p">,</span>  <span class="s">&quot;%d&quot;</span><span class="p">,</span>   <span class="s">&quot;%d&quot;</span>    <span class="p">},</span>  <span class="c1">// ImGuiDataType_S32</span>
    <span class="p">{</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">),</span>     <span class="s">&quot;U32&quot;</span><span class="p">,</span>  <span class="s">&quot;%u&quot;</span><span class="p">,</span>   <span class="s">&quot;%u&quot;</span>    <span class="p">},</span>
<span class="cp">#ifdef _MSC_VER</span>
    <span class="p">{</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ImS64</span><span class="p">),</span>            <span class="s">&quot;S64&quot;</span><span class="p">,</span>  <span class="s">&quot;%I64d&quot;</span><span class="p">,</span><span class="s">&quot;%I64d&quot;</span> <span class="p">},</span>  <span class="c1">// ImGuiDataType_S64</span>
    <span class="p">{</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ImU64</span><span class="p">),</span>            <span class="s">&quot;U64&quot;</span><span class="p">,</span>  <span class="s">&quot;%I64u&quot;</span><span class="p">,</span><span class="s">&quot;%I64u&quot;</span> <span class="p">},</span>
<span class="cp">#else</span>
    <span class="p">{</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ImS64</span><span class="p">),</span>            <span class="s">&quot;S64&quot;</span><span class="p">,</span>  <span class="s">&quot;%lld&quot;</span><span class="p">,</span> <span class="s">&quot;%lld&quot;</span>  <span class="p">},</span>  <span class="c1">// ImGuiDataType_S64</span>
    <span class="p">{</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ImU64</span><span class="p">),</span>            <span class="s">&quot;U64&quot;</span><span class="p">,</span>  <span class="s">&quot;%llu&quot;</span><span class="p">,</span> <span class="s">&quot;%llu&quot;</span>  <span class="p">},</span>
<span class="cp">#endif</span>
    <span class="p">{</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span>            <span class="s">&quot;float&quot;</span><span class="p">,</span> <span class="s">&quot;%f&quot;</span><span class="p">,</span>  <span class="s">&quot;%f&quot;</span>    <span class="p">},</span>  <span class="c1">// ImGuiDataType_Float (float are promoted to double in va_arg)</span>
    <span class="p">{</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">),</span>           <span class="s">&quot;double&quot;</span><span class="p">,</span><span class="s">&quot;%f&quot;</span><span class="p">,</span>  <span class="s">&quot;%lf&quot;</span>   <span class="p">},</span>  <span class="c1">// ImGuiDataType_Double</span>
<span class="p">};</span>
<span class="n">IM_STATIC_ASSERT</span><span class="p">(</span><span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">GDataTypeInfo</span><span class="p">)</span> <span class="o">==</span> <span class="n">ImGuiDataType_COUNT</span><span class="p">);</span>

<span class="c1">// FIXME-LEGACY: Prior to 1.61 our DragInt() function internally used floats and because of this the compile-time default value for format was &quot;%.0f&quot;.</span>
<span class="c1">// Even though we changed the compile-time default, we expect users to have carried %f around, which would break the display of DragInt() calls.</span>
<span class="c1">// To honor backward compatibility we are rewriting the format string, unless IMGUI_DISABLE_OBSOLETE_FUNCTIONS is enabled. What could possibly go wrong?!</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">PatchFormatStringFloatToInt</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;%&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;.&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;0&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;f&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// Fast legacy path for &quot;%.0f&quot; which is expected to be the most common case.</span>
        <span class="k">return</span> <span class="s">&quot;%d&quot;</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt_start</span> <span class="o">=</span> <span class="n">ImParseFormatFindStart</span><span class="p">(</span><span class="n">fmt</span><span class="p">);</span>    <span class="c1">// Find % (if any, and ignore %%)</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt_end</span> <span class="o">=</span> <span class="n">ImParseFormatFindEnd</span><span class="p">(</span><span class="n">fmt_start</span><span class="p">);</span>  <span class="c1">// Find end of format specifier, which itself is an exercise of confidence/recklessness (because snprintf is dependent on libc or user).</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fmt_end</span> <span class="o">&gt;</span> <span class="n">fmt_start</span> <span class="o">&amp;&amp;</span> <span class="n">fmt_end</span><span class="p">[</span><span class="mi">-1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;f&#39;</span><span class="p">)</span>
    <span class="p">{</span>
<span class="cp">#ifndef IMGUI_DISABLE_OBSOLETE_FUNCTIONS</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fmt_start</span> <span class="o">==</span> <span class="n">fmt</span> <span class="o">&amp;&amp;</span> <span class="n">fmt_end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&quot;%d&quot;</span><span class="p">;</span>
        <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
        <span class="n">ImFormatString</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">),</span> <span class="s">&quot;%.*s%%d%s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">fmt_start</span> <span class="o">-</span> <span class="n">fmt</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">fmt_end</span><span class="p">);</span> <span class="c1">// Honor leading and trailing decorations, but lose alignment/precision.</span>
        <span class="k">return</span> <span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">;</span>
<span class="cp">#else</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;DragInt(): Invalid format string!&quot;</span><span class="p">);</span> <span class="c1">// Old versions used a default parameter of &quot;%.0f&quot;, please replace with e.g. &quot;%d&quot;</span>
<span class="cp">#endif</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">const</span> <span class="n">ImGuiDataTypeInfo</span><span class="o">*</span> <span class="nf">ImGui::DataTypeGetInfo</span><span class="p">(</span><span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">data_type</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">data_type</span> <span class="o">&lt;</span> <span class="n">ImGuiDataType_COUNT</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="n">GDataTypeInfo</span><span class="p">[</span><span class="n">data_type</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">ImGui::DataTypeFormatString</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">buf_size</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_data</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Signedness doesn&#39;t matter when pushing integer arguments</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_S32</span> <span class="o">||</span> <span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_U32</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ImFormatString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU32</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_S64</span> <span class="o">||</span> <span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_U64</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ImFormatString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU64</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_Float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ImFormatString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_Double</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ImFormatString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_S8</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ImFormatString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS8</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_U8</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ImFormatString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU8</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_S16</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ImFormatString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_U16</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ImFormatString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span><span class="p">);</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::DataTypeApplyOp</span><span class="p">(</span><span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">op</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">output</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">arg1</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">arg2</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span> <span class="o">||</span> <span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">);</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">case</span> <span class="nl">ImGuiDataType_S8</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImS8</span><span class="o">*</span><span class="p">)</span><span class="n">output</span>  <span class="o">=</span> <span class="n">ImAddClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS8</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS8</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span>  <span class="n">IM_S8_MIN</span><span class="p">,</span>  <span class="n">IM_S8_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImS8</span><span class="o">*</span><span class="p">)</span><span class="n">output</span>  <span class="o">=</span> <span class="n">ImSubClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS8</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS8</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span>  <span class="n">IM_S8_MIN</span><span class="p">,</span>  <span class="n">IM_S8_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">ImGuiDataType_U8</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImU8</span><span class="o">*</span><span class="p">)</span><span class="n">output</span>  <span class="o">=</span> <span class="n">ImAddClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU8</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU8</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span>  <span class="n">IM_U8_MIN</span><span class="p">,</span>  <span class="n">IM_U8_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImU8</span><span class="o">*</span><span class="p">)</span><span class="n">output</span>  <span class="o">=</span> <span class="n">ImSubClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU8</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU8</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span>  <span class="n">IM_U8_MIN</span><span class="p">,</span>  <span class="n">IM_U8_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">ImGuiDataType_S16</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="n">ImAddClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span> <span class="n">IM_S16_MIN</span><span class="p">,</span> <span class="n">IM_S16_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="n">ImSubClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span> <span class="n">IM_S16_MIN</span><span class="p">,</span> <span class="n">IM_S16_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">ImGuiDataType_U16</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="n">ImAddClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span> <span class="n">IM_U16_MIN</span><span class="p">,</span> <span class="n">IM_U16_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="n">ImSubClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span> <span class="n">IM_U16_MIN</span><span class="p">,</span> <span class="n">IM_U16_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">ImGuiDataType_S32</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImS32</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="n">ImAddClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS32</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS32</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span> <span class="n">IM_S32_MIN</span><span class="p">,</span> <span class="n">IM_S32_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImS32</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="n">ImSubClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS32</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS32</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span> <span class="n">IM_S32_MIN</span><span class="p">,</span> <span class="n">IM_S32_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">ImGuiDataType_U32</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImU32</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="n">ImAddClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU32</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU32</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span> <span class="n">IM_U32_MIN</span><span class="p">,</span> <span class="n">IM_U32_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImU32</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="n">ImSubClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU32</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU32</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span> <span class="n">IM_U32_MIN</span><span class="p">,</span> <span class="n">IM_U32_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">ImGuiDataType_S64</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImS64</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="n">ImAddClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS64</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS64</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span> <span class="n">IM_S64_MIN</span><span class="p">,</span> <span class="n">IM_S64_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImS64</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="n">ImSubClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS64</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS64</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span> <span class="n">IM_S64_MIN</span><span class="p">,</span> <span class="n">IM_S64_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">ImGuiDataType_U64</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImU64</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="n">ImAddClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU64</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU64</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span> <span class="n">IM_U64_MIN</span><span class="p">,</span> <span class="n">IM_U64_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="n">ImU64</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="n">ImSubClampOverflow</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU64</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU64</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">,</span> <span class="n">IM_U64_MIN</span><span class="p">,</span> <span class="n">IM_U64_MAX</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">ImGuiDataType_Float</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span> <span class="o">+</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span> <span class="o">-</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">ImGuiDataType_Double</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span> <span class="o">+</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">output</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">arg1</span> <span class="o">-</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">arg2</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">ImGuiDataType_COUNT</span><span class="p">:</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// User can input math operators (e.g. +100) to edit a numerical values.</span>
<span class="c1">// NB: This is _not_ a full expression evaluator. We should probably add one and replace this dumb mess..</span>
<span class="kt">bool</span> <span class="nf">ImGui::DataTypeApplyOpFromText</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">initial_value_buf</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_data</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">ImCharIsBlankA</span><span class="p">(</span><span class="o">*</span><span class="n">buf</span><span class="p">))</span>
        <span class="n">buf</span><span class="o">++</span><span class="p">;</span>

    <span class="c1">// We don&#39;t support &#39;-&#39; op because it would conflict with inputing negative value.</span>
    <span class="c1">// Instead you can use +-100 to subtract from an existing value</span>
    <span class="kt">char</span> <span class="n">op</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span> <span class="o">||</span> <span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;*&#39;</span> <span class="o">||</span> <span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">buf</span><span class="o">++</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">ImCharIsBlankA</span><span class="p">(</span><span class="o">*</span><span class="n">buf</span><span class="p">))</span>
            <span class="n">buf</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">op</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Copy the value in an opaque buffer so we can compare at the end of the function if it changed at all.</span>
    <span class="k">const</span> <span class="n">ImGuiDataTypeInfo</span><span class="o">*</span> <span class="n">type_info</span> <span class="o">=</span> <span class="n">DataTypeGetInfo</span><span class="p">(</span><span class="n">data_type</span><span class="p">);</span>
    <span class="n">ImGuiDataTypeTempStorage</span> <span class="n">data_backup</span><span class="p">;</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data_backup</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">type_info</span><span class="o">-&gt;</span><span class="n">Size</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">format</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">type_info</span><span class="o">-&gt;</span><span class="n">ScanFmt</span><span class="p">;</span>

    <span class="c1">// FIXME-LEGACY: The aim is to remove those operators and write a proper expression evaluator at some point..</span>
    <span class="kt">int</span> <span class="n">arg1i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_S32</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span><span class="o">*</span> <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">arg0i</span> <span class="o">=</span> <span class="o">*</span><span class="n">v</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">arg1f</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">&amp;&amp;</span> <span class="n">sscanf</span><span class="p">(</span><span class="n">initial_value_buf</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg0i</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="c1">// Store operand in a float so we can use fractional value for multipliers (*1.1), but constant always parsed as integer so we can fit big integers (e.g. 2000000003) past float precision</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span>      <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg1i</span><span class="p">))</span> <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">arg0i</span> <span class="o">+</span> <span class="n">arg1i</span><span class="p">);</span> <span class="p">}</span>                   <span class="c1">// Add (use &quot;+-&quot; to subtract)</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;*&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%f&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg1f</span><span class="p">))</span> <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">arg0i</span> <span class="o">*</span> <span class="n">arg1f</span><span class="p">);</span> <span class="p">}</span>                   <span class="c1">// Multiply</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%f&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg1f</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">arg1f</span> <span class="o">!=</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">arg0i</span> <span class="o">/</span> <span class="n">arg1f</span><span class="p">);</span> <span class="p">}</span>  <span class="c1">// Divide</span>
        <span class="k">else</span>                <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg1i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="n">arg1i</span><span class="p">;</span> <span class="p">}</span>                           <span class="c1">// Assign constant</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_Float</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// For floats we have to ignore format with precision (e.g. &quot;%.2f&quot;) because sscanf doesn&#39;t take them in</span>
        <span class="n">format</span> <span class="o">=</span> <span class="s">&quot;%f&quot;</span><span class="p">;</span>
        <span class="kt">float</span><span class="o">*</span> <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">arg0f</span> <span class="o">=</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">arg1f</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">&amp;&amp;</span> <span class="n">sscanf</span><span class="p">(</span><span class="n">initial_value_buf</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg0f</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg1f</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span>      <span class="p">{</span> <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="n">arg0f</span> <span class="o">+</span> <span class="n">arg1f</span><span class="p">;</span> <span class="p">}</span>                    <span class="c1">// Add (use &quot;+-&quot; to subtract)</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;*&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="n">arg0f</span> <span class="o">*</span> <span class="n">arg1f</span><span class="p">;</span> <span class="p">}</span>                    <span class="c1">// Multiply</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">arg1f</span> <span class="o">!=</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="n">arg0f</span> <span class="o">/</span> <span class="n">arg1f</span><span class="p">;</span> <span class="p">}</span> <span class="c1">// Divide</span>
        <span class="k">else</span>                <span class="p">{</span> <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="n">arg1f</span><span class="p">;</span> <span class="p">}</span>                            <span class="c1">// Assign constant</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_Double</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">format</span> <span class="o">=</span> <span class="s">&quot;%lf&quot;</span><span class="p">;</span> <span class="c1">// scanf differentiate float/double unlike printf which forces everything to double because of ellipsis</span>
        <span class="kt">double</span><span class="o">*</span> <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">arg0f</span> <span class="o">=</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">arg1f</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">&amp;&amp;</span> <span class="n">sscanf</span><span class="p">(</span><span class="n">initial_value_buf</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg0f</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg1f</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span>      <span class="p">{</span> <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="n">arg0f</span> <span class="o">+</span> <span class="n">arg1f</span><span class="p">;</span> <span class="p">}</span>                    <span class="c1">// Add (use &quot;+-&quot; to subtract)</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;*&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="n">arg0f</span> <span class="o">*</span> <span class="n">arg1f</span><span class="p">;</span> <span class="p">}</span>                    <span class="c1">// Multiply</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">arg1f</span> <span class="o">!=</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="n">arg0f</span> <span class="o">/</span> <span class="n">arg1f</span><span class="p">;</span> <span class="p">}</span> <span class="c1">// Divide</span>
        <span class="k">else</span>                <span class="p">{</span> <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="n">arg1f</span><span class="p">;</span> <span class="p">}</span>                            <span class="c1">// Assign constant</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_U32</span> <span class="o">||</span> <span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_S64</span> <span class="o">||</span> <span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_U64</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// All other types assign constant</span>
        <span class="c1">// We don&#39;t bother handling support for legacy operators since they are a little too crappy. Instead we will later implement a proper expression evaluator in the future.</span>
        <span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">p_data</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// Small types need a 32-bit buffer to receive the result from scanf()</span>
        <span class="kt">int</span> <span class="n">v32</span><span class="p">;</span>
        <span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v32</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_S8</span><span class="p">)</span>
            <span class="o">*</span><span class="p">(</span><span class="n">ImS8</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImS8</span><span class="p">)</span><span class="n">ImClamp</span><span class="p">(</span><span class="n">v32</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">IM_S8_MIN</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">IM_S8_MAX</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_U8</span><span class="p">)</span>
            <span class="o">*</span><span class="p">(</span><span class="n">ImU8</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImU8</span><span class="p">)</span><span class="n">ImClamp</span><span class="p">(</span><span class="n">v32</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">IM_U8_MIN</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">IM_U8_MAX</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_S16</span><span class="p">)</span>
            <span class="o">*</span><span class="p">(</span><span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImS16</span><span class="p">)</span><span class="n">ImClamp</span><span class="p">(</span><span class="n">v32</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">IM_S16_MIN</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">IM_S16_MAX</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_U16</span><span class="p">)</span>
            <span class="o">*</span><span class="p">(</span><span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImU16</span><span class="p">)</span><span class="n">ImClamp</span><span class="p">(</span><span class="n">v32</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">IM_U16_MIN</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">IM_U16_MAX</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="n">IM_ASSERT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">memcmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data_backup</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">type_info</span><span class="o">-&gt;</span><span class="n">Size</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">DataTypeCompareT</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">*</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">*</span> <span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">lhs</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">rhs</span><span class="p">)</span> <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">lhs</span> <span class="o">&gt;</span> <span class="o">*</span><span class="n">rhs</span><span class="p">)</span> <span class="k">return</span> <span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DataTypeCompare</span><span class="p">(</span><span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">arg_1</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">arg_2</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S8</span><span class="p">:</span>     <span class="k">return</span> <span class="n">DataTypeCompareT</span><span class="o">&lt;</span><span class="n">ImS8</span>  <span class="o">&gt;</span><span class="p">((</span><span class="k">const</span> <span class="n">ImS8</span><span class="o">*</span>  <span class="p">)</span><span class="n">arg_1</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImS8</span><span class="o">*</span>  <span class="p">)</span><span class="n">arg_2</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U8</span><span class="p">:</span>     <span class="k">return</span> <span class="n">DataTypeCompareT</span><span class="o">&lt;</span><span class="n">ImU8</span>  <span class="o">&gt;</span><span class="p">((</span><span class="k">const</span> <span class="n">ImU8</span><span class="o">*</span>  <span class="p">)</span><span class="n">arg_1</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImU8</span><span class="o">*</span>  <span class="p">)</span><span class="n">arg_2</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S16</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DataTypeCompareT</span><span class="o">&lt;</span><span class="n">ImS16</span> <span class="o">&gt;</span><span class="p">((</span><span class="k">const</span> <span class="n">ImS16</span><span class="o">*</span> <span class="p">)</span><span class="n">arg_1</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImS16</span><span class="o">*</span> <span class="p">)</span><span class="n">arg_2</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U16</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DataTypeCompareT</span><span class="o">&lt;</span><span class="n">ImU16</span> <span class="o">&gt;</span><span class="p">((</span><span class="k">const</span> <span class="n">ImU16</span><span class="o">*</span> <span class="p">)</span><span class="n">arg_1</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImU16</span><span class="o">*</span> <span class="p">)</span><span class="n">arg_2</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S32</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DataTypeCompareT</span><span class="o">&lt;</span><span class="n">ImS32</span> <span class="o">&gt;</span><span class="p">((</span><span class="k">const</span> <span class="n">ImS32</span><span class="o">*</span> <span class="p">)</span><span class="n">arg_1</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImS32</span><span class="o">*</span> <span class="p">)</span><span class="n">arg_2</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U32</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DataTypeCompareT</span><span class="o">&lt;</span><span class="n">ImU32</span> <span class="o">&gt;</span><span class="p">((</span><span class="k">const</span> <span class="n">ImU32</span><span class="o">*</span> <span class="p">)</span><span class="n">arg_1</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImU32</span><span class="o">*</span> <span class="p">)</span><span class="n">arg_2</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S64</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DataTypeCompareT</span><span class="o">&lt;</span><span class="n">ImS64</span> <span class="o">&gt;</span><span class="p">((</span><span class="k">const</span> <span class="n">ImS64</span><span class="o">*</span> <span class="p">)</span><span class="n">arg_1</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImS64</span><span class="o">*</span> <span class="p">)</span><span class="n">arg_2</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U64</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DataTypeCompareT</span><span class="o">&lt;</span><span class="n">ImU64</span> <span class="o">&gt;</span><span class="p">((</span><span class="k">const</span> <span class="n">ImU64</span><span class="o">*</span> <span class="p">)</span><span class="n">arg_1</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImU64</span><span class="o">*</span> <span class="p">)</span><span class="n">arg_2</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_Float</span><span class="p">:</span>  <span class="k">return</span> <span class="n">DataTypeCompareT</span><span class="o">&lt;</span><span class="kt">float</span> <span class="o">&gt;</span><span class="p">((</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="p">)</span><span class="n">arg_1</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="p">)</span><span class="n">arg_2</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_Double</span><span class="p">:</span> <span class="k">return</span> <span class="n">DataTypeCompareT</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">((</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">arg_1</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">arg_2</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_COUNT</span><span class="p">:</span>  <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="n">DataTypeClampT</span><span class="p">(</span><span class="n">T</span><span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">*</span> <span class="n">v_min</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">*</span> <span class="n">v_max</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Clamp, both sides are optional, return true if modified</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">v</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">v_min</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="o">*</span><span class="n">v_min</span><span class="p">;</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">v_max</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">v</span> <span class="o">&gt;</span> <span class="o">*</span><span class="n">v_max</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="o">*</span><span class="n">v_max</span><span class="p">;</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DataTypeClamp</span><span class="p">(</span><span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_data</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_min</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_max</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S8</span><span class="p">:</span>     <span class="k">return</span> <span class="n">DataTypeClampT</span><span class="o">&lt;</span><span class="n">ImS8</span>  <span class="o">&gt;</span><span class="p">((</span><span class="n">ImS8</span><span class="o">*</span>  <span class="p">)</span><span class="n">p_data</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImS8</span><span class="o">*</span>  <span class="p">)</span><span class="n">p_min</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImS8</span><span class="o">*</span>  <span class="p">)</span><span class="n">p_max</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U8</span><span class="p">:</span>     <span class="k">return</span> <span class="n">DataTypeClampT</span><span class="o">&lt;</span><span class="n">ImU8</span>  <span class="o">&gt;</span><span class="p">((</span><span class="n">ImU8</span><span class="o">*</span>  <span class="p">)</span><span class="n">p_data</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImU8</span><span class="o">*</span>  <span class="p">)</span><span class="n">p_min</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImU8</span><span class="o">*</span>  <span class="p">)</span><span class="n">p_max</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S16</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DataTypeClampT</span><span class="o">&lt;</span><span class="n">ImS16</span> <span class="o">&gt;</span><span class="p">((</span><span class="n">ImS16</span><span class="o">*</span> <span class="p">)</span><span class="n">p_data</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImS16</span><span class="o">*</span> <span class="p">)</span><span class="n">p_min</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImS16</span><span class="o">*</span> <span class="p">)</span><span class="n">p_max</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U16</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DataTypeClampT</span><span class="o">&lt;</span><span class="n">ImU16</span> <span class="o">&gt;</span><span class="p">((</span><span class="n">ImU16</span><span class="o">*</span> <span class="p">)</span><span class="n">p_data</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImU16</span><span class="o">*</span> <span class="p">)</span><span class="n">p_min</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImU16</span><span class="o">*</span> <span class="p">)</span><span class="n">p_max</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S32</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DataTypeClampT</span><span class="o">&lt;</span><span class="n">ImS32</span> <span class="o">&gt;</span><span class="p">((</span><span class="n">ImS32</span><span class="o">*</span> <span class="p">)</span><span class="n">p_data</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImS32</span><span class="o">*</span> <span class="p">)</span><span class="n">p_min</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImS32</span><span class="o">*</span> <span class="p">)</span><span class="n">p_max</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U32</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DataTypeClampT</span><span class="o">&lt;</span><span class="n">ImU32</span> <span class="o">&gt;</span><span class="p">((</span><span class="n">ImU32</span><span class="o">*</span> <span class="p">)</span><span class="n">p_data</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImU32</span><span class="o">*</span> <span class="p">)</span><span class="n">p_min</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImU32</span><span class="o">*</span> <span class="p">)</span><span class="n">p_max</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S64</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DataTypeClampT</span><span class="o">&lt;</span><span class="n">ImS64</span> <span class="o">&gt;</span><span class="p">((</span><span class="n">ImS64</span><span class="o">*</span> <span class="p">)</span><span class="n">p_data</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImS64</span><span class="o">*</span> <span class="p">)</span><span class="n">p_min</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImS64</span><span class="o">*</span> <span class="p">)</span><span class="n">p_max</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U64</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DataTypeClampT</span><span class="o">&lt;</span><span class="n">ImU64</span> <span class="o">&gt;</span><span class="p">((</span><span class="n">ImU64</span><span class="o">*</span> <span class="p">)</span><span class="n">p_data</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImU64</span><span class="o">*</span> <span class="p">)</span><span class="n">p_min</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImU64</span><span class="o">*</span> <span class="p">)</span><span class="n">p_max</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_Float</span><span class="p">:</span>  <span class="k">return</span> <span class="n">DataTypeClampT</span><span class="o">&lt;</span><span class="kt">float</span> <span class="o">&gt;</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span> <span class="p">)</span><span class="n">p_data</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="p">)</span><span class="n">p_min</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="p">)</span><span class="n">p_max</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_Double</span><span class="p">:</span> <span class="k">return</span> <span class="n">DataTypeClampT</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">((</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">p_min</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_COUNT</span><span class="p">:</span>  <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">float</span> <span class="n">GetMinimumStepAtDecimalPrecision</span><span class="p">(</span><span class="kt">int</span> <span class="n">decimal_precision</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">min_steps</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.1f</span><span class="p">,</span> <span class="mf">0.01f</span><span class="p">,</span> <span class="mf">0.001f</span><span class="p">,</span> <span class="mf">0.0001f</span><span class="p">,</span> <span class="mf">0.00001f</span><span class="p">,</span> <span class="mf">0.000001f</span><span class="p">,</span> <span class="mf">0.0000001f</span><span class="p">,</span> <span class="mf">0.00000001f</span><span class="p">,</span> <span class="mf">0.000000001f</span> <span class="p">};</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">decimal_precision</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FLT_MIN</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">decimal_precision</span> <span class="o">&lt;</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">min_steps</span><span class="p">))</span> <span class="o">?</span> <span class="n">min_steps</span><span class="p">[</span><span class="n">decimal_precision</span><span class="p">]</span> <span class="o">:</span> <span class="n">ImPow</span><span class="p">(</span><span class="mf">10.0f</span><span class="p">,</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="o">-</span><span class="n">decimal_precision</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">TYPE</span><span class="o">&gt;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">ImAtoi</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span> <span class="n">TYPE</span><span class="o">*</span> <span class="n">output</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">negative</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">src</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="n">negative</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">src</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">src</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="n">src</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">TYPE</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">src</span> <span class="o">&gt;=</span> <span class="sc">&#39;0&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">src</span> <span class="o">&lt;=</span> <span class="sc">&#39;9&#39;</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">);</span>
    <span class="o">*</span><span class="n">output</span> <span class="o">=</span> <span class="n">negative</span> <span class="o">?</span> <span class="o">-</span><span class="nl">v</span> <span class="p">:</span> <span class="n">v</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">src</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">TYPE</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">SIGNEDTYPE</span><span class="o">&gt;</span>
<span class="n">TYPE</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">RoundScalarWithFormatT</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">TYPE</span> <span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt_start</span> <span class="o">=</span> <span class="n">ImParseFormatFindStart</span><span class="p">(</span><span class="n">format</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fmt_start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;%&#39;</span> <span class="o">||</span> <span class="n">fmt_start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;%&#39;</span><span class="p">)</span> <span class="c1">// Don&#39;t apply if the value is not visible in the format string</span>
        <span class="k">return</span> <span class="n">v</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">v_str</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
    <span class="n">ImFormatString</span><span class="p">(</span><span class="n">v_str</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">v_str</span><span class="p">),</span> <span class="n">fmt_start</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">v_str</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_Float</span> <span class="o">||</span> <span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_Double</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">TYPE</span><span class="p">)</span><span class="n">ImAtof</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="n">ImAtoi</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="p">(</span><span class="n">SIGNEDTYPE</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">v</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: DragScalar, DragFloat, DragInt, etc.</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - DragBehaviorT&lt;&gt;() [Internal]</span>
<span class="c1">// - DragBehavior() [Internal]</span>
<span class="c1">// - DragScalar()</span>
<span class="c1">// - DragScalarN()</span>
<span class="c1">// - DragFloat()</span>
<span class="c1">// - DragFloat2()</span>
<span class="c1">// - DragFloat3()</span>
<span class="c1">// - DragFloat4()</span>
<span class="c1">// - DragFloatRange2()</span>
<span class="c1">// - DragInt()</span>
<span class="c1">// - DragInt2()</span>
<span class="c1">// - DragInt3()</span>
<span class="c1">// - DragInt4()</span>
<span class="c1">// - DragIntRange2()</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="c1">// This is called by DragBehavior() when the widget is active (held by mouse or being manipulated with Nav controls)</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">TYPE</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">SIGNEDTYPE</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">FLOATTYPE</span><span class="o">&gt;</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragBehaviorT</span><span class="p">(</span><span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">TYPE</span><span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="k">const</span> <span class="n">TYPE</span> <span class="n">v_min</span><span class="p">,</span> <span class="k">const</span> <span class="n">TYPE</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiAxis</span> <span class="n">axis</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSliderFlags_Vertical</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiAxis_Y</span> <span class="p">:</span> <span class="n">ImGuiAxis_X</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_decimal</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_Float</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_Double</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_clamped</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">&lt;</span> <span class="n">v_max</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_logarithmic</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSliderFlags_Logarithmic</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">is_decimal</span><span class="p">;</span>

    <span class="c1">// Default tweak speed</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">v_speed</span> <span class="o">==</span> <span class="mf">0.0f</span> <span class="o">&amp;&amp;</span> <span class="n">is_clamped</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">v_max</span> <span class="o">-</span> <span class="n">v_min</span> <span class="o">&lt;</span> <span class="n">FLT_MAX</span><span class="p">))</span>
        <span class="n">v_speed</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)((</span><span class="n">v_max</span> <span class="o">-</span> <span class="n">v_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">.</span><span class="n">DragSpeedDefaultRatio</span><span class="p">);</span>

    <span class="c1">// Inputs accumulates into g.DragCurrentAccum, which is flushed into the current value as soon as it makes a difference with our precision settings</span>
    <span class="kt">float</span> <span class="n">adjust_delta</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdSource</span> <span class="o">==</span> <span class="n">ImGuiInputSource_Mouse</span> <span class="o">&amp;&amp;</span> <span class="n">IsMousePosValid</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseDragMaxDistanceSqr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0f</span> <span class="o">*</span> <span class="mf">1.0f</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">adjust_delta</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseDelta</span><span class="p">[</span><span class="n">axis</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyAlt</span><span class="p">)</span>
            <span class="n">adjust_delta</span> <span class="o">*=</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="mf">100.0f</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyShift</span><span class="p">)</span>
            <span class="n">adjust_delta</span> <span class="o">*=</span> <span class="mf">10.0f</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdSource</span> <span class="o">==</span> <span class="n">ImGuiInputSource_Nav</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">decimal_precision</span> <span class="o">=</span> <span class="n">is_decimal</span> <span class="o">?</span> <span class="n">ImParseFormatPrecision</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">adjust_delta</span> <span class="o">=</span> <span class="n">GetNavInputAmount2d</span><span class="p">(</span><span class="n">ImGuiNavDirSourceFlags_Keyboard</span> <span class="o">|</span> <span class="n">ImGuiNavDirSourceFlags_PadDPad</span><span class="p">,</span> <span class="n">ImGuiInputReadMode_RepeatFast</span><span class="p">,</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="mf">10.0f</span><span class="p">,</span> <span class="mf">10.0f</span><span class="p">)[</span><span class="n">axis</span><span class="p">];</span>
        <span class="n">v_speed</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">v_speed</span><span class="p">,</span> <span class="n">GetMinimumStepAtDecimalPrecision</span><span class="p">(</span><span class="n">decimal_precision</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="n">adjust_delta</span> <span class="o">*=</span> <span class="n">v_speed</span><span class="p">;</span>

    <span class="c1">// For vertical drag we currently assume that Up=higher value (like we do with vertical sliders). This may become a parameter.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">axis</span> <span class="o">==</span> <span class="n">ImGuiAxis_Y</span><span class="p">)</span>
        <span class="n">adjust_delta</span> <span class="o">=</span> <span class="o">-</span><span class="n">adjust_delta</span><span class="p">;</span>

    <span class="c1">// For logarithmic use our range is effectively 0..1 so scale the delta into that range</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_logarithmic</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">v_max</span> <span class="o">-</span> <span class="n">v_min</span> <span class="o">&lt;</span> <span class="n">FLT_MAX</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">v_max</span> <span class="o">-</span> <span class="n">v_min</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.000001f</span><span class="p">))</span> <span class="c1">// Epsilon to avoid /0</span>
        <span class="n">adjust_delta</span> <span class="o">/=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">v_max</span> <span class="o">-</span> <span class="n">v_min</span><span class="p">);</span>

    <span class="c1">// Clear current value on activation</span>
    <span class="c1">// Avoid altering values and clamping when we are _already_ past the limits and heading in the same direction, so e.g. if range is 0..255, current value is 300 and we are pushing to the right side, keep the 300.</span>
    <span class="kt">bool</span> <span class="n">is_just_activated</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdIsJustActivated</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">is_already_past_limits_and_pushing_outward</span> <span class="o">=</span> <span class="n">is_clamped</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="o">*</span><span class="n">v</span> <span class="o">&gt;=</span> <span class="n">v_max</span> <span class="o">&amp;&amp;</span> <span class="n">adjust_delta</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">*</span><span class="n">v</span> <span class="o">&lt;=</span> <span class="n">v_min</span> <span class="o">&amp;&amp;</span> <span class="n">adjust_delta</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_just_activated</span> <span class="o">||</span> <span class="n">is_already_past_limits_and_pushing_outward</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">g</span><span class="p">.</span><span class="n">DragCurrentAccum</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
        <span class="n">g</span><span class="p">.</span><span class="n">DragCurrentAccumDirty</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">adjust_delta</span> <span class="o">!=</span> <span class="mf">0.0f</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">g</span><span class="p">.</span><span class="n">DragCurrentAccum</span> <span class="o">+=</span> <span class="n">adjust_delta</span><span class="p">;</span>
        <span class="n">g</span><span class="p">.</span><span class="n">DragCurrentAccumDirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">DragCurrentAccumDirty</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">TYPE</span> <span class="n">v_cur</span> <span class="o">=</span> <span class="o">*</span><span class="n">v</span><span class="p">;</span>
    <span class="n">FLOATTYPE</span> <span class="n">v_old_ref_for_accum_remainder</span> <span class="o">=</span> <span class="p">(</span><span class="n">FLOATTYPE</span><span class="p">)</span><span class="mf">0.0f</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">logarithmic_zero_epsilon</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span> <span class="c1">// Only valid when is_logarithmic is true</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">zero_deadzone_halfsize</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span> <span class="c1">// Drag widgets have no deadzone (as it doesn&#39;t make sense)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_logarithmic</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// When using logarithmic sliders, we need to clamp to avoid hitting zero, but our choice of clamp value greatly affects slider precision. We attempt to use the specified precision to estimate a good lower bound.</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">decimal_precision</span> <span class="o">=</span> <span class="n">is_decimal</span> <span class="o">?</span> <span class="n">ImParseFormatPrecision</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">logarithmic_zero_epsilon</span> <span class="o">=</span> <span class="n">ImPow</span><span class="p">(</span><span class="mf">0.1f</span><span class="p">,</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">decimal_precision</span><span class="p">);</span>

        <span class="c1">// Convert to parametric space, apply delta, convert back</span>
        <span class="kt">float</span> <span class="n">v_old_parametric</span> <span class="o">=</span> <span class="n">ScaleRatioFromValueT</span><span class="o">&lt;</span><span class="n">TYPE</span><span class="p">,</span> <span class="n">SIGNEDTYPE</span><span class="p">,</span> <span class="n">FLOATTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">v_cur</span><span class="p">,</span> <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">,</span> <span class="n">is_logarithmic</span><span class="p">,</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">,</span> <span class="n">zero_deadzone_halfsize</span><span class="p">);</span>
        <span class="kt">float</span> <span class="n">v_new_parametric</span> <span class="o">=</span> <span class="n">v_old_parametric</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">DragCurrentAccum</span><span class="p">;</span>
        <span class="n">v_cur</span> <span class="o">=</span> <span class="n">ScaleValueFromRatioT</span><span class="o">&lt;</span><span class="n">TYPE</span><span class="p">,</span> <span class="n">SIGNEDTYPE</span><span class="p">,</span> <span class="n">FLOATTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">v_new_parametric</span><span class="p">,</span> <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">,</span> <span class="n">is_logarithmic</span><span class="p">,</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">,</span> <span class="n">zero_deadzone_halfsize</span><span class="p">);</span>
        <span class="n">v_old_ref_for_accum_remainder</span> <span class="o">=</span> <span class="n">v_old_parametric</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">v_cur</span> <span class="o">+=</span> <span class="p">(</span><span class="n">SIGNEDTYPE</span><span class="p">)</span><span class="n">g</span><span class="p">.</span><span class="n">DragCurrentAccum</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Round to user desired precision based on format string</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSliderFlags_NoRoundToFormat</span><span class="p">))</span>
        <span class="n">v_cur</span> <span class="o">=</span> <span class="n">RoundScalarWithFormatT</span><span class="o">&lt;</span><span class="n">TYPE</span><span class="p">,</span> <span class="n">SIGNEDTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">v_cur</span><span class="p">);</span>

    <span class="c1">// Preserve remainder after rounding has been applied. This also allow slow tweaking of values.</span>
    <span class="n">g</span><span class="p">.</span><span class="n">DragCurrentAccumDirty</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_logarithmic</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Convert to parametric space, apply delta, convert back</span>
        <span class="kt">float</span> <span class="n">v_new_parametric</span> <span class="o">=</span> <span class="n">ScaleRatioFromValueT</span><span class="o">&lt;</span><span class="n">TYPE</span><span class="p">,</span> <span class="n">SIGNEDTYPE</span><span class="p">,</span> <span class="n">FLOATTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">v_cur</span><span class="p">,</span> <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">,</span> <span class="n">is_logarithmic</span><span class="p">,</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">,</span> <span class="n">zero_deadzone_halfsize</span><span class="p">);</span>
        <span class="n">g</span><span class="p">.</span><span class="n">DragCurrentAccum</span> <span class="o">-=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">v_new_parametric</span> <span class="o">-</span> <span class="n">v_old_ref_for_accum_remainder</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">g</span><span class="p">.</span><span class="n">DragCurrentAccum</span> <span class="o">-=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)((</span><span class="n">SIGNEDTYPE</span><span class="p">)</span><span class="n">v_cur</span> <span class="o">-</span> <span class="p">(</span><span class="n">SIGNEDTYPE</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Lose zero sign for float/double</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">v_cur</span> <span class="o">==</span> <span class="p">(</span><span class="n">TYPE</span><span class="p">)</span><span class="mi">-0</span><span class="p">)</span>
        <span class="n">v_cur</span> <span class="o">=</span> <span class="p">(</span><span class="n">TYPE</span><span class="p">)</span><span class="mi">0</span><span class="p">;</span>

    <span class="c1">// Clamp values (+ handle overflow/wrap-around for integer types)</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">v</span> <span class="o">!=</span> <span class="n">v_cur</span> <span class="o">&amp;&amp;</span> <span class="n">is_clamped</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">v_cur</span> <span class="o">&lt;</span> <span class="n">v_min</span> <span class="o">||</span> <span class="p">(</span><span class="n">v_cur</span> <span class="o">&gt;</span> <span class="o">*</span><span class="n">v</span> <span class="o">&amp;&amp;</span> <span class="n">adjust_delta</span> <span class="o">&lt;</span> <span class="mf">0.0f</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_decimal</span><span class="p">))</span>
            <span class="n">v_cur</span> <span class="o">=</span> <span class="n">v_min</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">v_cur</span> <span class="o">&gt;</span> <span class="n">v_max</span> <span class="o">||</span> <span class="p">(</span><span class="n">v_cur</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">v</span> <span class="o">&amp;&amp;</span> <span class="n">adjust_delta</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_decimal</span><span class="p">))</span>
            <span class="n">v_cur</span> <span class="o">=</span> <span class="n">v_max</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Apply result</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">v</span> <span class="o">==</span> <span class="n">v_cur</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="n">v_cur</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragBehavior</span><span class="p">(</span><span class="n">ImGuiID</span> <span class="n">id</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_v</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_min</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Read imgui.cpp &quot;API BREAKING CHANGES&quot; section for 1.78 if you hit this assert.</span>
    <span class="n">IM_ASSERT</span><span class="p">((</span><span class="n">flags</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSliderFlags_InvalidMask_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;Invalid ImGuiSliderFlags flags! Has the &#39;float power&#39; argument been mistakenly cast to flags? Call function with ImGuiSliderFlags_Logarithmic flags instead.&quot;</span><span class="p">);</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdSource</span> <span class="o">==</span> <span class="n">ImGuiInputSource_Mouse</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ClearActiveID</span><span class="p">();</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdSource</span> <span class="o">==</span> <span class="n">ImGuiInputSource_Nav</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavActivatePressedId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdIsJustActivated</span><span class="p">)</span>
            <span class="n">ClearActiveID</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">!=</span> <span class="n">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">&amp;</span> <span class="n">ImGuiItemFlags_ReadOnly</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSliderFlags_ReadOnly</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S8</span><span class="p">:</span>     <span class="p">{</span> <span class="n">ImS32</span> <span class="n">v32</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImS32</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ImS8</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">;</span>  <span class="kt">bool</span> <span class="n">r</span> <span class="o">=</span> <span class="n">DragBehaviorT</span><span class="o">&lt;</span><span class="n">ImS32</span><span class="p">,</span> <span class="n">ImS32</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v32</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="n">p_min</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS8</span><span class="o">*</span><span class="p">)</span> <span class="nl">p_min</span> <span class="p">:</span> <span class="n">IM_S8_MIN</span><span class="p">,</span>  <span class="n">p_max</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS8</span><span class="o">*</span><span class="p">)</span><span class="nl">p_max</span>  <span class="p">:</span> <span class="n">IM_S8_MAX</span><span class="p">,</span>  <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">ImS8</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImS8</span><span class="p">)</span><span class="n">v32</span><span class="p">;</span> <span class="k">return</span> <span class="n">r</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U8</span><span class="p">:</span>     <span class="p">{</span> <span class="n">ImU32</span> <span class="n">v32</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImU32</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ImU8</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">;</span>  <span class="kt">bool</span> <span class="n">r</span> <span class="o">=</span> <span class="n">DragBehaviorT</span><span class="o">&lt;</span><span class="n">ImU32</span><span class="p">,</span> <span class="n">ImS32</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ImGuiDataType_U32</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v32</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="n">p_min</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU8</span><span class="o">*</span><span class="p">)</span> <span class="nl">p_min</span> <span class="p">:</span> <span class="n">IM_U8_MIN</span><span class="p">,</span>  <span class="n">p_max</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU8</span><span class="o">*</span><span class="p">)</span><span class="nl">p_max</span>  <span class="p">:</span> <span class="n">IM_U8_MAX</span><span class="p">,</span>  <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">ImU8</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImU8</span><span class="p">)</span><span class="n">v32</span><span class="p">;</span> <span class="k">return</span> <span class="n">r</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S16</span><span class="p">:</span>    <span class="p">{</span> <span class="n">ImS32</span> <span class="n">v32</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImS32</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">;</span> <span class="kt">bool</span> <span class="n">r</span> <span class="o">=</span> <span class="n">DragBehaviorT</span><span class="o">&lt;</span><span class="n">ImS32</span><span class="p">,</span> <span class="n">ImS32</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v32</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="n">p_min</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="nl">p_min</span> <span class="p">:</span> <span class="n">IM_S16_MIN</span><span class="p">,</span> <span class="n">p_max</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="nl">p_max</span> <span class="p">:</span> <span class="n">IM_S16_MAX</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImS16</span><span class="p">)</span><span class="n">v32</span><span class="p">;</span> <span class="k">return</span> <span class="n">r</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U16</span><span class="p">:</span>    <span class="p">{</span> <span class="n">ImU32</span> <span class="n">v32</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImU32</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">;</span> <span class="kt">bool</span> <span class="n">r</span> <span class="o">=</span> <span class="n">DragBehaviorT</span><span class="o">&lt;</span><span class="n">ImU32</span><span class="p">,</span> <span class="n">ImS32</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ImGuiDataType_U32</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v32</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="n">p_min</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="nl">p_min</span> <span class="p">:</span> <span class="n">IM_U16_MIN</span><span class="p">,</span> <span class="n">p_max</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="nl">p_max</span> <span class="p">:</span> <span class="n">IM_U16_MAX</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImU16</span><span class="p">)</span><span class="n">v32</span><span class="p">;</span> <span class="k">return</span> <span class="n">r</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S32</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DragBehaviorT</span><span class="o">&lt;</span><span class="n">ImS32</span><span class="p">,</span> <span class="n">ImS32</span><span class="p">,</span> <span class="kt">float</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="p">(</span><span class="n">ImS32</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">,</span>  <span class="n">v_speed</span><span class="p">,</span> <span class="n">p_min</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS32</span><span class="o">*</span> <span class="p">)</span><span class="nl">p_min</span> <span class="p">:</span> <span class="n">IM_S32_MIN</span><span class="p">,</span> <span class="n">p_max</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS32</span><span class="o">*</span> <span class="p">)</span><span class="nl">p_max</span> <span class="p">:</span> <span class="n">IM_S32_MAX</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U32</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DragBehaviorT</span><span class="o">&lt;</span><span class="n">ImU32</span><span class="p">,</span> <span class="n">ImS32</span><span class="p">,</span> <span class="kt">float</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="p">(</span><span class="n">ImU32</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">,</span>  <span class="n">v_speed</span><span class="p">,</span> <span class="n">p_min</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU32</span><span class="o">*</span> <span class="p">)</span><span class="nl">p_min</span> <span class="p">:</span> <span class="n">IM_U32_MIN</span><span class="p">,</span> <span class="n">p_max</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU32</span><span class="o">*</span> <span class="p">)</span><span class="nl">p_max</span> <span class="p">:</span> <span class="n">IM_U32_MAX</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S64</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DragBehaviorT</span><span class="o">&lt;</span><span class="n">ImS64</span><span class="p">,</span> <span class="n">ImS64</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="p">(</span><span class="n">ImS64</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">,</span>  <span class="n">v_speed</span><span class="p">,</span> <span class="n">p_min</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS64</span><span class="o">*</span> <span class="p">)</span><span class="nl">p_min</span> <span class="p">:</span> <span class="n">IM_S64_MIN</span><span class="p">,</span> <span class="n">p_max</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS64</span><span class="o">*</span> <span class="p">)</span><span class="nl">p_max</span> <span class="p">:</span> <span class="n">IM_S64_MAX</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U64</span><span class="p">:</span>    <span class="k">return</span> <span class="n">DragBehaviorT</span><span class="o">&lt;</span><span class="n">ImU64</span><span class="p">,</span> <span class="n">ImS64</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="p">(</span><span class="n">ImU64</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">,</span>  <span class="n">v_speed</span><span class="p">,</span> <span class="n">p_min</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU64</span><span class="o">*</span> <span class="p">)</span><span class="nl">p_min</span> <span class="p">:</span> <span class="n">IM_U64_MIN</span><span class="p">,</span> <span class="n">p_max</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU64</span><span class="o">*</span> <span class="p">)</span><span class="nl">p_max</span> <span class="p">:</span> <span class="n">IM_U64_MAX</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_Float</span><span class="p">:</span>  <span class="k">return</span> <span class="n">DragBehaviorT</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="p">,</span> <span class="kt">float</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">,</span>  <span class="n">v_speed</span><span class="p">,</span> <span class="n">p_min</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="p">)</span><span class="nl">p_min</span> <span class="p">:</span> <span class="o">-</span><span class="n">FLT_MAX</span><span class="p">,</span>   <span class="n">p_max</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="p">)</span><span class="nl">p_max</span> <span class="p">:</span> <span class="n">FLT_MAX</span><span class="p">,</span>    <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_Double</span><span class="p">:</span> <span class="k">return</span> <span class="n">DragBehaviorT</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="kt">double</span><span class="p">,</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="n">p_min</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="nl">p_min</span> <span class="p">:</span> <span class="o">-</span><span class="n">DBL_MAX</span><span class="p">,</span>   <span class="n">p_max</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="nl">p_max</span> <span class="p">:</span> <span class="n">DBL_MAX</span><span class="p">,</span>    <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_COUNT</span><span class="p">:</span>  <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Note: p_data, p_min and p_max are _pointers_ to a memory address holding the data. For a Drag widget, p_min and p_max are optional.</span>
<span class="c1">// Read code of e.g. DragFloat(), DragInt() etc. or examples in &#39;Demo-&gt;Widgets-&gt;Data Types&#39; to understand how to use this function directly.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragScalar</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_data</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_min</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">w</span> <span class="o">=</span> <span class="n">CalcItemWidth</span><span class="p">();</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">frame_bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">label_size</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">));</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">total_bb</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">label_size</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>

    <span class="n">ItemSize</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">frame_bb</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Default format string when passing NULL</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">format</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">DataTypeGetInfo</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">PrintFmt</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_S32</span> <span class="o">&amp;&amp;</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// (FIXME-LEGACY: Patch old &quot;%.0f&quot; format string to use &quot;%d&quot;, read function more details.)</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">PatchFormatStringFloatToInt</span><span class="p">(</span><span class="n">format</span><span class="p">);</span>

    <span class="c1">// Tabbing or CTRL-clicking on Drag turns it into an input box</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">hovered</span> <span class="o">=</span> <span class="n">ItemHoverable</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">temp_input_allowed</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSliderFlags_NoInput</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">temp_input_is_active</span> <span class="o">=</span> <span class="n">temp_input_allowed</span> <span class="o">&amp;&amp;</span> <span class="n">TempInputIsActive</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">temp_input_is_active</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">focus_requested</span> <span class="o">=</span> <span class="n">temp_input_allowed</span> <span class="o">&amp;&amp;</span> <span class="n">FocusableItemRegister</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">clicked</span> <span class="o">=</span> <span class="p">(</span><span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseClicked</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">double_clicked</span> <span class="o">=</span> <span class="p">(</span><span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseDoubleClicked</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">focus_requested</span> <span class="o">||</span> <span class="n">clicked</span> <span class="o">||</span> <span class="n">double_clicked</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">NavActivateId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">NavInputId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">SetActiveID</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">window</span><span class="p">);</span>
            <span class="n">SetFocusID</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">window</span><span class="p">);</span>
            <span class="n">FocusWindow</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
            <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdUsingNavDirMask</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiDir_Left</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiDir_Right</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">temp_input_allowed</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">focus_requested</span> <span class="o">||</span> <span class="p">(</span><span class="n">clicked</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyCtrl</span><span class="p">)</span> <span class="o">||</span> <span class="n">double_clicked</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">NavInputId</span> <span class="o">==</span> <span class="n">id</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">temp_input_is_active</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                <span class="n">FocusableItemUnregister</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">temp_input_is_active</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Only clamp CTRL+Click input when ImGuiSliderFlags_AlwaysClamp is set</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_clamp_input</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSliderFlags_AlwaysClamp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">p_min</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">p_max</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">DataTypeCompare</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">p_min</span><span class="p">,</span> <span class="n">p_max</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">TempInputScalar</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">is_clamp_input</span> <span class="o">?</span> <span class="nl">p_min</span> <span class="p">:</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">is_clamp_input</span> <span class="o">?</span> <span class="nl">p_max</span> <span class="p">:</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Draw frame</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">frame_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">?</span> <span class="nl">ImGuiCol_FrameBgActive</span> <span class="p">:</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">?</span> <span class="nl">ImGuiCol_FrameBgHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_FrameBg</span><span class="p">);</span>
    <span class="n">RenderNavHighlight</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="n">RenderFrame</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">frame_col</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">);</span>

    <span class="c1">// Drag behavior</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="n">DragBehavior</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="n">p_min</span><span class="p">,</span> <span class="n">p_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value_changed</span><span class="p">)</span>
        <span class="n">MarkItemEdited</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

    <span class="c1">// Display value using user-provided display format so user can add prefix/suffix/decorations to the value.</span>
    <span class="kt">char</span> <span class="n">value_buf</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">value_buf_end</span> <span class="o">=</span> <span class="n">value_buf</span> <span class="o">+</span> <span class="n">DataTypeFormatString</span><span class="p">(</span><span class="n">value_buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">value_buf</span><span class="p">),</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>
    <span class="n">RenderTextClipped</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">value_buf</span><span class="p">,</span> <span class="n">value_buf_end</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="n">RenderText</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">label</span><span class="p">);</span>

    <span class="n">IMGUI_TEST_ENGINE_ITEM_INFO</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragScalarN</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">components</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_min</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">BeginGroup</span><span class="p">();</span>
    <span class="n">PushID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="n">PushMultiItemsWidths</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">CalcItemWidth</span><span class="p">());</span>
    <span class="kt">size_t</span> <span class="n">type_size</span> <span class="o">=</span> <span class="n">GDataTypeInfo</span><span class="p">[</span><span class="n">data_type</span><span class="p">].</span><span class="n">Size</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">components</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">PushID</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="n">value_changed</span> <span class="o">|=</span> <span class="n">DragScalar</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="n">p_min</span><span class="p">,</span> <span class="n">p_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
        <span class="n">PopID</span><span class="p">();</span>
        <span class="n">PopItemWidth</span><span class="p">();</span>
        <span class="n">p_data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span> <span class="o">+</span> <span class="n">type_size</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">PopID</span><span class="p">();</span>

    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label_end</span> <span class="o">=</span> <span class="n">FindRenderedTextEnd</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">label</span> <span class="o">!=</span> <span class="n">label_end</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="n">TextEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">label_end</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">EndGroup</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragFloat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">DragScalar</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_Float</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragFloat2</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">DragScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_Float</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragFloat3</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">DragScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_Float</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragFloat4</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">DragScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_Float</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// NB: You likely want to specify the ImGuiSliderFlags_AlwaysClamp when using this.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragFloatRange2</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">v_current_min</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">v_current_max</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format_max</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">PushID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="n">BeginGroup</span><span class="p">();</span>
    <span class="n">PushMultiItemsWidths</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">CalcItemWidth</span><span class="p">());</span>

    <span class="kt">float</span> <span class="n">min_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">&gt;=</span> <span class="n">v_max</span><span class="p">)</span> <span class="o">?</span> <span class="o">-</span><span class="nl">FLT_MAX</span> <span class="p">:</span> <span class="n">v_min</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">min_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">&gt;=</span> <span class="n">v_max</span><span class="p">)</span> <span class="o">?</span> <span class="o">*</span><span class="nl">v_current_max</span> <span class="p">:</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">v_max</span><span class="p">,</span> <span class="o">*</span><span class="n">v_current_max</span><span class="p">);</span>
    <span class="n">ImGuiSliderFlags</span> <span class="n">min_flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="p">((</span><span class="n">min_min</span> <span class="o">==</span> <span class="n">min_max</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiSliderFlags_ReadOnly</span> <span class="p">:</span> <span class="mi">0</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="n">DragScalar</span><span class="p">(</span><span class="s">&quot;##min&quot;</span><span class="p">,</span> <span class="n">ImGuiDataType_Float</span><span class="p">,</span> <span class="n">v_current_min</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">min_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">min_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">min_flags</span><span class="p">);</span>
    <span class="n">PopItemWidth</span><span class="p">();</span>
    <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">max_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">&gt;=</span> <span class="n">v_max</span><span class="p">)</span> <span class="o">?</span> <span class="o">*</span><span class="nl">v_current_min</span> <span class="p">:</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">v_min</span><span class="p">,</span> <span class="o">*</span><span class="n">v_current_min</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">max_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">&gt;=</span> <span class="n">v_max</span><span class="p">)</span> <span class="o">?</span> <span class="nl">FLT_MAX</span> <span class="p">:</span> <span class="n">v_max</span><span class="p">;</span>
    <span class="n">ImGuiSliderFlags</span> <span class="n">max_flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="p">((</span><span class="n">max_min</span> <span class="o">==</span> <span class="n">max_max</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiSliderFlags_ReadOnly</span> <span class="p">:</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">value_changed</span> <span class="o">|=</span> <span class="n">DragScalar</span><span class="p">(</span><span class="s">&quot;##max&quot;</span><span class="p">,</span> <span class="n">ImGuiDataType_Float</span><span class="p">,</span> <span class="n">v_current_max</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">max_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">max_max</span><span class="p">,</span> <span class="n">format_max</span> <span class="o">?</span> <span class="nl">format_max</span> <span class="p">:</span> <span class="n">format</span><span class="p">,</span> <span class="n">max_flags</span><span class="p">);</span>
    <span class="n">PopItemWidth</span><span class="p">();</span>
    <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>

    <span class="n">TextEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">FindRenderedTextEnd</span><span class="p">(</span><span class="n">label</span><span class="p">));</span>
    <span class="n">EndGroup</span><span class="p">();</span>
    <span class="n">PopID</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// NB: v_speed is float to allow adjusting the drag speed with more precision</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragInt</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">DragScalar</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragInt2</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">DragScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragInt3</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">DragScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragInt4</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">DragScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// NB: You likely want to specify the ImGuiSliderFlags_AlwaysClamp when using this.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragIntRange2</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">v_current_min</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">v_current_max</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format_max</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">PushID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="n">BeginGroup</span><span class="p">();</span>
    <span class="n">PushMultiItemsWidths</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">CalcItemWidth</span><span class="p">());</span>

    <span class="kt">int</span> <span class="n">min_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">&gt;=</span> <span class="n">v_max</span><span class="p">)</span> <span class="o">?</span> <span class="nl">INT_MIN</span> <span class="p">:</span> <span class="n">v_min</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">min_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">&gt;=</span> <span class="n">v_max</span><span class="p">)</span> <span class="o">?</span> <span class="o">*</span><span class="nl">v_current_max</span> <span class="p">:</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">v_max</span><span class="p">,</span> <span class="o">*</span><span class="n">v_current_max</span><span class="p">);</span>
    <span class="n">ImGuiSliderFlags</span> <span class="n">min_flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="p">((</span><span class="n">min_min</span> <span class="o">==</span> <span class="n">min_max</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiSliderFlags_ReadOnly</span> <span class="p">:</span> <span class="mi">0</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="n">DragInt</span><span class="p">(</span><span class="s">&quot;##min&quot;</span><span class="p">,</span> <span class="n">v_current_min</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="n">min_min</span><span class="p">,</span> <span class="n">min_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">min_flags</span><span class="p">);</span>
    <span class="n">PopItemWidth</span><span class="p">();</span>
    <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">max_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">&gt;=</span> <span class="n">v_max</span><span class="p">)</span> <span class="o">?</span> <span class="o">*</span><span class="nl">v_current_min</span> <span class="p">:</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">v_min</span><span class="p">,</span> <span class="o">*</span><span class="n">v_current_min</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">max_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">&gt;=</span> <span class="n">v_max</span><span class="p">)</span> <span class="o">?</span> <span class="nl">INT_MAX</span> <span class="p">:</span> <span class="n">v_max</span><span class="p">;</span>
    <span class="n">ImGuiSliderFlags</span> <span class="n">max_flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="p">((</span><span class="n">max_min</span> <span class="o">==</span> <span class="n">max_max</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiSliderFlags_ReadOnly</span> <span class="p">:</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">value_changed</span> <span class="o">|=</span> <span class="n">DragInt</span><span class="p">(</span><span class="s">&quot;##max&quot;</span><span class="p">,</span> <span class="n">v_current_max</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="n">max_min</span><span class="p">,</span> <span class="n">max_max</span><span class="p">,</span> <span class="n">format_max</span> <span class="o">?</span> <span class="nl">format_max</span> <span class="p">:</span> <span class="n">format</span><span class="p">,</span> <span class="n">max_flags</span><span class="p">);</span>
    <span class="n">PopItemWidth</span><span class="p">();</span>
    <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>

    <span class="n">TextEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">FindRenderedTextEnd</span><span class="p">(</span><span class="n">label</span><span class="p">));</span>
    <span class="n">EndGroup</span><span class="p">();</span>
    <span class="n">PopID</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifndef IMGUI_DISABLE_OBSOLETE_FUNCTIONS</span>

<span class="c1">// Obsolete versions with power parameter. See https://github.com/ocornut/imgui/issues/3361 for details.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragScalar</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_data</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_min</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="kt">float</span> <span class="n">power</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiSliderFlags</span> <span class="n">drag_flags</span> <span class="o">=</span> <span class="n">ImGuiSliderFlags_None</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">power</span> <span class="o">!=</span> <span class="mf">1.0f</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">power</span> <span class="o">==</span> <span class="mf">1.0f</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;Call function with ImGuiSliderFlags_Logarithmic flags instead of using the old &#39;float power&#39; function!&quot;</span><span class="p">);</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">p_min</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">p_max</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>  <span class="c1">// When using a power curve the drag needs to have known bounds</span>
        <span class="n">drag_flags</span> <span class="o">|=</span> <span class="n">ImGuiSliderFlags_Logarithmic</span><span class="p">;</span>   <span class="c1">// Fallback for non-asserting paths</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">DragScalar</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="n">p_min</span><span class="p">,</span> <span class="n">p_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">drag_flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">DragScalarN</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">components</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_speed</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_min</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="kt">float</span> <span class="n">power</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiSliderFlags</span> <span class="n">drag_flags</span> <span class="o">=</span> <span class="n">ImGuiSliderFlags_None</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">power</span> <span class="o">!=</span> <span class="mf">1.0f</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">power</span> <span class="o">==</span> <span class="mf">1.0f</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;Call function with ImGuiSliderFlags_Logarithmic flags instead of using the old &#39;float power&#39; function!&quot;</span><span class="p">);</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">p_min</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">p_max</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>  <span class="c1">// When using a power curve the drag needs to have known bounds</span>
        <span class="n">drag_flags</span> <span class="o">|=</span> <span class="n">ImGuiSliderFlags_Logarithmic</span><span class="p">;</span>   <span class="c1">// Fallback for non-asserting paths</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">DragScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">v_speed</span><span class="p">,</span> <span class="n">p_min</span><span class="p">,</span> <span class="n">p_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">drag_flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="c1">// IMGUI_DISABLE_OBSOLETE_FUNCTIONS</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: SliderScalar, SliderFloat, SliderInt, etc.</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - ScaleRatioFromValueT&lt;&gt; [Internal]</span>
<span class="c1">// - ScaleValueFromRatioT&lt;&gt; [Internal]</span>
<span class="c1">// - SliderBehaviorT&lt;&gt;() [Internal]</span>
<span class="c1">// - SliderBehavior() [Internal]</span>
<span class="c1">// - SliderScalar()</span>
<span class="c1">// - SliderScalarN()</span>
<span class="c1">// - SliderFloat()</span>
<span class="c1">// - SliderFloat2()</span>
<span class="c1">// - SliderFloat3()</span>
<span class="c1">// - SliderFloat4()</span>
<span class="c1">// - SliderAngle()</span>
<span class="c1">// - SliderInt()</span>
<span class="c1">// - SliderInt2()</span>
<span class="c1">// - SliderInt3()</span>
<span class="c1">// - SliderInt4()</span>
<span class="c1">// - VSliderScalar()</span>
<span class="c1">// - VSliderFloat()</span>
<span class="c1">// - VSliderInt()</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="c1">// Convert a value v in the output space of a slider into a parametric position on the slider itself (the logical opposite of ScaleValueFromRatioT)</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">TYPE</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">SIGNEDTYPE</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">FLOATTYPE</span><span class="o">&gt;</span>
<span class="kt">float</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ScaleRatioFromValueT</span><span class="p">(</span><span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">TYPE</span> <span class="n">v</span><span class="p">,</span> <span class="n">TYPE</span> <span class="n">v_min</span><span class="p">,</span> <span class="n">TYPE</span> <span class="n">v_max</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">is_logarithmic</span><span class="p">,</span> <span class="kt">float</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">,</span> <span class="kt">float</span> <span class="n">zero_deadzone_halfsize</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">==</span> <span class="n">v_max</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="n">IM_UNUSED</span><span class="p">(</span><span class="n">data_type</span><span class="p">);</span>

    <span class="k">const</span> <span class="n">TYPE</span> <span class="n">v_clamped</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">&lt;</span> <span class="n">v_max</span><span class="p">)</span> <span class="o">?</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">)</span> <span class="o">:</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v_max</span><span class="p">,</span> <span class="n">v_min</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_logarithmic</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">flipped</span> <span class="o">=</span> <span class="n">v_max</span> <span class="o">&lt;</span> <span class="n">v_min</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">flipped</span><span class="p">)</span> <span class="c1">// Handle the case where the range is backwards</span>
            <span class="n">ImSwap</span><span class="p">(</span><span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">);</span>

        <span class="c1">// Fudge min/max to avoid getting close to log(0)</span>
        <span class="n">FLOATTYPE</span> <span class="n">v_min_fudged</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImAbs</span><span class="p">((</span><span class="n">FLOATTYPE</span><span class="p">)</span><span class="n">v_min</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">)</span> <span class="o">?</span> <span class="p">((</span><span class="n">v_min</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">?</span> <span class="o">-</span><span class="nl">logarithmic_zero_epsilon</span> <span class="p">:</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="n">FLOATTYPE</span><span class="p">)</span><span class="n">v_min</span><span class="p">;</span>
        <span class="n">FLOATTYPE</span> <span class="n">v_max_fudged</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImAbs</span><span class="p">((</span><span class="n">FLOATTYPE</span><span class="p">)</span><span class="n">v_max</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">)</span> <span class="o">?</span> <span class="p">((</span><span class="n">v_max</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">?</span> <span class="o">-</span><span class="nl">logarithmic_zero_epsilon</span> <span class="p">:</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="n">FLOATTYPE</span><span class="p">)</span><span class="n">v_max</span><span class="p">;</span>

        <span class="c1">// Awkward special cases - we need ranges of the form (-100 .. 0) to convert to (-100 .. -epsilon), not (-100 .. epsilon)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">v_min</span> <span class="o">==</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">v_max</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">))</span>
            <span class="n">v_min_fudged</span> <span class="o">=</span> <span class="o">-</span><span class="n">logarithmic_zero_epsilon</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">v_max</span> <span class="o">==</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">))</span>
            <span class="n">v_max_fudged</span> <span class="o">=</span> <span class="o">-</span><span class="n">logarithmic_zero_epsilon</span><span class="p">;</span>

        <span class="kt">float</span> <span class="n">result</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">v_clamped</span> <span class="o">&lt;=</span> <span class="n">v_min_fudged</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span> <span class="c1">// Workaround for values that are in-range but below our fudge</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">v_clamped</span> <span class="o">&gt;=</span> <span class="n">v_max_fudged</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span> <span class="c1">// Workaround for values that are in-range but above our fudge</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">v_min</span> <span class="o">*</span> <span class="n">v_max</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="c1">// Range crosses zero, so split into two portions</span>
        <span class="p">{</span>
            <span class="kt">float</span> <span class="n">zero_point_center</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">v_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">v_max</span> <span class="o">-</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">v_min</span><span class="p">);</span> <span class="c1">// The zero point in parametric space.  There&#39;s an argument we should take the logarithmic nature into account when calculating this, but for now this should do (and the most common case of a symmetrical range works fine)</span>
            <span class="kt">float</span> <span class="n">zero_point_snap_L</span> <span class="o">=</span> <span class="n">zero_point_center</span> <span class="o">-</span> <span class="n">zero_deadzone_halfsize</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">zero_point_snap_R</span> <span class="o">=</span> <span class="n">zero_point_center</span> <span class="o">+</span> <span class="n">zero_deadzone_halfsize</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="mf">0.0f</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">zero_point_center</span><span class="p">;</span> <span class="c1">// Special case for exactly zero</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0f</span> <span class="o">-</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">ImLog</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">FLOATTYPE</span><span class="p">)</span><span class="n">v_clamped</span> <span class="o">/</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">)</span> <span class="o">/</span> <span class="n">ImLog</span><span class="p">(</span><span class="o">-</span><span class="n">v_min_fudged</span> <span class="o">/</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">)))</span> <span class="o">*</span> <span class="n">zero_point_snap_L</span><span class="p">;</span>
            <span class="k">else</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">zero_point_snap_R</span> <span class="o">+</span> <span class="p">((</span><span class="kt">float</span><span class="p">)(</span><span class="n">ImLog</span><span class="p">((</span><span class="n">FLOATTYPE</span><span class="p">)</span><span class="n">v_clamped</span> <span class="o">/</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">)</span> <span class="o">/</span> <span class="n">ImLog</span><span class="p">(</span><span class="n">v_max_fudged</span> <span class="o">/</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0f</span> <span class="o">-</span> <span class="n">zero_point_snap_R</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">v_min</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">v_max</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">))</span> <span class="c1">// Entirely negative slider</span>
            <span class="n">result</span> <span class="o">=</span> <span class="mf">1.0f</span> <span class="o">-</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">ImLog</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">FLOATTYPE</span><span class="p">)</span><span class="n">v_clamped</span> <span class="o">/</span> <span class="o">-</span><span class="n">v_max_fudged</span><span class="p">)</span> <span class="o">/</span> <span class="n">ImLog</span><span class="p">(</span><span class="o">-</span><span class="n">v_min_fudged</span> <span class="o">/</span> <span class="o">-</span><span class="n">v_max_fudged</span><span class="p">));</span>
        <span class="k">else</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">ImLog</span><span class="p">((</span><span class="n">FLOATTYPE</span><span class="p">)</span><span class="n">v_clamped</span> <span class="o">/</span> <span class="n">v_min_fudged</span><span class="p">)</span> <span class="o">/</span> <span class="n">ImLog</span><span class="p">(</span><span class="n">v_max_fudged</span> <span class="o">/</span> <span class="n">v_min_fudged</span><span class="p">));</span>

        <span class="k">return</span> <span class="n">flipped</span> <span class="o">?</span> <span class="p">(</span><span class="mf">1.0f</span> <span class="o">-</span> <span class="n">result</span><span class="p">)</span> <span class="o">:</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Linear slider</span>
    <span class="k">return</span> <span class="p">(</span><span class="kt">float</span><span class="p">)((</span><span class="n">FLOATTYPE</span><span class="p">)(</span><span class="n">SIGNEDTYPE</span><span class="p">)(</span><span class="n">v_clamped</span> <span class="o">-</span> <span class="n">v_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">FLOATTYPE</span><span class="p">)(</span><span class="n">SIGNEDTYPE</span><span class="p">)(</span><span class="n">v_max</span> <span class="o">-</span> <span class="n">v_min</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// Convert a parametric position on a slider into a value v in the output space (the logical opposite of ScaleRatioFromValueT)</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">TYPE</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">SIGNEDTYPE</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">FLOATTYPE</span><span class="o">&gt;</span>
<span class="n">TYPE</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ScaleValueFromRatioT</span><span class="p">(</span><span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">float</span> <span class="n">t</span><span class="p">,</span> <span class="n">TYPE</span> <span class="n">v_min</span><span class="p">,</span> <span class="n">TYPE</span> <span class="n">v_max</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">is_logarithmic</span><span class="p">,</span> <span class="kt">float</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">,</span> <span class="kt">float</span> <span class="n">zero_deadzone_halfsize</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">==</span> <span class="n">v_max</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">TYPE</span><span class="p">)</span><span class="mf">0.0f</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_decimal</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_Float</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_Double</span><span class="p">);</span>

    <span class="n">TYPE</span> <span class="n">result</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_logarithmic</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// We special-case the extents because otherwise our fudging can lead to &quot;mathematically correct&quot; but non-intuitive behaviors like a fully-left slider not actually reaching the minimum value</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;=</span> <span class="mf">0.0f</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">v_min</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">&gt;=</span> <span class="mf">1.0f</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">v_max</span><span class="p">;</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">flipped</span> <span class="o">=</span> <span class="n">v_max</span> <span class="o">&lt;</span> <span class="n">v_min</span><span class="p">;</span> <span class="c1">// Check if range is &quot;backwards&quot;</span>

            <span class="c1">// Fudge min/max to avoid getting silly results close to zero</span>
            <span class="n">FLOATTYPE</span> <span class="n">v_min_fudged</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImAbs</span><span class="p">((</span><span class="n">FLOATTYPE</span><span class="p">)</span><span class="n">v_min</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">)</span> <span class="o">?</span> <span class="p">((</span><span class="n">v_min</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">?</span> <span class="o">-</span><span class="nl">logarithmic_zero_epsilon</span> <span class="p">:</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="n">FLOATTYPE</span><span class="p">)</span><span class="n">v_min</span><span class="p">;</span>
            <span class="n">FLOATTYPE</span> <span class="n">v_max_fudged</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImAbs</span><span class="p">((</span><span class="n">FLOATTYPE</span><span class="p">)</span><span class="n">v_max</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">)</span> <span class="o">?</span> <span class="p">((</span><span class="n">v_max</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">?</span> <span class="o">-</span><span class="nl">logarithmic_zero_epsilon</span> <span class="p">:</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="n">FLOATTYPE</span><span class="p">)</span><span class="n">v_max</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">flipped</span><span class="p">)</span>
                <span class="n">ImSwap</span><span class="p">(</span><span class="n">v_min_fudged</span><span class="p">,</span> <span class="n">v_max_fudged</span><span class="p">);</span>

            <span class="c1">// Awkward special case - we need ranges of the form (-100 .. 0) to convert to (-100 .. -epsilon), not (-100 .. epsilon)</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">v_max</span> <span class="o">==</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">))</span>
                <span class="n">v_max_fudged</span> <span class="o">=</span> <span class="o">-</span><span class="n">logarithmic_zero_epsilon</span><span class="p">;</span>

            <span class="kt">float</span> <span class="n">t_with_flip</span> <span class="o">=</span> <span class="n">flipped</span> <span class="o">?</span> <span class="p">(</span><span class="mf">1.0f</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">:</span> <span class="n">t</span><span class="p">;</span> <span class="c1">// t, but flipped if necessary to account for us flipping the range</span>

            <span class="k">if</span> <span class="p">((</span><span class="n">v_min</span> <span class="o">*</span> <span class="n">v_max</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="c1">// Range crosses zero, so we have to do this in two parts</span>
            <span class="p">{</span>
                <span class="kt">float</span> <span class="n">zero_point_center</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">ImMin</span><span class="p">(</span><span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">))</span> <span class="o">/</span> <span class="n">ImAbs</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">v_max</span> <span class="o">-</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">v_min</span><span class="p">);</span> <span class="c1">// The zero point in parametric space</span>
                <span class="kt">float</span> <span class="n">zero_point_snap_L</span> <span class="o">=</span> <span class="n">zero_point_center</span> <span class="o">-</span> <span class="n">zero_deadzone_halfsize</span><span class="p">;</span>
                <span class="kt">float</span> <span class="n">zero_point_snap_R</span> <span class="o">=</span> <span class="n">zero_point_center</span> <span class="o">+</span> <span class="n">zero_deadzone_halfsize</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">t_with_flip</span> <span class="o">&gt;=</span> <span class="n">zero_point_snap_L</span> <span class="o">&amp;&amp;</span> <span class="n">t_with_flip</span> <span class="o">&lt;=</span> <span class="n">zero_point_snap_R</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">TYPE</span><span class="p">)</span><span class="mf">0.0f</span><span class="p">;</span> <span class="c1">// Special case to make getting exactly zero possible (the epsilon prevents it otherwise)</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">t_with_flip</span> <span class="o">&lt;</span> <span class="n">zero_point_center</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">TYPE</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">logarithmic_zero_epsilon</span> <span class="o">*</span> <span class="n">ImPow</span><span class="p">(</span><span class="o">-</span><span class="n">v_min_fudged</span> <span class="o">/</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">,</span> <span class="p">(</span><span class="n">FLOATTYPE</span><span class="p">)(</span><span class="mf">1.0f</span> <span class="o">-</span> <span class="p">(</span><span class="n">t_with_flip</span> <span class="o">/</span> <span class="n">zero_point_snap_L</span><span class="p">))));</span>
                <span class="k">else</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">TYPE</span><span class="p">)(</span><span class="n">logarithmic_zero_epsilon</span> <span class="o">*</span> <span class="n">ImPow</span><span class="p">(</span><span class="n">v_max_fudged</span> <span class="o">/</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">,</span> <span class="p">(</span><span class="n">FLOATTYPE</span><span class="p">)((</span><span class="n">t_with_flip</span> <span class="o">-</span> <span class="n">zero_point_snap_R</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0f</span> <span class="o">-</span> <span class="n">zero_point_snap_R</span><span class="p">))));</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">v_min</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">v_max</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">))</span> <span class="c1">// Entirely negative slider</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">TYPE</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">v_max_fudged</span> <span class="o">*</span> <span class="n">ImPow</span><span class="p">(</span><span class="o">-</span><span class="n">v_min_fudged</span> <span class="o">/</span> <span class="o">-</span><span class="n">v_max_fudged</span><span class="p">,</span> <span class="p">(</span><span class="n">FLOATTYPE</span><span class="p">)(</span><span class="mf">1.0f</span> <span class="o">-</span> <span class="n">t_with_flip</span><span class="p">)));</span>
            <span class="k">else</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">TYPE</span><span class="p">)(</span><span class="n">v_min_fudged</span> <span class="o">*</span> <span class="n">ImPow</span><span class="p">(</span><span class="n">v_max_fudged</span> <span class="o">/</span> <span class="n">v_min_fudged</span><span class="p">,</span> <span class="p">(</span><span class="n">FLOATTYPE</span><span class="p">)</span><span class="n">t_with_flip</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// Linear slider</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">is_decimal</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">ImLerp</span><span class="p">(</span><span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="c1">// - For integer values we want the clicking position to match the grab box so we round above</span>
            <span class="c1">//   This code is carefully tuned to work with large values (e.g. high ranges of U64) while preserving this property..</span>
            <span class="c1">// - Not doing a *1.0 multiply at the end of a range as it tends to be lossy. While absolute aiming at a large s64/u64</span>
            <span class="c1">//   range is going to be imprecise anyway, with this check we at least make the edge values matches expected limits.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">FLOATTYPE</span> <span class="n">v_new_off_f</span> <span class="o">=</span> <span class="p">(</span><span class="n">SIGNEDTYPE</span><span class="p">)(</span><span class="n">v_max</span> <span class="o">-</span> <span class="n">v_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="p">;</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">TYPE</span><span class="p">)((</span><span class="n">SIGNEDTYPE</span><span class="p">)</span><span class="n">v_min</span> <span class="o">+</span> <span class="p">(</span><span class="n">SIGNEDTYPE</span><span class="p">)(</span><span class="n">v_new_off_f</span> <span class="o">+</span> <span class="p">(</span><span class="n">FLOATTYPE</span><span class="p">)(</span><span class="n">v_min</span> <span class="o">&gt;</span> <span class="n">v_max</span> <span class="o">?</span> <span class="mf">-0.5</span> <span class="o">:</span> <span class="mf">0.5</span><span class="p">)));</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">v_max</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// FIXME: Move more of the code into SliderBehavior()</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">TYPE</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">SIGNEDTYPE</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">FLOATTYPE</span><span class="o">&gt;</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SliderBehaviorT</span><span class="p">(</span><span class="k">const</span> <span class="n">ImRect</span><span class="o">&amp;</span> <span class="n">bb</span><span class="p">,</span> <span class="n">ImGuiID</span> <span class="n">id</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">TYPE</span><span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="k">const</span> <span class="n">TYPE</span> <span class="n">v_min</span><span class="p">,</span> <span class="k">const</span> <span class="n">TYPE</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="n">ImRect</span><span class="o">*</span> <span class="n">out_grab_bb</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">ImGuiAxis</span> <span class="n">axis</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSliderFlags_Vertical</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiAxis_Y</span> <span class="p">:</span> <span class="n">ImGuiAxis_X</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_decimal</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_Float</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_Double</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_logarithmic</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSliderFlags_Logarithmic</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">is_decimal</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">float</span> <span class="n">grab_padding</span> <span class="o">=</span> <span class="mf">2.0f</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">slider_sz</span> <span class="o">=</span> <span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">-</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">[</span><span class="n">axis</span><span class="p">])</span> <span class="o">-</span> <span class="n">grab_padding</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">grab_sz</span> <span class="o">=</span> <span class="n">style</span><span class="p">.</span><span class="n">GrabMinSize</span><span class="p">;</span>
    <span class="n">SIGNEDTYPE</span> <span class="n">v_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_min</span> <span class="o">&lt;</span> <span class="n">v_max</span> <span class="o">?</span> <span class="n">v_max</span> <span class="o">-</span> <span class="nl">v_min</span> <span class="p">:</span> <span class="n">v_min</span> <span class="o">-</span> <span class="n">v_max</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_decimal</span> <span class="o">&amp;&amp;</span> <span class="n">v_range</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>                                             <span class="c1">// v_range &lt; 0 may happen on integer overflows</span>
        <span class="n">grab_sz</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">((</span><span class="kt">float</span><span class="p">)(</span><span class="n">slider_sz</span> <span class="o">/</span> <span class="p">(</span><span class="n">v_range</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">style</span><span class="p">.</span><span class="n">GrabMinSize</span><span class="p">);</span>  <span class="c1">// For integer sliders: if possible have the grab size represent 1 unit</span>
    <span class="n">grab_sz</span> <span class="o">=</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">grab_sz</span><span class="p">,</span> <span class="n">slider_sz</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">slider_usable_sz</span> <span class="o">=</span> <span class="n">slider_sz</span> <span class="o">-</span> <span class="n">grab_sz</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">slider_usable_pos_min</span> <span class="o">=</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">+</span> <span class="n">grab_padding</span> <span class="o">+</span> <span class="n">grab_sz</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">slider_usable_pos_max</span> <span class="o">=</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">-</span> <span class="n">grab_padding</span> <span class="o">-</span> <span class="n">grab_sz</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">logarithmic_zero_epsilon</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span> <span class="c1">// Only valid when is_logarithmic is true</span>
    <span class="kt">float</span> <span class="n">zero_deadzone_halfsize</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span> <span class="c1">// Only valid when is_logarithmic is true</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_logarithmic</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// When using logarithmic sliders, we need to clamp to avoid hitting zero, but our choice of clamp value greatly affects slider precision. We attempt to use the specified precision to estimate a good lower bound.</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">decimal_precision</span> <span class="o">=</span> <span class="n">is_decimal</span> <span class="o">?</span> <span class="n">ImParseFormatPrecision</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">logarithmic_zero_epsilon</span> <span class="o">=</span> <span class="n">ImPow</span><span class="p">(</span><span class="mf">0.1f</span><span class="p">,</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">decimal_precision</span><span class="p">);</span>
        <span class="n">zero_deadzone_halfsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">LogSliderDeadzone</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">)</span> <span class="o">/</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">slider_usable_sz</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Process interacting with the slider</span>
    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">set_new_value</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">clicked_t</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdSource</span> <span class="o">==</span> <span class="n">ImGuiInputSource_Mouse</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">{</span>
                <span class="n">ClearActiveID</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="k">const</span> <span class="kt">float</span> <span class="n">mouse_abs_pos</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MousePos</span><span class="p">[</span><span class="n">axis</span><span class="p">];</span>
                <span class="n">clicked_t</span> <span class="o">=</span> <span class="p">(</span><span class="n">slider_usable_sz</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">?</span> <span class="n">ImClamp</span><span class="p">((</span><span class="n">mouse_abs_pos</span> <span class="o">-</span> <span class="n">slider_usable_pos_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">slider_usable_sz</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">)</span> <span class="o">:</span> <span class="mf">0.0f</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">axis</span> <span class="o">==</span> <span class="n">ImGuiAxis_Y</span><span class="p">)</span>
                    <span class="n">clicked_t</span> <span class="o">=</span> <span class="mf">1.0f</span> <span class="o">-</span> <span class="n">clicked_t</span><span class="p">;</span>
                <span class="n">set_new_value</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdSource</span> <span class="o">==</span> <span class="n">ImGuiInputSource_Nav</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdIsJustActivated</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">g</span><span class="p">.</span><span class="n">SliderCurrentAccum</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span> <span class="c1">// Reset any stored nav delta upon activation</span>
                <span class="n">g</span><span class="p">.</span><span class="n">SliderCurrentAccumDirty</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">input_delta2</span> <span class="o">=</span> <span class="n">GetNavInputAmount2d</span><span class="p">(</span><span class="n">ImGuiNavDirSourceFlags_Keyboard</span> <span class="o">|</span> <span class="n">ImGuiNavDirSourceFlags_PadDPad</span><span class="p">,</span> <span class="n">ImGuiInputReadMode_RepeatFast</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
            <span class="kt">float</span> <span class="n">input_delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">axis</span> <span class="o">==</span> <span class="n">ImGuiAxis_X</span><span class="p">)</span> <span class="o">?</span> <span class="n">input_delta2</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="o">-</span><span class="n">input_delta2</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">input_delta</span> <span class="o">!=</span> <span class="mf">0.0f</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">const</span> <span class="kt">int</span> <span class="n">decimal_precision</span> <span class="o">=</span> <span class="n">is_decimal</span> <span class="o">?</span> <span class="n">ImParseFormatPrecision</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">decimal_precision</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">input_delta</span> <span class="o">/=</span> <span class="mf">100.0f</span><span class="p">;</span>    <span class="c1">// Gamepad/keyboard tweak speeds in % of slider bounds</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">IsNavInputDown</span><span class="p">(</span><span class="n">ImGuiNavInput_TweakSlow</span><span class="p">))</span>
                        <span class="n">input_delta</span> <span class="o">/=</span> <span class="mf">10.0f</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">((</span><span class="n">v_range</span> <span class="o">&gt;=</span> <span class="mf">-100.0f</span> <span class="o">&amp;&amp;</span> <span class="n">v_range</span> <span class="o">&lt;=</span> <span class="mf">100.0f</span><span class="p">)</span> <span class="o">||</span> <span class="n">IsNavInputDown</span><span class="p">(</span><span class="n">ImGuiNavInput_TweakSlow</span><span class="p">))</span>
                        <span class="n">input_delta</span> <span class="o">=</span> <span class="p">((</span><span class="n">input_delta</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">?</span> <span class="mf">-1.0f</span> <span class="o">:</span> <span class="o">+</span><span class="mf">1.0f</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">v_range</span><span class="p">;</span> <span class="c1">// Gamepad/keyboard tweak speeds in integer steps</span>
                    <span class="k">else</span>
                        <span class="n">input_delta</span> <span class="o">/=</span> <span class="mf">100.0f</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">IsNavInputDown</span><span class="p">(</span><span class="n">ImGuiNavInput_TweakFast</span><span class="p">))</span>
                    <span class="n">input_delta</span> <span class="o">*=</span> <span class="mf">10.0f</span><span class="p">;</span>

                <span class="n">g</span><span class="p">.</span><span class="n">SliderCurrentAccum</span> <span class="o">+=</span> <span class="n">input_delta</span><span class="p">;</span>
                <span class="n">g</span><span class="p">.</span><span class="n">SliderCurrentAccumDirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="kt">float</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">SliderCurrentAccum</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavActivatePressedId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdIsJustActivated</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">ClearActiveID</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">SliderCurrentAccumDirty</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">clicked_t</span> <span class="o">=</span> <span class="n">ScaleRatioFromValueT</span><span class="o">&lt;</span><span class="n">TYPE</span><span class="p">,</span> <span class="n">SIGNEDTYPE</span><span class="p">,</span> <span class="n">FLOATTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">,</span> <span class="n">is_logarithmic</span><span class="p">,</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">,</span> <span class="n">zero_deadzone_halfsize</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">((</span><span class="n">clicked_t</span> <span class="o">&gt;=</span> <span class="mf">1.0f</span> <span class="o">&amp;&amp;</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">clicked_t</span> <span class="o">&lt;=</span> <span class="mf">0.0f</span> <span class="o">&amp;&amp;</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">))</span> <span class="c1">// This is to avoid applying the saturation when already past the limits</span>
                <span class="p">{</span>
                    <span class="n">set_new_value</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
                    <span class="n">g</span><span class="p">.</span><span class="n">SliderCurrentAccum</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span> <span class="c1">// If pushing up against the limits, don&#39;t continue to accumulate</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">set_new_value</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                    <span class="kt">float</span> <span class="n">old_clicked_t</span> <span class="o">=</span> <span class="n">clicked_t</span><span class="p">;</span>
                    <span class="n">clicked_t</span> <span class="o">=</span> <span class="n">ImSaturate</span><span class="p">(</span><span class="n">clicked_t</span> <span class="o">+</span> <span class="n">delta</span><span class="p">);</span>

                    <span class="c1">// Calculate what our &quot;new&quot; clicked_t will be, and thus how far we actually moved the slider, and subtract this from the accumulator</span>
                    <span class="n">TYPE</span> <span class="n">v_new</span> <span class="o">=</span> <span class="n">ScaleValueFromRatioT</span><span class="o">&lt;</span><span class="n">TYPE</span><span class="p">,</span> <span class="n">SIGNEDTYPE</span><span class="p">,</span> <span class="n">FLOATTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">clicked_t</span><span class="p">,</span> <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">,</span> <span class="n">is_logarithmic</span><span class="p">,</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">,</span> <span class="n">zero_deadzone_halfsize</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSliderFlags_NoRoundToFormat</span><span class="p">))</span>
                        <span class="n">v_new</span> <span class="o">=</span> <span class="n">RoundScalarWithFormatT</span><span class="o">&lt;</span><span class="n">TYPE</span><span class="p">,</span> <span class="n">SIGNEDTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">v_new</span><span class="p">);</span>
                    <span class="kt">float</span> <span class="n">new_clicked_t</span> <span class="o">=</span> <span class="n">ScaleRatioFromValueT</span><span class="o">&lt;</span><span class="n">TYPE</span><span class="p">,</span> <span class="n">SIGNEDTYPE</span><span class="p">,</span> <span class="n">FLOATTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">v_new</span><span class="p">,</span> <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">,</span> <span class="n">is_logarithmic</span><span class="p">,</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">,</span> <span class="n">zero_deadzone_halfsize</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="n">g</span><span class="p">.</span><span class="n">SliderCurrentAccum</span> <span class="o">-=</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">new_clicked_t</span> <span class="o">-</span> <span class="n">old_clicked_t</span><span class="p">,</span> <span class="n">delta</span><span class="p">);</span>
                    <span class="k">else</span>
                        <span class="n">g</span><span class="p">.</span><span class="n">SliderCurrentAccum</span> <span class="o">-=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">new_clicked_t</span> <span class="o">-</span> <span class="n">old_clicked_t</span><span class="p">,</span> <span class="n">delta</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="n">g</span><span class="p">.</span><span class="n">SliderCurrentAccumDirty</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">set_new_value</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TYPE</span> <span class="n">v_new</span> <span class="o">=</span> <span class="n">ScaleValueFromRatioT</span><span class="o">&lt;</span><span class="n">TYPE</span><span class="p">,</span> <span class="n">SIGNEDTYPE</span><span class="p">,</span> <span class="n">FLOATTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">clicked_t</span><span class="p">,</span> <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">,</span> <span class="n">is_logarithmic</span><span class="p">,</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">,</span> <span class="n">zero_deadzone_halfsize</span><span class="p">);</span>

            <span class="c1">// Round to user desired precision based on format string</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSliderFlags_NoRoundToFormat</span><span class="p">))</span>
                <span class="n">v_new</span> <span class="o">=</span> <span class="n">RoundScalarWithFormatT</span><span class="o">&lt;</span><span class="n">TYPE</span><span class="p">,</span> <span class="n">SIGNEDTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">v_new</span><span class="p">);</span>

            <span class="c1">// Apply result</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">v</span> <span class="o">!=</span> <span class="n">v_new</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="n">v_new</span><span class="p">;</span>
                <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">slider_sz</span> <span class="o">&lt;</span> <span class="mf">1.0f</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="o">*</span><span class="n">out_grab_bb</span> <span class="o">=</span> <span class="n">ImRect</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// Output grab position so it can be displayed by the caller</span>
        <span class="kt">float</span> <span class="n">grab_t</span> <span class="o">=</span> <span class="n">ScaleRatioFromValueT</span><span class="o">&lt;</span><span class="n">TYPE</span><span class="p">,</span> <span class="n">SIGNEDTYPE</span><span class="p">,</span> <span class="n">FLOATTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">,</span> <span class="n">is_logarithmic</span><span class="p">,</span> <span class="n">logarithmic_zero_epsilon</span><span class="p">,</span> <span class="n">zero_deadzone_halfsize</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">axis</span> <span class="o">==</span> <span class="n">ImGuiAxis_Y</span><span class="p">)</span>
            <span class="n">grab_t</span> <span class="o">=</span> <span class="mf">1.0f</span> <span class="o">-</span> <span class="n">grab_t</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">grab_pos</span> <span class="o">=</span> <span class="n">ImLerp</span><span class="p">(</span><span class="n">slider_usable_pos_min</span><span class="p">,</span> <span class="n">slider_usable_pos_max</span><span class="p">,</span> <span class="n">grab_t</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">axis</span> <span class="o">==</span> <span class="n">ImGuiAxis_X</span><span class="p">)</span>
            <span class="o">*</span><span class="n">out_grab_bb</span> <span class="o">=</span> <span class="n">ImRect</span><span class="p">(</span><span class="n">grab_pos</span> <span class="o">-</span> <span class="n">grab_sz</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">grab_padding</span><span class="p">,</span> <span class="n">grab_pos</span> <span class="o">+</span> <span class="n">grab_sz</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">grab_padding</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="o">*</span><span class="n">out_grab_bb</span> <span class="o">=</span> <span class="n">ImRect</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">grab_padding</span><span class="p">,</span> <span class="n">grab_pos</span> <span class="o">-</span> <span class="n">grab_sz</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">grab_padding</span><span class="p">,</span> <span class="n">grab_pos</span> <span class="o">+</span> <span class="n">grab_sz</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// For 32-bit and larger types, slider bounds are limited to half the natural type range.</span>
<span class="c1">// So e.g. an integer Slider between INT_MAX-10 and INT_MAX will fail, but an integer Slider between INT_MAX/2-10 and INT_MAX/2 will be ok.</span>
<span class="c1">// It would be possible to lift that limitation with some work but it doesn&#39;t seem to be worth it for sliders.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SliderBehavior</span><span class="p">(</span><span class="k">const</span> <span class="n">ImRect</span><span class="o">&amp;</span> <span class="n">bb</span><span class="p">,</span> <span class="n">ImGuiID</span> <span class="n">id</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_v</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_min</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="n">ImRect</span><span class="o">*</span> <span class="n">out_grab_bb</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Read imgui.cpp &quot;API BREAKING CHANGES&quot; section for 1.78 if you hit this assert.</span>
    <span class="n">IM_ASSERT</span><span class="p">((</span><span class="n">flags</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSliderFlags_InvalidMask_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;Invalid ImGuiSliderFlags flag!  Has the &#39;float power&#39; argument been mistakenly cast to flags? Call function with ImGuiSliderFlags_Logarithmic flags instead.&quot;</span><span class="p">);</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">&amp;</span> <span class="n">ImGuiItemFlags_ReadOnly</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSliderFlags_ReadOnly</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S8</span><span class="p">:</span>  <span class="p">{</span> <span class="n">ImS32</span> <span class="n">v32</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImS32</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ImS8</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">;</span>  <span class="kt">bool</span> <span class="n">r</span> <span class="o">=</span> <span class="n">SliderBehaviorT</span><span class="o">&lt;</span><span class="n">ImS32</span><span class="p">,</span> <span class="n">ImS32</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v32</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS8</span><span class="o">*</span><span class="p">)</span><span class="n">p_min</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS8</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span><span class="p">,</span>  <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">out_grab_bb</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">ImS8</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span>  <span class="o">=</span> <span class="p">(</span><span class="n">ImS8</span><span class="p">)</span><span class="n">v32</span><span class="p">;</span>  <span class="k">return</span> <span class="n">r</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U8</span><span class="p">:</span>  <span class="p">{</span> <span class="n">ImU32</span> <span class="n">v32</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImU32</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ImU8</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">;</span>  <span class="kt">bool</span> <span class="n">r</span> <span class="o">=</span> <span class="n">SliderBehaviorT</span><span class="o">&lt;</span><span class="n">ImU32</span><span class="p">,</span> <span class="n">ImS32</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">ImGuiDataType_U32</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v32</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU8</span><span class="o">*</span><span class="p">)</span><span class="n">p_min</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU8</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span><span class="p">,</span>  <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">out_grab_bb</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">ImU8</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span>  <span class="o">=</span> <span class="p">(</span><span class="n">ImU8</span><span class="p">)</span><span class="n">v32</span><span class="p">;</span>  <span class="k">return</span> <span class="n">r</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S16</span><span class="p">:</span> <span class="p">{</span> <span class="n">ImS32</span> <span class="n">v32</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImS32</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">;</span> <span class="kt">bool</span> <span class="n">r</span> <span class="o">=</span> <span class="n">SliderBehaviorT</span><span class="o">&lt;</span><span class="n">ImS32</span><span class="p">,</span> <span class="n">ImS32</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v32</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="n">p_min</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">out_grab_bb</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">ImS16</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImS16</span><span class="p">)</span><span class="n">v32</span><span class="p">;</span> <span class="k">return</span> <span class="n">r</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U16</span><span class="p">:</span> <span class="p">{</span> <span class="n">ImU32</span> <span class="n">v32</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImU32</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">;</span> <span class="kt">bool</span> <span class="n">r</span> <span class="o">=</span> <span class="n">SliderBehaviorT</span><span class="o">&lt;</span><span class="n">ImU32</span><span class="p">,</span> <span class="n">ImS32</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">ImGuiDataType_U32</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v32</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="n">p_min</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">out_grab_bb</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">ImU16</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImU16</span><span class="p">)</span><span class="n">v32</span><span class="p">;</span> <span class="k">return</span> <span class="n">r</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S32</span><span class="p">:</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS32</span><span class="o">*</span><span class="p">)</span><span class="n">p_min</span> <span class="o">&gt;=</span> <span class="n">IM_S32_MIN</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS32</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span> <span class="o">&lt;=</span> <span class="n">IM_S32_MAX</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">SliderBehaviorT</span><span class="o">&lt;</span><span class="n">ImS32</span><span class="p">,</span> <span class="n">ImS32</span><span class="p">,</span> <span class="kt">float</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="p">(</span><span class="n">ImS32</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS32</span><span class="o">*</span><span class="p">)</span><span class="n">p_min</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS32</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span><span class="p">,</span>  <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">out_grab_bb</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U32</span><span class="p">:</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU32</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span> <span class="o">&lt;=</span> <span class="n">IM_U32_MAX</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">SliderBehaviorT</span><span class="o">&lt;</span><span class="n">ImU32</span><span class="p">,</span> <span class="n">ImS32</span><span class="p">,</span> <span class="kt">float</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="p">(</span><span class="n">ImU32</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU32</span><span class="o">*</span><span class="p">)</span><span class="n">p_min</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU32</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span><span class="p">,</span>  <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">out_grab_bb</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_S64</span><span class="p">:</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS64</span><span class="o">*</span><span class="p">)</span><span class="n">p_min</span> <span class="o">&gt;=</span> <span class="n">IM_S64_MIN</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS64</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span> <span class="o">&lt;=</span> <span class="n">IM_S64_MAX</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">SliderBehaviorT</span><span class="o">&lt;</span><span class="n">ImS64</span><span class="p">,</span> <span class="n">ImS64</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="p">(</span><span class="n">ImS64</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS64</span><span class="o">*</span><span class="p">)</span><span class="n">p_min</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImS64</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span><span class="p">,</span>  <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">out_grab_bb</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_U64</span><span class="p">:</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU64</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span> <span class="o">&lt;=</span> <span class="n">IM_U64_MAX</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">SliderBehaviorT</span><span class="o">&lt;</span><span class="n">ImU64</span><span class="p">,</span> <span class="n">ImS64</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="p">(</span><span class="n">ImU64</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU64</span><span class="o">*</span><span class="p">)</span><span class="n">p_min</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">ImU64</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span><span class="p">,</span>  <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">out_grab_bb</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_Float</span><span class="p">:</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">p_min</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">FLT_MAX</span> <span class="o">/</span> <span class="mf">2.0f</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span> <span class="o">&lt;=</span> <span class="n">FLT_MAX</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">SliderBehaviorT</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="p">,</span> <span class="kt">float</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">p_min</span><span class="p">,</span>  <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span><span class="p">,</span>  <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">out_grab_bb</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_Double</span><span class="p">:</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">p_min</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">DBL_MAX</span> <span class="o">/</span> <span class="mf">2.0f</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span> <span class="o">&lt;=</span> <span class="n">DBL_MAX</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">SliderBehaviorT</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="kt">double</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">p_v</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">p_min</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">p_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">out_grab_bb</span><span class="p">);</span>
    <span class="k">case</span> <span class="nl">ImGuiDataType_COUNT</span><span class="p">:</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Note: p_data, p_min and p_max are _pointers_ to a memory address holding the data. For a slider, they are all required.</span>
<span class="c1">// Read code of e.g. SliderFloat(), SliderInt() etc. or examples in &#39;Demo-&gt;Widgets-&gt;Data Types&#39; to understand how to use this function directly.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SliderScalar</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_data</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_min</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">w</span> <span class="o">=</span> <span class="n">CalcItemWidth</span><span class="p">();</span>

    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">frame_bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">label_size</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">));</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">total_bb</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">label_size</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>

    <span class="n">ItemSize</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">frame_bb</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Default format string when passing NULL</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">format</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">DataTypeGetInfo</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">PrintFmt</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_S32</span> <span class="o">&amp;&amp;</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// (FIXME-LEGACY: Patch old &quot;%.0f&quot; format string to use &quot;%d&quot;, read function more details.)</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">PatchFormatStringFloatToInt</span><span class="p">(</span><span class="n">format</span><span class="p">);</span>

    <span class="c1">// Tabbing or CTRL-clicking on Slider turns it into an input box</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">hovered</span> <span class="o">=</span> <span class="n">ItemHoverable</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">temp_input_allowed</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSliderFlags_NoInput</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">temp_input_is_active</span> <span class="o">=</span> <span class="n">temp_input_allowed</span> <span class="o">&amp;&amp;</span> <span class="n">TempInputIsActive</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">temp_input_is_active</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">focus_requested</span> <span class="o">=</span> <span class="n">temp_input_allowed</span> <span class="o">&amp;&amp;</span> <span class="n">FocusableItemRegister</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">clicked</span> <span class="o">=</span> <span class="p">(</span><span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseClicked</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">focus_requested</span> <span class="o">||</span> <span class="n">clicked</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">NavActivateId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">NavInputId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">SetActiveID</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">window</span><span class="p">);</span>
            <span class="n">SetFocusID</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">window</span><span class="p">);</span>
            <span class="n">FocusWindow</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
            <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdUsingNavDirMask</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiDir_Left</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiDir_Right</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">temp_input_allowed</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">focus_requested</span> <span class="o">||</span> <span class="p">(</span><span class="n">clicked</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyCtrl</span><span class="p">)</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">NavInputId</span> <span class="o">==</span> <span class="n">id</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">temp_input_is_active</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                <span class="n">FocusableItemUnregister</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">temp_input_is_active</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Only clamp CTRL+Click input when ImGuiSliderFlags_AlwaysClamp is set</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_clamp_input</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSliderFlags_AlwaysClamp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">TempInputScalar</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">is_clamp_input</span> <span class="o">?</span> <span class="nl">p_min</span> <span class="p">:</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">is_clamp_input</span> <span class="o">?</span> <span class="nl">p_max</span> <span class="p">:</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Draw frame</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">frame_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">?</span> <span class="nl">ImGuiCol_FrameBgActive</span> <span class="p">:</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">?</span> <span class="nl">ImGuiCol_FrameBgHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_FrameBg</span><span class="p">);</span>
    <span class="n">RenderNavHighlight</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="n">RenderFrame</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">frame_col</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">);</span>

    <span class="c1">// Slider behavior</span>
    <span class="n">ImRect</span> <span class="n">grab_bb</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="n">SliderBehavior</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">p_min</span><span class="p">,</span> <span class="n">p_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">grab_bb</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value_changed</span><span class="p">)</span>
        <span class="n">MarkItemEdited</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

    <span class="c1">// Render grab</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">grab_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">grab_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">grab_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">grab_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">?</span> <span class="nl">ImGuiCol_SliderGrabActive</span> <span class="p">:</span> <span class="n">ImGuiCol_SliderGrab</span><span class="p">),</span> <span class="n">style</span><span class="p">.</span><span class="n">GrabRounding</span><span class="p">);</span>

    <span class="c1">// Display value using user-provided display format so user can add prefix/suffix/decorations to the value.</span>
    <span class="kt">char</span> <span class="n">value_buf</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">value_buf_end</span> <span class="o">=</span> <span class="n">value_buf</span> <span class="o">+</span> <span class="n">DataTypeFormatString</span><span class="p">(</span><span class="n">value_buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">value_buf</span><span class="p">),</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>
    <span class="n">RenderTextClipped</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">value_buf</span><span class="p">,</span> <span class="n">value_buf_end</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="n">RenderText</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">label</span><span class="p">);</span>

    <span class="n">IMGUI_TEST_ENGINE_ITEM_INFO</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Add multiple sliders on 1 line for compact edition of multiple components</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SliderScalarN</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">components</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">v_min</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">BeginGroup</span><span class="p">();</span>
    <span class="n">PushID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="n">PushMultiItemsWidths</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">CalcItemWidth</span><span class="p">());</span>
    <span class="kt">size_t</span> <span class="n">type_size</span> <span class="o">=</span> <span class="n">GDataTypeInfo</span><span class="p">[</span><span class="n">data_type</span><span class="p">].</span><span class="n">Size</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">components</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">PushID</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="n">value_changed</span> <span class="o">|=</span> <span class="n">SliderScalar</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
        <span class="n">PopID</span><span class="p">();</span>
        <span class="n">PopItemWidth</span><span class="p">();</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">v</span> <span class="o">+</span> <span class="n">type_size</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">PopID</span><span class="p">();</span>

    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label_end</span> <span class="o">=</span> <span class="n">FindRenderedTextEnd</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">label</span> <span class="o">!=</span> <span class="n">label_end</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="n">TextEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">label_end</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">EndGroup</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SliderFloat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">SliderScalar</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_Float</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SliderFloat2</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kt">float</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">SliderScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_Float</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SliderFloat3</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="kt">float</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">SliderScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_Float</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SliderFloat4</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="kt">float</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">SliderScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_Float</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SliderAngle</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">v_rad</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_degrees_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_degrees_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">format</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="n">format</span> <span class="o">=</span> <span class="s">&quot;%.0f deg&quot;</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">v_deg</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">v_rad</span><span class="p">)</span> <span class="o">*</span> <span class="mf">360.0f</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">IM_PI</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="n">SliderFloat</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_deg</span><span class="p">,</span> <span class="n">v_degrees_min</span><span class="p">,</span> <span class="n">v_degrees_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
    <span class="o">*</span><span class="n">v_rad</span> <span class="o">=</span> <span class="n">v_deg</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">IM_PI</span><span class="p">)</span> <span class="o">/</span> <span class="mf">360.0f</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SliderInt</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">SliderScalar</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SliderInt2</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kt">int</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">SliderScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SliderInt3</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="kt">int</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">SliderScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SliderInt4</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="kt">int</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">SliderScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">VSliderScalar</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_data</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_min</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>

    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">frame_bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">size</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">bb</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">label_size</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>

    <span class="n">ItemSize</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Default format string when passing NULL</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">format</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">DataTypeGetInfo</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">PrintFmt</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_S32</span> <span class="o">&amp;&amp;</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// (FIXME-LEGACY: Patch old &quot;%.0f&quot; format string to use &quot;%d&quot;, read function more details.)</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">PatchFormatStringFloatToInt</span><span class="p">(</span><span class="n">format</span><span class="p">);</span>

    <span class="k">const</span> <span class="kt">bool</span> <span class="n">hovered</span> <span class="o">=</span> <span class="n">ItemHoverable</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseClicked</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">NavActivateId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">NavInputId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SetActiveID</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">window</span><span class="p">);</span>
        <span class="n">SetFocusID</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">window</span><span class="p">);</span>
        <span class="n">FocusWindow</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
        <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdUsingNavDirMask</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiDir_Up</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiDir_Down</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Draw frame</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">frame_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">?</span> <span class="nl">ImGuiCol_FrameBgActive</span> <span class="p">:</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">?</span> <span class="nl">ImGuiCol_FrameBgHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_FrameBg</span><span class="p">);</span>
    <span class="n">RenderNavHighlight</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="n">RenderFrame</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">frame_col</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">);</span>

    <span class="c1">// Slider behavior</span>
    <span class="n">ImRect</span> <span class="n">grab_bb</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="n">SliderBehavior</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">p_min</span><span class="p">,</span> <span class="n">p_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">ImGuiSliderFlags_Vertical</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">grab_bb</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value_changed</span><span class="p">)</span>
        <span class="n">MarkItemEdited</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

    <span class="c1">// Render grab</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">grab_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">grab_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">grab_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">grab_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">?</span> <span class="nl">ImGuiCol_SliderGrabActive</span> <span class="p">:</span> <span class="n">ImGuiCol_SliderGrab</span><span class="p">),</span> <span class="n">style</span><span class="p">.</span><span class="n">GrabRounding</span><span class="p">);</span>

    <span class="c1">// Display value using user-provided display format so user can add prefix/suffix/decorations to the value.</span>
    <span class="c1">// For the vertical slider we allow centered text to overlap the frame padding</span>
    <span class="kt">char</span> <span class="n">value_buf</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">value_buf_end</span> <span class="o">=</span> <span class="n">value_buf</span> <span class="o">+</span> <span class="n">DataTypeFormatString</span><span class="p">(</span><span class="n">value_buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">value_buf</span><span class="p">),</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>
    <span class="n">RenderTextClipped</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">value_buf</span><span class="p">,</span> <span class="n">value_buf_end</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="n">RenderText</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">label</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">VSliderFloat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">VSliderScalar</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">ImGuiDataType_Float</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">VSliderInt</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_min</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiSliderFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">VSliderScalar</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#ifndef IMGUI_DISABLE_OBSOLETE_FUNCTIONS</span>

<span class="c1">// Obsolete versions with power parameter. See https://github.com/ocornut/imgui/issues/3361 for details.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SliderScalar</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_data</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_min</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="kt">float</span> <span class="n">power</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiSliderFlags</span> <span class="n">slider_flags</span> <span class="o">=</span> <span class="n">ImGuiSliderFlags_None</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">power</span> <span class="o">!=</span> <span class="mf">1.0f</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">power</span> <span class="o">==</span> <span class="mf">1.0f</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;Call function with ImGuiSliderFlags_Logarithmic flags instead of using the old &#39;float power&#39; function!&quot;</span><span class="p">);</span>
        <span class="n">slider_flags</span> <span class="o">|=</span> <span class="n">ImGuiSliderFlags_Logarithmic</span><span class="p">;</span>   <span class="c1">// Fallback for non-asserting paths</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">SliderScalar</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">p_min</span><span class="p">,</span> <span class="n">p_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">slider_flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SliderScalarN</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">components</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">v_min</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">v_max</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="kt">float</span> <span class="n">power</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiSliderFlags</span> <span class="n">slider_flags</span> <span class="o">=</span> <span class="n">ImGuiSliderFlags_None</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">power</span> <span class="o">!=</span> <span class="mf">1.0f</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">power</span> <span class="o">==</span> <span class="mf">1.0f</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;Call function with ImGuiSliderFlags_Logarithmic flags instead of using the old &#39;float power&#39; function!&quot;</span><span class="p">);</span>
        <span class="n">slider_flags</span> <span class="o">|=</span> <span class="n">ImGuiSliderFlags_Logarithmic</span><span class="p">;</span>   <span class="c1">// Fallback for non-asserting paths</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">SliderScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">slider_flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="c1">// IMGUI_DISABLE_OBSOLETE_FUNCTIONS</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: InputScalar, InputFloat, InputInt, etc.</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - ImParseFormatFindStart() [Internal]</span>
<span class="c1">// - ImParseFormatFindEnd() [Internal]</span>
<span class="c1">// - ImParseFormatTrimDecorations() [Internal]</span>
<span class="c1">// - ImParseFormatPrecision() [Internal]</span>
<span class="c1">// - TempInputTextScalar() [Internal]</span>
<span class="c1">// - InputScalar()</span>
<span class="c1">// - InputScalarN()</span>
<span class="c1">// - InputFloat()</span>
<span class="c1">// - InputFloat2()</span>
<span class="c1">// - InputFloat3()</span>
<span class="c1">// - InputFloat4()</span>
<span class="c1">// - InputInt()</span>
<span class="c1">// - InputInt2()</span>
<span class="c1">// - InputInt3()</span>
<span class="c1">// - InputInt4()</span>
<span class="c1">// - InputDouble()</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="c1">// We don&#39;t use strchr() because our strings are usually very short and often start with &#39;%&#39;</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">ImParseFormatFindStart</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;%&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;%&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fmt</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;%&#39;</span><span class="p">)</span>
            <span class="n">fmt</span><span class="o">++</span><span class="p">;</span>
        <span class="n">fmt</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">ImParseFormatFindEnd</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Printf/scanf types modifiers: I/L/h/j/l/t/w/z. Other uppercase letters qualify as types aka end of the format.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;%&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ignored_uppercase_mask</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="sc">&#39;I&#39;</span><span class="o">-</span><span class="sc">&#39;A&#39;</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="sc">&#39;L&#39;</span><span class="o">-</span><span class="sc">&#39;A&#39;</span><span class="p">));</span>
    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ignored_lowercase_mask</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="sc">&#39;h&#39;</span><span class="o">-</span><span class="sc">&#39;a&#39;</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="sc">&#39;j&#39;</span><span class="o">-</span><span class="sc">&#39;a&#39;</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="sc">&#39;l&#39;</span><span class="o">-</span><span class="sc">&#39;a&#39;</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="sc">&#39;t&#39;</span><span class="o">-</span><span class="sc">&#39;a&#39;</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="sc">&#39;w&#39;</span><span class="o">-</span><span class="sc">&#39;a&#39;</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="sc">&#39;z&#39;</span><span class="o">-</span><span class="sc">&#39;a&#39;</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">;</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="o">*</span><span class="n">fmt</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">fmt</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="sc">&#39;A&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">&#39;Z&#39;</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="sc">&#39;A&#39;</span><span class="p">))</span> <span class="o">&amp;</span> <span class="n">ignored_uppercase_mask</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fmt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="sc">&#39;a&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">&#39;z&#39;</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="sc">&#39;a&#39;</span><span class="p">))</span> <span class="o">&amp;</span> <span class="n">ignored_lowercase_mask</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fmt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Extract the format out of a format string with leading or trailing decorations</span>
<span class="c1">//  fmt = &quot;blah blah&quot;  -&gt; return fmt</span>
<span class="c1">//  fmt = &quot;%.3f&quot;       -&gt; return fmt</span>
<span class="c1">//  fmt = &quot;hello %.3f&quot; -&gt; return fmt + 6</span>
<span class="c1">//  fmt = &quot;%.3f hello&quot; -&gt; return buf written with &quot;%.3f&quot;</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">ImParseFormatTrimDecorations</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">buf_size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt_start</span> <span class="o">=</span> <span class="n">ImParseFormatFindStart</span><span class="p">(</span><span class="n">fmt</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fmt_start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;%&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt_end</span> <span class="o">=</span> <span class="n">ImParseFormatFindEnd</span><span class="p">(</span><span class="n">fmt_start</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fmt_end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// If we only have leading decoration, we don&#39;t need to copy the data.</span>
        <span class="k">return</span> <span class="n">fmt_start</span><span class="p">;</span>
    <span class="n">ImStrncpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">fmt_start</span><span class="p">,</span> <span class="n">ImMin</span><span class="p">((</span><span class="kt">size_t</span><span class="p">)(</span><span class="n">fmt_end</span> <span class="o">-</span> <span class="n">fmt_start</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">buf</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Parse display precision back from the display format string</span>
<span class="c1">// FIXME: This is still used by some navigation code path to infer a minimum tweak step, but we should aim to rework widgets so it isn&#39;t needed.</span>
<span class="kt">int</span> <span class="n">ImParseFormatPrecision</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="kt">int</span> <span class="n">default_precision</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="n">ImParseFormatFindStart</span><span class="p">(</span><span class="n">fmt</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;%&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">default_precision</span><span class="p">;</span>
    <span class="n">fmt</span><span class="o">++</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">fmt</span> <span class="o">&gt;=</span> <span class="sc">&#39;0&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">fmt</span> <span class="o">&lt;=</span> <span class="sc">&#39;9&#39;</span><span class="p">)</span>
        <span class="n">fmt</span><span class="o">++</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">precision</span> <span class="o">=</span> <span class="n">INT_MAX</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">fmt</span> <span class="o">==</span> <span class="sc">&#39;.&#39;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">ImAtoi</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">fmt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">precision</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">precision</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">precision</span> <span class="o">&gt;</span> <span class="mi">99</span><span class="p">)</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="n">default_precision</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">fmt</span> <span class="o">==</span> <span class="sc">&#39;e&#39;</span> <span class="o">||</span> <span class="o">*</span><span class="n">fmt</span> <span class="o">==</span> <span class="sc">&#39;E&#39;</span><span class="p">)</span> <span class="c1">// Maximum precision with scientific notation</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">fmt</span> <span class="o">==</span> <span class="sc">&#39;g&#39;</span> <span class="o">||</span> <span class="o">*</span><span class="n">fmt</span> <span class="o">==</span> <span class="sc">&#39;G&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">precision</span> <span class="o">==</span> <span class="n">INT_MAX</span><span class="p">)</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">precision</span> <span class="o">==</span> <span class="n">INT_MAX</span><span class="p">)</span> <span class="o">?</span> <span class="nl">default_precision</span> <span class="p">:</span> <span class="n">precision</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Create text input in place of another active widget (e.g. used when doing a CTRL+Click on drag/slider widgets)</span>
<span class="c1">// FIXME: Facilitate using this in variety of other situations.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TempInputText</span><span class="p">(</span><span class="k">const</span> <span class="n">ImRect</span><span class="o">&amp;</span> <span class="n">bb</span><span class="p">,</span> <span class="n">ImGuiID</span> <span class="n">id</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">buf_size</span><span class="p">,</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// On the first frame, g.TempInputTextId == 0, then on subsequent frames it becomes == id.</span>
    <span class="c1">// We clear ActiveID on the first frame to allow the InputText() taking it back.</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">init</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TempInputId</span> <span class="o">!=</span> <span class="n">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">init</span><span class="p">)</span>
        <span class="n">ClearActiveID</span><span class="p">();</span>

    <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="n">InputTextEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">GetSize</span><span class="p">(),</span> <span class="n">flags</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">init</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// First frame we started displaying the InputText widget, we expect it to take the active id.</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span><span class="p">);</span>
        <span class="n">g</span><span class="p">.</span><span class="n">TempInputId</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Note that Drag/Slider functions are only forwarding the min/max values clamping values if the ImGuiSliderFlags_AlwaysClamp flag is set!</span>
<span class="c1">// This is intended: this way we allow CTRL+Click manual input to set a value out of bounds, for maximum flexibility.</span>
<span class="c1">// However this may not be ideal for all uses, as some user code may break on out of bound values.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TempInputScalar</span><span class="p">(</span><span class="k">const</span> <span class="n">ImRect</span><span class="o">&amp;</span> <span class="n">bb</span><span class="p">,</span> <span class="n">ImGuiID</span> <span class="n">id</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_data</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_clamp_min</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_clamp_max</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>

    <span class="kt">char</span> <span class="n">fmt_buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">data_buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">ImParseFormatTrimDecorations</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">fmt_buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">fmt_buf</span><span class="p">));</span>
    <span class="n">DataTypeFormatString</span><span class="p">(</span><span class="n">data_buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">data_buf</span><span class="p">),</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>
    <span class="n">ImStrTrimBlanks</span><span class="p">(</span><span class="n">data_buf</span><span class="p">);</span>

    <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">ImGuiInputTextFlags_AutoSelectAll</span> <span class="o">|</span> <span class="n">ImGuiInputTextFlags_NoMarkEdited</span><span class="p">;</span>
    <span class="n">flags</span> <span class="o">|=</span> <span class="p">((</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_Float</span> <span class="o">||</span> <span class="n">data_type</span> <span class="o">==</span> <span class="n">ImGuiDataType_Double</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiInputTextFlags_CharsScientific</span> <span class="p">:</span> <span class="n">ImGuiInputTextFlags_CharsDecimal</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">TempInputText</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">data_buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">data_buf</span><span class="p">),</span> <span class="n">flags</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// Backup old value</span>
        <span class="kt">size_t</span> <span class="n">data_type_size</span> <span class="o">=</span> <span class="n">DataTypeGetInfo</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Size</span><span class="p">;</span>
        <span class="n">ImGuiDataTypeTempStorage</span> <span class="n">data_backup</span><span class="p">;</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data_backup</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">data_type_size</span><span class="p">);</span>

        <span class="c1">// Apply new value (or operations) then clamp</span>
        <span class="n">DataTypeApplyOpFromText</span><span class="p">(</span><span class="n">data_buf</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">InputTextState</span><span class="p">.</span><span class="n">InitialTextA</span><span class="p">.</span><span class="n">Data</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p_clamp_min</span> <span class="o">||</span> <span class="n">p_clamp_max</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">DataTypeCompare</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">p_clamp_min</span><span class="p">,</span> <span class="n">p_clamp_max</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">ImSwap</span><span class="p">(</span><span class="n">p_clamp_min</span><span class="p">,</span> <span class="n">p_clamp_max</span><span class="p">);</span>
            <span class="n">DataTypeClamp</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">p_clamp_min</span><span class="p">,</span> <span class="n">p_clamp_max</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Only mark as edited if new value is different</span>
        <span class="n">value_changed</span> <span class="o">=</span> <span class="n">memcmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data_backup</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">data_type_size</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">value_changed</span><span class="p">)</span>
            <span class="n">MarkItemEdited</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Note: p_data, p_step, p_step_fast are _pointers_ to a memory address holding the data. For an Input widget, p_step and p_step_fast are optional.</span>
<span class="c1">// Read code of e.g. InputFloat(), InputInt() etc. or examples in &#39;Demo-&gt;Widgets-&gt;Data Types&#39; to understand how to use this function directly.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">InputScalar</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_data</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_step</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_step_fast</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">format</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">DataTypeGetInfo</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">PrintFmt</span><span class="p">;</span>

    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
    <span class="n">DataTypeFormatString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>

    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiInputTextFlags_CharsHexadecimal</span> <span class="o">|</span> <span class="n">ImGuiInputTextFlags_CharsScientific</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiInputTextFlags_CharsDecimal</span><span class="p">;</span>
    <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiInputTextFlags_AutoSelectAll</span><span class="p">;</span>
    <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiInputTextFlags_NoMarkEdited</span><span class="p">;</span>  <span class="c1">// We call MarkItemEdited() ourselves by comparing the actual data rather than the string.</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">p_step</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">button_size</span> <span class="o">=</span> <span class="n">GetFrameHeight</span><span class="p">();</span>

        <span class="n">BeginGroup</span><span class="p">();</span> <span class="c1">// The only purpose of the group here is to allow the caller to query item data e.g. IsItemActive()</span>
        <span class="n">PushID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
        <span class="n">SetNextItemWidth</span><span class="p">(</span><span class="n">ImMax</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">CalcItemWidth</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="n">button_size</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">InputText</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">flags</span><span class="p">))</span> <span class="c1">// PushId(label) + &quot;&quot; gives us the expected ID from outside point of view</span>
            <span class="n">value_changed</span> <span class="o">=</span> <span class="n">DataTypeApplyOpFromText</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">InputTextState</span><span class="p">.</span><span class="n">InitialTextA</span><span class="p">.</span><span class="n">Data</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>

        <span class="c1">// Step buttons</span>
        <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">backup_frame_padding</span> <span class="o">=</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">;</span>
        <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
        <span class="n">ImGuiButtonFlags</span> <span class="n">button_flags</span> <span class="o">=</span> <span class="n">ImGuiButtonFlags_Repeat</span> <span class="o">|</span> <span class="n">ImGuiButtonFlags_DontClosePopups</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_ReadOnly</span><span class="p">)</span>
            <span class="n">button_flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_Disabled</span><span class="p">;</span>
        <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ButtonEx</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">button_size</span><span class="p">,</span> <span class="n">button_size</span><span class="p">),</span> <span class="n">button_flags</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">DataTypeApplyOp</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="sc">&#39;-&#39;</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyCtrl</span> <span class="o">&amp;&amp;</span> <span class="n">p_step_fast</span> <span class="o">?</span> <span class="nl">p_step_fast</span> <span class="p">:</span> <span class="n">p_step</span><span class="p">);</span>
            <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ButtonEx</span><span class="p">(</span><span class="s">&quot;+&quot;</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">button_size</span><span class="p">,</span> <span class="n">button_size</span><span class="p">),</span> <span class="n">button_flags</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">DataTypeApplyOp</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="sc">&#39;+&#39;</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyCtrl</span> <span class="o">&amp;&amp;</span> <span class="n">p_step_fast</span> <span class="o">?</span> <span class="nl">p_step_fast</span> <span class="p">:</span> <span class="n">p_step</span><span class="p">);</span>
            <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label_end</span> <span class="o">=</span> <span class="n">FindRenderedTextEnd</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">label</span> <span class="o">!=</span> <span class="n">label_end</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
            <span class="n">TextEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">label_end</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span> <span class="o">=</span> <span class="n">backup_frame_padding</span><span class="p">;</span>

        <span class="n">PopID</span><span class="p">();</span>
        <span class="n">EndGroup</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">InputText</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">flags</span><span class="p">))</span>
            <span class="n">value_changed</span> <span class="o">=</span> <span class="n">DataTypeApplyOpFromText</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">InputTextState</span><span class="p">.</span><span class="n">InitialTextA</span><span class="p">.</span><span class="n">Data</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value_changed</span><span class="p">)</span>
        <span class="n">MarkItemEdited</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemId</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">InputScalarN</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType</span> <span class="n">data_type</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">components</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_step</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">p_step_fast</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">BeginGroup</span><span class="p">();</span>
    <span class="n">PushID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="n">PushMultiItemsWidths</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">CalcItemWidth</span><span class="p">());</span>
    <span class="kt">size_t</span> <span class="n">type_size</span> <span class="o">=</span> <span class="n">GDataTypeInfo</span><span class="p">[</span><span class="n">data_type</span><span class="p">].</span><span class="n">Size</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">components</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">PushID</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="n">value_changed</span> <span class="o">|=</span> <span class="n">InputScalar</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">p_data</span><span class="p">,</span> <span class="n">p_step</span><span class="p">,</span> <span class="n">p_step_fast</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
        <span class="n">PopID</span><span class="p">();</span>
        <span class="n">PopItemWidth</span><span class="p">();</span>
        <span class="n">p_data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">p_data</span> <span class="o">+</span> <span class="n">type_size</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">PopID</span><span class="p">();</span>

    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label_end</span> <span class="o">=</span> <span class="n">FindRenderedTextEnd</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">label</span> <span class="o">!=</span> <span class="n">label_end</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SameLine</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="n">TextEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">label_end</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">EndGroup</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">InputFloat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">float</span> <span class="n">step</span><span class="p">,</span> <span class="kt">float</span> <span class="n">step_fast</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiInputTextFlags_CharsScientific</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">InputScalar</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_Float</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">step</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="o">&amp;</span><span class="nl">step</span> <span class="p">:</span> <span class="nb">NULL</span><span class="p">),</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">step_fast</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="o">&amp;</span><span class="nl">step_fast</span> <span class="p">:</span> <span class="nb">NULL</span><span class="p">),</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">InputFloat2</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">InputScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_Float</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">InputFloat3</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">InputScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_Float</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">InputFloat4</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">InputScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_Float</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">InputInt</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">step</span><span class="p">,</span> <span class="kt">int</span> <span class="n">step_fast</span><span class="p">,</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Hexadecimal input provided as a convenience but the flag name is awkward. Typically you&#39;d use InputText() to parse your own data, if you want to handle prefixes.</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CharsHexadecimal</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;%08X&quot;</span> <span class="o">:</span> <span class="s">&quot;%d&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">InputScalar</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">step</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="o">&amp;</span><span class="nl">step</span> <span class="p">:</span> <span class="nb">NULL</span><span class="p">),</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">step_fast</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="o">&amp;</span><span class="nl">step_fast</span> <span class="p">:</span> <span class="nb">NULL</span><span class="p">),</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">InputInt2</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">InputScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">InputInt3</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">InputScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">InputInt4</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">InputScalarN</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_S32</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">InputDouble</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">double</span><span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">double</span> <span class="n">step</span><span class="p">,</span> <span class="kt">double</span> <span class="n">step_fast</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiInputTextFlags_CharsScientific</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">InputScalar</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ImGuiDataType_Double</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">step</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="o">?</span> <span class="o">&amp;</span><span class="nl">step</span> <span class="p">:</span> <span class="nb">NULL</span><span class="p">),</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">step_fast</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="o">?</span> <span class="o">&amp;</span><span class="nl">step_fast</span> <span class="p">:</span> <span class="nb">NULL</span><span class="p">),</span> <span class="n">format</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: InputText, InputTextMultiline, InputTextWithHint</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - InputText()</span>
<span class="c1">// - InputTextWithHint()</span>
<span class="c1">// - InputTextMultiline()</span>
<span class="c1">// - InputTextEx() [Internal]</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">InputText</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">buf_size</span><span class="p">,</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="n">ImGuiInputTextCallback</span> <span class="n">callback</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_Multiline</span><span class="p">));</span> <span class="c1">// call InputTextMultiline()</span>
    <span class="k">return</span> <span class="n">InputTextEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">buf_size</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">flags</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">user_data</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">InputTextMultiline</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">buf_size</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size</span><span class="p">,</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="n">ImGuiInputTextCallback</span> <span class="n">callback</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">InputTextEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">buf_size</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">ImGuiInputTextFlags_Multiline</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">user_data</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">InputTextWithHint</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">hint</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">buf_size</span><span class="p">,</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="n">ImGuiInputTextCallback</span> <span class="n">callback</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_Multiline</span><span class="p">));</span> <span class="c1">// call InputTextMultiline()</span>
    <span class="k">return</span> <span class="n">InputTextEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">buf_size</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">flags</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">user_data</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">InputTextCalcTextLenAndLineCount</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text_begin</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">**</span> <span class="n">out_text_end</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">line_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span> <span class="o">=</span> <span class="n">text_begin</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">)</span> <span class="c1">// We are only matching for \n so we can ignore UTF-8 decoding</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span>
            <span class="n">line_count</span><span class="o">++</span><span class="p">;</span>
    <span class="n">s</span><span class="o">--</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;\n&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;\r&#39;</span><span class="p">)</span>
        <span class="n">line_count</span><span class="o">++</span><span class="p">;</span>
    <span class="o">*</span><span class="n">out_text_end</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">line_count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">ImVec2</span> <span class="n">InputTextCalcTextSizeW</span><span class="p">(</span><span class="k">const</span> <span class="n">ImWchar</span><span class="o">*</span> <span class="n">text_begin</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImWchar</span><span class="o">*</span> <span class="n">text_end</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImWchar</span><span class="o">**</span> <span class="n">remaining</span><span class="p">,</span> <span class="n">ImVec2</span><span class="o">*</span> <span class="n">out_offset</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">stop_on_new_line</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImFont</span><span class="o">*</span> <span class="n">font</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Font</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">line_height</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">line_height</span> <span class="o">/</span> <span class="n">font</span><span class="o">-&gt;</span><span class="n">FontSize</span><span class="p">;</span>

    <span class="n">ImVec2</span> <span class="n">text_size</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">line_width</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">ImWchar</span><span class="o">*</span> <span class="n">s</span> <span class="o">=</span> <span class="n">text_begin</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="n">text_end</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)(</span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">text_size</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">text_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">line_width</span><span class="p">);</span>
            <span class="n">text_size</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">line_height</span><span class="p">;</span>
            <span class="n">line_width</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">stop_on_new_line</span><span class="p">)</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\r&#39;</span><span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span>

        <span class="k">const</span> <span class="kt">float</span> <span class="n">char_width</span> <span class="o">=</span> <span class="n">font</span><span class="o">-&gt;</span><span class="n">GetCharAdvance</span><span class="p">((</span><span class="n">ImWchar</span><span class="p">)</span><span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span><span class="p">;</span>
        <span class="n">line_width</span> <span class="o">+=</span> <span class="n">char_width</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">text_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">line_width</span><span class="p">)</span>
        <span class="n">text_size</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">line_width</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">out_offset</span><span class="p">)</span>
        <span class="o">*</span><span class="n">out_offset</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">text_size</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">line_height</span><span class="p">);</span>  <span class="c1">// offset allow for the possibility of sitting after a trailing \n</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">line_width</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">text_size</span><span class="p">.</span><span class="n">y</span> <span class="o">==</span> <span class="mf">0.0f</span><span class="p">)</span>                        <span class="c1">// whereas size.y will ignore the trailing \n</span>
        <span class="n">text_size</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">line_height</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">remaining</span><span class="p">)</span>
        <span class="o">*</span><span class="n">remaining</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">text_size</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Wrapper for stb_textedit.h to edit text (our wrapper is for: statically sized buffer, single-line, wchar characters. InputText converts between UTF-8 and wchar)</span>
<span class="k">namespace</span> <span class="nn">ImStb</span>
<span class="p">{</span>

<span class="k">static</span> <span class="kt">int</span>     <span class="nf">STB_TEXTEDIT_STRINGLEN</span><span class="p">(</span><span class="k">const</span> <span class="n">STB_TEXTEDIT_STRING</span><span class="o">*</span> <span class="n">obj</span><span class="p">)</span>                             <span class="p">{</span> <span class="k">return</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">CurLenW</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="n">ImWchar</span> <span class="nf">STB_TEXTEDIT_GETCHAR</span><span class="p">(</span><span class="k">const</span> <span class="n">STB_TEXTEDIT_STRING</span><span class="o">*</span> <span class="n">obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>                      <span class="p">{</span> <span class="k">return</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span> <span class="p">}</span>
<span class="k">static</span> <span class="kt">float</span>   <span class="nf">STB_TEXTEDIT_GETWIDTH</span><span class="p">(</span><span class="n">STB_TEXTEDIT_STRING</span><span class="o">*</span> <span class="n">obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line_start_idx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">char_idx</span><span class="p">)</span>  <span class="p">{</span> <span class="n">ImWchar</span> <span class="n">c</span> <span class="o">=</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">[</span><span class="n">line_start_idx</span> <span class="o">+</span> <span class="n">char_idx</span><span class="p">];</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="n">STB_TEXTEDIT_GETWIDTH_NEWLINE</span><span class="p">;</span> <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span> <span class="k">return</span> <span class="n">g</span><span class="p">.</span><span class="n">Font</span><span class="o">-&gt;</span><span class="n">GetCharAdvance</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">/</span> <span class="n">g</span><span class="p">.</span><span class="n">Font</span><span class="o">-&gt;</span><span class="n">FontSize</span><span class="p">);</span> <span class="p">}</span>
<span class="k">static</span> <span class="kt">int</span>     <span class="nf">STB_TEXTEDIT_KEYTOTEXT</span><span class="p">(</span><span class="kt">int</span> <span class="n">key</span><span class="p">)</span>                                                    <span class="p">{</span> <span class="k">return</span> <span class="n">key</span> <span class="o">&gt;=</span> <span class="mh">0x200000</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">key</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="n">ImWchar</span> <span class="n">STB_TEXTEDIT_NEWLINE</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">void</span>    <span class="nf">STB_TEXTEDIT_LAYOUTROW</span><span class="p">(</span><span class="n">StbTexteditRow</span><span class="o">*</span> <span class="n">r</span><span class="p">,</span> <span class="n">STB_TEXTEDIT_STRING</span><span class="o">*</span> <span class="n">obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line_start_idx</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="n">ImWchar</span><span class="o">*</span> <span class="n">text</span> <span class="o">=</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImWchar</span><span class="o">*</span> <span class="n">text_remaining</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">size</span> <span class="o">=</span> <span class="n">InputTextCalcTextSizeW</span><span class="p">(</span><span class="n">text</span> <span class="o">+</span> <span class="n">line_start_idx</span><span class="p">,</span> <span class="n">text</span> <span class="o">+</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">CurLenW</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">text_remaining</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="n">r</span><span class="o">-&gt;</span><span class="n">x0</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="n">r</span><span class="o">-&gt;</span><span class="n">x1</span> <span class="o">=</span> <span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">r</span><span class="o">-&gt;</span><span class="n">baseline_y_delta</span> <span class="o">=</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="n">r</span><span class="o">-&gt;</span><span class="n">ymin</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="n">r</span><span class="o">-&gt;</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="n">r</span><span class="o">-&gt;</span><span class="n">num_chars</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">text_remaining</span> <span class="o">-</span> <span class="p">(</span><span class="n">text</span> <span class="o">+</span> <span class="n">line_start_idx</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">bool</span> <span class="nf">is_separator</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span>                                        <span class="p">{</span> <span class="k">return</span> <span class="n">ImCharIsBlankW</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">||</span> <span class="n">c</span><span class="o">==</span><span class="sc">&#39;,&#39;</span> <span class="o">||</span> <span class="n">c</span><span class="o">==</span><span class="sc">&#39;;&#39;</span> <span class="o">||</span> <span class="n">c</span><span class="o">==</span><span class="sc">&#39;(&#39;</span> <span class="o">||</span> <span class="n">c</span><span class="o">==</span><span class="sc">&#39;)&#39;</span> <span class="o">||</span> <span class="n">c</span><span class="o">==</span><span class="sc">&#39;{&#39;</span> <span class="o">||</span> <span class="n">c</span><span class="o">==</span><span class="sc">&#39;}&#39;</span> <span class="o">||</span> <span class="n">c</span><span class="o">==</span><span class="sc">&#39;[&#39;</span> <span class="o">||</span> <span class="n">c</span><span class="o">==</span><span class="sc">&#39;]&#39;</span> <span class="o">||</span> <span class="n">c</span><span class="o">==</span><span class="sc">&#39;|&#39;</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">is_word_boundary_from_right</span><span class="p">(</span><span class="n">STB_TEXTEDIT_STRING</span><span class="o">*</span> <span class="n">obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>      <span class="p">{</span> <span class="k">return</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="p">(</span><span class="n">is_separator</span><span class="p">(</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_separator</span><span class="p">(</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="p">)</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">STB_TEXTEDIT_MOVEWORDLEFT_IMPL</span><span class="p">(</span><span class="n">STB_TEXTEDIT_STRING</span><span class="o">*</span> <span class="n">obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>   <span class="p">{</span> <span class="n">idx</span><span class="o">--</span><span class="p">;</span> <span class="k">while</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_word_boundary_from_right</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">idx</span><span class="p">))</span> <span class="n">idx</span><span class="o">--</span><span class="p">;</span> <span class="k">return</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">idx</span><span class="p">;</span> <span class="p">}</span>
<span class="cp">#ifdef __APPLE__    </span><span class="c1">// FIXME: Move setting to IO structure</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">is_word_boundary_from_left</span><span class="p">(</span><span class="n">STB_TEXTEDIT_STRING</span><span class="o">*</span> <span class="n">obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>       <span class="p">{</span> <span class="k">return</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="p">(</span><span class="o">!</span><span class="n">is_separator</span><span class="p">(</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="n">is_separator</span><span class="p">(</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="p">)</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">STB_TEXTEDIT_MOVEWORDRIGHT_IMPL</span><span class="p">(</span><span class="n">STB_TEXTEDIT_STRING</span><span class="o">*</span> <span class="n">obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>  <span class="p">{</span> <span class="n">idx</span><span class="o">++</span><span class="p">;</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">CurLenW</span><span class="p">;</span> <span class="k">while</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="n">len</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_word_boundary_from_left</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">idx</span><span class="p">))</span> <span class="n">idx</span><span class="o">++</span><span class="p">;</span> <span class="k">return</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="n">len</span> <span class="o">?</span> <span class="nl">len</span> <span class="p">:</span> <span class="n">idx</span><span class="p">;</span> <span class="p">}</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">STB_TEXTEDIT_MOVEWORDRIGHT_IMPL</span><span class="p">(</span><span class="n">STB_TEXTEDIT_STRING</span><span class="o">*</span> <span class="n">obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>  <span class="p">{</span> <span class="n">idx</span><span class="o">++</span><span class="p">;</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">CurLenW</span><span class="p">;</span> <span class="k">while</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="n">len</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_word_boundary_from_right</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">idx</span><span class="p">))</span> <span class="n">idx</span><span class="o">++</span><span class="p">;</span> <span class="k">return</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="n">len</span> <span class="o">?</span> <span class="nl">len</span> <span class="p">:</span> <span class="n">idx</span><span class="p">;</span> <span class="p">}</span>
<span class="cp">#endif</span>
<span class="cp">#define STB_TEXTEDIT_MOVEWORDLEFT   STB_TEXTEDIT_MOVEWORDLEFT_IMPL    </span><span class="c1">// They need to be #define for stb_textedit.h</span>
<span class="cp">#define STB_TEXTEDIT_MOVEWORDRIGHT  STB_TEXTEDIT_MOVEWORDRIGHT_IMPL</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">STB_TEXTEDIT_DELETECHARS</span><span class="p">(</span><span class="n">STB_TEXTEDIT_STRING</span><span class="o">*</span> <span class="n">obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pos</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImWchar</span><span class="o">*</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Data</span> <span class="o">+</span> <span class="n">pos</span><span class="p">;</span>

    <span class="c1">// We maintain our buffer length in both UTF-8 and wchar formats</span>
    <span class="n">obj</span><span class="o">-&gt;</span><span class="n">Edited</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">obj</span><span class="o">-&gt;</span><span class="n">CurLenA</span> <span class="o">-=</span> <span class="n">ImTextCountUtf8BytesFromStr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">dst</span> <span class="o">+</span> <span class="n">n</span><span class="p">);</span>
    <span class="n">obj</span><span class="o">-&gt;</span><span class="n">CurLenW</span> <span class="o">-=</span> <span class="n">n</span><span class="p">;</span>

    <span class="c1">// Offset remaining text (FIXME-OPT: Use memmove)</span>
    <span class="k">const</span> <span class="n">ImWchar</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Data</span> <span class="o">+</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">n</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">ImWchar</span> <span class="n">c</span> <span class="o">=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span><span class="p">)</span>
        <span class="o">*</span><span class="n">dst</span><span class="o">++</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="o">*</span><span class="n">dst</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">bool</span> <span class="nf">STB_TEXTEDIT_INSERTCHARS</span><span class="p">(</span><span class="n">STB_TEXTEDIT_STRING</span><span class="o">*</span> <span class="n">obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pos</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImWchar</span><span class="o">*</span> <span class="n">new_text</span><span class="p">,</span> <span class="kt">int</span> <span class="n">new_text_len</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_resizable</span> <span class="o">=</span> <span class="p">(</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">UserFlags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CallbackResize</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">text_len</span> <span class="o">=</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">CurLenW</span><span class="p">;</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">pos</span> <span class="o">&lt;=</span> <span class="n">text_len</span><span class="p">);</span>

    <span class="k">const</span> <span class="kt">int</span> <span class="n">new_text_len_utf8</span> <span class="o">=</span> <span class="n">ImTextCountUtf8BytesFromStr</span><span class="p">(</span><span class="n">new_text</span><span class="p">,</span> <span class="n">new_text</span> <span class="o">+</span> <span class="n">new_text_len</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_resizable</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">new_text_len_utf8</span> <span class="o">+</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">CurLenA</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">BufCapacityA</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Grow internal buffer if needed</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">new_text_len</span> <span class="o">+</span> <span class="n">text_len</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Size</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_resizable</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">text_len</span> <span class="o">&lt;</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Size</span><span class="p">);</span>
        <span class="n">obj</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">text_len</span> <span class="o">+</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">new_text_len</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">ImMax</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">new_text_len</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">ImWchar</span><span class="o">*</span> <span class="n">text</span> <span class="o">=</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pos</span> <span class="o">!=</span> <span class="n">text_len</span><span class="p">)</span>
        <span class="n">memmove</span><span class="p">(</span><span class="n">text</span> <span class="o">+</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">new_text_len</span><span class="p">,</span> <span class="n">text</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)(</span><span class="n">text_len</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ImWchar</span><span class="p">));</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="n">text</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">new_text</span><span class="p">,</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">new_text_len</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ImWchar</span><span class="p">));</span>

    <span class="n">obj</span><span class="o">-&gt;</span><span class="n">Edited</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">obj</span><span class="o">-&gt;</span><span class="n">CurLenW</span> <span class="o">+=</span> <span class="n">new_text_len</span><span class="p">;</span>
    <span class="n">obj</span><span class="o">-&gt;</span><span class="n">CurLenA</span> <span class="o">+=</span> <span class="n">new_text_len_utf8</span><span class="p">;</span>
    <span class="n">obj</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">[</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">CurLenW</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>

    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// We don&#39;t use an enum so we can build even with conflicting symbols (if another user of stb_textedit.h leak their STB_TEXTEDIT_K_* symbols)</span>
<span class="cp">#define STB_TEXTEDIT_K_LEFT         0x200000 </span><span class="c1">// keyboard input to move cursor left</span>
<span class="cp">#define STB_TEXTEDIT_K_RIGHT        0x200001 </span><span class="c1">// keyboard input to move cursor right</span>
<span class="cp">#define STB_TEXTEDIT_K_UP           0x200002 </span><span class="c1">// keyboard input to move cursor up</span>
<span class="cp">#define STB_TEXTEDIT_K_DOWN         0x200003 </span><span class="c1">// keyboard input to move cursor down</span>
<span class="cp">#define STB_TEXTEDIT_K_LINESTART    0x200004 </span><span class="c1">// keyboard input to move cursor to start of line</span>
<span class="cp">#define STB_TEXTEDIT_K_LINEEND      0x200005 </span><span class="c1">// keyboard input to move cursor to end of line</span>
<span class="cp">#define STB_TEXTEDIT_K_TEXTSTART    0x200006 </span><span class="c1">// keyboard input to move cursor to start of text</span>
<span class="cp">#define STB_TEXTEDIT_K_TEXTEND      0x200007 </span><span class="c1">// keyboard input to move cursor to end of text</span>
<span class="cp">#define STB_TEXTEDIT_K_DELETE       0x200008 </span><span class="c1">// keyboard input to delete selection or character under cursor</span>
<span class="cp">#define STB_TEXTEDIT_K_BACKSPACE    0x200009 </span><span class="c1">// keyboard input to delete selection or character left of cursor</span>
<span class="cp">#define STB_TEXTEDIT_K_UNDO         0x20000A </span><span class="c1">// keyboard input to perform undo</span>
<span class="cp">#define STB_TEXTEDIT_K_REDO         0x20000B </span><span class="c1">// keyboard input to perform redo</span>
<span class="cp">#define STB_TEXTEDIT_K_WORDLEFT     0x20000C </span><span class="c1">// keyboard input to move cursor left one word</span>
<span class="cp">#define STB_TEXTEDIT_K_WORDRIGHT    0x20000D </span><span class="c1">// keyboard input to move cursor right one word</span>
<span class="cp">#define STB_TEXTEDIT_K_PGUP         0x20000E </span><span class="c1">// keyboard input to move cursor up a page</span>
<span class="cp">#define STB_TEXTEDIT_K_PGDOWN       0x20000F </span><span class="c1">// keyboard input to move cursor down a page</span>
<span class="cp">#define STB_TEXTEDIT_K_SHIFT        0x400000</span>

<span class="cp">#define STB_TEXTEDIT_IMPLEMENTATION</span>
<span class="cp">#include</span> <span class="cpf">&lt;imgui/imstb_textedit.h&gt;</span><span class="cp"></span>

<span class="c1">// stb_textedit internally allows for a single undo record to do addition and deletion, but somehow, calling</span>
<span class="c1">// the stb_textedit_paste() function creates two separate records, so we perform it manually. (FIXME: Report to nothings/stb?)</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">stb_textedit_replace</span><span class="p">(</span><span class="n">STB_TEXTEDIT_STRING</span><span class="o">*</span> <span class="n">str</span><span class="p">,</span> <span class="n">STB_TexteditState</span><span class="o">*</span> <span class="n">state</span><span class="p">,</span> <span class="k">const</span> <span class="n">STB_TEXTEDIT_CHARTYPE</span><span class="o">*</span> <span class="n">text</span><span class="p">,</span> <span class="kt">int</span> <span class="n">text_len</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">stb_text_makeundo_replace</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">str</span><span class="o">-&gt;</span><span class="n">CurLenW</span><span class="p">,</span> <span class="n">text_len</span><span class="p">);</span>
    <span class="n">ImStb</span><span class="o">::</span><span class="n">STB_TEXTEDIT_DELETECHARS</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">str</span><span class="o">-&gt;</span><span class="n">CurLenW</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">text_len</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ImStb</span><span class="o">::</span><span class="n">STB_TEXTEDIT_INSERTCHARS</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">text_len</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">cursor</span> <span class="o">=</span> <span class="n">text_len</span><span class="p">;</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">has_preferred_x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// Failed to insert character, normally shouldn&#39;t happen because of how we currently use stb_textedit_replace()</span>
<span class="p">}</span>

<span class="p">}</span> <span class="c1">// namespace ImStb</span>

<span class="kt">void</span> <span class="n">ImGuiInputTextState</span><span class="o">::</span><span class="n">OnKeyPressed</span><span class="p">(</span><span class="kt">int</span> <span class="n">key</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">stb_textedit_key</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Stb</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
    <span class="n">CursorFollow</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">CursorAnimReset</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">ImGuiInputTextCallbackData</span><span class="o">::</span><span class="n">ImGuiInputTextCallbackData</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// Public API to manipulate UTF-8 text</span>
<span class="c1">// We expose UTF-8 to the user (unlike the STB_TEXTEDIT_* functions which are manipulating wchar)</span>
<span class="c1">// FIXME: The existence of this rarely exercised code path is a bit of a nuisance.</span>
<span class="kt">void</span> <span class="n">ImGuiInputTextCallbackData</span><span class="o">::</span><span class="n">DeleteChars</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">,</span> <span class="kt">int</span> <span class="n">bytes_count</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">pos</span> <span class="o">+</span> <span class="n">bytes_count</span> <span class="o">&lt;=</span> <span class="n">BufTextLen</span><span class="p">);</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">Buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="n">Buf</span> <span class="o">+</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">bytes_count</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span><span class="p">)</span>
        <span class="o">*</span><span class="n">dst</span><span class="o">++</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="o">*</span><span class="n">dst</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">CursorPos</span> <span class="o">&gt;=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">bytes_count</span><span class="p">)</span>
        <span class="n">CursorPos</span> <span class="o">-=</span> <span class="n">bytes_count</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">CursorPos</span> <span class="o">&gt;=</span> <span class="n">pos</span><span class="p">)</span>
        <span class="n">CursorPos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">SelectionStart</span> <span class="o">=</span> <span class="n">SelectionEnd</span> <span class="o">=</span> <span class="n">CursorPos</span><span class="p">;</span>
    <span class="n">BufDirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">BufTextLen</span> <span class="o">-=</span> <span class="n">bytes_count</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImGuiInputTextCallbackData</span><span class="o">::</span><span class="n">InsertChars</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">new_text</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">new_text_end</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_resizable</span> <span class="o">=</span> <span class="p">(</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CallbackResize</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">new_text_len</span> <span class="o">=</span> <span class="n">new_text_end</span> <span class="o">?</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">new_text_end</span> <span class="o">-</span> <span class="n">new_text</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">strlen</span><span class="p">(</span><span class="n">new_text</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">new_text_len</span> <span class="o">+</span> <span class="n">BufTextLen</span> <span class="o">&gt;=</span> <span class="n">BufSize</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_resizable</span><span class="p">)</span>
            <span class="k">return</span><span class="p">;</span>

        <span class="c1">// Contrary to STB_TEXTEDIT_INSERTCHARS() this is working in the UTF8 buffer, hence the mildly similar code (until we remove the U16 buffer altogether!)</span>
        <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
        <span class="n">ImGuiInputTextState</span><span class="o">*</span> <span class="n">edit_state</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">.</span><span class="n">InputTextState</span><span class="p">;</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">edit_state</span><span class="o">-&gt;</span><span class="n">ID</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">edit_state</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">);</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">Buf</span> <span class="o">==</span> <span class="n">edit_state</span><span class="o">-&gt;</span><span class="n">TextA</span><span class="p">.</span><span class="n">Data</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">new_buf_size</span> <span class="o">=</span> <span class="n">BufTextLen</span> <span class="o">+</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">new_text_len</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">ImMax</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">new_text_len</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">edit_state</span><span class="o">-&gt;</span><span class="n">TextA</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">new_buf_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">Buf</span> <span class="o">=</span> <span class="n">edit_state</span><span class="o">-&gt;</span><span class="n">TextA</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span>
        <span class="n">BufSize</span> <span class="o">=</span> <span class="n">edit_state</span><span class="o">-&gt;</span><span class="n">BufCapacityA</span> <span class="o">=</span> <span class="n">new_buf_size</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">BufTextLen</span> <span class="o">!=</span> <span class="n">pos</span><span class="p">)</span>
        <span class="n">memmove</span><span class="p">(</span><span class="n">Buf</span> <span class="o">+</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">new_text_len</span><span class="p">,</span> <span class="n">Buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)(</span><span class="n">BufTextLen</span> <span class="o">-</span> <span class="n">pos</span><span class="p">));</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="n">Buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">new_text</span><span class="p">,</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">new_text_len</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
    <span class="n">Buf</span><span class="p">[</span><span class="n">BufTextLen</span> <span class="o">+</span> <span class="n">new_text_len</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">CursorPos</span> <span class="o">&gt;=</span> <span class="n">pos</span><span class="p">)</span>
        <span class="n">CursorPos</span> <span class="o">+=</span> <span class="n">new_text_len</span><span class="p">;</span>
    <span class="n">SelectionStart</span> <span class="o">=</span> <span class="n">SelectionEnd</span> <span class="o">=</span> <span class="n">CursorPos</span><span class="p">;</span>
    <span class="n">BufDirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">BufTextLen</span> <span class="o">+=</span> <span class="n">new_text_len</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Return false to discard a character.</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="n">InputTextFilterCharacter</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">*</span> <span class="n">p_char</span><span class="p">,</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="n">ImGuiInputTextCallback</span> <span class="n">callback</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="o">*</span><span class="n">p_char</span><span class="p">;</span>

    <span class="c1">// Filter non-printable (NB: isprint is unreliable! see #2467)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mh">0x20</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">pass</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="n">pass</span> <span class="o">|=</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_Multiline</span><span class="p">));</span>
        <span class="n">pass</span> <span class="o">|=</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\t&#39;</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_AllowTabInput</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pass</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// We ignore Ascii representation of delete (emitted from Backspace on OSX, see #2578, #2817)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="mi">127</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Filter private Unicode range. GLFW on OSX seems to send private characters for special keys like arrow keys (FIXME)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="mh">0xE000</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="mh">0xF8FF</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Filter Unicode ranges we are not handling in this build.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="n">IM_UNICODE_CODEPOINT_MAX</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Generic named filters</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiInputTextFlags_CharsDecimal</span> <span class="o">|</span> <span class="n">ImGuiInputTextFlags_CharsHexadecimal</span> <span class="o">|</span> <span class="n">ImGuiInputTextFlags_CharsUppercase</span> <span class="o">|</span> <span class="n">ImGuiInputTextFlags_CharsNoBlank</span> <span class="o">|</span> <span class="n">ImGuiInputTextFlags_CharsScientific</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// The libc allows overriding locale, with e.g. &#39;setlocale(LC_NUMERIC, &quot;de_DE.UTF-8&quot;);&#39; which affect the output/input of printf/scanf.</span>
        <span class="c1">// The standard mandate that programs starts in the &quot;C&quot; locale where the decimal point is &#39;.&#39;.</span>
        <span class="c1">// We don&#39;t really intend to provide widespread support for it, but out of empathy for people stuck with using odd API, we support the bare minimum aka overriding the decimal point.</span>
        <span class="c1">// Change the default decimal_point with:</span>
        <span class="c1">//   ImGui::GetCurrentContext()-&gt;PlatformLocaleDecimalPoint = *localeconv()-&gt;decimal_point;</span>
        <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">c_decimal_point</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">g</span><span class="p">.</span><span class="n">PlatformLocaleDecimalPoint</span><span class="p">;</span>

        <span class="c1">// Allow 0-9 . - + * /</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CharsDecimal</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="sc">&#39;0&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">&#39;9&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="n">c_decimal_point</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">&#39;*&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">&#39;/&#39;</span><span class="p">))</span>
                <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

        <span class="c1">// Allow 0-9 . - + * / e E</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CharsScientific</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="sc">&#39;0&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">&#39;9&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="n">c_decimal_point</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">&#39;*&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">&#39;/&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">&#39;e&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">&#39;E&#39;</span><span class="p">))</span>
                <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

        <span class="c1">// Allow 0-9 a-F A-F</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CharsHexadecimal</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="sc">&#39;0&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">&#39;9&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="sc">&#39;a&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">&#39;f&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="sc">&#39;A&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">&#39;F&#39;</span><span class="p">))</span>
                <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

        <span class="c1">// Turn a-z into A-Z</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CharsUppercase</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="sc">&#39;a&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">&#39;z&#39;</span><span class="p">)</span>
                <span class="o">*</span><span class="n">p_char</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)(</span><span class="sc">&#39;A&#39;</span> <span class="o">-</span> <span class="sc">&#39;a&#39;</span><span class="p">));</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CharsNoBlank</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ImCharIsBlankW</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
                <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Custom callback filter</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CallbackCharFilter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ImGuiInputTextCallbackData</span> <span class="n">callback_data</span><span class="p">;</span>
        <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">callback_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ImGuiInputTextCallbackData</span><span class="p">));</span>
        <span class="n">callback_data</span><span class="p">.</span><span class="n">EventFlag</span> <span class="o">=</span> <span class="n">ImGuiInputTextFlags_CallbackCharFilter</span><span class="p">;</span>
        <span class="n">callback_data</span><span class="p">.</span><span class="n">EventChar</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImWchar</span><span class="p">)</span><span class="n">c</span><span class="p">;</span>
        <span class="n">callback_data</span><span class="p">.</span><span class="n">Flags</span> <span class="o">=</span> <span class="n">flags</span><span class="p">;</span>
        <span class="n">callback_data</span><span class="p">.</span><span class="n">UserData</span> <span class="o">=</span> <span class="n">user_data</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">callback</span><span class="p">(</span><span class="o">&amp;</span><span class="n">callback_data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="o">*</span><span class="n">p_char</span> <span class="o">=</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">EventChar</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">callback_data</span><span class="p">.</span><span class="n">EventChar</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Edit a string of text</span>
<span class="c1">// - buf_size account for the zero-terminator, so a buf_size of 6 can hold &quot;Hello&quot; but not &quot;Hello!&quot;.</span>
<span class="c1">//   This is so we can easily call InputText() on static arrays using ARRAYSIZE() and to match</span>
<span class="c1">//   Note that in std::string world, capacity() would omit 1 byte used by the zero-terminator.</span>
<span class="c1">// - When active, hold on a privately held copy of the text (and apply back to &#39;buf&#39;). So changing &#39;buf&#39; while the InputText is active has no effect.</span>
<span class="c1">// - If you want to use ImGui::InputText() with std::string, see misc/cpp/imgui_stdlib.h</span>
<span class="c1">// (FIXME: Rather confusing and messy function, among the worse part of our codebase, expecting to rewrite a V2 at some point.. Partly because we are</span>
<span class="c1">//  doing UTF8 &gt; U16 &gt; UTF8 conversions on the go to easily interface with stb_textedit. Ideally should stay in UTF-8 all the time. See https://github.com/nothings/stb/issues/188)</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">InputTextEx</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">hint</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">buf_size</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size_arg</span><span class="p">,</span> <span class="n">ImGuiInputTextFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="n">ImGuiInputTextCallback</span> <span class="n">callback</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">callback_user_data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">buf</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">buf_size</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CallbackHistory</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_Multiline</span><span class="p">)));</span>        <span class="c1">// Can&#39;t use both together (they both use up/down keys)</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CallbackCompletion</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_AllowTabInput</span><span class="p">)));</span> <span class="c1">// Can&#39;t use both together (they both use tab key)</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiIO</span><span class="o">&amp;</span> <span class="n">io</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">bool</span> <span class="n">RENDER_SELECTION_WHEN_INACTIVE</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_multiline</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_Multiline</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_readonly</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_ReadOnly</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_password</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_Password</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_undoable</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_NoUndoRedo</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_resizable</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CallbackResize</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_resizable</span><span class="p">)</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">callback</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span> <span class="c1">// Must provide a callback if you set the ImGuiInputTextFlags_CallbackResize flag!</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">is_multiline</span><span class="p">)</span> <span class="c1">// Open group before calling GetID() because groups tracks id created within their scope,</span>
        <span class="n">BeginGroup</span><span class="p">();</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">frame_size</span> <span class="o">=</span> <span class="n">CalcItemSize</span><span class="p">(</span><span class="n">size_arg</span><span class="p">,</span> <span class="n">CalcItemWidth</span><span class="p">(),</span> <span class="p">(</span><span class="n">is_multiline</span> <span class="o">?</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">8.0f</span> <span class="o">:</span> <span class="n">label_size</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">);</span> <span class="c1">// Arbitrary default of 8 lines high for multi-line</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">total_size</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">frame_size</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">label_size</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">),</span> <span class="n">frame_size</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>

    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">frame_bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">frame_size</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">total_bb</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">total_size</span><span class="p">);</span>

    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">draw_window</span> <span class="o">=</span> <span class="n">window</span><span class="p">;</span>
    <span class="n">ImVec2</span> <span class="n">inner_size</span> <span class="o">=</span> <span class="n">frame_size</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_multiline</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">frame_bb</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">ItemSize</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
            <span class="n">EndGroup</span><span class="p">();</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// We reproduce the contents of BeginChildFrame() in order to provide &#39;label&#39; so our window internal data are easier to read/debug.</span>
        <span class="n">PushStyleColor</span><span class="p">(</span><span class="n">ImGuiCol_ChildBg</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">Colors</span><span class="p">[</span><span class="n">ImGuiCol_FrameBg</span><span class="p">]);</span>
        <span class="n">PushStyleVar</span><span class="p">(</span><span class="n">ImGuiStyleVar_ChildRounding</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">);</span>
        <span class="n">PushStyleVar</span><span class="p">(</span><span class="n">ImGuiStyleVar_ChildBorderSize</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameBorderSize</span><span class="p">);</span>
        <span class="n">PushStyleVar</span><span class="p">(</span><span class="n">ImGuiStyleVar_WindowPadding</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">);</span>
        <span class="kt">bool</span> <span class="n">child_visible</span> <span class="o">=</span> <span class="n">BeginChildEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">GetSize</span><span class="p">(),</span> <span class="nb">true</span><span class="p">,</span> <span class="n">ImGuiWindowFlags_NoMove</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_AlwaysUseWindowPadding</span><span class="p">);</span>
        <span class="n">PopStyleVar</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
        <span class="n">PopStyleColor</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">child_visible</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">EndChild</span><span class="p">();</span>
            <span class="n">EndGroup</span><span class="p">();</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">draw_window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span> <span class="c1">// Child window</span>
        <span class="n">draw_window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">NavLayerActiveMaskNext</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">draw_window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">NavLayerCurrent</span><span class="p">);</span> <span class="c1">// This is to ensure that EndChild() will display a navigation highlight so we can &quot;enter&quot; into it.</span>
        <span class="n">inner_size</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">draw_window</span><span class="o">-&gt;</span><span class="n">ScrollbarSizes</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">ItemSize</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">frame_bb</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">hovered</span> <span class="o">=</span> <span class="n">ItemHoverable</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">hovered</span><span class="p">)</span>
        <span class="n">g</span><span class="p">.</span><span class="n">MouseCursor</span> <span class="o">=</span> <span class="n">ImGuiMouseCursor_TextInput</span><span class="p">;</span>

    <span class="c1">// We are only allowed to access the state if we are already the active widget.</span>
    <span class="n">ImGuiInputTextState</span><span class="o">*</span> <span class="n">state</span> <span class="o">=</span> <span class="n">GetInputTextState</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

    <span class="k">const</span> <span class="kt">bool</span> <span class="n">focus_requested</span> <span class="o">=</span> <span class="n">FocusableItemRegister</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">focus_requested_by_code</span> <span class="o">=</span> <span class="n">focus_requested</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FocusRequestCurrWindow</span> <span class="o">==</span> <span class="n">window</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">FocusRequestCurrCounterRegular</span> <span class="o">==</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">FocusCounterRegular</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">focus_requested_by_tab</span> <span class="o">=</span> <span class="n">focus_requested</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">focus_requested_by_code</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">bool</span> <span class="n">user_clicked</span> <span class="o">=</span> <span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseClicked</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">user_nav_input_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">!=</span> <span class="n">id</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">g</span><span class="p">.</span><span class="n">NavInputId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavActivateId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavInputSource</span> <span class="o">==</span> <span class="n">ImGuiInputSource_NavKeyboard</span><span class="p">));</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">user_scroll_finish</span> <span class="o">=</span> <span class="n">is_multiline</span> <span class="o">&amp;&amp;</span> <span class="n">state</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdPreviousFrame</span> <span class="o">==</span> <span class="n">GetWindowScrollbarID</span><span class="p">(</span><span class="n">draw_window</span><span class="p">,</span> <span class="n">ImGuiAxis_Y</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">user_scroll_active</span> <span class="o">=</span> <span class="n">is_multiline</span> <span class="o">&amp;&amp;</span> <span class="n">state</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">GetWindowScrollbarID</span><span class="p">(</span><span class="n">draw_window</span><span class="p">,</span> <span class="n">ImGuiAxis_Y</span><span class="p">);</span>

    <span class="kt">bool</span> <span class="n">clear_active_id</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">select_all</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">!=</span> <span class="n">id</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_AutoSelectAll</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">user_nav_input_start</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">is_multiline</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">scroll_y</span> <span class="o">=</span> <span class="n">is_multiline</span> <span class="o">?</span> <span class="n">draw_window</span><span class="o">-&gt;</span><span class="n">Scroll</span><span class="p">.</span><span class="nl">y</span> <span class="p">:</span> <span class="n">FLT_MAX</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">bool</span> <span class="n">init_changed_specs</span> <span class="o">=</span> <span class="p">(</span><span class="n">state</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">single_line</span> <span class="o">!=</span> <span class="o">!</span><span class="n">is_multiline</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">init_make_active</span> <span class="o">=</span> <span class="p">(</span><span class="n">focus_requested</span> <span class="o">||</span> <span class="n">user_clicked</span> <span class="o">||</span> <span class="n">user_scroll_finish</span> <span class="o">||</span> <span class="n">user_nav_input_start</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">init_state</span> <span class="o">=</span> <span class="p">(</span><span class="n">init_make_active</span> <span class="o">||</span> <span class="n">user_scroll_active</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">init_state</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">!=</span> <span class="n">id</span><span class="p">)</span> <span class="o">||</span> <span class="n">init_changed_specs</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Access state even if we don&#39;t own it yet.</span>
        <span class="n">state</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">.</span><span class="n">InputTextState</span><span class="p">;</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorAnimReset</span><span class="p">();</span>

        <span class="c1">// Take a copy of the initial buffer value (both in original UTF-8 format and converted to wchar)</span>
        <span class="c1">// From the moment we focused we are ignoring the content of &#39;buf&#39; (unless we are in read-only mode)</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">buf_len</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">InitialTextA</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">buf_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>    <span class="c1">// UTF-8. we use +1 to make sure that .Data is always pointing to at least an empty string.</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">InitialTextA</span><span class="p">.</span><span class="n">Data</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">buf_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

        <span class="c1">// Start edition</span>
        <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buf_end</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">buf_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>          <span class="c1">// wchar count &lt;= UTF-8 count. we use +1 to make sure that .Data is always pointing to at least an empty string.</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextA</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextAIsValid</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>                <span class="c1">// TextA is not valid yet (we will display buf until then)</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">CurLenW</span> <span class="o">=</span> <span class="n">ImTextStrFromUtf8</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Data</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf_end</span><span class="p">);</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">CurLenA</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">buf_end</span> <span class="o">-</span> <span class="n">buf</span><span class="p">);</span>      <span class="c1">// We can&#39;t get the result from ImStrncpy() above because it is not UTF-8 aware. Here we&#39;ll cut off malformed UTF-8.</span>

        <span class="c1">// Preserve cursor position and undo/redo stack if we come back to same widget</span>
        <span class="c1">// FIXME: For non-readonly widgets we might be able to require that TextAIsValid &amp;&amp; TextA == buf ? (untested) and discard undo stack if user buffer has changed.</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">recycle_state</span> <span class="o">=</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">ID</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">init_changed_specs</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">recycle_state</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Recycle existing cursor/selection/undo stack but clamp position</span>
            <span class="c1">// Note a single mouse click will override the cursor/position immediately by calling stb_textedit_click handler.</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorClamp</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">ID</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">ScrollX</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
            <span class="n">stb_textedit_initialize_state</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">,</span> <span class="o">!</span><span class="n">is_multiline</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_multiline</span> <span class="o">&amp;&amp;</span> <span class="n">focus_requested_by_code</span><span class="p">)</span>
                <span class="n">select_all</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_AlwaysInsertMode</span><span class="p">)</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">insert_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_multiline</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">focus_requested_by_tab</span> <span class="o">||</span> <span class="p">(</span><span class="n">user_clicked</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">KeyCtrl</span><span class="p">)))</span>
            <span class="n">select_all</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">!=</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="n">init_make_active</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">state</span> <span class="o">&amp;&amp;</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">ID</span> <span class="o">==</span> <span class="n">id</span><span class="p">);</span>
        <span class="n">SetActiveID</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">window</span><span class="p">);</span>
        <span class="n">SetFocusID</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">window</span><span class="p">);</span>
        <span class="n">FocusWindow</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>

        <span class="c1">// Declare our inputs</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">ImGuiNavInput_COUNT</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">);</span>
        <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdUsingNavDirMask</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiDir_Left</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiDir_Right</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">is_multiline</span> <span class="o">||</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CallbackHistory</span><span class="p">))</span>
            <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdUsingNavDirMask</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiDir_Up</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiDir_Down</span><span class="p">);</span>
        <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdUsingNavInputMask</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiNavInput_Cancel</span><span class="p">);</span>
        <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdUsingKeyInputMask</span> <span class="o">|=</span> <span class="p">((</span><span class="n">ImU64</span><span class="p">)</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiKey_Home</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">ImU64</span><span class="p">)</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiKey_End</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">is_multiline</span><span class="p">)</span>
            <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdUsingKeyInputMask</span> <span class="o">|=</span> <span class="p">((</span><span class="n">ImU64</span><span class="p">)</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiKey_PageUp</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">ImU64</span><span class="p">)</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiKey_PageDown</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiInputTextFlags_CallbackCompletion</span> <span class="o">|</span> <span class="n">ImGuiInputTextFlags_AllowTabInput</span><span class="p">))</span>  <span class="c1">// Disable keyboard tabbing out as we will use the \t character.</span>
            <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdUsingKeyInputMask</span> <span class="o">|=</span> <span class="p">((</span><span class="n">ImU64</span><span class="p">)</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ImGuiKey_Tab</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// We have an edge case if ActiveId was set through another widget (e.g. widget being swapped), clear id immediately (don&#39;t wait until the end of the function)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="n">state</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="n">ClearActiveID</span><span class="p">();</span>

    <span class="c1">// Release focus when we click outside</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseClicked</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">init_state</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">init_make_active</span><span class="p">)</span> <span class="c1">//-V560</span>
        <span class="n">clear_active_id</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

    <span class="c1">// Lock the decision of whether we are going to take the path displaying the cursor or selection</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">render_cursor</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">state</span> <span class="o">&amp;&amp;</span> <span class="n">user_scroll_active</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">render_selection</span> <span class="o">=</span> <span class="n">state</span> <span class="o">&amp;&amp;</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">HasSelection</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">RENDER_SELECTION_WHEN_INACTIVE</span> <span class="o">||</span> <span class="n">render_cursor</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">enter_pressed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// When read-only we always use the live data passed to the function</span>
    <span class="c1">// FIXME-OPT: Because our selection/cursor code currently needs the wide text we need to convert it when active, which is not ideal :(</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_readonly</span> <span class="o">&amp;&amp;</span> <span class="n">state</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">render_cursor</span> <span class="o">||</span> <span class="n">render_selection</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buf_end</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">buf_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">CurLenW</span> <span class="o">=</span> <span class="n">ImTextStrFromUtf8</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Data</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Size</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf_end</span><span class="p">);</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">CurLenA</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">buf_end</span> <span class="o">-</span> <span class="n">buf</span><span class="p">);</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorClamp</span><span class="p">();</span>
        <span class="n">render_selection</span> <span class="o">&amp;=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">HasSelection</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Select the buffer to render.</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">buf_display_from_state</span> <span class="o">=</span> <span class="p">(</span><span class="n">render_cursor</span> <span class="o">||</span> <span class="n">render_selection</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_readonly</span> <span class="o">&amp;&amp;</span> <span class="n">state</span> <span class="o">&amp;&amp;</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextAIsValid</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_displaying_hint</span> <span class="o">=</span> <span class="p">(</span><span class="n">hint</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">buf_display_from_state</span> <span class="o">?</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextA</span><span class="p">.</span><span class="nl">Data</span> <span class="p">:</span> <span class="n">buf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>

    <span class="c1">// Password pushes a temporary font with only a fallback glyph</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_password</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_displaying_hint</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="n">ImFontGlyph</span><span class="o">*</span> <span class="n">glyph</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Font</span><span class="o">-&gt;</span><span class="n">FindGlyph</span><span class="p">(</span><span class="sc">&#39;*&#39;</span><span class="p">);</span>
        <span class="n">ImFont</span><span class="o">*</span> <span class="n">password_font</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">.</span><span class="n">InputTextPasswordFont</span><span class="p">;</span>
        <span class="n">password_font</span><span class="o">-&gt;</span><span class="n">FontSize</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Font</span><span class="o">-&gt;</span><span class="n">FontSize</span><span class="p">;</span>
        <span class="n">password_font</span><span class="o">-&gt;</span><span class="n">Scale</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Font</span><span class="o">-&gt;</span><span class="n">Scale</span><span class="p">;</span>
        <span class="n">password_font</span><span class="o">-&gt;</span><span class="n">Ascent</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Font</span><span class="o">-&gt;</span><span class="n">Ascent</span><span class="p">;</span>
        <span class="n">password_font</span><span class="o">-&gt;</span><span class="n">Descent</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Font</span><span class="o">-&gt;</span><span class="n">Descent</span><span class="p">;</span>
        <span class="n">password_font</span><span class="o">-&gt;</span><span class="n">ContainerAtlas</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Font</span><span class="o">-&gt;</span><span class="n">ContainerAtlas</span><span class="p">;</span>
        <span class="n">password_font</span><span class="o">-&gt;</span><span class="n">FallbackGlyph</span> <span class="o">=</span> <span class="n">glyph</span><span class="p">;</span>
        <span class="n">password_font</span><span class="o">-&gt;</span><span class="n">FallbackAdvanceX</span> <span class="o">=</span> <span class="n">glyph</span><span class="o">-&gt;</span><span class="n">AdvanceX</span><span class="p">;</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">password_font</span><span class="o">-&gt;</span><span class="n">Glyphs</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">password_font</span><span class="o">-&gt;</span><span class="n">IndexAdvanceX</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">password_font</span><span class="o">-&gt;</span><span class="n">IndexLookup</span><span class="p">.</span><span class="n">empty</span><span class="p">());</span>
        <span class="n">PushFont</span><span class="p">(</span><span class="n">password_font</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Process mouse inputs and character inputs</span>
    <span class="kt">int</span> <span class="n">backup_current_text_length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">state</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
        <span class="n">backup_current_text_length</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">CurLenA</span><span class="p">;</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">Edited</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">BufCapacityA</span> <span class="o">=</span> <span class="n">buf_size</span><span class="p">;</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">UserFlags</span> <span class="o">=</span> <span class="n">flags</span><span class="p">;</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">UserCallback</span> <span class="o">=</span> <span class="n">callback</span><span class="p">;</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">UserCallbackData</span> <span class="o">=</span> <span class="n">callback_user_data</span><span class="p">;</span>

        <span class="c1">// Although we are active we don&#39;t prevent mouse from hovering other elements unless we are interacting right now with the widget.</span>
        <span class="c1">// Down the line we should have a cleaner library-wide concept of Selected vs Active.</span>
        <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdAllowOverlap</span> <span class="o">=</span> <span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">g</span><span class="p">.</span><span class="n">WantTextInputNextFrame</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="c1">// Edit in progress</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">mouse_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">ScrollX</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">mouse_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">is_multiline</span> <span class="o">?</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">draw_window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">));</span>

        <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_osx</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">ConfigMacOSXBehaviors</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">select_all</span> <span class="o">||</span> <span class="p">(</span><span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_osx</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseDoubleClicked</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="p">{</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">SelectAll</span><span class="p">();</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">SelectedAllMouseLock</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="n">is_osx</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseDoubleClicked</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="p">{</span>
            <span class="c1">// Double-click select a word only, OS X style (by simulating keystrokes)</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">(</span><span class="n">STB_TEXTEDIT_K_WORDLEFT</span><span class="p">);</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">(</span><span class="n">STB_TEXTEDIT_K_WORDRIGHT</span> <span class="o">|</span> <span class="n">STB_TEXTEDIT_K_SHIFT</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MouseClicked</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">SelectedAllMouseLock</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">hovered</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">stb_textedit_click</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">,</span> <span class="n">mouse_x</span><span class="p">,</span> <span class="n">mouse_y</span><span class="p">);</span>
                <span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorAnimReset</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">SelectedAllMouseLock</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">x</span> <span class="o">!=</span> <span class="mf">0.0f</span> <span class="o">||</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">y</span> <span class="o">!=</span> <span class="mf">0.0f</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">stb_textedit_drag</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">,</span> <span class="n">mouse_x</span><span class="p">,</span> <span class="n">mouse_y</span><span class="p">);</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorAnimReset</span><span class="p">();</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorFollow</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">SelectedAllMouseLock</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">SelectedAllMouseLock</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

        <span class="c1">// It is ill-defined whether the backend needs to send a \t character when pressing the TAB keys.</span>
        <span class="c1">// Win32 and GLFW naturally do it but not SDL.</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">ignore_char_inputs</span> <span class="o">=</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">KeyCtrl</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">KeyAlt</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">is_osx</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">KeySuper</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_AllowTabInput</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_Tab</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">ignore_char_inputs</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">KeyShift</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_readonly</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">InputQueueCharacters</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="sc">&#39;\t&#39;</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;\t&#39;</span><span class="p">;</span> <span class="c1">// Insert TAB</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">InputTextFilterCharacter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">callback_user_data</span><span class="p">))</span>
                    <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">c</span><span class="p">);</span>
            <span class="p">}</span>

        <span class="c1">// Process regular text input (before we check for Return because using some IME will effectively send a Return?)</span>
        <span class="c1">// We ignore CTRL inputs, but need to allow ALT+CTRL as some keyboards (e.g. German) use AltGR (which _is_ Alt+Ctrl) to input certain characters.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">InputQueueCharacters</span><span class="p">.</span><span class="n">Size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ignore_char_inputs</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_readonly</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">user_nav_input_start</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">io</span><span class="p">.</span><span class="n">InputQueueCharacters</span><span class="p">.</span><span class="n">Size</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// Insert character if they pass filtering</span>
                    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">io</span><span class="p">.</span><span class="n">InputQueueCharacters</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\t&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">KeyShift</span><span class="p">)</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">InputTextFilterCharacter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">callback_user_data</span><span class="p">))</span>
                        <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">c</span><span class="p">);</span>
                <span class="p">}</span>

            <span class="c1">// Consume characters</span>
            <span class="n">io</span><span class="p">.</span><span class="n">InputQueueCharacters</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Process other shortcuts/key-presses</span>
    <span class="kt">bool</span> <span class="n">cancel_edit</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdIsJustActivated</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">clear_active_id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">state</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
        <span class="c1">// Commented out as a hack to make imgui work multi-threaded. (Glyn)</span>
        <span class="c1">// IM_ASSERT(io.KeyMods == GetMergedKeyModFlags() &amp;&amp; &quot;Mismatching io.KeyCtrl/io.KeyShift/io.KeyAlt/io.KeySuper vs io.KeyMods&quot;); // We rarely do this check, but if anything let&#39;s do it here.</span>

        <span class="k">const</span> <span class="kt">int</span> <span class="n">row_count_per_page</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">((</span><span class="kt">int</span><span class="p">)((</span><span class="n">inner_size</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">row_count_per_page</span> <span class="o">=</span> <span class="n">row_count_per_page</span><span class="p">;</span>

        <span class="k">const</span> <span class="kt">int</span> <span class="n">k_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">KeyShift</span> <span class="o">?</span> <span class="nl">STB_TEXTEDIT_K_SHIFT</span> <span class="p">:</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_osx</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">ConfigMacOSXBehaviors</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_osx_shift_shortcut</span> <span class="o">=</span> <span class="n">is_osx</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">KeyMods</span> <span class="o">==</span> <span class="p">(</span><span class="n">ImGuiKeyModFlags_Super</span> <span class="o">|</span> <span class="n">ImGuiKeyModFlags_Shift</span><span class="p">));</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_wordmove_key_down</span> <span class="o">=</span> <span class="n">is_osx</span> <span class="o">?</span> <span class="n">io</span><span class="p">.</span><span class="nl">KeyAlt</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="n">KeyCtrl</span><span class="p">;</span>                     <span class="c1">// OS X style: Text editing cursor movement using Alt instead of Ctrl</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_startend_key_down</span> <span class="o">=</span> <span class="n">is_osx</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">KeySuper</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">KeyCtrl</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">KeyAlt</span><span class="p">;</span>  <span class="c1">// OS X style: Line/Text Start and End using Cmd+Arrows instead of Home/End</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_ctrl_key_only</span> <span class="o">=</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">KeyMods</span> <span class="o">==</span> <span class="n">ImGuiKeyModFlags_Ctrl</span><span class="p">);</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_shift_key_only</span> <span class="o">=</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">KeyMods</span> <span class="o">==</span> <span class="n">ImGuiKeyModFlags_Shift</span><span class="p">);</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_shortcut_key</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">ConfigMacOSXBehaviors</span> <span class="o">?</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">KeyMods</span> <span class="o">==</span> <span class="n">ImGuiKeyModFlags_Super</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">KeyMods</span> <span class="o">==</span> <span class="n">ImGuiKeyModFlags_Ctrl</span><span class="p">);</span>

        <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_cut</span>   <span class="o">=</span> <span class="p">((</span><span class="n">is_shortcut_key</span> <span class="o">&amp;&amp;</span> <span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_X</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="n">is_shift_key_only</span> <span class="o">&amp;&amp;</span> <span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_Delete</span><span class="p">)))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_readonly</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_password</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">is_multiline</span> <span class="o">||</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">HasSelection</span><span class="p">());</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_copy</span>  <span class="o">=</span> <span class="p">((</span><span class="n">is_shortcut_key</span> <span class="o">&amp;&amp;</span> <span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_C</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="n">is_ctrl_key_only</span>  <span class="o">&amp;&amp;</span> <span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_Insert</span><span class="p">)))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_password</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">is_multiline</span> <span class="o">||</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">HasSelection</span><span class="p">());</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_paste</span> <span class="o">=</span> <span class="p">((</span><span class="n">is_shortcut_key</span> <span class="o">&amp;&amp;</span> <span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_V</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="n">is_shift_key_only</span> <span class="o">&amp;&amp;</span> <span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_Insert</span><span class="p">)))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_readonly</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_undo</span>  <span class="o">=</span> <span class="p">((</span><span class="n">is_shortcut_key</span> <span class="o">&amp;&amp;</span> <span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_Z</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_readonly</span> <span class="o">&amp;&amp;</span> <span class="n">is_undoable</span><span class="p">);</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_redo</span>  <span class="o">=</span> <span class="p">((</span><span class="n">is_shortcut_key</span> <span class="o">&amp;&amp;</span> <span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_Y</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="n">is_osx_shift_shortcut</span> <span class="o">&amp;&amp;</span> <span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_Z</span><span class="p">)))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_readonly</span> <span class="o">&amp;&amp;</span> <span class="n">is_undoable</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_LeftArrow</span><span class="p">))</span>                        <span class="p">{</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">((</span><span class="n">is_startend_key_down</span> <span class="o">?</span> <span class="nl">STB_TEXTEDIT_K_LINESTART</span> <span class="p">:</span> <span class="n">is_wordmove_key_down</span> <span class="o">?</span> <span class="nl">STB_TEXTEDIT_K_WORDLEFT</span> <span class="p">:</span> <span class="n">STB_TEXTEDIT_K_LEFT</span><span class="p">)</span> <span class="o">|</span> <span class="n">k_mask</span><span class="p">);</span> <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_RightArrow</span><span class="p">))</span>                  <span class="p">{</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">((</span><span class="n">is_startend_key_down</span> <span class="o">?</span> <span class="nl">STB_TEXTEDIT_K_LINEEND</span> <span class="p">:</span> <span class="n">is_wordmove_key_down</span> <span class="o">?</span> <span class="nl">STB_TEXTEDIT_K_WORDRIGHT</span> <span class="p">:</span> <span class="n">STB_TEXTEDIT_K_RIGHT</span><span class="p">)</span> <span class="o">|</span> <span class="n">k_mask</span><span class="p">);</span> <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_UpArrow</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">is_multiline</span><span class="p">)</span>     <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">KeyCtrl</span><span class="p">)</span> <span class="n">SetScrollY</span><span class="p">(</span><span class="n">draw_window</span><span class="p">,</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">draw_window</span><span class="o">-&gt;</span><span class="n">Scroll</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span> <span class="k">else</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">((</span><span class="n">is_startend_key_down</span> <span class="o">?</span> <span class="nl">STB_TEXTEDIT_K_TEXTSTART</span> <span class="p">:</span> <span class="n">STB_TEXTEDIT_K_UP</span><span class="p">)</span> <span class="o">|</span> <span class="n">k_mask</span><span class="p">);</span> <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_DownArrow</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">is_multiline</span><span class="p">)</span>   <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">KeyCtrl</span><span class="p">)</span> <span class="n">SetScrollY</span><span class="p">(</span><span class="n">draw_window</span><span class="p">,</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">draw_window</span><span class="o">-&gt;</span><span class="n">Scroll</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">,</span> <span class="n">GetScrollMaxY</span><span class="p">()));</span> <span class="k">else</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">((</span><span class="n">is_startend_key_down</span> <span class="o">?</span> <span class="nl">STB_TEXTEDIT_K_TEXTEND</span> <span class="p">:</span> <span class="n">STB_TEXTEDIT_K_DOWN</span><span class="p">)</span> <span class="o">|</span> <span class="n">k_mask</span><span class="p">);</span> <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_PageUp</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">is_multiline</span><span class="p">)</span>      <span class="p">{</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">(</span><span class="n">STB_TEXTEDIT_K_PGUP</span> <span class="o">|</span> <span class="n">k_mask</span><span class="p">);</span> <span class="n">scroll_y</span> <span class="o">-=</span> <span class="n">row_count_per_page</span> <span class="o">*</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_PageDown</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">is_multiline</span><span class="p">)</span>    <span class="p">{</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">(</span><span class="n">STB_TEXTEDIT_K_PGDOWN</span> <span class="o">|</span> <span class="n">k_mask</span><span class="p">);</span> <span class="n">scroll_y</span> <span class="o">+=</span> <span class="n">row_count_per_page</span> <span class="o">*</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_Home</span><span class="p">))</span>                        <span class="p">{</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">KeyCtrl</span> <span class="o">?</span> <span class="n">STB_TEXTEDIT_K_TEXTSTART</span> <span class="o">|</span> <span class="nl">k_mask</span> <span class="p">:</span> <span class="n">STB_TEXTEDIT_K_LINESTART</span> <span class="o">|</span> <span class="n">k_mask</span><span class="p">);</span> <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_End</span><span class="p">))</span>                         <span class="p">{</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">KeyCtrl</span> <span class="o">?</span> <span class="n">STB_TEXTEDIT_K_TEXTEND</span> <span class="o">|</span> <span class="nl">k_mask</span> <span class="p">:</span> <span class="n">STB_TEXTEDIT_K_LINEEND</span> <span class="o">|</span> <span class="n">k_mask</span><span class="p">);</span> <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_Delete</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_readonly</span><span class="p">)</span>      <span class="p">{</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">(</span><span class="n">STB_TEXTEDIT_K_DELETE</span> <span class="o">|</span> <span class="n">k_mask</span><span class="p">);</span> <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_Backspace</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_readonly</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">HasSelection</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">is_wordmove_key_down</span><span class="p">)</span>
                    <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">(</span><span class="n">STB_TEXTEDIT_K_WORDLEFT</span> <span class="o">|</span> <span class="n">STB_TEXTEDIT_K_SHIFT</span><span class="p">);</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">is_osx</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">KeySuper</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">KeyAlt</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">KeyCtrl</span><span class="p">)</span>
                    <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">(</span><span class="n">STB_TEXTEDIT_K_LINESTART</span> <span class="o">|</span> <span class="n">STB_TEXTEDIT_K_SHIFT</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">(</span><span class="n">STB_TEXTEDIT_K_BACKSPACE</span> <span class="o">|</span> <span class="n">k_mask</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_Enter</span><span class="p">)</span> <span class="o">||</span> <span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_KeyPadEnter</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">ctrl_enter_for_new_line</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CtrlEnterForNewLine</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_multiline</span> <span class="o">||</span> <span class="p">(</span><span class="n">ctrl_enter_for_new_line</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">KeyCtrl</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="n">ctrl_enter_for_new_line</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">KeyCtrl</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">enter_pressed</span> <span class="o">=</span> <span class="n">clear_active_id</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_readonly</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="c1">// Insert new line</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">InputTextFilterCharacter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">callback_user_data</span><span class="p">))</span>
                    <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">c</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_Escape</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">clear_active_id</span> <span class="o">=</span> <span class="n">cancel_edit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">is_undo</span> <span class="o">||</span> <span class="n">is_redo</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">OnKeyPressed</span><span class="p">(</span><span class="n">is_undo</span> <span class="o">?</span> <span class="nl">STB_TEXTEDIT_K_UNDO</span> <span class="p">:</span> <span class="n">STB_TEXTEDIT_K_REDO</span><span class="p">);</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">ClearSelection</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">is_shortcut_key</span> <span class="o">&amp;&amp;</span> <span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_A</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">SelectAll</span><span class="p">();</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorFollow</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">is_cut</span> <span class="o">||</span> <span class="n">is_copy</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Cut, Copy</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">SetClipboardTextFn</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">const</span> <span class="kt">int</span> <span class="n">ib</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">HasSelection</span><span class="p">()</span> <span class="o">?</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">select_start</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">select_end</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
                <span class="k">const</span> <span class="kt">int</span> <span class="n">ie</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">HasSelection</span><span class="p">()</span> <span class="o">?</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">select_start</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">select_end</span><span class="p">)</span> <span class="o">:</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">CurLenW</span><span class="p">;</span>
                <span class="k">const</span> <span class="kt">int</span> <span class="n">clipboard_data_len</span> <span class="o">=</span> <span class="n">ImTextCountUtf8BytesFromStr</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Data</span> <span class="o">+</span> <span class="n">ib</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Data</span> <span class="o">+</span> <span class="n">ie</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                <span class="kt">char</span><span class="o">*</span> <span class="n">clipboard_data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">IM_ALLOC</span><span class="p">(</span><span class="n">clipboard_data_len</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
                <span class="n">ImTextStrToUtf8</span><span class="p">(</span><span class="n">clipboard_data</span><span class="p">,</span> <span class="n">clipboard_data_len</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Data</span> <span class="o">+</span> <span class="n">ib</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Data</span> <span class="o">+</span> <span class="n">ie</span><span class="p">);</span>
                <span class="n">SetClipboardText</span><span class="p">(</span><span class="n">clipboard_data</span><span class="p">);</span>
                <span class="n">MemFree</span><span class="p">(</span><span class="n">clipboard_data</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">is_cut</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">HasSelection</span><span class="p">())</span>
                    <span class="n">state</span><span class="o">-&gt;</span><span class="n">SelectAll</span><span class="p">();</span>
                <span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorFollow</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                <span class="n">stb_textedit_cut</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">is_paste</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">clipboard</span> <span class="o">=</span> <span class="n">GetClipboardText</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="c1">// Filter pasted buffer</span>
                <span class="k">const</span> <span class="kt">int</span> <span class="n">clipboard_len</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">strlen</span><span class="p">(</span><span class="n">clipboard</span><span class="p">);</span>
                <span class="n">ImWchar</span><span class="o">*</span> <span class="n">clipboard_filtered</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImWchar</span><span class="o">*</span><span class="p">)</span><span class="n">IM_ALLOC</span><span class="p">((</span><span class="n">clipboard_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ImWchar</span><span class="p">));</span>
                <span class="kt">int</span> <span class="n">clipboard_filtered_len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span> <span class="o">=</span> <span class="n">clipboard</span><span class="p">;</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span> <span class="p">)</span>
                <span class="p">{</span>
                    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">c</span><span class="p">;</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="n">ImTextCharFromUtf8</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">InputTextFilterCharacter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">callback_user_data</span><span class="p">))</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="n">clipboard_filtered</span><span class="p">[</span><span class="n">clipboard_filtered_len</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImWchar</span><span class="p">)</span><span class="n">c</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">clipboard_filtered</span><span class="p">[</span><span class="n">clipboard_filtered_len</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">clipboard_filtered_len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// If everything was filtered, ignore the pasting operation</span>
                <span class="p">{</span>
                    <span class="n">stb_textedit_paste</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">,</span> <span class="n">clipboard_filtered</span><span class="p">,</span> <span class="n">clipboard_filtered_len</span><span class="p">);</span>
                    <span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorFollow</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">MemFree</span><span class="p">(</span><span class="n">clipboard_filtered</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Update render selection flag after events have been handled, so selection highlight can be displayed during the same frame.</span>
        <span class="n">render_selection</span> <span class="o">|=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">HasSelection</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">RENDER_SELECTION_WHEN_INACTIVE</span> <span class="o">||</span> <span class="n">render_cursor</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Process callbacks and apply result back to user&#39;s buffer.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">state</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
        <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">apply_new_text</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">apply_new_text_length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cancel_edit</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Restore initial value. Only return true if restoring to the initial value changes the current buffer contents.</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_readonly</span> <span class="o">&amp;&amp;</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">InitialTextA</span><span class="p">.</span><span class="n">Data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// Push records into the undo stack so we can CTRL+Z the revert operation itself</span>
                <span class="n">apply_new_text</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">InitialTextA</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span>
                <span class="n">apply_new_text_length</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">InitialTextA</span><span class="p">.</span><span class="n">Size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">ImVector</span><span class="o">&lt;</span><span class="n">ImWchar</span><span class="o">&gt;</span> <span class="n">w_text</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">apply_new_text_length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">w_text</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">ImTextCountCharsFromUtf8</span><span class="p">(</span><span class="n">apply_new_text</span><span class="p">,</span> <span class="n">apply_new_text</span> <span class="o">+</span> <span class="n">apply_new_text_length</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                    <span class="n">ImTextStrFromUtf8</span><span class="p">(</span><span class="n">w_text</span><span class="p">.</span><span class="n">Data</span><span class="p">,</span> <span class="n">w_text</span><span class="p">.</span><span class="n">Size</span><span class="p">,</span> <span class="n">apply_new_text</span><span class="p">,</span> <span class="n">apply_new_text</span> <span class="o">+</span> <span class="n">apply_new_text_length</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="n">stb_textedit_replace</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">,</span> <span class="n">w_text</span><span class="p">.</span><span class="n">Data</span><span class="p">,</span> <span class="p">(</span><span class="n">apply_new_text_length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="n">w_text</span><span class="p">.</span><span class="n">Size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// When using &#39;ImGuiInputTextFlags_EnterReturnsTrue&#39; as a special case we reapply the live buffer back to the input buffer before clearing ActiveId, even though strictly speaking it wasn&#39;t modified on this frame.</span>
        <span class="c1">// If we didn&#39;t do that, code like InputInt() with ImGuiInputTextFlags_EnterReturnsTrue would fail.</span>
        <span class="c1">// This also allows the user to use InputText() with ImGuiInputTextFlags_EnterReturnsTrue without maintaining any user-side storage (please note that if you use this property along ImGuiInputTextFlags_CallbackResize you can end up with your temporary string object unnecessarily allocating once a frame, either store your string data, either if you don&#39;t then don&#39;t use ImGuiInputTextFlags_CallbackResize).</span>
        <span class="kt">bool</span> <span class="n">apply_edit_back_to_user_buffer</span> <span class="o">=</span> <span class="o">!</span><span class="n">cancel_edit</span> <span class="o">||</span> <span class="p">(</span><span class="n">enter_pressed</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_EnterReturnsTrue</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">apply_edit_back_to_user_buffer</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Apply new value immediately - copy modified buffer back</span>
            <span class="c1">// Note that as soon as the input box is active, the in-widget value gets priority over any underlying modification of the input buffer</span>
            <span class="c1">// FIXME: We actually always render &#39;buf&#39; when calling DrawList-&gt;AddText, making the comment above incorrect.</span>
            <span class="c1">// FIXME-OPT: CPU waste to do this every time the widget is active, should mark dirty state from the stb_textedit callbacks.</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_readonly</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextAIsValid</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextA</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Size</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">ImTextStrToUtf8</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">TextA</span><span class="p">.</span><span class="n">Data</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextA</span><span class="p">.</span><span class="n">Size</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Data</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// User callback</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiInputTextFlags_CallbackCompletion</span> <span class="o">|</span> <span class="n">ImGuiInputTextFlags_CallbackHistory</span> <span class="o">|</span> <span class="n">ImGuiInputTextFlags_CallbackEdit</span> <span class="o">|</span> <span class="n">ImGuiInputTextFlags_CallbackAlways</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">callback</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>

                <span class="c1">// The reason we specify the usage semantic (Completion/History) is that Completion needs to disable keyboard TABBING at the moment.</span>
                <span class="n">ImGuiInputTextFlags</span> <span class="n">event_flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="n">ImGuiKey</span> <span class="n">event_key</span> <span class="o">=</span> <span class="n">ImGuiKey_COUNT</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CallbackCompletion</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_Tab</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">event_flag</span> <span class="o">=</span> <span class="n">ImGuiInputTextFlags_CallbackCompletion</span><span class="p">;</span>
                    <span class="n">event_key</span> <span class="o">=</span> <span class="n">ImGuiKey_Tab</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CallbackHistory</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_UpArrow</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">event_flag</span> <span class="o">=</span> <span class="n">ImGuiInputTextFlags_CallbackHistory</span><span class="p">;</span>
                    <span class="n">event_key</span> <span class="o">=</span> <span class="n">ImGuiKey_UpArrow</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CallbackHistory</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">IsKeyPressedMap</span><span class="p">(</span><span class="n">ImGuiKey_DownArrow</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">event_flag</span> <span class="o">=</span> <span class="n">ImGuiInputTextFlags_CallbackHistory</span><span class="p">;</span>
                    <span class="n">event_key</span> <span class="o">=</span> <span class="n">ImGuiKey_DownArrow</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CallbackEdit</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Edited</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">event_flag</span> <span class="o">=</span> <span class="n">ImGuiInputTextFlags_CallbackEdit</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_CallbackAlways</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">event_flag</span> <span class="o">=</span> <span class="n">ImGuiInputTextFlags_CallbackAlways</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">event_flag</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">ImGuiInputTextCallbackData</span> <span class="n">callback_data</span><span class="p">;</span>
                    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">callback_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ImGuiInputTextCallbackData</span><span class="p">));</span>
                    <span class="n">callback_data</span><span class="p">.</span><span class="n">EventFlag</span> <span class="o">=</span> <span class="n">event_flag</span><span class="p">;</span>
                    <span class="n">callback_data</span><span class="p">.</span><span class="n">Flags</span> <span class="o">=</span> <span class="n">flags</span><span class="p">;</span>
                    <span class="n">callback_data</span><span class="p">.</span><span class="n">UserData</span> <span class="o">=</span> <span class="n">callback_user_data</span><span class="p">;</span>

                    <span class="n">callback_data</span><span class="p">.</span><span class="n">EventKey</span> <span class="o">=</span> <span class="n">event_key</span><span class="p">;</span>
                    <span class="n">callback_data</span><span class="p">.</span><span class="n">Buf</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextA</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span>
                    <span class="n">callback_data</span><span class="p">.</span><span class="n">BufTextLen</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">CurLenA</span><span class="p">;</span>
                    <span class="n">callback_data</span><span class="p">.</span><span class="n">BufSize</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">BufCapacityA</span><span class="p">;</span>
                    <span class="n">callback_data</span><span class="p">.</span><span class="n">BufDirty</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

                    <span class="c1">// We have to convert from wchar-positions to UTF-8-positions, which can be pretty slow (an incentive to ditch the ImWchar buffer, see https://github.com/nothings/stb/issues/188)</span>
                    <span class="n">ImWchar</span><span class="o">*</span> <span class="n">text</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span>
                    <span class="k">const</span> <span class="kt">int</span> <span class="n">utf8_cursor_pos</span> <span class="o">=</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">ImTextCountUtf8BytesFromStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">text</span> <span class="o">+</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">cursor</span><span class="p">);</span>
                    <span class="k">const</span> <span class="kt">int</span> <span class="n">utf8_selection_start</span> <span class="o">=</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">SelectionStart</span> <span class="o">=</span> <span class="n">ImTextCountUtf8BytesFromStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">text</span> <span class="o">+</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">select_start</span><span class="p">);</span>
                    <span class="k">const</span> <span class="kt">int</span> <span class="n">utf8_selection_end</span> <span class="o">=</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">SelectionEnd</span> <span class="o">=</span> <span class="n">ImTextCountUtf8BytesFromStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">text</span> <span class="o">+</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">select_end</span><span class="p">);</span>

                    <span class="c1">// Call user code</span>
                    <span class="n">callback</span><span class="p">(</span><span class="o">&amp;</span><span class="n">callback_data</span><span class="p">);</span>

                    <span class="c1">// Read back what user may have modified</span>
                    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">Buf</span> <span class="o">==</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextA</span><span class="p">.</span><span class="n">Data</span><span class="p">);</span>  <span class="c1">// Invalid to modify those fields</span>
                    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">BufSize</span> <span class="o">==</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">BufCapacityA</span><span class="p">);</span>
                    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">Flags</span> <span class="o">==</span> <span class="n">flags</span><span class="p">);</span>
                    <span class="k">const</span> <span class="kt">bool</span> <span class="n">buf_dirty</span> <span class="o">=</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">BufDirty</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">!=</span> <span class="n">utf8_cursor_pos</span> <span class="o">||</span> <span class="n">buf_dirty</span><span class="p">)</span>            <span class="p">{</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="n">ImTextCountCharsFromUtf8</span><span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">Buf</span><span class="p">,</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">Buf</span> <span class="o">+</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">);</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorFollow</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">SelectionStart</span> <span class="o">!=</span> <span class="n">utf8_selection_start</span> <span class="o">||</span> <span class="n">buf_dirty</span><span class="p">)</span>  <span class="p">{</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">select_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">SelectionStart</span> <span class="o">==</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">)</span> <span class="o">?</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="nl">cursor</span> <span class="p">:</span> <span class="n">ImTextCountCharsFromUtf8</span><span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">Buf</span><span class="p">,</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">Buf</span> <span class="o">+</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">SelectionStart</span><span class="p">);</span> <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">SelectionEnd</span> <span class="o">!=</span> <span class="n">utf8_selection_end</span> <span class="o">||</span> <span class="n">buf_dirty</span><span class="p">)</span>      <span class="p">{</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">select_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">SelectionEnd</span> <span class="o">==</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">SelectionStart</span><span class="p">)</span> <span class="o">?</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="nl">select_start</span> <span class="p">:</span> <span class="n">ImTextCountCharsFromUtf8</span><span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">Buf</span><span class="p">,</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">Buf</span> <span class="o">+</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">SelectionEnd</span><span class="p">);</span> <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">buf_dirty</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">BufTextLen</span> <span class="o">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">strlen</span><span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">Buf</span><span class="p">));</span> <span class="c1">// You need to maintain BufTextLen if you change the text!</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">BufTextLen</span> <span class="o">&gt;</span> <span class="n">backup_current_text_length</span> <span class="o">&amp;&amp;</span> <span class="n">is_resizable</span><span class="p">)</span>
                            <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Size</span> <span class="o">+</span> <span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">BufTextLen</span> <span class="o">-</span> <span class="n">backup_current_text_length</span><span class="p">));</span>
                        <span class="n">state</span><span class="o">-&gt;</span><span class="n">CurLenW</span> <span class="o">=</span> <span class="n">ImTextStrFromUtf8</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Data</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Size</span><span class="p">,</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">Buf</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
                        <span class="n">state</span><span class="o">-&gt;</span><span class="n">CurLenA</span> <span class="o">=</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">BufTextLen</span><span class="p">;</span>  <span class="c1">// Assume correct length and valid UTF-8 from user, saves us an extra strlen()</span>
                        <span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorAnimReset</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// Will copy result string if modified</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_readonly</span> <span class="o">&amp;&amp;</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">TextA</span><span class="p">.</span><span class="n">Data</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">apply_new_text</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextA</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span>
                <span class="n">apply_new_text_length</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">CurLenA</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Copy result to user buffer</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">apply_new_text</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// We cannot test for &#39;backup_current_text_length != apply_new_text_length&#39; here because we have no guarantee that the size</span>
            <span class="c1">// of our owned buffer matches the size of the string object held by the user, and by design we allow InputText() to be used</span>
            <span class="c1">// without any storage on user&#39;s side.</span>
            <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">apply_new_text_length</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">is_resizable</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">ImGuiInputTextCallbackData</span> <span class="n">callback_data</span><span class="p">;</span>
                <span class="n">callback_data</span><span class="p">.</span><span class="n">EventFlag</span> <span class="o">=</span> <span class="n">ImGuiInputTextFlags_CallbackResize</span><span class="p">;</span>
                <span class="n">callback_data</span><span class="p">.</span><span class="n">Flags</span> <span class="o">=</span> <span class="n">flags</span><span class="p">;</span>
                <span class="n">callback_data</span><span class="p">.</span><span class="n">Buf</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
                <span class="n">callback_data</span><span class="p">.</span><span class="n">BufTextLen</span> <span class="o">=</span> <span class="n">apply_new_text_length</span><span class="p">;</span>
                <span class="n">callback_data</span><span class="p">.</span><span class="n">BufSize</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">buf_size</span><span class="p">,</span> <span class="n">apply_new_text_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">callback_data</span><span class="p">.</span><span class="n">UserData</span> <span class="o">=</span> <span class="n">callback_user_data</span><span class="p">;</span>
                <span class="n">callback</span><span class="p">(</span><span class="o">&amp;</span><span class="n">callback_data</span><span class="p">);</span>
                <span class="n">buf</span> <span class="o">=</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">Buf</span><span class="p">;</span>
                <span class="n">buf_size</span> <span class="o">=</span> <span class="n">callback_data</span><span class="p">.</span><span class="n">BufSize</span><span class="p">;</span>
                <span class="n">apply_new_text_length</span> <span class="o">=</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">callback_data</span><span class="p">.</span><span class="n">BufTextLen</span><span class="p">,</span> <span class="n">buf_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">apply_new_text_length</span> <span class="o">&lt;=</span> <span class="n">buf_size</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">//IMGUI_DEBUG_LOG(&quot;InputText(\&quot;%s\&quot;): apply_new_text length %d\n&quot;, label, apply_new_text_length);</span>

            <span class="c1">// If the underlying buffer resize was denied or not carried to the next frame, apply_new_text_length+1 may be &gt;= buf_size.</span>
            <span class="n">ImStrncpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">apply_new_text</span><span class="p">,</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">apply_new_text_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">));</span>
            <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Clear temporary user storage</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">UserFlags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">UserCallback</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">UserCallbackData</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Release active ID at the end of the function (so e.g. pressing Return still does a final application of the value)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">clear_active_id</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
        <span class="n">ClearActiveID</span><span class="p">();</span>

    <span class="c1">// Render frame</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_multiline</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">RenderNavHighlight</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
        <span class="n">RenderFrame</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_FrameBg</span><span class="p">),</span> <span class="nb">true</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="n">ImVec4</span> <span class="n">clip_rect</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">inner_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">inner_size</span><span class="p">.</span><span class="n">y</span><span class="p">);</span> <span class="c1">// Not using frame_bb.Max because we have adjusted size</span>
    <span class="n">ImVec2</span> <span class="n">draw_pos</span> <span class="o">=</span> <span class="n">is_multiline</span> <span class="o">?</span> <span class="n">draw_window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="nl">CursorPos</span> <span class="p">:</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">;</span>
    <span class="n">ImVec2</span> <span class="nf">text_size</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>

    <span class="c1">// Set upper limit of single-line InputTextEx() at 2 million characters strings. The current pathological worst case is a long line</span>
    <span class="c1">// without any carriage return, which would makes ImFont::RenderText() reserve too many vertices and probably crash. Avoid it altogether.</span>
    <span class="c1">// Note that we only use this limit on single-line InputText(), so a pathologically large line on a InputTextMultiline() would still crash.</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">buf_display_max_length</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buf_display</span> <span class="o">=</span> <span class="n">buf_display_from_state</span> <span class="o">?</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextA</span><span class="p">.</span><span class="nl">Data</span> <span class="p">:</span> <span class="n">buf</span><span class="p">;</span> <span class="c1">//-V595</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buf_display_end</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="c1">// We have specialized paths below for setting the length</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_displaying_hint</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">buf_display</span> <span class="o">=</span> <span class="n">hint</span><span class="p">;</span>
        <span class="n">buf_display_end</span> <span class="o">=</span> <span class="n">hint</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">hint</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Render text. We currently only render selection when the widget is active or while scrolling.</span>
    <span class="c1">// FIXME: We could remove the &#39;&amp;&amp; render_cursor&#39; to keep rendering selection when inactive.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">render_cursor</span> <span class="o">||</span> <span class="n">render_selection</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">state</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_displaying_hint</span><span class="p">)</span>
            <span class="n">buf_display_end</span> <span class="o">=</span> <span class="n">buf_display</span> <span class="o">+</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">CurLenA</span><span class="p">;</span>

        <span class="c1">// Render text (with cursor and selection)</span>
        <span class="c1">// This is going to be messy. We need to:</span>
        <span class="c1">// - Display the text (this alone can be more easily clipped)</span>
        <span class="c1">// - Handle scrolling, highlight selection, display cursor (those all requires some form of 1d-&gt;2d cursor position calculation)</span>
        <span class="c1">// - Measure text height (for scrollbar)</span>
        <span class="c1">// We are attempting to do most of that in **one main pass** to minimize the computation cost (non-negligible for large amount of text) + 2nd pass for selection rendering (we could merge them by an extra refactoring effort)</span>
        <span class="c1">// FIXME: This should occur on buf_display but we&#39;d need to maintain cursor/select_start/select_end for UTF-8.</span>
        <span class="k">const</span> <span class="n">ImWchar</span><span class="o">*</span> <span class="n">text_begin</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">TextW</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span>
        <span class="n">ImVec2</span> <span class="n">cursor_offset</span><span class="p">,</span> <span class="n">select_start_offset</span><span class="p">;</span>

        <span class="p">{</span>
            <span class="c1">// Find lines numbers straddling &#39;cursor&#39; (slot 0) and &#39;select_start&#39; (slot 1) positions.</span>
            <span class="k">const</span> <span class="n">ImWchar</span><span class="o">*</span> <span class="n">searches_input_ptr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>
            <span class="kt">int</span> <span class="n">searches_result_line_no</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">-1000</span><span class="p">,</span> <span class="mi">-1000</span> <span class="p">};</span>
            <span class="kt">int</span> <span class="n">searches_remaining</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">render_cursor</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">searches_input_ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">text_begin</span> <span class="o">+</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">cursor</span><span class="p">;</span>
                <span class="n">searches_result_line_no</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
                <span class="n">searches_remaining</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">render_selection</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">searches_input_ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">text_begin</span> <span class="o">+</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">select_start</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">select_end</span><span class="p">);</span>
                <span class="n">searches_result_line_no</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
                <span class="n">searches_remaining</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// Iterate all lines to find our line numbers</span>
            <span class="c1">// In multi-line mode, we never exit the loop until all lines are counted, so add one extra to the searches_remaining counter.</span>
            <span class="n">searches_remaining</span> <span class="o">+=</span> <span class="n">is_multiline</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">line_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="c1">//for (const ImWchar* s = text_begin; (s = (const ImWchar*)wcschr((const wchar_t*)s, (wchar_t)&#39;\n&#39;)) != NULL; s++)  // FIXME-OPT: Could use this when wchar_t are 16-bit</span>
            <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImWchar</span><span class="o">*</span> <span class="n">s</span> <span class="o">=</span> <span class="n">text_begin</span><span class="p">;</span> <span class="o">*</span><span class="n">s</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">s</span><span class="o">++</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">s</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">line_count</span><span class="o">++</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">searches_result_line_no</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">-1</span> <span class="o">&amp;&amp;</span> <span class="n">s</span> <span class="o">&gt;=</span> <span class="n">searches_input_ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span> <span class="n">searches_result_line_no</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_count</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">searches_remaining</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span> <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">searches_result_line_no</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">-1</span> <span class="o">&amp;&amp;</span> <span class="n">s</span> <span class="o">&gt;=</span> <span class="n">searches_input_ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span> <span class="n">searches_result_line_no</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_count</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">searches_remaining</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span> <span class="p">}</span>
                <span class="p">}</span>
            <span class="n">line_count</span><span class="o">++</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">searches_result_line_no</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span>
                <span class="n">searches_result_line_no</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_count</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">searches_result_line_no</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span>
                <span class="n">searches_result_line_no</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_count</span><span class="p">;</span>

            <span class="c1">// Calculate 2d position by finding the beginning of the line and measuring distance</span>
            <span class="n">cursor_offset</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">InputTextCalcTextSizeW</span><span class="p">(</span><span class="n">ImStrbolW</span><span class="p">(</span><span class="n">searches_input_ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">text_begin</span><span class="p">),</span> <span class="n">searches_input_ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="n">x</span><span class="p">;</span>
            <span class="n">cursor_offset</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">searches_result_line_no</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">searches_result_line_no</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">select_start_offset</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">InputTextCalcTextSizeW</span><span class="p">(</span><span class="n">ImStrbolW</span><span class="p">(</span><span class="n">searches_input_ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">text_begin</span><span class="p">),</span> <span class="n">searches_input_ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">]).</span><span class="n">x</span><span class="p">;</span>
                <span class="n">select_start_offset</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">searches_result_line_no</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// Store text height (note that we haven&#39;t calculated text width at all, see GitHub issues #383, #1224)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">is_multiline</span><span class="p">)</span>
                <span class="n">text_size</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">inner_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">line_count</span> <span class="o">*</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Scroll</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">render_cursor</span> <span class="o">&amp;&amp;</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorFollow</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Horizontal scroll in chunks of quarter width</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_NoHorizontalScroll</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">const</span> <span class="kt">float</span> <span class="n">scroll_increment_x</span> <span class="o">=</span> <span class="n">inner_size</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.25f</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">cursor_offset</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">ScrollX</span><span class="p">)</span>
                    <span class="n">state</span><span class="o">-&gt;</span><span class="n">ScrollX</span> <span class="o">=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">ImMax</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="n">cursor_offset</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">scroll_increment_x</span><span class="p">));</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cursor_offset</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">inner_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">ScrollX</span><span class="p">)</span>
                    <span class="n">state</span><span class="o">-&gt;</span><span class="n">ScrollX</span> <span class="o">=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">cursor_offset</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">inner_size</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">scroll_increment_x</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">state</span><span class="o">-&gt;</span><span class="n">ScrollX</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// Vertical scroll</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">is_multiline</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// Test if cursor is vertically visible</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">cursor_offset</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">&lt;</span> <span class="n">scroll_y</span><span class="p">)</span>
                    <span class="n">scroll_y</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="n">cursor_offset</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">);</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cursor_offset</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">inner_size</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">scroll_y</span><span class="p">)</span>
                    <span class="n">scroll_y</span> <span class="o">=</span> <span class="n">cursor_offset</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">inner_size</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">;</span>
                <span class="k">const</span> <span class="kt">float</span> <span class="n">scroll_max_y</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">((</span><span class="n">text_size</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">)</span> <span class="o">-</span> <span class="n">inner_size</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
                <span class="n">scroll_y</span> <span class="o">=</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">scroll_y</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="n">scroll_max_y</span><span class="p">);</span>
                <span class="n">draw_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="p">(</span><span class="n">draw_window</span><span class="o">-&gt;</span><span class="n">Scroll</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">scroll_y</span><span class="p">);</span>   <span class="c1">// Manipulate cursor pos immediately avoid a frame of lag</span>
                <span class="n">draw_window</span><span class="o">-&gt;</span><span class="n">Scroll</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">scroll_y</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorFollow</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Draw selection</span>
        <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">draw_scroll</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">ScrollX</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">render_selection</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="n">ImWchar</span><span class="o">*</span> <span class="n">text_selected_begin</span> <span class="o">=</span> <span class="n">text_begin</span> <span class="o">+</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">select_start</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">select_end</span><span class="p">);</span>
            <span class="k">const</span> <span class="n">ImWchar</span><span class="o">*</span> <span class="n">text_selected_end</span> <span class="o">=</span> <span class="n">text_begin</span> <span class="o">+</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">select_start</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">Stb</span><span class="p">.</span><span class="n">select_end</span><span class="p">);</span>

            <span class="n">ImU32</span> <span class="n">bg_color</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_TextSelectedBg</span><span class="p">,</span> <span class="n">render_cursor</span> <span class="o">?</span> <span class="mf">1.0f</span> <span class="o">:</span> <span class="mf">0.6f</span><span class="p">);</span> <span class="c1">// FIXME: current code flow mandate that render_cursor is always true here, we are leaving the transparent one for tests.</span>
            <span class="kt">float</span> <span class="n">bg_offy_up</span> <span class="o">=</span> <span class="n">is_multiline</span> <span class="o">?</span> <span class="mf">0.0f</span> <span class="o">:</span> <span class="mf">-1.0f</span><span class="p">;</span>    <span class="c1">// FIXME: those offsets should be part of the style? they don&#39;t play so well with multi-line selection.</span>
            <span class="kt">float</span> <span class="n">bg_offy_dn</span> <span class="o">=</span> <span class="n">is_multiline</span> <span class="o">?</span> <span class="mf">0.0f</span> <span class="o">:</span> <span class="mf">2.0f</span><span class="p">;</span>
            <span class="n">ImVec2</span> <span class="n">rect_pos</span> <span class="o">=</span> <span class="n">draw_pos</span> <span class="o">+</span> <span class="n">select_start_offset</span> <span class="o">-</span> <span class="n">draw_scroll</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImWchar</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">text_selected_begin</span><span class="p">;</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">text_selected_end</span><span class="p">;</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">rect_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">clip_rect</span><span class="p">.</span><span class="n">w</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">)</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">rect_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">clip_rect</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">//p = (const ImWchar*)wmemchr((const wchar_t*)p, &#39;\n&#39;, text_selected_end - p);  // FIXME-OPT: Could use this when wchar_t are 16-bit</span>
                    <span class="c1">//p = p ? p + 1 : text_selected_end;</span>
                    <span class="k">while</span> <span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">text_selected_end</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span>
                            <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">ImVec2</span> <span class="n">rect_size</span> <span class="o">=</span> <span class="n">InputTextCalcTextSizeW</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">text_selected_end</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">rect_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="n">rect_size</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">Font</span><span class="o">-&gt;</span><span class="n">GetCharAdvance</span><span class="p">((</span><span class="n">ImWchar</span><span class="p">)</span><span class="sc">&#39; &#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.50f</span><span class="p">);</span> <span class="c1">// So we can see selected empty lines</span>
                    <span class="n">ImRect</span> <span class="nf">rect</span><span class="p">(</span><span class="n">rect_pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="n">bg_offy_up</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">),</span> <span class="n">rect_pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">rect_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">bg_offy_dn</span><span class="p">));</span>
                    <span class="n">rect</span><span class="p">.</span><span class="n">ClipWith</span><span class="p">(</span><span class="n">clip_rect</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">Overlaps</span><span class="p">(</span><span class="n">clip_rect</span><span class="p">))</span>
                        <span class="n">draw_window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">bg_color</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="n">rect_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">draw_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">draw_scroll</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
                <span class="n">rect_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// We test for &#39;buf_display_max_length&#39; as a way to avoid some pathological cases (e.g. single-line 1 MB string) which would make ImDrawList crash.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">is_multiline</span> <span class="o">||</span> <span class="p">(</span><span class="n">buf_display_end</span> <span class="o">-</span> <span class="n">buf_display</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">buf_display_max_length</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ImU32</span> <span class="n">col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">is_displaying_hint</span> <span class="o">?</span> <span class="nl">ImGuiCol_TextDisabled</span> <span class="p">:</span> <span class="n">ImGuiCol_Text</span><span class="p">);</span>
            <span class="n">draw_window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddText</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">Font</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">,</span> <span class="n">draw_pos</span> <span class="o">-</span> <span class="n">draw_scroll</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">buf_display</span><span class="p">,</span> <span class="n">buf_display_end</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="n">is_multiline</span> <span class="o">?</span> <span class="nb">NULL</span> <span class="o">:</span> <span class="o">&amp;</span><span class="n">clip_rect</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Draw blinking cursor</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">render_cursor</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorAnim</span> <span class="o">+=</span> <span class="n">io</span><span class="p">.</span><span class="n">DeltaTime</span><span class="p">;</span>
            <span class="kt">bool</span> <span class="n">cursor_is_visible</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">ConfigInputTextCursorBlink</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorAnim</span> <span class="o">&lt;=</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">||</span> <span class="n">ImFmod</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">CursorAnim</span><span class="p">,</span> <span class="mf">1.20f</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.80f</span><span class="p">;</span>
            <span class="n">ImVec2</span> <span class="n">cursor_screen_pos</span> <span class="o">=</span> <span class="n">draw_pos</span> <span class="o">+</span> <span class="n">cursor_offset</span> <span class="o">-</span> <span class="n">draw_scroll</span><span class="p">;</span>
            <span class="n">ImRect</span> <span class="nf">cursor_screen_rect</span><span class="p">(</span><span class="n">cursor_screen_pos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cursor_screen_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="n">cursor_screen_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="n">cursor_screen_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="mf">1.5f</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cursor_is_visible</span> <span class="o">&amp;&amp;</span> <span class="n">cursor_screen_rect</span><span class="p">.</span><span class="n">Overlaps</span><span class="p">(</span><span class="n">clip_rect</span><span class="p">))</span>
                <span class="n">draw_window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddLine</span><span class="p">(</span><span class="n">cursor_screen_rect</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">cursor_screen_rect</span><span class="p">.</span><span class="n">GetBL</span><span class="p">(),</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_Text</span><span class="p">));</span>

            <span class="c1">// Notify OS of text input position for advanced IME (-1 x offset so that Windows IME can cover our cursor. Bit of an extra nicety.)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_readonly</span><span class="p">)</span>
                <span class="n">g</span><span class="p">.</span><span class="n">PlatformImePos</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">cursor_screen_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="n">cursor_screen_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// Render text only (no selection, no cursor)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">is_multiline</span><span class="p">)</span>
            <span class="n">text_size</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">inner_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">InputTextCalcTextLenAndLineCount</span><span class="p">(</span><span class="n">buf_display</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf_display_end</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">);</span> <span class="c1">// We don&#39;t need width</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_displaying_hint</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
            <span class="n">buf_display_end</span> <span class="o">=</span> <span class="n">buf_display</span> <span class="o">+</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">CurLenA</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_displaying_hint</span><span class="p">)</span>
            <span class="n">buf_display_end</span> <span class="o">=</span> <span class="n">buf_display</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf_display</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">is_multiline</span> <span class="o">||</span> <span class="p">(</span><span class="n">buf_display_end</span> <span class="o">-</span> <span class="n">buf_display</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">buf_display_max_length</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ImU32</span> <span class="n">col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">is_displaying_hint</span> <span class="o">?</span> <span class="nl">ImGuiCol_TextDisabled</span> <span class="p">:</span> <span class="n">ImGuiCol_Text</span><span class="p">);</span>
            <span class="n">draw_window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddText</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">Font</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">,</span> <span class="n">draw_pos</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">buf_display</span><span class="p">,</span> <span class="n">buf_display_end</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="n">is_multiline</span> <span class="o">?</span> <span class="nb">NULL</span> <span class="o">:</span> <span class="o">&amp;</span><span class="n">clip_rect</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">is_password</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_displaying_hint</span><span class="p">)</span>
        <span class="n">PopFont</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">is_multiline</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Dummy</span><span class="p">(</span><span class="n">text_size</span><span class="p">);</span>
        <span class="n">EndChild</span><span class="p">();</span>
        <span class="n">EndGroup</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Log as text</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">LogEnabled</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">is_password</span> <span class="o">||</span> <span class="n">is_displaying_hint</span><span class="p">))</span>
        <span class="n">LogRenderedText</span><span class="p">(</span><span class="o">&amp;</span><span class="n">draw_pos</span><span class="p">,</span> <span class="n">buf_display</span><span class="p">,</span> <span class="n">buf_display_end</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">RenderText</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">label</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">value_changed</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_NoMarkEdited</span><span class="p">))</span>
        <span class="n">MarkItemEdited</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

    <span class="n">IMGUI_TEST_ENGINE_ITEM_INFO</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiInputTextFlags_EnterReturnsTrue</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">enter_pressed</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: ColorEdit, ColorPicker, ColorButton, etc.</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - ColorEdit3()</span>
<span class="c1">// - ColorEdit4()</span>
<span class="c1">// - ColorPicker3()</span>
<span class="c1">// - RenderColorRectWithAlphaCheckerboard() [Internal]</span>
<span class="c1">// - ColorPicker4()</span>
<span class="c1">// - ColorButton()</span>
<span class="c1">// - SetColorEditOptions()</span>
<span class="c1">// - ColorTooltip() [Internal]</span>
<span class="c1">// - ColorEditOptionsPopup() [Internal]</span>
<span class="c1">// - ColorPickerOptionsPopup() [Internal]</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ColorEdit3</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ImGuiColorEditFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">ColorEdit4</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Edit colors components (each component in 0.0f..1.0f range).</span>
<span class="c1">// See enum ImGuiColorEditFlags_ for available options. e.g. Only access 3 floats if ImGuiColorEditFlags_NoAlpha flag is set.</span>
<span class="c1">// With typical options: Left-click on color square to open color picker. Right-click to open option menu. CTRL-Click over input fields to edit them and TAB to go to next item.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ColorEdit4</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="n">col</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ImGuiColorEditFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">square_sz</span> <span class="o">=</span> <span class="n">GetFrameHeight</span><span class="p">();</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">w_full</span> <span class="o">=</span> <span class="n">CalcItemWidth</span><span class="p">();</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">w_button</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoSmallPreview</span><span class="p">)</span> <span class="o">?</span> <span class="mf">0.0f</span> <span class="o">:</span> <span class="p">(</span><span class="n">square_sz</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">w_inputs</span> <span class="o">=</span> <span class="n">w_full</span> <span class="o">-</span> <span class="n">w_button</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label_display_end</span> <span class="o">=</span> <span class="n">FindRenderedTextEnd</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="n">g</span><span class="p">.</span><span class="n">NextItemData</span><span class="p">.</span><span class="n">ClearFlags</span><span class="p">();</span>

    <span class="n">BeginGroup</span><span class="p">();</span>
    <span class="n">PushID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>

    <span class="c1">// If we&#39;re not showing any slider there&#39;s no point in doing any HSV conversions</span>
    <span class="k">const</span> <span class="n">ImGuiColorEditFlags</span> <span class="n">flags_untouched</span> <span class="o">=</span> <span class="n">flags</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoInputs</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">ImGuiColorEditFlags__DisplayMask</span><span class="p">))</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_DisplayRGB</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoOptions</span><span class="p">;</span>

    <span class="c1">// Context menu: display and modify options (before defaults are applied)</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoOptions</span><span class="p">))</span>
        <span class="n">ColorEditOptionsPopup</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

    <span class="c1">// Read stored options</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DisplayMask</span><span class="p">))</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ColorEditOptions</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DisplayMask</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DataTypeMask</span><span class="p">))</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ColorEditOptions</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DataTypeMask</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__PickerMask</span><span class="p">))</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ColorEditOptions</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__PickerMask</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__InputMask</span><span class="p">))</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ColorEditOptions</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__InputMask</span><span class="p">);</span>
    <span class="n">flags</span> <span class="o">|=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ColorEditOptions</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">ImGuiColorEditFlags__DisplayMask</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags__DataTypeMask</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags__PickerMask</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags__InputMask</span><span class="p">));</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">ImIsPowerOfTwo</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DisplayMask</span><span class="p">));</span> <span class="c1">// Check that only 1 is selected</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">ImIsPowerOfTwo</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__InputMask</span><span class="p">));</span>   <span class="c1">// Check that only 1 is selected</span>

    <span class="k">const</span> <span class="kt">bool</span> <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_HDR</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">components</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">?</span> <span class="mi">4</span> <span class="o">:</span> <span class="mi">3</span><span class="p">;</span>

    <span class="c1">// Convert to the formats we need</span>
    <span class="kt">float</span> <span class="n">f</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">?</span> <span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">:</span> <span class="mf">1.0f</span> <span class="p">};</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_InputHSV</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_DisplayRGB</span><span class="p">))</span>
        <span class="n">ColorConvertHSVtoRGB</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_InputRGB</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_DisplayHSV</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// Hue is lost when converting from greyscale rgb (saturation=0). Restore it.</span>
        <span class="n">ColorConvertRGBtoHSV</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ColorEditLastColor</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">ColorEditLastHue</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">ColorEditLastSat</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">IM_F32_TO_INT8_UNBOUND</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">IM_F32_TO_INT8_UNBOUND</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">IM_F32_TO_INT8_UNBOUND</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">IM_F32_TO_INT8_UNBOUND</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="p">};</span>

    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">value_changed_as_float</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">inputs_offset_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">ColorButtonPosition</span> <span class="o">==</span> <span class="n">ImGuiDir_Left</span><span class="p">)</span> <span class="o">?</span> <span class="nl">w_button</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">inputs_offset_x</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiColorEditFlags_DisplayRGB</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_DisplayHSV</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoInputs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// RGB/HSV 0..255 Sliders</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">w_item_one</span>  <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">IM_FLOOR</span><span class="p">((</span><span class="n">w_inputs</span> <span class="o">-</span> <span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">components</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">components</span><span class="p">));</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">w_item_last</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">w_inputs</span> <span class="o">-</span> <span class="p">(</span><span class="n">w_item_one</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">components</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)));</span>

        <span class="k">const</span> <span class="kt">bool</span> <span class="n">hide_prefix</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_item_one</span> <span class="o">&lt;=</span> <span class="n">CalcTextSize</span><span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_Float</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;M:0.000&quot;</span> <span class="o">:</span> <span class="s">&quot;M:000&quot;</span><span class="p">).</span><span class="n">x</span><span class="p">);</span>
        <span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">ids</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;##X&quot;</span><span class="p">,</span> <span class="s">&quot;##Y&quot;</span><span class="p">,</span> <span class="s">&quot;##Z&quot;</span><span class="p">,</span> <span class="s">&quot;##W&quot;</span> <span class="p">};</span>
        <span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt_table_int</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span>
        <span class="p">{</span>
            <span class="p">{</span>   <span class="s">&quot;%3d&quot;</span><span class="p">,</span>   <span class="s">&quot;%3d&quot;</span><span class="p">,</span>   <span class="s">&quot;%3d&quot;</span><span class="p">,</span>   <span class="s">&quot;%3d&quot;</span> <span class="p">},</span> <span class="c1">// Short display</span>
            <span class="p">{</span> <span class="s">&quot;R:%3d&quot;</span><span class="p">,</span> <span class="s">&quot;G:%3d&quot;</span><span class="p">,</span> <span class="s">&quot;B:%3d&quot;</span><span class="p">,</span> <span class="s">&quot;A:%3d&quot;</span> <span class="p">},</span> <span class="c1">// Long display for RGBA</span>
            <span class="p">{</span> <span class="s">&quot;H:%3d&quot;</span><span class="p">,</span> <span class="s">&quot;S:%3d&quot;</span><span class="p">,</span> <span class="s">&quot;V:%3d&quot;</span><span class="p">,</span> <span class="s">&quot;A:%3d&quot;</span> <span class="p">}</span>  <span class="c1">// Long display for HSVA</span>
        <span class="p">};</span>
        <span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt_table_float</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span>
        <span class="p">{</span>
            <span class="p">{</span>   <span class="s">&quot;%0.3f&quot;</span><span class="p">,</span>   <span class="s">&quot;%0.3f&quot;</span><span class="p">,</span>   <span class="s">&quot;%0.3f&quot;</span><span class="p">,</span>   <span class="s">&quot;%0.3f&quot;</span> <span class="p">},</span> <span class="c1">// Short display</span>
            <span class="p">{</span> <span class="s">&quot;R:%0.3f&quot;</span><span class="p">,</span> <span class="s">&quot;G:%0.3f&quot;</span><span class="p">,</span> <span class="s">&quot;B:%0.3f&quot;</span><span class="p">,</span> <span class="s">&quot;A:%0.3f&quot;</span> <span class="p">},</span> <span class="c1">// Long display for RGBA</span>
            <span class="p">{</span> <span class="s">&quot;H:%0.3f&quot;</span><span class="p">,</span> <span class="s">&quot;S:%0.3f&quot;</span><span class="p">,</span> <span class="s">&quot;V:%0.3f&quot;</span><span class="p">,</span> <span class="s">&quot;A:%0.3f&quot;</span> <span class="p">}</span>  <span class="c1">// Long display for HSVA</span>
        <span class="p">};</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">fmt_idx</span> <span class="o">=</span> <span class="n">hide_prefix</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_DisplayHSV</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">components</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
            <span class="n">SetNextItemWidth</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">components</span><span class="p">)</span> <span class="o">?</span> <span class="nl">w_item_one</span> <span class="p">:</span> <span class="n">w_item_last</span><span class="p">);</span>

            <span class="c1">// FIXME: When ImGuiColorEditFlags_HDR flag is passed HS values snap in weird ways when SV values go below 0.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_Float</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">value_changed</span> <span class="o">|=</span> <span class="n">DragFloat</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="mf">255.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="n">hdr</span> <span class="o">?</span> <span class="mf">0.0f</span> <span class="o">:</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="n">fmt_table_float</span><span class="p">[</span><span class="n">fmt_idx</span><span class="p">][</span><span class="n">n</span><span class="p">]);</span>
                <span class="n">value_changed_as_float</span> <span class="o">|=</span> <span class="n">value_changed</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">value_changed</span> <span class="o">|=</span> <span class="n">DragInt</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">hdr</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">255</span><span class="p">,</span> <span class="n">fmt_table_int</span><span class="p">[</span><span class="n">fmt_idx</span><span class="p">][</span><span class="n">n</span><span class="p">]);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoOptions</span><span class="p">))</span>
                <span class="n">OpenPopupOnItemClick</span><span class="p">(</span><span class="s">&quot;context&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_DisplayHex</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoInputs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// RGB Hexadecimal Input</span>
        <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">ImFormatString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="s">&quot;#%02X%02X%02X%02X&quot;</span><span class="p">,</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">));</span>
        <span class="k">else</span>
            <span class="n">ImFormatString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="s">&quot;#%02X%02X%02X&quot;</span><span class="p">,</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">));</span>
        <span class="n">SetNextItemWidth</span><span class="p">(</span><span class="n">w_inputs</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">InputText</span><span class="p">(</span><span class="s">&quot;##Text&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">ImGuiInputTextFlags_CharsHexadecimal</span> <span class="o">|</span> <span class="n">ImGuiInputTextFlags_CharsUppercase</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="kt">char</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span> <span class="o">==</span> <span class="sc">&#39;#&#39;</span> <span class="o">||</span> <span class="n">ImCharIsBlankA</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">))</span>
                <span class="n">p</span><span class="o">++</span><span class="p">;</span>
            <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
                <span class="n">sscanf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&quot;%02X%02X%02X%02X&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span> <span class="c1">// Treat at unsigned (%X is unsigned)</span>
            <span class="k">else</span>
                <span class="n">sscanf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&quot;%02X%02X%02X&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoOptions</span><span class="p">))</span>
            <span class="n">OpenPopupOnItemClick</span><span class="p">(</span><span class="s">&quot;context&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">picker_active_window</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoSmallPreview</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">button_offset_x</span> <span class="o">=</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoInputs</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">ColorButtonPosition</span> <span class="o">==</span> <span class="n">ImGuiDir_Left</span><span class="p">))</span> <span class="o">?</span> <span class="mf">0.0f</span> <span class="o">:</span> <span class="n">w_inputs</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">button_offset_x</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>

        <span class="k">const</span> <span class="n">ImVec4</span> <span class="nf">col_v4</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">?</span> <span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">:</span> <span class="mf">1.0f</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ColorButton</span><span class="p">(</span><span class="s">&quot;##ColorButton&quot;</span><span class="p">,</span> <span class="n">col_v4</span><span class="p">,</span> <span class="n">flags</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoPicker</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="c1">// Store current color and open a picker</span>
                <span class="n">g</span><span class="p">.</span><span class="n">ColorPickerRef</span> <span class="o">=</span> <span class="n">col_v4</span><span class="p">;</span>
                <span class="n">OpenPopup</span><span class="p">(</span><span class="s">&quot;picker&quot;</span><span class="p">);</span>
                <span class="n">SetNextWindowPos</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemRect</span><span class="p">.</span><span class="n">GetBL</span><span class="p">()</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoOptions</span><span class="p">))</span>
            <span class="n">OpenPopupOnItemClick</span><span class="p">(</span><span class="s">&quot;context&quot;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">BeginPopup</span><span class="p">(</span><span class="s">&quot;picker&quot;</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">picker_active_window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">label</span> <span class="o">!=</span> <span class="n">label_display_end</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">TextEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">label_display_end</span><span class="p">);</span>
                <span class="n">Spacing</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">ImGuiColorEditFlags</span> <span class="n">picker_flags_to_forward</span> <span class="o">=</span> <span class="n">ImGuiColorEditFlags__DataTypeMask</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags__PickerMask</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags__InputMask</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_HDR</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_AlphaBar</span><span class="p">;</span>
            <span class="n">ImGuiColorEditFlags</span> <span class="n">picker_flags</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags_untouched</span> <span class="o">&amp;</span> <span class="n">picker_flags_to_forward</span><span class="p">)</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags__DisplayMask</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoLabel</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_AlphaPreviewHalf</span><span class="p">;</span>
            <span class="n">SetNextItemWidth</span><span class="p">(</span><span class="n">square_sz</span> <span class="o">*</span> <span class="mf">12.0f</span><span class="p">);</span> <span class="c1">// Use 256 + bar sizes?</span>
            <span class="n">value_changed</span> <span class="o">|=</span> <span class="n">ColorPicker4</span><span class="p">(</span><span class="s">&quot;##picker&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">picker_flags</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">.</span><span class="n">ColorPickerRef</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
            <span class="n">EndPopup</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">label</span> <span class="o">!=</span> <span class="n">label_display_end</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoLabel</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">text_offset_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoInputs</span><span class="p">)</span> <span class="o">?</span> <span class="nl">w_button</span> <span class="p">:</span> <span class="n">w_full</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">text_offset_x</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
        <span class="n">TextEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">label_display_end</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Convert back</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value_changed</span> <span class="o">&amp;&amp;</span> <span class="n">picker_active_window</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">value_changed_as_float</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
                <span class="n">f</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="mf">255.0f</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_DisplayHSV</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_InputRGB</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">g</span><span class="p">.</span><span class="n">ColorEditLastHue</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="n">g</span><span class="p">.</span><span class="n">ColorEditLastSat</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
            <span class="n">ColorConvertHSVtoRGB</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
            <span class="n">memcpy</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ColorEditLastColor</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_DisplayRGB</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_InputHSV</span><span class="p">))</span>
            <span class="n">ColorConvertRGBtoHSV</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

        <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="n">PopID</span><span class="p">();</span>
    <span class="n">EndGroup</span><span class="p">();</span>

    <span class="c1">// Drag and Drop Target</span>
    <span class="c1">// NB: The flag test is merely an optional micro-optimization, BeginDragDropTarget() does the same test.</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemStatusFlags</span> <span class="o">&amp;</span> <span class="n">ImGuiItemStatusFlags_HoveredRect</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoDragDrop</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">BeginDragDropTarget</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">accepted_drag_drop</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImGuiPayload</span><span class="o">*</span> <span class="n">payload</span> <span class="o">=</span> <span class="n">AcceptDragDropPayload</span><span class="p">(</span><span class="n">IMGUI_PAYLOAD_TYPE_COLOR_3F</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">memcpy</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">col</span><span class="p">,</span> <span class="n">payload</span><span class="o">-&gt;</span><span class="n">Data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// Preserve alpha if any //-V512</span>
            <span class="n">value_changed</span> <span class="o">=</span> <span class="n">accepted_drag_drop</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImGuiPayload</span><span class="o">*</span> <span class="n">payload</span> <span class="o">=</span> <span class="n">AcceptDragDropPayload</span><span class="p">(</span><span class="n">IMGUI_PAYLOAD_TYPE_COLOR_4F</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">memcpy</span><span class="p">((</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">col</span><span class="p">,</span> <span class="n">payload</span><span class="o">-&gt;</span><span class="n">Data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">components</span><span class="p">);</span>
            <span class="n">value_changed</span> <span class="o">=</span> <span class="n">accepted_drag_drop</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Drag-drop payloads are always RGB</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">accepted_drag_drop</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_InputHSV</span><span class="p">))</span>
            <span class="n">ColorConvertRGBtoHSV</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="n">EndDragDropTarget</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// When picker is being actively used, use its active id so IsItemActive() will function on ColorEdit4().</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">picker_active_window</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdWindow</span> <span class="o">==</span> <span class="n">picker_active_window</span><span class="p">)</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemId</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">value_changed</span><span class="p">)</span>
        <span class="n">MarkItemEdited</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemId</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ColorPicker3</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ImGuiColorEditFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="n">col4</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">1.0f</span> <span class="p">};</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ColorPicker4</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">col4</span><span class="p">,</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">col4</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">col4</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">col4</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Helper for ColorPicker4()</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">RenderArrowsForVerticalBar</span><span class="p">(</span><span class="n">ImDrawList</span><span class="o">*</span> <span class="n">draw_list</span><span class="p">,</span> <span class="n">ImVec2</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ImVec2</span> <span class="n">half_sz</span><span class="p">,</span> <span class="kt">float</span> <span class="n">bar_w</span><span class="p">,</span> <span class="kt">float</span> <span class="n">alpha</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImU32</span> <span class="n">alpha8</span> <span class="o">=</span> <span class="n">IM_F32_TO_INT8_SAT</span><span class="p">(</span><span class="n">alpha</span><span class="p">);</span>
    <span class="n">ImGui</span><span class="o">::</span><span class="n">RenderArrowPointingAt</span><span class="p">(</span><span class="n">draw_list</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">half_sz</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>         <span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">half_sz</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">half_sz</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ImGuiDir_Right</span><span class="p">,</span> <span class="n">IM_COL32</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">alpha8</span><span class="p">));</span>
    <span class="n">ImGui</span><span class="o">::</span><span class="n">RenderArrowPointingAt</span><span class="p">(</span><span class="n">draw_list</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">half_sz</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>             <span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">half_sz</span><span class="p">,</span>                              <span class="n">ImGuiDir_Right</span><span class="p">,</span> <span class="n">IM_COL32</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="n">alpha8</span><span class="p">));</span>
    <span class="n">ImGui</span><span class="o">::</span><span class="n">RenderArrowPointingAt</span><span class="p">(</span><span class="n">draw_list</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">bar_w</span> <span class="o">-</span> <span class="n">half_sz</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">half_sz</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">half_sz</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ImGuiDir_Left</span><span class="p">,</span>  <span class="n">IM_COL32</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">alpha8</span><span class="p">));</span>
    <span class="n">ImGui</span><span class="o">::</span><span class="n">RenderArrowPointingAt</span><span class="p">(</span><span class="n">draw_list</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">bar_w</span> <span class="o">-</span> <span class="n">half_sz</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>     <span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">half_sz</span><span class="p">,</span>                              <span class="n">ImGuiDir_Left</span><span class="p">,</span>  <span class="n">IM_COL32</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="n">alpha8</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// Note: ColorPicker4() only accesses 3 floats if ImGuiColorEditFlags_NoAlpha flag is set.</span>
<span class="c1">// (In C++ the &#39;float col[4]&#39; notation for a function argument is equivalent to &#39;float* col&#39;, we only specify a size to facilitate understanding of the code.)</span>
<span class="c1">// FIXME: we adjust the big color square height based on item width, which may cause a flickering feedback loop (if automatic height makes a vertical scrollbar appears, affecting automatic width..)</span>
<span class="c1">// FIXME: this is trying to be aware of style.Alpha but not fully correct. Also, the color wheel will have overlapping glitches with (style.Alpha &lt; 1.0)</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ColorPicker4</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="n">col</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ImGuiColorEditFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="n">ref_col</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImDrawList</span><span class="o">*</span> <span class="n">draw_list</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">;</span>
    <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="n">ImGuiIO</span><span class="o">&amp;</span> <span class="n">io</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">float</span> <span class="n">width</span> <span class="o">=</span> <span class="n">CalcItemWidth</span><span class="p">();</span>
    <span class="n">g</span><span class="p">.</span><span class="n">NextItemData</span><span class="p">.</span><span class="n">ClearFlags</span><span class="p">();</span>

    <span class="n">PushID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="n">BeginGroup</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoSidePreview</span><span class="p">))</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiColorEditFlags_NoSmallPreview</span><span class="p">;</span>

    <span class="c1">// Context menu: display and store options.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoOptions</span><span class="p">))</span>
        <span class="n">ColorPickerOptionsPopup</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

    <span class="c1">// Read stored options</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__PickerMask</span><span class="p">))</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="p">((</span><span class="n">g</span><span class="p">.</span><span class="n">ColorEditOptions</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__PickerMask</span><span class="p">)</span> <span class="o">?</span> <span class="n">g</span><span class="p">.</span><span class="nl">ColorEditOptions</span> <span class="p">:</span> <span class="n">ImGuiColorEditFlags__OptionsDefault</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__PickerMask</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__InputMask</span><span class="p">))</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="p">((</span><span class="n">g</span><span class="p">.</span><span class="n">ColorEditOptions</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__InputMask</span><span class="p">)</span> <span class="o">?</span> <span class="n">g</span><span class="p">.</span><span class="nl">ColorEditOptions</span> <span class="p">:</span> <span class="n">ImGuiColorEditFlags__OptionsDefault</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__InputMask</span><span class="p">;</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">ImIsPowerOfTwo</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__PickerMask</span><span class="p">));</span> <span class="c1">// Check that only 1 is selected</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">ImIsPowerOfTwo</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__InputMask</span><span class="p">));</span>  <span class="c1">// Check that only 1 is selected</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoOptions</span><span class="p">))</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ColorEditOptions</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_AlphaBar</span><span class="p">);</span>

    <span class="c1">// Setup</span>
    <span class="kt">int</span> <span class="n">components</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">)</span> <span class="o">?</span> <span class="mi">3</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">alpha_bar</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_AlphaBar</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">);</span>
    <span class="n">ImVec2</span> <span class="n">picker_pos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">square_sz</span> <span class="o">=</span> <span class="n">GetFrameHeight</span><span class="p">();</span>
    <span class="kt">float</span> <span class="n">bars_width</span> <span class="o">=</span> <span class="n">square_sz</span><span class="p">;</span> <span class="c1">// Arbitrary smallish width of Hue/Alpha picking bars</span>
    <span class="kt">float</span> <span class="n">sv_picker_size</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">bars_width</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="n">alpha_bar</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">bars_width</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">));</span> <span class="c1">// Saturation/Value picking box</span>
    <span class="kt">float</span> <span class="n">bar0_pos_x</span> <span class="o">=</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">sv_picker_size</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">bar1_pos_x</span> <span class="o">=</span> <span class="n">bar0_pos_x</span> <span class="o">+</span> <span class="n">bars_width</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">bars_triangles_half_sz</span> <span class="o">=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">bars_width</span> <span class="o">*</span> <span class="mf">0.20f</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">backup_initial_col</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="n">backup_initial_col</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">components</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>

    <span class="kt">float</span> <span class="n">wheel_thickness</span> <span class="o">=</span> <span class="n">sv_picker_size</span> <span class="o">*</span> <span class="mf">0.08f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">wheel_r_outer</span> <span class="o">=</span> <span class="n">sv_picker_size</span> <span class="o">*</span> <span class="mf">0.50f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">wheel_r_inner</span> <span class="o">=</span> <span class="n">wheel_r_outer</span> <span class="o">-</span> <span class="n">wheel_thickness</span><span class="p">;</span>
    <span class="n">ImVec2</span> <span class="nf">wheel_center</span><span class="p">(</span><span class="n">picker_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">sv_picker_size</span> <span class="o">+</span> <span class="n">bars_width</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5f</span><span class="p">,</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">sv_picker_size</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">);</span>

    <span class="c1">// Note: the triangle is displayed rotated with triangle_pa pointing to Hue, but most coordinates stays unrotated for logic.</span>
    <span class="kt">float</span> <span class="n">triangle_r</span> <span class="o">=</span> <span class="n">wheel_r_inner</span> <span class="o">-</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">sv_picker_size</span> <span class="o">*</span> <span class="mf">0.027f</span><span class="p">);</span>
    <span class="n">ImVec2</span> <span class="n">triangle_pa</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">triangle_r</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span> <span class="c1">// Hue point.</span>
    <span class="n">ImVec2</span> <span class="n">triangle_pb</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">triangle_r</span> <span class="o">*</span> <span class="mf">-0.5f</span><span class="p">,</span> <span class="n">triangle_r</span> <span class="o">*</span> <span class="mf">-0.866025f</span><span class="p">);</span> <span class="c1">// Black point.</span>
    <span class="n">ImVec2</span> <span class="n">triangle_pc</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">triangle_r</span> <span class="o">*</span> <span class="mf">-0.5f</span><span class="p">,</span> <span class="n">triangle_r</span> <span class="o">*</span> <span class="o">+</span><span class="mf">0.866025f</span><span class="p">);</span> <span class="c1">// White point.</span>

    <span class="kt">float</span> <span class="n">H</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">S</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">V</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="kt">float</span> <span class="n">R</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">G</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">B</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_InputRGB</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Hue is lost when converting from greyscale rgb (saturation=0). Restore it.</span>
        <span class="n">ColorConvertRGBtoHSV</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ColorEditLastColor</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">S</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">H</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">ColorEditLastHue</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">V</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">S</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">ColorEditLastSat</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_InputHSV</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ColorConvertHSVtoRGB</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span> <span class="n">value_changed_h</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span> <span class="n">value_changed_sv</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">PushItemFlag</span><span class="p">(</span><span class="n">ImGuiItemFlags_NoNav</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_PickerHueWheel</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Hue wheel + SV triangle logic</span>
        <span class="n">InvisibleButton</span><span class="p">(</span><span class="s">&quot;hsv&quot;</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">sv_picker_size</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">bars_width</span><span class="p">,</span> <span class="n">sv_picker_size</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">IsItemActive</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">ImVec2</span> <span class="n">initial_off</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseClickedPos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">wheel_center</span><span class="p">;</span>
            <span class="n">ImVec2</span> <span class="n">current_off</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MousePos</span> <span class="o">-</span> <span class="n">wheel_center</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">initial_dist2</span> <span class="o">=</span> <span class="n">ImLengthSqr</span><span class="p">(</span><span class="n">initial_off</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">initial_dist2</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">wheel_r_inner</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">wheel_r_inner</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">initial_dist2</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">wheel_r_outer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">wheel_r_outer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="c1">// Interactive with Hue wheel</span>
                <span class="n">H</span> <span class="o">=</span> <span class="n">ImAtan2</span><span class="p">(</span><span class="n">current_off</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">current_off</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">IM_PI</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">H</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">)</span>
                    <span class="n">H</span> <span class="o">+=</span> <span class="mf">1.0f</span><span class="p">;</span>
                <span class="n">value_changed</span> <span class="o">=</span> <span class="n">value_changed_h</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="kt">float</span> <span class="n">cos_hue_angle</span> <span class="o">=</span> <span class="n">ImCos</span><span class="p">(</span><span class="o">-</span><span class="n">H</span> <span class="o">*</span> <span class="mf">2.0f</span> <span class="o">*</span> <span class="n">IM_PI</span><span class="p">);</span>
            <span class="kt">float</span> <span class="n">sin_hue_angle</span> <span class="o">=</span> <span class="n">ImSin</span><span class="p">(</span><span class="o">-</span><span class="n">H</span> <span class="o">*</span> <span class="mf">2.0f</span> <span class="o">*</span> <span class="n">IM_PI</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ImTriangleContainsPoint</span><span class="p">(</span><span class="n">triangle_pa</span><span class="p">,</span> <span class="n">triangle_pb</span><span class="p">,</span> <span class="n">triangle_pc</span><span class="p">,</span> <span class="n">ImRotate</span><span class="p">(</span><span class="n">initial_off</span><span class="p">,</span> <span class="n">cos_hue_angle</span><span class="p">,</span> <span class="n">sin_hue_angle</span><span class="p">)))</span>
            <span class="p">{</span>
                <span class="c1">// Interacting with SV triangle</span>
                <span class="n">ImVec2</span> <span class="n">current_off_unrotated</span> <span class="o">=</span> <span class="n">ImRotate</span><span class="p">(</span><span class="n">current_off</span><span class="p">,</span> <span class="n">cos_hue_angle</span><span class="p">,</span> <span class="n">sin_hue_angle</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ImTriangleContainsPoint</span><span class="p">(</span><span class="n">triangle_pa</span><span class="p">,</span> <span class="n">triangle_pb</span><span class="p">,</span> <span class="n">triangle_pc</span><span class="p">,</span> <span class="n">current_off_unrotated</span><span class="p">))</span>
                    <span class="n">current_off_unrotated</span> <span class="o">=</span> <span class="n">ImTriangleClosestPoint</span><span class="p">(</span><span class="n">triangle_pa</span><span class="p">,</span> <span class="n">triangle_pb</span><span class="p">,</span> <span class="n">triangle_pc</span><span class="p">,</span> <span class="n">current_off_unrotated</span><span class="p">);</span>
                <span class="kt">float</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">,</span> <span class="n">ww</span><span class="p">;</span>
                <span class="n">ImTriangleBarycentricCoords</span><span class="p">(</span><span class="n">triangle_pa</span><span class="p">,</span> <span class="n">triangle_pb</span><span class="p">,</span> <span class="n">triangle_pc</span><span class="p">,</span> <span class="n">current_off_unrotated</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">,</span> <span class="n">ww</span><span class="p">);</span>
                <span class="n">V</span> <span class="o">=</span> <span class="n">ImClamp</span><span class="p">(</span><span class="mf">1.0f</span> <span class="o">-</span> <span class="n">vv</span><span class="p">,</span> <span class="mf">0.0001f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
                <span class="n">S</span> <span class="o">=</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">uu</span> <span class="o">/</span> <span class="n">V</span><span class="p">,</span> <span class="mf">0.0001f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
                <span class="n">value_changed</span> <span class="o">=</span> <span class="n">value_changed_sv</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoOptions</span><span class="p">))</span>
            <span class="n">OpenPopupOnItemClick</span><span class="p">(</span><span class="s">&quot;context&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_PickerHueBar</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// SV rectangle logic</span>
        <span class="n">InvisibleButton</span><span class="p">(</span><span class="s">&quot;sv&quot;</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">sv_picker_size</span><span class="p">,</span> <span class="n">sv_picker_size</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">IsItemActive</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">ImSaturate</span><span class="p">((</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sv_picker_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
            <span class="n">V</span> <span class="o">=</span> <span class="mf">1.0f</span> <span class="o">-</span> <span class="n">ImSaturate</span><span class="p">((</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sv_picker_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
            <span class="n">value_changed</span> <span class="o">=</span> <span class="n">value_changed_sv</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoOptions</span><span class="p">))</span>
            <span class="n">OpenPopupOnItemClick</span><span class="p">(</span><span class="s">&quot;context&quot;</span><span class="p">);</span>

        <span class="c1">// Hue bar logic</span>
        <span class="n">SetCursorScreenPos</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">bar0_pos_x</span><span class="p">,</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
        <span class="n">InvisibleButton</span><span class="p">(</span><span class="s">&quot;hue&quot;</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">bars_width</span><span class="p">,</span> <span class="n">sv_picker_size</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">IsItemActive</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">ImSaturate</span><span class="p">((</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sv_picker_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
            <span class="n">value_changed</span> <span class="o">=</span> <span class="n">value_changed_h</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Alpha bar logic</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">alpha_bar</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SetCursorScreenPos</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">bar1_pos_x</span><span class="p">,</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
        <span class="n">InvisibleButton</span><span class="p">(</span><span class="s">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">bars_width</span><span class="p">,</span> <span class="n">sv_picker_size</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">IsItemActive</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0f</span> <span class="o">-</span> <span class="n">ImSaturate</span><span class="p">((</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sv_picker_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
            <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">PopItemFlag</span><span class="p">();</span> <span class="c1">// ImGuiItemFlags_NoNav</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoSidePreview</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="n">BeginGroup</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoLabel</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label_display_end</span> <span class="o">=</span> <span class="n">FindRenderedTextEnd</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">label</span> <span class="o">!=</span> <span class="n">label_display_end</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoSidePreview</span><span class="p">))</span>
                <span class="n">SameLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
            <span class="n">TextEx</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">label_display_end</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoSidePreview</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">PushItemFlag</span><span class="p">(</span><span class="n">ImGuiItemFlags_NoNavDefaultFocus</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
        <span class="n">ImVec4</span> <span class="nf">col_v4</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">)</span> <span class="o">?</span> <span class="mf">1.0f</span> <span class="o">:</span> <span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoLabel</span><span class="p">))</span>
            <span class="n">Text</span><span class="p">(</span><span class="s">&quot;Current&quot;</span><span class="p">);</span>

        <span class="n">ImGuiColorEditFlags</span> <span class="n">sub_flags_to_forward</span> <span class="o">=</span> <span class="n">ImGuiColorEditFlags__InputMask</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_HDR</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_AlphaPreview</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_AlphaPreviewHalf</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoTooltip</span><span class="p">;</span>
        <span class="n">ColorButton</span><span class="p">(</span><span class="s">&quot;##current&quot;</span><span class="p">,</span> <span class="n">col_v4</span><span class="p">,</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">sub_flags_to_forward</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">square_sz</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">square_sz</span> <span class="o">*</span> <span class="mi">2</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ref_col</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Text</span><span class="p">(</span><span class="s">&quot;Original&quot;</span><span class="p">);</span>
            <span class="n">ImVec4</span> <span class="nf">ref_col_v4</span><span class="p">(</span><span class="n">ref_col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ref_col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ref_col</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">)</span> <span class="o">?</span> <span class="mf">1.0f</span> <span class="o">:</span> <span class="n">ref_col</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ColorButton</span><span class="p">(</span><span class="s">&quot;##original&quot;</span><span class="p">,</span> <span class="n">ref_col_v4</span><span class="p">,</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">sub_flags_to_forward</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">square_sz</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">square_sz</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)))</span>
            <span class="p">{</span>
                <span class="n">memcpy</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">ref_col</span><span class="p">,</span> <span class="n">components</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>
                <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">PopItemFlag</span><span class="p">();</span>
        <span class="n">EndGroup</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Convert back color to RGB</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value_changed_h</span> <span class="o">||</span> <span class="n">value_changed_sv</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_InputRGB</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ColorConvertHSVtoRGB</span><span class="p">(</span><span class="n">H</span> <span class="o">&gt;=</span> <span class="mf">1.0f</span> <span class="o">?</span> <span class="n">H</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">*</span> <span class="mf">1e-6f</span> <span class="o">:</span> <span class="n">H</span><span class="p">,</span> <span class="n">S</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="nl">S</span> <span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="mf">1e-6f</span><span class="p">,</span> <span class="n">V</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="nl">V</span> <span class="p">:</span> <span class="mf">1e-6f</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
            <span class="n">g</span><span class="p">.</span><span class="n">ColorEditLastHue</span> <span class="o">=</span> <span class="n">H</span><span class="p">;</span>
            <span class="n">g</span><span class="p">.</span><span class="n">ColorEditLastSat</span> <span class="o">=</span> <span class="n">S</span><span class="p">;</span>
            <span class="n">memcpy</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ColorEditLastColor</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_InputHSV</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">H</span><span class="p">;</span>
            <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="p">;</span>
            <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// R,G,B and H,S,V slider color editor</span>
    <span class="kt">bool</span> <span class="n">value_changed_fix_hue_wrap</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoInputs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">PushItemWidth</span><span class="p">((</span><span class="n">alpha_bar</span> <span class="o">?</span> <span class="nl">bar1_pos_x</span> <span class="p">:</span> <span class="n">bar0_pos_x</span><span class="p">)</span> <span class="o">+</span> <span class="n">bars_width</span> <span class="o">-</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="n">ImGuiColorEditFlags</span> <span class="n">sub_flags_to_forward</span> <span class="o">=</span> <span class="n">ImGuiColorEditFlags__DataTypeMask</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags__InputMask</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_HDR</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoOptions</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoSmallPreview</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_AlphaPreview</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_AlphaPreviewHalf</span><span class="p">;</span>
        <span class="n">ImGuiColorEditFlags</span> <span class="n">sub_flags</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">sub_flags_to_forward</span><span class="p">)</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoPicker</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_DisplayRGB</span> <span class="o">||</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DisplayMask</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ColorEdit4</span><span class="p">(</span><span class="s">&quot;##rgb&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">sub_flags</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_DisplayRGB</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="c1">// FIXME: Hackily differentiating using the DragInt (ActiveId != 0 &amp;&amp; !ActiveIdAllowOverlap) vs. using the InputText or DropTarget.</span>
                <span class="c1">// For the later we don&#39;t want to run the hue-wrap canceling code. If you are well versed in HSV picker please provide your input! (See #2050)</span>
                <span class="n">value_changed_fix_hue_wrap</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveIdAllowOverlap</span><span class="p">);</span>
                <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_DisplayHSV</span> <span class="o">||</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DisplayMask</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">value_changed</span> <span class="o">|=</span> <span class="n">ColorEdit4</span><span class="p">(</span><span class="s">&quot;##hsv&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">sub_flags</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_DisplayHSV</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_DisplayHex</span> <span class="o">||</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DisplayMask</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">value_changed</span> <span class="o">|=</span> <span class="n">ColorEdit4</span><span class="p">(</span><span class="s">&quot;##hex&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">sub_flags</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_DisplayHex</span><span class="p">);</span>
        <span class="n">PopItemWidth</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Try to cancel hue wrap (after ColorEdit4 call), if any</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value_changed_fix_hue_wrap</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_InputRGB</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="kt">float</span> <span class="n">new_H</span><span class="p">,</span> <span class="n">new_S</span><span class="p">,</span> <span class="n">new_V</span><span class="p">;</span>
        <span class="n">ColorConvertRGBtoHSV</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">new_H</span><span class="p">,</span> <span class="n">new_S</span><span class="p">,</span> <span class="n">new_V</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">new_H</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">H</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">new_V</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">V</span> <span class="o">!=</span> <span class="n">new_V</span><span class="p">)</span>
                <span class="n">ColorConvertHSVtoRGB</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">new_V</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">V</span> <span class="o">*</span> <span class="mf">0.5f</span> <span class="o">:</span> <span class="n">new_V</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">new_S</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">ColorConvertHSVtoRGB</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">new_S</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">S</span> <span class="o">*</span> <span class="mf">0.5f</span> <span class="o">:</span> <span class="n">new_S</span><span class="p">,</span> <span class="n">new_V</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">value_changed</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_InputRGB</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
            <span class="n">ColorConvertRGBtoHSV</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ColorEditLastColor</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// Fix local Hue as display below will use it immediately.</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">S</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">ColorEditLastHue</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">V</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">S</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">ColorEditLastSat</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_InputHSV</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
            <span class="n">ColorConvertHSVtoRGB</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="kt">int</span> <span class="n">style_alpha8</span> <span class="o">=</span> <span class="n">IM_F32_TO_INT8_SAT</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">Alpha</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">col_black</span> <span class="o">=</span> <span class="n">IM_COL32</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">style_alpha8</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">col_white</span> <span class="o">=</span> <span class="n">IM_COL32</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="n">style_alpha8</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">col_midgrey</span> <span class="o">=</span> <span class="n">IM_COL32</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="n">style_alpha8</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">col_hues</span><span class="p">[</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">IM_COL32</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">style_alpha8</span><span class="p">),</span> <span class="n">IM_COL32</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">style_alpha8</span><span class="p">),</span> <span class="n">IM_COL32</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">style_alpha8</span><span class="p">),</span> <span class="n">IM_COL32</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="n">style_alpha8</span><span class="p">),</span> <span class="n">IM_COL32</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="n">style_alpha8</span><span class="p">),</span> <span class="n">IM_COL32</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="n">style_alpha8</span><span class="p">),</span> <span class="n">IM_COL32</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">style_alpha8</span><span class="p">)</span> <span class="p">};</span>

    <span class="n">ImVec4</span> <span class="nf">hue_color_f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">Alpha</span><span class="p">);</span> <span class="n">ColorConvertHSVtoRGB</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hue_color_f</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">hue_color_f</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">hue_color_f</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
    <span class="n">ImU32</span> <span class="n">hue_color32</span> <span class="o">=</span> <span class="n">ColorConvertFloat4ToU32</span><span class="p">(</span><span class="n">hue_color_f</span><span class="p">);</span>
    <span class="n">ImU32</span> <span class="n">user_col32_striped_of_alpha</span> <span class="o">=</span> <span class="n">ColorConvertFloat4ToU32</span><span class="p">(</span><span class="n">ImVec4</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">Alpha</span><span class="p">));</span> <span class="c1">// Important: this is still including the main rendering/style alpha!!</span>

    <span class="n">ImVec2</span> <span class="n">sv_cursor_pos</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_PickerHueWheel</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Render Hue Wheel</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">aeps</span> <span class="o">=</span> <span class="mf">0.5f</span> <span class="o">/</span> <span class="n">wheel_r_outer</span><span class="p">;</span> <span class="c1">// Half a pixel arc length in radians (2pi cancels out).</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">segment_per_arc</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">wheel_r_outer</span> <span class="o">/</span> <span class="mi">12</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">a0</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span>     <span class="o">/</span><span class="mf">6.0f</span> <span class="o">*</span> <span class="mf">2.0f</span> <span class="o">*</span> <span class="n">IM_PI</span> <span class="o">-</span> <span class="n">aeps</span><span class="p">;</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">a1</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mf">1.0f</span><span class="p">)</span><span class="o">/</span><span class="mf">6.0f</span> <span class="o">*</span> <span class="mf">2.0f</span> <span class="o">*</span> <span class="n">IM_PI</span> <span class="o">+</span> <span class="n">aeps</span><span class="p">;</span>
            <span class="k">const</span> <span class="kt">int</span> <span class="n">vert_start_idx</span> <span class="o">=</span> <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">VtxBuffer</span><span class="p">.</span><span class="n">Size</span><span class="p">;</span>
            <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PathArcTo</span><span class="p">(</span><span class="n">wheel_center</span><span class="p">,</span> <span class="p">(</span><span class="n">wheel_r_inner</span> <span class="o">+</span> <span class="n">wheel_r_outer</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5f</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">segment_per_arc</span><span class="p">);</span>
            <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PathStroke</span><span class="p">(</span><span class="n">col_white</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="n">wheel_thickness</span><span class="p">);</span>
            <span class="k">const</span> <span class="kt">int</span> <span class="n">vert_end_idx</span> <span class="o">=</span> <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">VtxBuffer</span><span class="p">.</span><span class="n">Size</span><span class="p">;</span>

            <span class="c1">// Paint colors over existing vertices</span>
            <span class="n">ImVec2</span> <span class="nf">gradient_p0</span><span class="p">(</span><span class="n">wheel_center</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">ImCos</span><span class="p">(</span><span class="n">a0</span><span class="p">)</span> <span class="o">*</span> <span class="n">wheel_r_inner</span><span class="p">,</span> <span class="n">wheel_center</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ImSin</span><span class="p">(</span><span class="n">a0</span><span class="p">)</span> <span class="o">*</span> <span class="n">wheel_r_inner</span><span class="p">);</span>
            <span class="n">ImVec2</span> <span class="nf">gradient_p1</span><span class="p">(</span><span class="n">wheel_center</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">ImCos</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span> <span class="o">*</span> <span class="n">wheel_r_inner</span><span class="p">,</span> <span class="n">wheel_center</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ImSin</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span> <span class="o">*</span> <span class="n">wheel_r_inner</span><span class="p">);</span>
            <span class="n">ShadeVertsLinearColorGradientKeepAlpha</span><span class="p">(</span><span class="n">draw_list</span><span class="p">,</span> <span class="n">vert_start_idx</span><span class="p">,</span> <span class="n">vert_end_idx</span><span class="p">,</span> <span class="n">gradient_p0</span><span class="p">,</span> <span class="n">gradient_p1</span><span class="p">,</span> <span class="n">col_hues</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">col_hues</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="c1">// Render Cursor + preview on Hue Wheel</span>
        <span class="kt">float</span> <span class="n">cos_hue_angle</span> <span class="o">=</span> <span class="n">ImCos</span><span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="mf">2.0f</span> <span class="o">*</span> <span class="n">IM_PI</span><span class="p">);</span>
        <span class="kt">float</span> <span class="n">sin_hue_angle</span> <span class="o">=</span> <span class="n">ImSin</span><span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="mf">2.0f</span> <span class="o">*</span> <span class="n">IM_PI</span><span class="p">);</span>
        <span class="n">ImVec2</span> <span class="nf">hue_cursor_pos</span><span class="p">(</span><span class="n">wheel_center</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">cos_hue_angle</span> <span class="o">*</span> <span class="p">(</span><span class="n">wheel_r_inner</span> <span class="o">+</span> <span class="n">wheel_r_outer</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="n">wheel_center</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">sin_hue_angle</span> <span class="o">*</span> <span class="p">(</span><span class="n">wheel_r_inner</span> <span class="o">+</span> <span class="n">wheel_r_outer</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">);</span>
        <span class="kt">float</span> <span class="n">hue_cursor_rad</span> <span class="o">=</span> <span class="n">value_changed_h</span> <span class="o">?</span> <span class="n">wheel_thickness</span> <span class="o">*</span> <span class="mf">0.65f</span> <span class="o">:</span> <span class="n">wheel_thickness</span> <span class="o">*</span> <span class="mf">0.55f</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">hue_cursor_segments</span> <span class="o">=</span> <span class="n">ImClamp</span><span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">hue_cursor_rad</span> <span class="o">/</span> <span class="mf">1.4f</span><span class="p">),</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddCircleFilled</span><span class="p">(</span><span class="n">hue_cursor_pos</span><span class="p">,</span> <span class="n">hue_cursor_rad</span><span class="p">,</span> <span class="n">hue_color32</span><span class="p">,</span> <span class="n">hue_cursor_segments</span><span class="p">);</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddCircle</span><span class="p">(</span><span class="n">hue_cursor_pos</span><span class="p">,</span> <span class="n">hue_cursor_rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">col_midgrey</span><span class="p">,</span> <span class="n">hue_cursor_segments</span><span class="p">);</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddCircle</span><span class="p">(</span><span class="n">hue_cursor_pos</span><span class="p">,</span> <span class="n">hue_cursor_rad</span><span class="p">,</span> <span class="n">col_white</span><span class="p">,</span> <span class="n">hue_cursor_segments</span><span class="p">);</span>

        <span class="c1">// Render SV triangle (rotated according to hue)</span>
        <span class="n">ImVec2</span> <span class="n">tra</span> <span class="o">=</span> <span class="n">wheel_center</span> <span class="o">+</span> <span class="n">ImRotate</span><span class="p">(</span><span class="n">triangle_pa</span><span class="p">,</span> <span class="n">cos_hue_angle</span><span class="p">,</span> <span class="n">sin_hue_angle</span><span class="p">);</span>
        <span class="n">ImVec2</span> <span class="n">trb</span> <span class="o">=</span> <span class="n">wheel_center</span> <span class="o">+</span> <span class="n">ImRotate</span><span class="p">(</span><span class="n">triangle_pb</span><span class="p">,</span> <span class="n">cos_hue_angle</span><span class="p">,</span> <span class="n">sin_hue_angle</span><span class="p">);</span>
        <span class="n">ImVec2</span> <span class="n">trc</span> <span class="o">=</span> <span class="n">wheel_center</span> <span class="o">+</span> <span class="n">ImRotate</span><span class="p">(</span><span class="n">triangle_pc</span><span class="p">,</span> <span class="n">cos_hue_angle</span><span class="p">,</span> <span class="n">sin_hue_angle</span><span class="p">);</span>
        <span class="n">ImVec2</span> <span class="n">uv_white</span> <span class="o">=</span> <span class="n">GetFontTexUvWhitePixel</span><span class="p">();</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PrimReserve</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PrimVtx</span><span class="p">(</span><span class="n">tra</span><span class="p">,</span> <span class="n">uv_white</span><span class="p">,</span> <span class="n">hue_color32</span><span class="p">);</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PrimVtx</span><span class="p">(</span><span class="n">trb</span><span class="p">,</span> <span class="n">uv_white</span><span class="p">,</span> <span class="n">hue_color32</span><span class="p">);</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PrimVtx</span><span class="p">(</span><span class="n">trc</span><span class="p">,</span> <span class="n">uv_white</span><span class="p">,</span> <span class="n">col_white</span><span class="p">);</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PrimVtx</span><span class="p">(</span><span class="n">tra</span><span class="p">,</span> <span class="n">uv_white</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PrimVtx</span><span class="p">(</span><span class="n">trb</span><span class="p">,</span> <span class="n">uv_white</span><span class="p">,</span> <span class="n">col_black</span><span class="p">);</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PrimVtx</span><span class="p">(</span><span class="n">trc</span><span class="p">,</span> <span class="n">uv_white</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddTriangle</span><span class="p">(</span><span class="n">tra</span><span class="p">,</span> <span class="n">trb</span><span class="p">,</span> <span class="n">trc</span><span class="p">,</span> <span class="n">col_midgrey</span><span class="p">,</span> <span class="mf">1.5f</span><span class="p">);</span>
        <span class="n">sv_cursor_pos</span> <span class="o">=</span> <span class="n">ImLerp</span><span class="p">(</span><span class="n">ImLerp</span><span class="p">(</span><span class="n">trc</span><span class="p">,</span> <span class="n">tra</span><span class="p">,</span> <span class="n">ImSaturate</span><span class="p">(</span><span class="n">S</span><span class="p">)),</span> <span class="n">trb</span><span class="p">,</span> <span class="n">ImSaturate</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">V</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_PickerHueBar</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Render SV Square</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilledMultiColor</span><span class="p">(</span><span class="n">picker_pos</span><span class="p">,</span> <span class="n">picker_pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">sv_picker_size</span><span class="p">,</span> <span class="n">sv_picker_size</span><span class="p">),</span> <span class="n">col_white</span><span class="p">,</span> <span class="n">hue_color32</span><span class="p">,</span> <span class="n">hue_color32</span><span class="p">,</span> <span class="n">col_white</span><span class="p">);</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilledMultiColor</span><span class="p">(</span><span class="n">picker_pos</span><span class="p">,</span> <span class="n">picker_pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">sv_picker_size</span><span class="p">,</span> <span class="n">sv_picker_size</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">col_black</span><span class="p">,</span> <span class="n">col_black</span><span class="p">);</span>
        <span class="n">RenderFrameBorder</span><span class="p">(</span><span class="n">picker_pos</span><span class="p">,</span> <span class="n">picker_pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">sv_picker_size</span><span class="p">,</span> <span class="n">sv_picker_size</span><span class="p">),</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="n">sv_cursor_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">IM_ROUND</span><span class="p">(</span><span class="n">picker_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">ImSaturate</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>     <span class="o">*</span> <span class="n">sv_picker_size</span><span class="p">),</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">sv_picker_size</span> <span class="o">-</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// Sneakily prevent the circle to stick out too much</span>
        <span class="n">sv_cursor_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">IM_ROUND</span><span class="p">(</span><span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ImSaturate</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">sv_picker_size</span><span class="p">),</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">sv_picker_size</span> <span class="o">-</span> <span class="mi">2</span><span class="p">);</span>

        <span class="c1">// Render Hue Bar</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
            <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilledMultiColor</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">bar0_pos_x</span><span class="p">,</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">sv_picker_size</span> <span class="o">/</span> <span class="mi">6</span><span class="p">)),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">bar0_pos_x</span> <span class="o">+</span> <span class="n">bars_width</span><span class="p">,</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">sv_picker_size</span> <span class="o">/</span> <span class="mi">6</span><span class="p">)),</span> <span class="n">col_hues</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">col_hues</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">col_hues</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">col_hues</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
        <span class="kt">float</span> <span class="n">bar0_line_y</span> <span class="o">=</span> <span class="n">IM_ROUND</span><span class="p">(</span><span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">H</span> <span class="o">*</span> <span class="n">sv_picker_size</span><span class="p">);</span>
        <span class="n">RenderFrameBorder</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">bar0_pos_x</span><span class="p">,</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">bar0_pos_x</span> <span class="o">+</span> <span class="n">bars_width</span><span class="p">,</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">sv_picker_size</span><span class="p">),</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="n">RenderArrowsForVerticalBar</span><span class="p">(</span><span class="n">draw_list</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">bar0_pos_x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bar0_line_y</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">bars_triangles_half_sz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bars_triangles_half_sz</span><span class="p">),</span> <span class="n">bars_width</span> <span class="o">+</span> <span class="mf">2.0f</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">Alpha</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Render cursor/preview circle (clamp S/V within 0..1 range because floating points colors may lead HSV values to be out of range)</span>
    <span class="kt">float</span> <span class="n">sv_cursor_rad</span> <span class="o">=</span> <span class="n">value_changed_sv</span> <span class="o">?</span> <span class="mf">10.0f</span> <span class="o">:</span> <span class="mf">6.0f</span><span class="p">;</span>
    <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddCircleFilled</span><span class="p">(</span><span class="n">sv_cursor_pos</span><span class="p">,</span> <span class="n">sv_cursor_rad</span><span class="p">,</span> <span class="n">user_col32_striped_of_alpha</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
    <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddCircle</span><span class="p">(</span><span class="n">sv_cursor_pos</span><span class="p">,</span> <span class="n">sv_cursor_rad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">col_midgrey</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
    <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddCircle</span><span class="p">(</span><span class="n">sv_cursor_pos</span><span class="p">,</span> <span class="n">sv_cursor_rad</span><span class="p">,</span> <span class="n">col_white</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>

    <span class="c1">// Render alpha bar</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">alpha_bar</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">float</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">ImSaturate</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
        <span class="n">ImRect</span> <span class="nf">bar1_bb</span><span class="p">(</span><span class="n">bar1_pos_x</span><span class="p">,</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">bar1_pos_x</span> <span class="o">+</span> <span class="n">bars_width</span><span class="p">,</span> <span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">sv_picker_size</span><span class="p">);</span>
        <span class="n">RenderColorRectWithAlphaCheckerboard</span><span class="p">(</span><span class="n">draw_list</span><span class="p">,</span> <span class="n">bar1_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bar1_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bar1_bb</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilledMultiColor</span><span class="p">(</span><span class="n">bar1_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bar1_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">user_col32_striped_of_alpha</span><span class="p">,</span> <span class="n">user_col32_striped_of_alpha</span><span class="p">,</span> <span class="n">user_col32_striped_of_alpha</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">IM_COL32_A_MASK</span><span class="p">,</span> <span class="n">user_col32_striped_of_alpha</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">IM_COL32_A_MASK</span><span class="p">);</span>
        <span class="kt">float</span> <span class="n">bar1_line_y</span> <span class="o">=</span> <span class="n">IM_ROUND</span><span class="p">(</span><span class="n">picker_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0f</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">sv_picker_size</span><span class="p">);</span>
        <span class="n">RenderFrameBorder</span><span class="p">(</span><span class="n">bar1_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bar1_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="n">RenderArrowsForVerticalBar</span><span class="p">(</span><span class="n">draw_list</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">bar1_pos_x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bar1_line_y</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">bars_triangles_half_sz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bars_triangles_half_sz</span><span class="p">),</span> <span class="n">bars_width</span> <span class="o">+</span> <span class="mf">2.0f</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">Alpha</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">EndGroup</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">value_changed</span> <span class="o">&amp;&amp;</span> <span class="n">memcmp</span><span class="p">(</span><span class="n">backup_initial_col</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">components</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value_changed</span><span class="p">)</span>
        <span class="n">MarkItemEdited</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemId</span><span class="p">);</span>

    <span class="n">PopID</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// A little color square. Return true when clicked.</span>
<span class="c1">// FIXME: May want to display/ignore the alpha component in the color display? Yet show it in the tooltip.</span>
<span class="c1">// &#39;desc_id&#39; is not called &#39;label&#39; because we don&#39;t display it next to the button, but only in the tooltip.</span>
<span class="c1">// Note that &#39;col&#39; may be encoded in HSV if ImGuiColorEditFlags_InputHSV is set.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ColorButton</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">desc_id</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec4</span><span class="o">&amp;</span> <span class="n">col</span><span class="p">,</span> <span class="n">ImGuiColorEditFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="n">ImVec2</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">desc_id</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">default_size</span> <span class="o">=</span> <span class="n">GetFrameHeight</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">==</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">default_size</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">==</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">default_size</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">size</span><span class="p">);</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">default_size</span><span class="p">)</span> <span class="o">?</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="nl">y</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">hovered</span><span class="p">,</span> <span class="n">held</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">ImGuiColorEditFlags_AlphaPreview</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_AlphaPreviewHalf</span><span class="p">);</span>

    <span class="n">ImVec4</span> <span class="n">col_rgb</span> <span class="o">=</span> <span class="n">col</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_InputHSV</span><span class="p">)</span>
        <span class="n">ColorConvertHSVtoRGB</span><span class="p">(</span><span class="n">col_rgb</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">col_rgb</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">col_rgb</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">col_rgb</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">col_rgb</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">col_rgb</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>

    <span class="n">ImVec4</span> <span class="nf">col_rgb_without_alpha</span><span class="p">(</span><span class="n">col_rgb</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">col_rgb</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">col_rgb</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">grid_step</span> <span class="o">=</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.99f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">rounding</span> <span class="o">=</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">,</span> <span class="n">grid_step</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">);</span>
    <span class="n">ImRect</span> <span class="n">bb_inner</span> <span class="o">=</span> <span class="n">bb</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">off</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoBorder</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">off</span> <span class="o">=</span> <span class="mf">-0.75f</span><span class="p">;</span> <span class="c1">// The border (using Col_FrameBg) tends to look off when color is near-opaque and rounding is enabled. This offset seemed like a good middle ground to reduce those artifacts.</span>
        <span class="n">bb_inner</span><span class="p">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">off</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_AlphaPreviewHalf</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">col_rgb</span><span class="p">.</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mf">1.0f</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">float</span> <span class="n">mid_x</span> <span class="o">=</span> <span class="n">IM_ROUND</span><span class="p">((</span><span class="n">bb_inner</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">bb_inner</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">);</span>
        <span class="n">RenderColorRectWithAlphaCheckerboard</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">bb_inner</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">grid_step</span><span class="p">,</span> <span class="n">bb_inner</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">bb_inner</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">col_rgb</span><span class="p">),</span> <span class="n">grid_step</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="o">-</span><span class="n">grid_step</span> <span class="o">+</span> <span class="n">off</span><span class="p">,</span> <span class="n">off</span><span class="p">),</span> <span class="n">rounding</span><span class="p">,</span> <span class="n">ImDrawCornerFlags_TopRight</span> <span class="o">|</span> <span class="n">ImDrawCornerFlags_BotRight</span><span class="p">);</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">bb_inner</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">mid_x</span><span class="p">,</span> <span class="n">bb_inner</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">col_rgb_without_alpha</span><span class="p">),</span> <span class="n">rounding</span><span class="p">,</span> <span class="n">ImDrawCornerFlags_TopLeft</span> <span class="o">|</span> <span class="n">ImDrawCornerFlags_BotLeft</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// Because GetColorU32() multiplies by the global style Alpha and we don&#39;t want to display a checkerboard if the source code had no alpha</span>
        <span class="n">ImVec4</span> <span class="n">col_source</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_AlphaPreview</span><span class="p">)</span> <span class="o">?</span> <span class="nl">col_rgb</span> <span class="p">:</span> <span class="n">col_rgb_without_alpha</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">col_source</span><span class="p">.</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mf">1.0f</span><span class="p">)</span>
            <span class="n">RenderColorRectWithAlphaCheckerboard</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">bb_inner</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bb_inner</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">col_source</span><span class="p">),</span> <span class="n">grid_step</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">off</span><span class="p">,</span> <span class="n">off</span><span class="p">),</span> <span class="n">rounding</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">bb_inner</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bb_inner</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">col_source</span><span class="p">),</span> <span class="n">rounding</span><span class="p">,</span> <span class="n">ImDrawCornerFlags_All</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">RenderNavHighlight</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoBorder</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FrameBorderSize</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
            <span class="n">RenderFrameBorder</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">rounding</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddRect</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_FrameBg</span><span class="p">),</span> <span class="n">rounding</span><span class="p">);</span> <span class="c1">// Color button are often in need of some sort of border</span>
    <span class="p">}</span>

    <span class="c1">// Drag and Drop Source</span>
    <span class="c1">// NB: The ActiveId test is merely an optional micro-optimization, BeginDragDropSource() does the same test.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoDragDrop</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">BeginDragDropSource</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">)</span>
            <span class="n">SetDragDropPayload</span><span class="p">(</span><span class="n">IMGUI_PAYLOAD_TYPE_COLOR_3F</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">col_rgb</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ImGuiCond_Once</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="n">SetDragDropPayload</span><span class="p">(</span><span class="n">IMGUI_PAYLOAD_TYPE_COLOR_4F</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">col_rgb</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">ImGuiCond_Once</span><span class="p">);</span>
        <span class="n">ColorButton</span><span class="p">(</span><span class="n">desc_id</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
        <span class="n">SameLine</span><span class="p">();</span>
        <span class="n">TextEx</span><span class="p">(</span><span class="s">&quot;Color&quot;</span><span class="p">);</span>
        <span class="n">EndDragDropSource</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Tooltip</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoTooltip</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">hovered</span><span class="p">)</span>
        <span class="n">ColorTooltip</span><span class="p">(</span><span class="n">desc_id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">col</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiColorEditFlags__InputMask</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_AlphaPreview</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_AlphaPreviewHalf</span><span class="p">));</span>

    <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Initialize/override default color options</span>
<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SetColorEditOptions</span><span class="p">(</span><span class="n">ImGuiColorEditFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DisplayMask</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiColorEditFlags__OptionsDefault</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DisplayMask</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DataTypeMask</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiColorEditFlags__OptionsDefault</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DataTypeMask</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__PickerMask</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiColorEditFlags__OptionsDefault</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__PickerMask</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__InputMask</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiColorEditFlags__OptionsDefault</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__InputMask</span><span class="p">;</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">ImIsPowerOfTwo</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DisplayMask</span><span class="p">));</span>    <span class="c1">// Check only 1 option is selected</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">ImIsPowerOfTwo</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DataTypeMask</span><span class="p">));</span>   <span class="c1">// Check only 1 option is selected</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">ImIsPowerOfTwo</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__PickerMask</span><span class="p">));</span>     <span class="c1">// Check only 1 option is selected</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">ImIsPowerOfTwo</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__InputMask</span><span class="p">));</span>      <span class="c1">// Check only 1 option is selected</span>
    <span class="n">g</span><span class="p">.</span><span class="n">ColorEditOptions</span> <span class="o">=</span> <span class="n">flags</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Note: only access 3 floats if ImGuiColorEditFlags_NoAlpha flag is set.</span>
<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ColorTooltip</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="n">col</span><span class="p">,</span> <span class="n">ImGuiColorEditFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>

    <span class="n">BeginTooltipEx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ImGuiTooltipFlags_OverridePreviousTooltip</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text_end</span> <span class="o">=</span> <span class="n">text</span> <span class="o">?</span> <span class="n">FindRenderedTextEnd</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">:</span> <span class="n">text</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">text_end</span> <span class="o">&gt;</span> <span class="n">text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">TextEx</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">text_end</span><span class="p">);</span>
        <span class="n">Separator</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">ImVec2</span> <span class="n">sz</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">ImVec4</span> <span class="nf">cf</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">)</span> <span class="o">?</span> <span class="mf">1.0f</span> <span class="o">:</span> <span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
    <span class="kt">int</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">IM_F32_TO_INT8_SAT</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">cg</span> <span class="o">=</span> <span class="n">IM_F32_TO_INT8_SAT</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">IM_F32_TO_INT8_SAT</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">ca</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">)</span> <span class="o">?</span> <span class="mi">255</span> <span class="o">:</span> <span class="n">IM_F32_TO_INT8_SAT</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
    <span class="n">ColorButton</span><span class="p">(</span><span class="s">&quot;##preview&quot;</span><span class="p">,</span> <span class="n">cf</span><span class="p">,</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiColorEditFlags__InputMask</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_AlphaPreview</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_AlphaPreviewHalf</span><span class="p">))</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoTooltip</span><span class="p">,</span> <span class="n">sz</span><span class="p">);</span>
    <span class="n">SameLine</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_InputRGB</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__InputMask</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">)</span>
            <span class="n">Text</span><span class="p">(</span><span class="s">&quot;#%02X%02X%02X</span><span class="se">\n</span><span class="s">R: %d, G: %d, B: %d</span><span class="se">\n</span><span class="s">(%.3f, %.3f, %.3f)&quot;</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">cg</span><span class="p">,</span> <span class="n">cb</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">cg</span><span class="p">,</span> <span class="n">cb</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="k">else</span>
            <span class="n">Text</span><span class="p">(</span><span class="s">&quot;#%02X%02X%02X%02X</span><span class="se">\n</span><span class="s">R:%d, G:%d, B:%d, A:%d</span><span class="se">\n</span><span class="s">(%.3f, %.3f, %.3f, %.3f)&quot;</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">cg</span><span class="p">,</span> <span class="n">cb</span><span class="p">,</span> <span class="n">ca</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">cg</span><span class="p">,</span> <span class="n">cb</span><span class="p">,</span> <span class="n">ca</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_InputHSV</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">)</span>
            <span class="n">Text</span><span class="p">(</span><span class="s">&quot;H: %.3f, S: %.3f, V: %.3f&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="k">else</span>
            <span class="n">Text</span><span class="p">(</span><span class="s">&quot;H: %.3f, S: %.3f, V: %.3f, A: %.3f&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">EndTooltip</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ColorEditOptionsPopup</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="n">col</span><span class="p">,</span> <span class="n">ImGuiColorEditFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">bool</span> <span class="n">allow_opt_inputs</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DisplayMask</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">allow_opt_datatype</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__DataTypeMask</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="n">allow_opt_inputs</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">allow_opt_datatype</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">BeginPopup</span><span class="p">(</span><span class="s">&quot;context&quot;</span><span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiColorEditFlags</span> <span class="n">opts</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">ColorEditOptions</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">allow_opt_inputs</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">RadioButton</span><span class="p">(</span><span class="s">&quot;RGB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">opts</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_DisplayRGB</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="n">opts</span> <span class="o">=</span> <span class="p">(</span><span class="n">opts</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">ImGuiColorEditFlags__DisplayMask</span><span class="p">)</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_DisplayRGB</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">RadioButton</span><span class="p">(</span><span class="s">&quot;HSV&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">opts</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_DisplayHSV</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="n">opts</span> <span class="o">=</span> <span class="p">(</span><span class="n">opts</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">ImGuiColorEditFlags__DisplayMask</span><span class="p">)</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_DisplayHSV</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">RadioButton</span><span class="p">(</span><span class="s">&quot;Hex&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">opts</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_DisplayHex</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="n">opts</span> <span class="o">=</span> <span class="p">(</span><span class="n">opts</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">ImGuiColorEditFlags__DisplayMask</span><span class="p">)</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_DisplayHex</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">allow_opt_datatype</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">allow_opt_inputs</span><span class="p">)</span> <span class="n">Separator</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">RadioButton</span><span class="p">(</span><span class="s">&quot;0..255&quot;</span><span class="p">,</span>     <span class="p">(</span><span class="n">opts</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_Uint8</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="n">opts</span> <span class="o">=</span> <span class="p">(</span><span class="n">opts</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">ImGuiColorEditFlags__DataTypeMask</span><span class="p">)</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_Uint8</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">RadioButton</span><span class="p">(</span><span class="s">&quot;0.00..1.00&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">opts</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_Float</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="n">opts</span> <span class="o">=</span> <span class="p">(</span><span class="n">opts</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">ImGuiColorEditFlags__DataTypeMask</span><span class="p">)</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_Float</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">allow_opt_inputs</span> <span class="o">||</span> <span class="n">allow_opt_datatype</span><span class="p">)</span>
        <span class="n">Separator</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Button</span><span class="p">(</span><span class="s">&quot;Copy as..&quot;</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
        <span class="n">OpenPopup</span><span class="p">(</span><span class="s">&quot;Copy&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">BeginPopup</span><span class="p">(</span><span class="s">&quot;Copy&quot;</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">IM_F32_TO_INT8_SAT</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">cg</span> <span class="o">=</span> <span class="n">IM_F32_TO_INT8_SAT</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">IM_F32_TO_INT8_SAT</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">ca</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">)</span> <span class="o">?</span> <span class="mi">255</span> <span class="o">:</span> <span class="n">IM_F32_TO_INT8_SAT</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
        <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
        <span class="n">ImFormatString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="s">&quot;(%.3ff, %.3ff, %.3ff, %.3ff)&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">)</span> <span class="o">?</span> <span class="mf">1.0f</span> <span class="o">:</span> <span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Selectable</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
            <span class="n">SetClipboardText</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
        <span class="n">ImFormatString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="s">&quot;(%d,%d,%d,%d)&quot;</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">cg</span><span class="p">,</span> <span class="n">cb</span><span class="p">,</span> <span class="n">ca</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Selectable</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
            <span class="n">SetClipboardText</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
        <span class="n">ImFormatString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="s">&quot;#%02X%02X%02X&quot;</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">cg</span><span class="p">,</span> <span class="n">cb</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Selectable</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
            <span class="n">SetClipboardText</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">ImFormatString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="s">&quot;#%02X%02X%02X%02X&quot;</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">cg</span><span class="p">,</span> <span class="n">cb</span><span class="p">,</span> <span class="n">ca</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Selectable</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
                <span class="n">SetClipboardText</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">EndPopup</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">g</span><span class="p">.</span><span class="n">ColorEditOptions</span> <span class="o">=</span> <span class="n">opts</span><span class="p">;</span>
    <span class="n">EndPopup</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ColorPickerOptionsPopup</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="n">ref_col</span><span class="p">,</span> <span class="n">ImGuiColorEditFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">bool</span> <span class="n">allow_opt_picker</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__PickerMask</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">allow_opt_alpha_bar</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_AlphaBar</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="n">allow_opt_picker</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">allow_opt_alpha_bar</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">BeginPopup</span><span class="p">(</span><span class="s">&quot;context&quot;</span><span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">allow_opt_picker</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ImVec2</span> <span class="nf">picker_size</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">-</span> <span class="p">(</span><span class="n">GetFrameHeight</span><span class="p">()</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="mf">1.0f</span><span class="p">));</span> <span class="c1">// FIXME: Picker size copied from main picker function</span>
        <span class="n">PushItemWidth</span><span class="p">(</span><span class="n">picker_size</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">picker_type</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">picker_type</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">picker_type</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Draw small/thumbnail version of each picker type (over an invisible button for selection)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">picker_type</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">Separator</span><span class="p">();</span>
            <span class="n">PushID</span><span class="p">(</span><span class="n">picker_type</span><span class="p">);</span>
            <span class="n">ImGuiColorEditFlags</span> <span class="n">picker_flags</span> <span class="o">=</span> <span class="n">ImGuiColorEditFlags_NoInputs</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoOptions</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoLabel</span> <span class="o">|</span> <span class="n">ImGuiColorEditFlags_NoSidePreview</span> <span class="o">|</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">picker_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">picker_flags</span> <span class="o">|=</span> <span class="n">ImGuiColorEditFlags_PickerHueBar</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">picker_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">picker_flags</span> <span class="o">|=</span> <span class="n">ImGuiColorEditFlags_PickerHueWheel</span><span class="p">;</span>
            <span class="n">ImVec2</span> <span class="n">backup_pos</span> <span class="o">=</span> <span class="n">GetCursorScreenPos</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Selectable</span><span class="p">(</span><span class="s">&quot;##selectable&quot;</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">picker_size</span><span class="p">))</span> <span class="c1">// By default, Selectable() is closing popup</span>
                <span class="n">g</span><span class="p">.</span><span class="n">ColorEditOptions</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ColorEditOptions</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">ImGuiColorEditFlags__PickerMask</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">picker_flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags__PickerMask</span><span class="p">);</span>
            <span class="n">SetCursorScreenPos</span><span class="p">(</span><span class="n">backup_pos</span><span class="p">);</span>
            <span class="n">ImVec4</span> <span class="n">previewing_ref_col</span><span class="p">;</span>
            <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">previewing_ref_col</span><span class="p">,</span> <span class="n">ref_col</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">picker_flags</span> <span class="o">&amp;</span> <span class="n">ImGuiColorEditFlags_NoAlpha</span><span class="p">)</span> <span class="o">?</span> <span class="mi">3</span> <span class="o">:</span> <span class="mi">4</span><span class="p">));</span>
            <span class="n">ColorPicker4</span><span class="p">(</span><span class="s">&quot;##previewing_picker&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">previewing_ref_col</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">picker_flags</span><span class="p">);</span>
            <span class="n">PopID</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="n">PopItemWidth</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">allow_opt_alpha_bar</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">allow_opt_picker</span><span class="p">)</span> <span class="n">Separator</span><span class="p">();</span>
        <span class="n">CheckboxFlags</span><span class="p">(</span><span class="s">&quot;Alpha Bar&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">.</span><span class="n">ColorEditOptions</span><span class="p">,</span> <span class="n">ImGuiColorEditFlags_AlphaBar</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">EndPopup</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: TreeNode, CollapsingHeader, etc.</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - TreeNode()</span>
<span class="c1">// - TreeNodeV()</span>
<span class="c1">// - TreeNodeEx()</span>
<span class="c1">// - TreeNodeExV()</span>
<span class="c1">// - TreeNodeBehavior() [Internal]</span>
<span class="c1">// - TreePush()</span>
<span class="c1">// - TreePop()</span>
<span class="c1">// - GetTreeNodeToLabelSpacing()</span>
<span class="c1">// - SetNextItemOpen()</span>
<span class="c1">// - CollapsingHeader()</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreeNode</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str_id</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
    <span class="kt">va_list</span> <span class="n">args</span><span class="p">;</span>
    <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">is_open</span> <span class="o">=</span> <span class="n">TreeNodeExV</span><span class="p">(</span><span class="n">str_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">is_open</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreeNode</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">ptr_id</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
    <span class="kt">va_list</span> <span class="n">args</span><span class="p">;</span>
    <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">is_open</span> <span class="o">=</span> <span class="n">TreeNodeExV</span><span class="p">(</span><span class="n">ptr_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">is_open</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreeNode</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">TreeNodeBehavior</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreeNodeV</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str_id</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="kt">va_list</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">TreeNodeExV</span><span class="p">(</span><span class="n">str_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreeNodeV</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">ptr_id</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="kt">va_list</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">TreeNodeExV</span><span class="p">(</span><span class="n">ptr_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreeNodeEx</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">ImGuiTreeNodeFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">TreeNodeBehavior</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">flags</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreeNodeEx</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str_id</span><span class="p">,</span> <span class="n">ImGuiTreeNodeFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
    <span class="kt">va_list</span> <span class="n">args</span><span class="p">;</span>
    <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">is_open</span> <span class="o">=</span> <span class="n">TreeNodeExV</span><span class="p">(</span><span class="n">str_id</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">is_open</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreeNodeEx</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">ptr_id</span><span class="p">,</span> <span class="n">ImGuiTreeNodeFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
    <span class="kt">va_list</span> <span class="n">args</span><span class="p">;</span>
    <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">is_open</span> <span class="o">=</span> <span class="n">TreeNodeExV</span><span class="p">(</span><span class="n">ptr_id</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">is_open</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreeNodeExV</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str_id</span><span class="p">,</span> <span class="n">ImGuiTreeNodeFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="kt">va_list</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label_end</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span> <span class="o">+</span> <span class="n">ImFormatStringV</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">TreeNodeBehavior</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">str_id</span><span class="p">),</span> <span class="n">flags</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">,</span> <span class="n">label_end</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreeNodeExV</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">ptr_id</span><span class="p">,</span> <span class="n">ImGuiTreeNodeFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="kt">va_list</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label_end</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span> <span class="o">+</span> <span class="n">ImFormatStringV</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">TreeNodeBehavior</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">ptr_id</span><span class="p">),</span> <span class="n">flags</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">TempBuffer</span><span class="p">,</span> <span class="n">label_end</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreeNodeBehaviorIsOpen</span><span class="p">(</span><span class="n">ImGuiID</span> <span class="n">id</span><span class="p">,</span> <span class="n">ImGuiTreeNodeFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_Leaf</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>

    <span class="c1">// We only write to the tree storage if the user clicks (or explicitly use the SetNextItemOpen function)</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="n">ImGuiStorage</span><span class="o">*</span> <span class="n">storage</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">StateStorage</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">is_open</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NextItemData</span><span class="p">.</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiNextItemDataFlags_HasOpen</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NextItemData</span><span class="p">.</span><span class="n">OpenCond</span> <span class="o">&amp;</span> <span class="n">ImGuiCond_Always</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">is_open</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">NextItemData</span><span class="p">.</span><span class="n">OpenVal</span><span class="p">;</span>
            <span class="n">storage</span><span class="o">-&gt;</span><span class="n">SetInt</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">is_open</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="c1">// We treat ImGuiCond_Once and ImGuiCond_FirstUseEver the same because tree node state are not saved persistently.</span>
            <span class="k">const</span> <span class="kt">int</span> <span class="n">stored_value</span> <span class="o">=</span> <span class="n">storage</span><span class="o">-&gt;</span><span class="n">GetInt</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">stored_value</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">is_open</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">NextItemData</span><span class="p">.</span><span class="n">OpenVal</span><span class="p">;</span>
                <span class="n">storage</span><span class="o">-&gt;</span><span class="n">SetInt</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">is_open</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">is_open</span> <span class="o">=</span> <span class="n">stored_value</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">is_open</span> <span class="o">=</span> <span class="n">storage</span><span class="o">-&gt;</span><span class="n">GetInt</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_DefaultOpen</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// When logging is enabled, we automatically expand tree nodes (but *NOT* collapsing headers.. seems like sensible behavior).</span>
    <span class="c1">// NB- If we are above max depth we still allow manually opened nodes to be logged.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">LogEnabled</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_NoAutoOpenOnLog</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">TreeDepth</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">LogDepthRef</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">LogDepthToExpand</span><span class="p">)</span>
        <span class="n">is_open</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">is_open</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreeNodeBehavior</span><span class="p">(</span><span class="n">ImGuiID</span> <span class="n">id</span><span class="p">,</span> <span class="n">ImGuiTreeNodeFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label_end</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">display_frame</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_Framed</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">padding</span> <span class="o">=</span> <span class="p">(</span><span class="n">display_frame</span> <span class="o">||</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_FramePadding</span><span class="p">))</span> <span class="o">?</span> <span class="n">style</span><span class="p">.</span><span class="nl">FramePadding</span> <span class="p">:</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineTextBaseOffset</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">label_end</span><span class="p">)</span>
        <span class="n">label_end</span> <span class="o">=</span> <span class="n">FindRenderedTextEnd</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">label_end</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

    <span class="c1">// We vertically grow up to current line height up the typical widget height.</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">frame_height</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">ImMin</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineSize</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span> <span class="n">label_size</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">padding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">ImRect</span> <span class="n">frame_bb</span><span class="p">;</span>
    <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_SpanFullWidth</span><span class="p">)</span> <span class="o">?</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WorkRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WorkRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">frame_height</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">display_frame</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Framed header expand a little outside the default padding, to the edge of InnerClipRect</span>
        <span class="c1">// (FIXME: May remove this at some point and make InnerClipRect align with WindowPadding.x instead of WindowPadding.x*0.5f)</span>
        <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowPadding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.5f</span> <span class="o">-</span> <span class="mf">1.0f</span><span class="p">);</span>
        <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowPadding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="kt">float</span> <span class="n">text_offset_x</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="p">(</span><span class="n">display_frame</span> <span class="o">?</span> <span class="n">padding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">:</span> <span class="n">padding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>           <span class="c1">// Collapser arrow width + Spacing</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">text_offset_y</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">padding</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineTextBaseOffset</span><span class="p">);</span>                    <span class="c1">// Latch before ItemSize changes it</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">text_width</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">padding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">:</span> <span class="mf">0.0f</span><span class="p">);</span>  <span class="c1">// Include collapser</span>
    <span class="n">ImVec2</span> <span class="nf">text_pos</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">text_offset_x</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">text_offset_y</span><span class="p">);</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">text_width</span><span class="p">,</span> <span class="n">frame_height</span><span class="p">),</span> <span class="n">padding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>

    <span class="c1">// For regular tree nodes, we arbitrary allow to click past 2 worth of ItemSpacing</span>
    <span class="n">ImRect</span> <span class="n">interact_bb</span> <span class="o">=</span> <span class="n">frame_bb</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">display_frame</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiTreeNodeFlags_SpanAvailWidth</span> <span class="o">|</span> <span class="n">ImGuiTreeNodeFlags_SpanFullWidth</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">interact_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">text_width</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">;</span>

    <span class="c1">// Store a flag for the current depth to tell if we will allow closing this node when navigating one of its child.</span>
    <span class="c1">// For this purpose we essentially compare if g.NavIdIsAlive went from 0 to 1 between TreeNode() and TreePop().</span>
    <span class="c1">// This is currently only support 32 level deep and we are fine with (1 &lt;&lt; Depth) overflowing into a zero.</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_leaf</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_Leaf</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">is_open</span> <span class="o">=</span> <span class="n">TreeNodeBehaviorIsOpen</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_open</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">NavIdIsAlive</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_NavLeftJumpsBackHere</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_NoTreePushOnOpen</span><span class="p">))</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">TreeJumpToParentOnPopMask</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">TreeDepth</span><span class="p">);</span>

    <span class="kt">bool</span> <span class="n">item_add</span> <span class="o">=</span> <span class="n">ItemAdd</span><span class="p">(</span><span class="n">interact_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemStatusFlags</span> <span class="o">|=</span> <span class="n">ImGuiItemStatusFlags_HasDisplayRect</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemDisplayRect</span> <span class="o">=</span> <span class="n">frame_bb</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">item_add</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">is_open</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_NoTreePushOnOpen</span><span class="p">))</span>
            <span class="n">TreePushOverrideID</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
        <span class="n">IMGUI_TEST_ENGINE_ITEM_INFO</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemId</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">|</span> <span class="p">(</span><span class="n">is_leaf</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">ImGuiItemStatusFlags_Openable</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">is_open</span> <span class="o">?</span> <span class="nl">ImGuiItemStatusFlags_Opened</span> <span class="p">:</span> <span class="mi">0</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">is_open</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">ImGuiButtonFlags</span> <span class="n">button_flags</span> <span class="o">=</span> <span class="n">ImGuiTreeNodeFlags_None</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_AllowItemOverlap</span><span class="p">)</span>
        <span class="n">button_flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_AllowItemOverlap</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_leaf</span><span class="p">)</span>
        <span class="n">button_flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_PressedOnDragDropHold</span><span class="p">;</span>

    <span class="c1">// We allow clicking on the arrow section with keyboard modifiers held, in order to easily</span>
    <span class="c1">// allow browsing a tree while preserving selection with code implementing multi-selection patterns.</span>
    <span class="c1">// When clicking on the rest of the tree node we always disallow keyboard modifiers.</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">arrow_hit_x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">text_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">text_offset_x</span><span class="p">)</span> <span class="o">-</span> <span class="n">style</span><span class="p">.</span><span class="n">TouchExtraPadding</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">arrow_hit_x2</span> <span class="o">=</span> <span class="p">(</span><span class="n">text_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">text_offset_x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="n">padding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">)</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">TouchExtraPadding</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_mouse_x_over_arrow</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">arrow_hit_x1</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">arrow_hit_x2</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span> <span class="o">!=</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredWindow</span> <span class="o">||</span> <span class="o">!</span><span class="n">is_mouse_x_over_arrow</span><span class="p">)</span>
        <span class="n">button_flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_NoKeyModifiers</span><span class="p">;</span>

    <span class="c1">// Open behaviors can be altered with the _OpenOnArrow and _OnOnDoubleClick flags.</span>
    <span class="c1">// Some alteration have subtle effects (e.g. toggle on MouseUp vs MouseDown events) due to requirements for multi-selection and drag and drop support.</span>
    <span class="c1">// - Single-click on label = Toggle on MouseUp (default, when _OpenOnArrow=0)</span>
    <span class="c1">// - Single-click on arrow = Toggle on MouseDown (when _OpenOnArrow=0)</span>
    <span class="c1">// - Single-click on arrow = Toggle on MouseDown (when _OpenOnArrow=1)</span>
    <span class="c1">// - Double-click on label = Toggle on MouseDoubleClick (when _OpenOnDoubleClick=1)</span>
    <span class="c1">// - Double-click on arrow = Toggle on MouseDoubleClick (when _OpenOnDoubleClick=1 and _OpenOnArrow=0)</span>
    <span class="c1">// It is rather standard that arrow click react on Down rather than Up.</span>
    <span class="c1">// We set ImGuiButtonFlags_PressedOnClickRelease on OpenOnDoubleClick because we want the item to be active on the initial MouseDown in order for drag and drop to work.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_mouse_x_over_arrow</span><span class="p">)</span>
        <span class="n">button_flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_PressedOnClick</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_OpenOnDoubleClick</span><span class="p">)</span>
        <span class="n">button_flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_PressedOnClickRelease</span> <span class="o">|</span> <span class="n">ImGuiButtonFlags_PressedOnDoubleClick</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="n">button_flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_PressedOnClickRelease</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">selected</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_Selected</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">was_selected</span> <span class="o">=</span> <span class="n">selected</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">hovered</span><span class="p">,</span> <span class="n">held</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">interact_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">,</span> <span class="n">button_flags</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">toggled</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_leaf</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pressed</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">DragDropHoldJustPressedId</span> <span class="o">!=</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiTreeNodeFlags_OpenOnArrow</span> <span class="o">|</span> <span class="n">ImGuiTreeNodeFlags_OpenOnDoubleClick</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavActivateId</span> <span class="o">==</span> <span class="n">id</span><span class="p">))</span>
                <span class="n">toggled</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_OpenOnArrow</span><span class="p">)</span>
                <span class="n">toggled</span> <span class="o">|=</span> <span class="n">is_mouse_x_over_arrow</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">NavDisableMouseHover</span><span class="p">;</span> <span class="c1">// Lightweight equivalent of IsMouseHoveringRect() since ButtonBehavior() already did the job</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_OpenOnDoubleClick</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseDoubleClicked</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">toggled</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pressed</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">DragDropHoldJustPressedId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">button_flags</span> <span class="o">&amp;</span> <span class="n">ImGuiButtonFlags_PressedOnDragDropHold</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_open</span><span class="p">)</span> <span class="c1">// When using Drag and Drop &quot;hold to open&quot; we keep the node highlighted after opening, but never close it again.</span>
                <span class="n">toggled</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavMoveRequest</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavMoveDir</span> <span class="o">==</span> <span class="n">ImGuiDir_Left</span> <span class="o">&amp;&amp;</span> <span class="n">is_open</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">toggled</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="n">NavMoveRequestCancel</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavMoveRequest</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavMoveDir</span> <span class="o">==</span> <span class="n">ImGuiDir_Right</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_open</span><span class="p">)</span> <span class="c1">// If there&#39;s something upcoming on the line we may want to give it the priority?</span>
        <span class="p">{</span>
            <span class="n">toggled</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="n">NavMoveRequestCancel</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">toggled</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">is_open</span> <span class="o">=</span> <span class="o">!</span><span class="n">is_open</span><span class="p">;</span>
            <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">StateStorage</span><span class="o">-&gt;</span><span class="n">SetInt</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">is_open</span><span class="p">);</span>
            <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemStatusFlags</span> <span class="o">|=</span> <span class="n">ImGuiItemStatusFlags_ToggledOpen</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_AllowItemOverlap</span><span class="p">)</span>
        <span class="n">SetItemAllowOverlap</span><span class="p">();</span>

    <span class="c1">// In this branch, TreeNodeBehavior() cannot toggle the selection so this will never trigger.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">selected</span> <span class="o">!=</span> <span class="n">was_selected</span><span class="p">)</span> <span class="c1">//-V547</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemStatusFlags</span> <span class="o">|=</span> <span class="n">ImGuiItemStatusFlags_ToggledSelection</span><span class="p">;</span>

    <span class="c1">// Render</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">text_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_Text</span><span class="p">);</span>
    <span class="n">ImGuiNavHighlightFlags</span> <span class="n">nav_highlight_flags</span> <span class="o">=</span> <span class="n">ImGuiNavHighlightFlags_TypeThin</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">display_frame</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Framed type</span>
        <span class="k">const</span> <span class="n">ImU32</span> <span class="n">bg_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">((</span><span class="n">held</span> <span class="o">&amp;&amp;</span> <span class="n">hovered</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiCol_HeaderActive</span> <span class="p">:</span> <span class="n">hovered</span> <span class="o">?</span> <span class="nl">ImGuiCol_HeaderHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_Header</span><span class="p">);</span>
        <span class="n">RenderFrame</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">bg_col</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">);</span>
        <span class="n">RenderNavHighlight</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">nav_highlight_flags</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_Bullet</span><span class="p">)</span>
            <span class="n">RenderBullet</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">text_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">text_offset_x</span> <span class="o">*</span> <span class="mf">0.60f</span><span class="p">,</span> <span class="n">text_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">),</span> <span class="n">text_col</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_leaf</span><span class="p">)</span>
            <span class="n">RenderArrow</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">text_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">text_offset_x</span> <span class="o">+</span> <span class="n">padding</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">text_pos</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">text_col</span><span class="p">,</span> <span class="n">is_open</span> <span class="o">?</span> <span class="nl">ImGuiDir_Down</span> <span class="p">:</span> <span class="n">ImGuiDir_Right</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
        <span class="k">else</span> <span class="c1">// Leaf without bullet, left-adjusted text</span>
            <span class="n">text_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">text_offset_x</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_ClipLabelForTrailingButton</span><span class="p">)</span>
            <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">LogEnabled</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// NB: &#39;##&#39; is normally used to hide text (as a library-wide feature), so we need to specify the text range to make sure the ## aren&#39;t stripped out here.</span>
            <span class="k">const</span> <span class="kt">char</span> <span class="n">log_prefix</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">##&quot;</span><span class="p">;</span>
            <span class="k">const</span> <span class="kt">char</span> <span class="n">log_suffix</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;##&quot;</span><span class="p">;</span>
            <span class="n">LogRenderedText</span><span class="p">(</span><span class="o">&amp;</span><span class="n">text_pos</span><span class="p">,</span> <span class="n">log_prefix</span><span class="p">,</span> <span class="n">log_prefix</span> <span class="o">+</span> <span class="mi">3</span><span class="p">);</span>
            <span class="n">RenderTextClipped</span><span class="p">(</span><span class="n">text_pos</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">label_end</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">label_size</span><span class="p">);</span>
            <span class="n">LogRenderedText</span><span class="p">(</span><span class="o">&amp;</span><span class="n">text_pos</span><span class="p">,</span> <span class="n">log_suffix</span><span class="p">,</span> <span class="n">log_suffix</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">RenderTextClipped</span><span class="p">(</span><span class="n">text_pos</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">label_end</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">label_size</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// Unframed typed for tree nodes</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">hovered</span> <span class="o">||</span> <span class="n">selected</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="n">ImU32</span> <span class="n">bg_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">((</span><span class="n">held</span> <span class="o">&amp;&amp;</span> <span class="n">hovered</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiCol_HeaderActive</span> <span class="p">:</span> <span class="n">hovered</span> <span class="o">?</span> <span class="nl">ImGuiCol_HeaderHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_Header</span><span class="p">);</span>
            <span class="n">RenderFrame</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">bg_col</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
            <span class="n">RenderNavHighlight</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">nav_highlight_flags</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_Bullet</span><span class="p">)</span>
            <span class="n">RenderBullet</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">text_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">text_offset_x</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="n">text_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">),</span> <span class="n">text_col</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_leaf</span><span class="p">)</span>
            <span class="n">RenderArrow</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">text_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">text_offset_x</span> <span class="o">+</span> <span class="n">padding</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">text_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">0.15f</span><span class="p">),</span> <span class="n">text_col</span><span class="p">,</span> <span class="n">is_open</span> <span class="o">?</span> <span class="nl">ImGuiDir_Down</span> <span class="p">:</span> <span class="n">ImGuiDir_Right</span><span class="p">,</span> <span class="mf">0.70f</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">LogEnabled</span><span class="p">)</span>
            <span class="n">LogRenderedText</span><span class="p">(</span><span class="o">&amp;</span><span class="n">text_pos</span><span class="p">,</span> <span class="s">&quot;&gt;&quot;</span><span class="p">);</span>
        <span class="n">RenderText</span><span class="p">(</span><span class="n">text_pos</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">label_end</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">is_open</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTreeNodeFlags_NoTreePushOnOpen</span><span class="p">))</span>
        <span class="n">TreePushOverrideID</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="n">IMGUI_TEST_ENGINE_ITEM_INFO</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">|</span> <span class="p">(</span><span class="n">is_leaf</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">ImGuiItemStatusFlags_Openable</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">is_open</span> <span class="o">?</span> <span class="nl">ImGuiItemStatusFlags_Opened</span> <span class="p">:</span> <span class="mi">0</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">is_open</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreePush</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str_id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="n">Indent</span><span class="p">();</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">TreeDepth</span><span class="o">++</span><span class="p">;</span>
    <span class="n">PushID</span><span class="p">(</span><span class="n">str_id</span> <span class="o">?</span> <span class="nl">str_id</span> <span class="p">:</span> <span class="s">&quot;#TreePush&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreePush</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">ptr_id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="n">Indent</span><span class="p">();</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">TreeDepth</span><span class="o">++</span><span class="p">;</span>
    <span class="n">PushID</span><span class="p">(</span><span class="n">ptr_id</span> <span class="o">?</span> <span class="nl">ptr_id</span> <span class="p">:</span> <span class="p">(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="s">&quot;#TreePush&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreePushOverrideID</span><span class="p">(</span><span class="n">ImGuiID</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="n">Indent</span><span class="p">();</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">TreeDepth</span><span class="o">++</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">IDStack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TreePop</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="n">Unindent</span><span class="p">();</span>

    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">TreeDepth</span><span class="o">--</span><span class="p">;</span>
    <span class="n">ImU32</span> <span class="n">tree_depth_mask</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">TreeDepth</span><span class="p">);</span>

    <span class="c1">// Handle Left arrow to move to parent tree node (when ImGuiTreeNodeFlags_NavLeftJumpsBackHere is enabled)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavMoveDir</span> <span class="o">==</span> <span class="n">ImGuiDir_Left</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavWindow</span> <span class="o">==</span> <span class="n">window</span> <span class="o">&amp;&amp;</span> <span class="n">NavMoveRequestButNoResultYet</span><span class="p">())</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavIdIsAlive</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">TreeJumpToParentOnPopMask</span> <span class="o">&amp;</span> <span class="n">tree_depth_mask</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">SetNavID</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">IDStack</span><span class="p">.</span><span class="n">back</span><span class="p">(),</span> <span class="n">g</span><span class="p">.</span><span class="n">NavLayer</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="n">NavMoveRequestCancel</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">TreeJumpToParentOnPopMask</span> <span class="o">&amp;=</span> <span class="n">tree_depth_mask</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">IDStack</span><span class="p">.</span><span class="n">Size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// There should always be 1 element in the IDStack (pushed during window creation). If this triggers you called TreePop/PopID too much.</span>
    <span class="n">PopID</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Horizontal distance preceding label when using TreeNode() or Bullet()</span>
<span class="kt">float</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetTreeNodeToLabelSpacing</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Set next TreeNode/CollapsingHeader open state.</span>
<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SetNextItemOpen</span><span class="p">(</span><span class="kt">bool</span> <span class="n">is_open</span><span class="p">,</span> <span class="n">ImGuiCond</span> <span class="n">cond</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="n">g</span><span class="p">.</span><span class="n">NextItemData</span><span class="p">.</span><span class="n">Flags</span> <span class="o">|=</span> <span class="n">ImGuiNextItemDataFlags_HasOpen</span><span class="p">;</span>
    <span class="n">g</span><span class="p">.</span><span class="n">NextItemData</span><span class="p">.</span><span class="n">OpenVal</span> <span class="o">=</span> <span class="n">is_open</span><span class="p">;</span>
    <span class="n">g</span><span class="p">.</span><span class="n">NextItemData</span><span class="p">.</span><span class="n">OpenCond</span> <span class="o">=</span> <span class="n">cond</span> <span class="o">?</span> <span class="nl">cond</span> <span class="p">:</span> <span class="n">ImGuiCond_Always</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// CollapsingHeader returns true when opened but do not indent nor push into the ID stack (because of the ImGuiTreeNodeFlags_NoTreePushOnOpen flag).</span>
<span class="c1">// This is basically the same as calling TreeNodeEx(label, ImGuiTreeNodeFlags_CollapsingHeader). You can remove the _NoTreePushOnOpen flag if you want behavior closer to normal TreeNode().</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">CollapsingHeader</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">ImGuiTreeNodeFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">TreeNodeBehavior</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">ImGuiTreeNodeFlags_CollapsingHeader</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">CollapsingHeader</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">bool</span><span class="o">*</span> <span class="n">p_open</span><span class="p">,</span> <span class="n">ImGuiTreeNodeFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">p_open</span> <span class="o">&amp;&amp;</span> <span class="o">!*</span><span class="n">p_open</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiTreeNodeFlags_CollapsingHeader</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p_open</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiTreeNodeFlags_AllowItemOverlap</span> <span class="o">|</span> <span class="n">ImGuiTreeNodeFlags_ClipLabelForTrailingButton</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">is_open</span> <span class="o">=</span> <span class="n">TreeNodeBehavior</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p_open</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Create a small overlapping close button</span>
        <span class="c1">// FIXME: We can evolve this into user accessible helpers to add extra buttons on title bars, headers, etc.</span>
        <span class="c1">// FIXME: CloseButton can overlap into text, need find a way to clip the text somehow.</span>
        <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
        <span class="n">ImGuiLastItemDataBackup</span> <span class="n">last_item_backup</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">button_size</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">button_x</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">2.0f</span> <span class="o">-</span> <span class="n">button_size</span><span class="p">);</span>
        <span class="kt">float</span> <span class="n">button_y</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
        <span class="n">ImGuiID</span> <span class="n">close_button_id</span> <span class="o">=</span> <span class="n">GetIDWithSeed</span><span class="p">(</span><span class="s">&quot;#CLOSE&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">CloseButton</span><span class="p">(</span><span class="n">close_button_id</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">button_x</span><span class="p">,</span> <span class="n">button_y</span><span class="p">)))</span>
            <span class="o">*</span><span class="n">p_open</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="n">last_item_backup</span><span class="p">.</span><span class="n">Restore</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">is_open</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: Selectable</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - Selectable()</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="c1">// Tip: pass a non-visible label (e.g. &quot;##hello&quot;) then you can use the space to draw other text or image.</span>
<span class="c1">// But you need to make sure the ID is unique, e.g. enclose calls in PushID/PopID or use ##unique_id.</span>
<span class="c1">// With this scheme, ImGuiSelectableFlags_SpanAllColumns and ImGuiSelectableFlags_AllowItemOverlap are also frequently used flags.</span>
<span class="c1">// FIXME: Selectable() with (size.x == 0.0f) and (SelectableTextAlign.x &gt; 0.0f) followed by SameLine() is currently not supported.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">Selectable</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">selected</span><span class="p">,</span> <span class="n">ImGuiSelectableFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size_arg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>

    <span class="c1">// Submit label or explicit size to ItemSize(), whereas ItemAdd() will submit a larger/spanning rectangle.</span>
    <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="n">ImVec2</span> <span class="nf">size</span><span class="p">(</span><span class="n">size_arg</span><span class="p">.</span><span class="n">x</span> <span class="o">!=</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="n">size_arg</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="n">label_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">size_arg</span><span class="p">.</span><span class="n">y</span> <span class="o">!=</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="n">size_arg</span><span class="p">.</span><span class="nl">y</span> <span class="p">:</span> <span class="n">label_size</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">ImVec2</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">;</span>
    <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineTextBaseOffset</span><span class="p">;</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>

    <span class="c1">// Fill horizontal space</span>
    <span class="c1">// We don&#39;t support (size &lt; 0.0f) in Selectable() because the ItemSpacing extension would make explicitely right-aligned sizes not visibly match other widgets.</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">span_all_columns</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_SpanAllColumns</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">min_x</span> <span class="o">=</span> <span class="n">span_all_columns</span> <span class="o">?</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ParentWorkRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">max_x</span> <span class="o">=</span> <span class="n">span_all_columns</span> <span class="o">?</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ParentWorkRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WorkRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">size_arg</span><span class="p">.</span><span class="n">x</span> <span class="o">==</span> <span class="mf">0.0f</span> <span class="o">||</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_SpanAvailWidth</span><span class="p">))</span>
        <span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span><span class="p">);</span>

    <span class="c1">// Text stays at the submission position, but bounding box may be extended on both sides</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">text_min</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="nf">text_max</span><span class="p">(</span><span class="n">min_x</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>

    <span class="c1">// Selectables are meant to be tightly packed together with no click-gap, so we extend their box to cover spacing between selectable.</span>
    <span class="n">ImRect</span> <span class="nf">bb</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">text_max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">text_max</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_NoPadWithHalfSpacing</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">spacing_x</span> <span class="o">=</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">spacing_y</span> <span class="o">=</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">spacing_L</span> <span class="o">=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">spacing_x</span> <span class="o">*</span> <span class="mf">0.50f</span><span class="p">);</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">spacing_U</span> <span class="o">=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">spacing_y</span> <span class="o">*</span> <span class="mf">0.50f</span><span class="p">);</span>
        <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">spacing_L</span><span class="p">;</span>
        <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">-=</span> <span class="n">spacing_U</span><span class="p">;</span>
        <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="p">(</span><span class="n">spacing_x</span> <span class="o">-</span> <span class="n">spacing_L</span><span class="p">);</span>
        <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="p">(</span><span class="n">spacing_y</span> <span class="o">-</span> <span class="n">spacing_U</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">//if (g.IO.KeyCtrl) { GetForegroundDrawList()-&gt;AddRect(bb.Min, bb.Max, IM_COL32(0, 255, 0, 255)); }</span>

    <span class="c1">// Modify ClipRect for the ItemAdd(), faster than doing a PushColumnsBackground/PushTableBackground for every Selectable..</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">backup_clip_rect_min_x</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">backup_clip_rect_max_x</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">span_all_columns</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ParentWorkRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ParentWorkRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="n">item_add</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_Disabled</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ImGuiItemFlags</span> <span class="n">backup_item_flags</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span><span class="p">;</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">|=</span> <span class="n">ImGuiItemFlags_Disabled</span> <span class="o">|</span> <span class="n">ImGuiItemFlags_NoNavDefaultFocus</span><span class="p">;</span>
        <span class="n">item_add</span> <span class="o">=</span> <span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">=</span> <span class="n">backup_item_flags</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">item_add</span> <span class="o">=</span> <span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">span_all_columns</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">backup_clip_rect_min_x</span><span class="p">;</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">backup_clip_rect_max_x</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">item_add</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// FIXME: We can standardize the behavior of those two, we could also keep the fast path of override ClipRect + full push on render only,</span>
    <span class="c1">// which would be advantageous since most selectable are not selected.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">span_all_columns</span> <span class="o">&amp;&amp;</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span><span class="p">)</span>
        <span class="n">PushColumnsBackground</span><span class="p">();</span>

    <span class="c1">// We use NoHoldingActiveID on menus so user can click and _hold_ on a menu then drag to browse child entries</span>
    <span class="n">ImGuiButtonFlags</span> <span class="n">button_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_NoHoldingActiveID</span><span class="p">)</span> <span class="p">{</span> <span class="n">button_flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_NoHoldingActiveId</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_SelectOnClick</span><span class="p">)</span>     <span class="p">{</span> <span class="n">button_flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_PressedOnClick</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_SelectOnRelease</span><span class="p">)</span>   <span class="p">{</span> <span class="n">button_flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_PressedOnRelease</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_Disabled</span><span class="p">)</span>          <span class="p">{</span> <span class="n">button_flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_Disabled</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_AllowDoubleClick</span><span class="p">)</span>  <span class="p">{</span> <span class="n">button_flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_PressedOnClickRelease</span> <span class="o">|</span> <span class="n">ImGuiButtonFlags_PressedOnDoubleClick</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_AllowItemOverlap</span><span class="p">)</span>  <span class="p">{</span> <span class="n">button_flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_AllowItemOverlap</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_Disabled</span><span class="p">)</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">bool</span> <span class="n">was_selected</span> <span class="o">=</span> <span class="n">selected</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">hovered</span><span class="p">,</span> <span class="n">held</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">,</span> <span class="n">button_flags</span><span class="p">);</span>

    <span class="c1">// Update NavId when clicking or when Hovering (this doesn&#39;t happen on most widgets), so navigation can be resumed with gamepad/keyboard</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pressed</span> <span class="o">||</span> <span class="p">(</span><span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_SetNavIdOnHover</span><span class="p">)))</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">NavDisableMouseHover</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavWindow</span> <span class="o">==</span> <span class="n">window</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavLayer</span> <span class="o">==</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">NavLayerCurrent</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">g</span><span class="p">.</span><span class="n">NavDisableHighlight</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="n">SetNavID</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">NavLayerCurrent</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">NavFocusScopeIdCurrent</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pressed</span><span class="p">)</span>
        <span class="n">MarkItemEdited</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_AllowItemOverlap</span><span class="p">)</span>
        <span class="n">SetItemAllowOverlap</span><span class="p">();</span>

    <span class="c1">// In this branch, Selectable() cannot toggle the selection so this will never trigger.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">selected</span> <span class="o">!=</span> <span class="n">was_selected</span><span class="p">)</span> <span class="c1">//-V547</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemStatusFlags</span> <span class="o">|=</span> <span class="n">ImGuiItemStatusFlags_ToggledSelection</span><span class="p">;</span>

    <span class="c1">// Render</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">held</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_DrawHoveredWhenHeld</span><span class="p">))</span>
        <span class="n">hovered</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">hovered</span> <span class="o">||</span> <span class="n">selected</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="n">ImU32</span> <span class="n">col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">((</span><span class="n">held</span> <span class="o">&amp;&amp;</span> <span class="n">hovered</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiCol_HeaderActive</span> <span class="p">:</span> <span class="n">hovered</span> <span class="o">?</span> <span class="nl">ImGuiCol_HeaderHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_Header</span><span class="p">);</span>
        <span class="n">RenderFrame</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="n">RenderNavHighlight</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">ImGuiNavHighlightFlags_TypeThin</span> <span class="o">|</span> <span class="n">ImGuiNavHighlightFlags_NoRounding</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">span_all_columns</span> <span class="o">&amp;&amp;</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span><span class="p">)</span>
        <span class="n">PopColumnsBackground</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_Disabled</span><span class="p">)</span> <span class="n">PushStyleColor</span><span class="p">(</span><span class="n">ImGuiCol_Text</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">Colors</span><span class="p">[</span><span class="n">ImGuiCol_TextDisabled</span><span class="p">]);</span>
    <span class="n">RenderTextClipped</span><span class="p">(</span><span class="n">text_min</span><span class="p">,</span> <span class="n">text_max</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">label_size</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">SelectableTextAlign</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bb</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_Disabled</span><span class="p">)</span> <span class="n">PopStyleColor</span><span class="p">();</span>

    <span class="c1">// Automatically close popups</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pressed</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiWindowFlags_Popup</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiSelectableFlags_DontClosePopups</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">&amp;</span> <span class="n">ImGuiItemFlags_SelectableDontClosePopup</span><span class="p">))</span>
        <span class="n">CloseCurrentPopup</span><span class="p">();</span>

    <span class="n">IMGUI_TEST_ENGINE_ITEM_INFO</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">Selectable</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">bool</span><span class="o">*</span> <span class="n">p_selected</span><span class="p">,</span> <span class="n">ImGuiSelectableFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size_arg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Selectable</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="o">*</span><span class="n">p_selected</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">size_arg</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="o">*</span><span class="n">p_selected</span> <span class="o">=</span> <span class="o">!*</span><span class="n">p_selected</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: ListBox</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - ListBox()</span>
<span class="c1">// - ListBoxHeader()</span>
<span class="c1">// - ListBoxFooter()</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// FIXME: This is an old API. We should redesign some of it, rename ListBoxHeader-&gt;BeginListBox, ListBoxFooter-&gt;EndListBox</span>
<span class="c1">// and promote using them over existing ListBox() functions, similarly to change with combo boxes.</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="c1">// FIXME: In principle this function should be called BeginListBox(). We should rename it after re-evaluating if we want to keep the same signature.</span>
<span class="c1">// Helper to calculate the size of a listbox and display a label on the right.</span>
<span class="c1">// Tip: To have a list filling the entire window width, PushItemWidth(-1) and pass an non-visible label e.g. &quot;##empty&quot;</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ListBoxHeader</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">size_arg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

    <span class="c1">// Size default to hold ~7 items. Fractional number of items helps seeing that we can scroll down/up without looking at scrollbar.</span>
    <span class="n">ImVec2</span> <span class="n">size</span> <span class="o">=</span> <span class="n">CalcItemSize</span><span class="p">(</span><span class="n">size_arg</span><span class="p">,</span> <span class="n">CalcItemWidth</span><span class="p">(),</span> <span class="n">GetTextLineHeightWithSpacing</span><span class="p">()</span> <span class="o">*</span> <span class="mf">7.4f</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">ImVec2</span> <span class="n">frame_size</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">label_size</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
    <span class="n">ImRect</span> <span class="nf">frame_bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">frame_size</span><span class="p">);</span>
    <span class="n">ImRect</span> <span class="nf">bb</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">label_size</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemRect</span> <span class="o">=</span> <span class="n">bb</span><span class="p">;</span> <span class="c1">// Forward storage for ListBoxFooter.. dodgy.</span>
    <span class="n">g</span><span class="p">.</span><span class="n">NextItemData</span><span class="p">.</span><span class="n">ClearFlags</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IsRectVisible</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">ItemSize</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">GetSize</span><span class="p">(),</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
        <span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">frame_bb</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">BeginGroup</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">RenderText</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">label</span><span class="p">);</span>

    <span class="n">BeginChildFrame</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">GetSize</span><span class="p">());</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// FIXME: In principle this function should be called EndListBox(). We should rename it after re-evaluating if we want to keep the same signature.</span>
<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ListBoxHeader</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span> <span class="n">items_count</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height_in_items</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Size default to hold ~7.25 items.</span>
    <span class="c1">// We add +25% worth of item height to allow the user to see at a glance if there are more items up/down, without looking at the scrollbar.</span>
    <span class="c1">// We don&#39;t add this extra bit if items_count &lt;= height_in_items. It is slightly dodgy, because it means a dynamic list of items will make the widget resize occasionally when it crosses that size.</span>
    <span class="c1">// I am expecting that someone will come and complain about this behavior in a remote future, then we can advise on a better solution.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">height_in_items</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">height_in_items</span> <span class="o">=</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">items_count</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">GetStyle</span><span class="p">();</span>
    <span class="kt">float</span> <span class="n">height_in_items_f</span> <span class="o">=</span> <span class="p">(</span><span class="n">height_in_items</span> <span class="o">&lt;</span> <span class="n">items_count</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="n">height_in_items</span> <span class="o">+</span> <span class="mf">0.25f</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="n">height_in_items</span> <span class="o">+</span> <span class="mf">0.00f</span><span class="p">);</span>

    <span class="c1">// We include ItemSpacing.y so that a list sized for the exact number of items doesn&#39;t make a scrollbar appears. We could also enforce that by passing a flag to BeginChild().</span>
    <span class="n">ImVec2</span> <span class="n">size</span><span class="p">;</span>
    <span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">ImFloor</span><span class="p">(</span><span class="n">GetTextLineHeightWithSpacing</span><span class="p">()</span> <span class="o">*</span> <span class="n">height_in_items_f</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ListBoxHeader</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// FIXME: In principle this function should be called EndListBox(). We should rename it after re-evaluating if we want to keep the same signature.</span>
<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ListBoxFooter</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">parent_window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ParentWindow</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="n">bb</span> <span class="o">=</span> <span class="n">parent_window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemRect</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">GetStyle</span><span class="p">();</span>

    <span class="n">EndChildFrame</span><span class="p">();</span>

    <span class="c1">// Redeclare item size so that it includes the label (we have stored the full size in LastItemRect)</span>
    <span class="c1">// We call SameLine() to restore DC.CurrentLine* data</span>
    <span class="n">SameLine</span><span class="p">();</span>
    <span class="n">parent_window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">;</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">EndGroup</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ListBox</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">current_item</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="k">const</span> <span class="n">items</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">items_count</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height_items</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="n">ListBox</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">current_item</span><span class="p">,</span> <span class="n">Items_ArrayGetter</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">items</span><span class="p">,</span> <span class="n">items_count</span><span class="p">,</span> <span class="n">height_items</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">ListBox</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">current_item</span><span class="p">,</span> <span class="kt">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">items_getter</span><span class="p">)(</span><span class="kt">void</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">**</span><span class="p">),</span> <span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">items_count</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height_in_items</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ListBoxHeader</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">items_count</span><span class="p">,</span> <span class="n">height_in_items</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Assume all items have even height (= 1 line of text). If you need items of different or variable sizes you can create a custom version of ListBox() in your code without using the clipper.</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">ImGuiListClipper</span> <span class="n">clipper</span><span class="p">;</span>
    <span class="n">clipper</span><span class="p">.</span><span class="n">Begin</span><span class="p">(</span><span class="n">items_count</span><span class="p">,</span> <span class="n">GetTextLineHeightWithSpacing</span><span class="p">());</span> <span class="c1">// We know exactly our line height here so we pass it as a minor optimization, but generally you don&#39;t need to.</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">clipper</span><span class="p">.</span><span class="n">Step</span><span class="p">())</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">clipper</span><span class="p">.</span><span class="n">DisplayStart</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">clipper</span><span class="p">.</span><span class="n">DisplayEnd</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="kt">bool</span> <span class="n">item_selected</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="o">*</span><span class="n">current_item</span><span class="p">);</span>
            <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">item_text</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">items_getter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">item_text</span><span class="p">))</span>
                <span class="n">item_text</span> <span class="o">=</span> <span class="s">&quot;*Unknown item*&quot;</span><span class="p">;</span>

            <span class="n">PushID</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Selectable</span><span class="p">(</span><span class="n">item_text</span><span class="p">,</span> <span class="n">item_selected</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="o">*</span><span class="n">current_item</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
                <span class="n">value_changed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">item_selected</span><span class="p">)</span>
                <span class="n">SetItemDefaultFocus</span><span class="p">();</span>
            <span class="n">PopID</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="n">ListBoxFooter</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value_changed</span><span class="p">)</span>
        <span class="n">MarkItemEdited</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemId</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">value_changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: PlotLines, PlotHistogram</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - PlotEx() [Internal]</span>
<span class="c1">// - PlotLines()</span>
<span class="c1">// - PlotHistogram()</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="kt">int</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">PlotEx</span><span class="p">(</span><span class="n">ImGuiPlotType</span> <span class="n">plot_type</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="p">(</span><span class="o">*</span><span class="n">values_getter</span><span class="p">)(</span><span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">),</span> <span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">values_count</span><span class="p">,</span> <span class="kt">int</span> <span class="n">values_offset</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">overlay_text</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale_max</span><span class="p">,</span> <span class="n">ImVec2</span> <span class="n">frame_size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>

    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">frame_size</span><span class="p">.</span><span class="n">x</span> <span class="o">==</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="n">frame_size</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">CalcItemWidth</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">frame_size</span><span class="p">.</span><span class="n">y</span> <span class="o">==</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="n">frame_size</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">label_size</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>

    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">frame_bb</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">+</span> <span class="n">frame_size</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">inner_bb</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span> <span class="o">-</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">total_bb</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">label_size</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">total_bb</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">frame_bb</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">hovered</span> <span class="o">=</span> <span class="n">ItemHoverable</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>

    <span class="c1">// Determine scale from values if not specified</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">scale_min</span> <span class="o">==</span> <span class="n">FLT_MAX</span> <span class="o">||</span> <span class="n">scale_max</span> <span class="o">==</span> <span class="n">FLT_MAX</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">float</span> <span class="n">v_min</span> <span class="o">=</span> <span class="n">FLT_MAX</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">v_max</span> <span class="o">=</span> <span class="o">-</span><span class="n">FLT_MAX</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values_count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">v</span> <span class="o">=</span> <span class="n">values_getter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">!=</span> <span class="n">v</span><span class="p">)</span> <span class="c1">// Ignore NaN values</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="n">v_min</span> <span class="o">=</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">v_min</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
            <span class="n">v_max</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">v_max</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">scale_min</span> <span class="o">==</span> <span class="n">FLT_MAX</span><span class="p">)</span>
            <span class="n">scale_min</span> <span class="o">=</span> <span class="n">v_min</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">scale_max</span> <span class="o">==</span> <span class="n">FLT_MAX</span><span class="p">)</span>
            <span class="n">scale_max</span> <span class="o">=</span> <span class="n">v_max</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">RenderFrame</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_FrameBg</span><span class="p">),</span> <span class="nb">true</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">FrameRounding</span><span class="p">);</span>

    <span class="k">const</span> <span class="kt">int</span> <span class="n">values_count_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">plot_type</span> <span class="o">==</span> <span class="n">ImGuiPlotType_Lines</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">idx_hovered</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">values_count</span> <span class="o">&gt;=</span> <span class="n">values_count_min</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">res_w</span> <span class="o">=</span> <span class="n">ImMin</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">frame_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">values_count</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">plot_type</span> <span class="o">==</span> <span class="n">ImGuiPlotType_Lines</span><span class="p">)</span> <span class="o">?</span> <span class="mi">-1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">item_count</span> <span class="o">=</span> <span class="n">values_count</span> <span class="o">+</span> <span class="p">((</span><span class="n">plot_type</span> <span class="o">==</span> <span class="n">ImGuiPlotType_Lines</span><span class="p">)</span> <span class="o">?</span> <span class="mi">-1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>

        <span class="c1">// Tooltip on hover</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="n">inner_bb</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MousePos</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">t</span> <span class="o">=</span> <span class="n">ImClamp</span><span class="p">((</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">inner_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">inner_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">inner_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.9999f</span><span class="p">);</span>
            <span class="k">const</span> <span class="kt">int</span> <span class="n">v_idx</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">t</span> <span class="o">*</span> <span class="n">item_count</span><span class="p">);</span>
            <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">v_idx</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">v_idx</span> <span class="o">&lt;</span> <span class="n">values_count</span><span class="p">);</span>

            <span class="k">const</span> <span class="kt">float</span> <span class="n">v0</span> <span class="o">=</span> <span class="n">values_getter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">v_idx</span> <span class="o">+</span> <span class="n">values_offset</span><span class="p">)</span> <span class="o">%</span> <span class="n">values_count</span><span class="p">);</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">values_getter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">v_idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">values_offset</span><span class="p">)</span> <span class="o">%</span> <span class="n">values_count</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plot_type</span> <span class="o">==</span> <span class="n">ImGuiPlotType_Lines</span><span class="p">)</span>
                <span class="n">SetTooltip</span><span class="p">(</span><span class="s">&quot;%d: %8.4g</span><span class="se">\n</span><span class="s">%d: %8.4g&quot;</span><span class="p">,</span> <span class="n">v_idx</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">v_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v1</span><span class="p">);</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">plot_type</span> <span class="o">==</span> <span class="n">ImGuiPlotType_Histogram</span><span class="p">)</span>
                <span class="n">SetTooltip</span><span class="p">(</span><span class="s">&quot;%d: %8.4g&quot;</span><span class="p">,</span> <span class="n">v_idx</span><span class="p">,</span> <span class="n">v0</span><span class="p">);</span>
            <span class="n">idx_hovered</span> <span class="o">=</span> <span class="n">v_idx</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">const</span> <span class="kt">float</span> <span class="n">t_step</span> <span class="o">=</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">res_w</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">inv_scale</span> <span class="o">=</span> <span class="p">(</span><span class="n">scale_min</span> <span class="o">==</span> <span class="n">scale_max</span><span class="p">)</span> <span class="o">?</span> <span class="mf">0.0f</span> <span class="o">:</span> <span class="p">(</span><span class="mf">1.0f</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale_max</span> <span class="o">-</span> <span class="n">scale_min</span><span class="p">));</span>

        <span class="kt">float</span> <span class="n">v0</span> <span class="o">=</span> <span class="n">values_getter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">values_offset</span><span class="p">)</span> <span class="o">%</span> <span class="n">values_count</span><span class="p">);</span>
        <span class="kt">float</span> <span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
        <span class="n">ImVec2</span> <span class="n">tp0</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span> <span class="n">t0</span><span class="p">,</span> <span class="mf">1.0f</span> <span class="o">-</span> <span class="n">ImSaturate</span><span class="p">((</span><span class="n">v0</span> <span class="o">-</span> <span class="n">scale_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">inv_scale</span><span class="p">)</span> <span class="p">);</span>                       <span class="c1">// Point in the normalized space of our target rectangle</span>
        <span class="kt">float</span> <span class="n">histogram_zero_line_t</span> <span class="o">=</span> <span class="p">(</span><span class="n">scale_min</span> <span class="o">*</span> <span class="n">scale_max</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="o">-</span><span class="n">scale_min</span> <span class="o">*</span> <span class="n">inv_scale</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="n">scale_min</span> <span class="o">&lt;</span> <span class="mf">0.0f</span> <span class="o">?</span> <span class="mf">0.0f</span> <span class="o">:</span> <span class="mf">1.0f</span><span class="p">);</span>   <span class="c1">// Where does the zero line stands</span>

        <span class="k">const</span> <span class="n">ImU32</span> <span class="n">col_base</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">((</span><span class="n">plot_type</span> <span class="o">==</span> <span class="n">ImGuiPlotType_Lines</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiCol_PlotLines</span> <span class="p">:</span> <span class="n">ImGuiCol_PlotHistogram</span><span class="p">);</span>
        <span class="k">const</span> <span class="n">ImU32</span> <span class="n">col_hovered</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">((</span><span class="n">plot_type</span> <span class="o">==</span> <span class="n">ImGuiPlotType_Lines</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiCol_PlotLinesHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_PlotHistogramHovered</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">res_w</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">t_step</span><span class="p">;</span>
            <span class="k">const</span> <span class="kt">int</span> <span class="n">v1_idx</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">t0</span> <span class="o">*</span> <span class="n">item_count</span> <span class="o">+</span> <span class="mf">0.5f</span><span class="p">);</span>
            <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">v1_idx</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">v1_idx</span> <span class="o">&lt;</span> <span class="n">values_count</span><span class="p">);</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">values_getter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">v1_idx</span> <span class="o">+</span> <span class="n">values_offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">values_count</span><span class="p">);</span>
            <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">tp1</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span> <span class="n">t1</span><span class="p">,</span> <span class="mf">1.0f</span> <span class="o">-</span> <span class="n">ImSaturate</span><span class="p">((</span><span class="n">v1</span> <span class="o">-</span> <span class="n">scale_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">inv_scale</span><span class="p">)</span> <span class="p">);</span>

            <span class="c1">// NB: Draw calls are merged together by the DrawList system. Still, we should render our batch are lower level to save a bit of CPU.</span>
            <span class="n">ImVec2</span> <span class="n">pos0</span> <span class="o">=</span> <span class="n">ImLerp</span><span class="p">(</span><span class="n">inner_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">inner_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">tp0</span><span class="p">);</span>
            <span class="n">ImVec2</span> <span class="n">pos1</span> <span class="o">=</span> <span class="n">ImLerp</span><span class="p">(</span><span class="n">inner_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">inner_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="p">(</span><span class="n">plot_type</span> <span class="o">==</span> <span class="n">ImGuiPlotType_Lines</span><span class="p">)</span> <span class="o">?</span> <span class="nl">tp1</span> <span class="p">:</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">tp1</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">histogram_zero_line_t</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plot_type</span> <span class="o">==</span> <span class="n">ImGuiPlotType_Lines</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddLine</span><span class="p">(</span><span class="n">pos0</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">idx_hovered</span> <span class="o">==</span> <span class="n">v1_idx</span> <span class="o">?</span> <span class="nl">col_hovered</span> <span class="p">:</span> <span class="n">col_base</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">plot_type</span> <span class="o">==</span> <span class="n">ImGuiPlotType_Histogram</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">pos1</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">pos0</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mf">2.0f</span><span class="p">)</span>
                    <span class="n">pos1</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="mf">1.0f</span><span class="p">;</span>
                <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">pos0</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">idx_hovered</span> <span class="o">==</span> <span class="n">v1_idx</span> <span class="o">?</span> <span class="nl">col_hovered</span> <span class="p">:</span> <span class="n">col_base</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="n">t0</span> <span class="o">=</span> <span class="n">t1</span><span class="p">;</span>
            <span class="n">tp0</span> <span class="o">=</span> <span class="n">tp1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Text overlay</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">overlay_text</span><span class="p">)</span>
        <span class="n">RenderTextClipped</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">overlay_text</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="n">RenderText</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">frame_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">inner_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">label</span><span class="p">);</span>

    <span class="c1">// Return hovered index or -1 if none are hovered.</span>
    <span class="c1">// This is currently not exposed in the public API because we need a larger redesign of the whole thing, but in the short-term we are making it available in PlotEx().</span>
    <span class="k">return</span> <span class="n">idx_hovered</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="nc">ImGuiPlotArrayGetterData</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="n">Values</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">Stride</span><span class="p">;</span>

    <span class="n">ImGuiPlotArrayGetterData</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="n">values</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stride</span><span class="p">)</span> <span class="p">{</span> <span class="n">Values</span> <span class="o">=</span> <span class="n">values</span><span class="p">;</span> <span class="n">Stride</span> <span class="o">=</span> <span class="n">stride</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">float</span> <span class="nf">Plot_ArrayGetter</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiPlotArrayGetterData</span><span class="o">*</span> <span class="n">plot_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImGuiPlotArrayGetterData</span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">v</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span><span class="o">*</span><span class="p">)(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span><span class="p">)((</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">plot_data</span><span class="o">-&gt;</span><span class="n">Values</span> <span class="o">+</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">idx</span> <span class="o">*</span> <span class="n">plot_data</span><span class="o">-&gt;</span><span class="n">Stride</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">v</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::PlotLines</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="n">values</span><span class="p">,</span> <span class="kt">int</span> <span class="n">values_count</span><span class="p">,</span> <span class="kt">int</span> <span class="n">values_offset</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">overlay_text</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale_max</span><span class="p">,</span> <span class="n">ImVec2</span> <span class="n">graph_size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stride</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiPlotArrayGetterData</span> <span class="n">data</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">stride</span><span class="p">);</span>
    <span class="n">PlotEx</span><span class="p">(</span><span class="n">ImGuiPlotType_Lines</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Plot_ArrayGetter</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">values_count</span><span class="p">,</span> <span class="n">values_offset</span><span class="p">,</span> <span class="n">overlay_text</span><span class="p">,</span> <span class="n">scale_min</span><span class="p">,</span> <span class="n">scale_max</span><span class="p">,</span> <span class="n">graph_size</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::PlotLines</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="p">(</span><span class="o">*</span><span class="n">values_getter</span><span class="p">)(</span><span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">),</span> <span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">values_count</span><span class="p">,</span> <span class="kt">int</span> <span class="n">values_offset</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">overlay_text</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale_max</span><span class="p">,</span> <span class="n">ImVec2</span> <span class="n">graph_size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">PlotEx</span><span class="p">(</span><span class="n">ImGuiPlotType_Lines</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">values_getter</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">values_count</span><span class="p">,</span> <span class="n">values_offset</span><span class="p">,</span> <span class="n">overlay_text</span><span class="p">,</span> <span class="n">scale_min</span><span class="p">,</span> <span class="n">scale_max</span><span class="p">,</span> <span class="n">graph_size</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::PlotHistogram</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="n">values</span><span class="p">,</span> <span class="kt">int</span> <span class="n">values_count</span><span class="p">,</span> <span class="kt">int</span> <span class="n">values_offset</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">overlay_text</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale_max</span><span class="p">,</span> <span class="n">ImVec2</span> <span class="n">graph_size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stride</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiPlotArrayGetterData</span> <span class="n">data</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">stride</span><span class="p">);</span>
    <span class="n">PlotEx</span><span class="p">(</span><span class="n">ImGuiPlotType_Histogram</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Plot_ArrayGetter</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">values_count</span><span class="p">,</span> <span class="n">values_offset</span><span class="p">,</span> <span class="n">overlay_text</span><span class="p">,</span> <span class="n">scale_min</span><span class="p">,</span> <span class="n">scale_max</span><span class="p">,</span> <span class="n">graph_size</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::PlotHistogram</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">float</span> <span class="p">(</span><span class="o">*</span><span class="n">values_getter</span><span class="p">)(</span><span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">),</span> <span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">values_count</span><span class="p">,</span> <span class="kt">int</span> <span class="n">values_offset</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">overlay_text</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale_min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale_max</span><span class="p">,</span> <span class="n">ImVec2</span> <span class="n">graph_size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">PlotEx</span><span class="p">(</span><span class="n">ImGuiPlotType_Histogram</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">values_getter</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">values_count</span><span class="p">,</span> <span class="n">values_offset</span><span class="p">,</span> <span class="n">overlay_text</span><span class="p">,</span> <span class="n">scale_min</span><span class="p">,</span> <span class="n">scale_max</span><span class="p">,</span> <span class="n">graph_size</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: Value helpers</span>
<span class="c1">// Those is not very useful, legacy API.</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - Value()</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="kt">void</span> <span class="nf">ImGui::Value</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">prefix</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Text</span><span class="p">(</span><span class="s">&quot;%s: %s&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span> <span class="o">?</span> <span class="s">&quot;true&quot;</span> <span class="o">:</span> <span class="s">&quot;false&quot;</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::Value</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">prefix</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Text</span><span class="p">(</span><span class="s">&quot;%s: %d&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::Value</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">prefix</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Text</span><span class="p">(</span><span class="s">&quot;%s: %d&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::Value</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">prefix</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">float_format</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">float_format</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">char</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
        <span class="n">ImFormatString</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="s">&quot;%%s: %s&quot;</span><span class="p">,</span> <span class="n">float_format</span><span class="p">);</span>
        <span class="n">Text</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">Text</span><span class="p">(</span><span class="s">&quot;%s: %.3f&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] MenuItem, BeginMenu, EndMenu, etc.</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - ImGuiMenuColumns [Internal]</span>
<span class="c1">// - BeginMenuBar()</span>
<span class="c1">// - EndMenuBar()</span>
<span class="c1">// - BeginMainMenuBar()</span>
<span class="c1">// - EndMainMenuBar()</span>
<span class="c1">// - BeginMenu()</span>
<span class="c1">// - EndMenu()</span>
<span class="c1">// - MenuItem()</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="c1">// Helpers for internal use</span>
<span class="kt">void</span> <span class="nf">ImGuiMenuColumns::Update</span><span class="p">(</span><span class="kt">int</span> <span class="n">count</span><span class="p">,</span> <span class="kt">float</span> <span class="n">spacing</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">clear</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">count</span> <span class="o">==</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">Pos</span><span class="p">));</span>
    <span class="n">IM_UNUSED</span><span class="p">(</span><span class="n">count</span><span class="p">);</span>
    <span class="n">Width</span> <span class="o">=</span> <span class="n">NextWidth</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="n">Spacing</span> <span class="o">=</span> <span class="n">spacing</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">clear</span><span class="p">)</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">NextWidths</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">NextWidths</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">Pos</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">NextWidths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
            <span class="n">Width</span> <span class="o">+=</span> <span class="n">Spacing</span><span class="p">;</span>
        <span class="n">Pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">Width</span><span class="p">);</span>
        <span class="n">Width</span> <span class="o">+=</span> <span class="n">NextWidths</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">NextWidths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">ImGuiMenuColumns::DeclColumns</span><span class="p">(</span><span class="kt">float</span> <span class="n">w0</span><span class="p">,</span> <span class="kt">float</span> <span class="n">w1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">w2</span><span class="p">)</span> <span class="c1">// not using va_arg because they promote float to double</span>
<span class="p">{</span>
    <span class="n">NextWidth</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="n">NextWidths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">NextWidths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w0</span><span class="p">);</span>
    <span class="n">NextWidths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">NextWidths</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">w1</span><span class="p">);</span>
    <span class="n">NextWidths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">NextWidths</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">w2</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IM_ARRAYSIZE</span><span class="p">(</span><span class="n">Pos</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">NextWidth</span> <span class="o">+=</span> <span class="n">NextWidths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">NextWidths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="o">?</span> <span class="nl">Spacing</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">Width</span><span class="p">,</span> <span class="n">NextWidth</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">ImGuiMenuColumns::CalcExtraSpace</span><span class="p">(</span><span class="kt">float</span> <span class="n">avail_w</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">ImMax</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="n">avail_w</span> <span class="o">-</span> <span class="n">Width</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// FIXME: Provided a rectangle perhaps e.g. a BeginMenuBarEx() could be used anywhere..</span>
<span class="c1">// Currently the main responsibility of this function being to setup clip-rect + horizontal layout + menu navigation layer.</span>
<span class="c1">// Ideally we also want this to be responsible for claiming space out of the main window scrolling rectangle, in which case ImGuiWindowFlags_MenuBar will become unnecessary.</span>
<span class="c1">// Then later the same system could be used for multiple menu-bars, scrollbars, side-bars.</span>
<span class="kt">bool</span> <span class="nf">ImGui::BeginMenuBar</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiWindowFlags_MenuBar</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">!</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">MenuBarAppending</span><span class="p">);</span>
    <span class="n">BeginGroup</span><span class="p">();</span> <span class="c1">// Backup position on layer 0 // FIXME: Misleading to use a group for that backup/restore</span>
    <span class="n">PushID</span><span class="p">(</span><span class="s">&quot;##menubar&quot;</span><span class="p">);</span>

    <span class="c1">// We don&#39;t clip with current window clipping rectangle as it is already set to the area below. However we clip with window full rect.</span>
    <span class="c1">// We remove 1 worth of rounding to Max.x to that text in long menus and small windows don&#39;t tend to display over the lower-right rounded area, which looks particularly glitchy.</span>
    <span class="n">ImRect</span> <span class="n">bar_rect</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">MenuBarRect</span><span class="p">();</span>
    <span class="n">ImRect</span> <span class="n">clip_rect</span><span class="p">(</span><span class="n">IM_ROUND</span><span class="p">(</span><span class="n">bar_rect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowBorderSize</span><span class="p">),</span> <span class="n">IM_ROUND</span><span class="p">(</span><span class="n">bar_rect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowBorderSize</span><span class="p">),</span> <span class="n">IM_ROUND</span><span class="p">(</span><span class="n">ImMax</span><span class="p">(</span><span class="n">bar_rect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">bar_rect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowRounding</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowBorderSize</span><span class="p">))),</span> <span class="n">IM_ROUND</span><span class="p">(</span><span class="n">bar_rect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
    <span class="n">clip_rect</span><span class="p">.</span><span class="n">ClipWith</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">OuterRectClipped</span><span class="p">);</span>
    <span class="n">PushClipRect</span><span class="p">(</span><span class="n">clip_rect</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">clip_rect</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

    <span class="c1">// We overwrite CursorMaxPos because BeginGroup sets it to CursorPos (essentially the .EmitItem hack in EndMenuBar() would need something analoguous here, maybe a BeginGroupEx() with flags).</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorMaxPos</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">bar_rect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">MenuBarOffset</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">bar_rect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">MenuBarOffset</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LayoutType</span> <span class="o">=</span> <span class="n">ImGuiLayoutType_Horizontal</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">NavLayerCurrent</span> <span class="o">=</span> <span class="n">ImGuiNavLayer_Menu</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">MenuBarAppending</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">AlignTextToFramePadding</span><span class="p">();</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::EndMenuBar</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>

    <span class="c1">// Nav: When a move request within one of our child menu failed, capture the request to navigate among our siblings.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">NavMoveRequestButNoResultYet</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavMoveDir</span> <span class="o">==</span> <span class="n">ImGuiDir_Left</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">NavMoveDir</span> <span class="o">==</span> <span class="n">ImGuiDir_Right</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavWindow</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiWindowFlags_ChildMenu</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">nav_earliest_child</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">NavWindow</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">nav_earliest_child</span><span class="o">-&gt;</span><span class="n">ParentWindow</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">nav_earliest_child</span><span class="o">-&gt;</span><span class="n">ParentWindow</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiWindowFlags_ChildMenu</span><span class="p">))</span>
            <span class="n">nav_earliest_child</span> <span class="o">=</span> <span class="n">nav_earliest_child</span><span class="o">-&gt;</span><span class="n">ParentWindow</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nav_earliest_child</span><span class="o">-&gt;</span><span class="n">ParentWindow</span> <span class="o">==</span> <span class="n">window</span> <span class="o">&amp;&amp;</span> <span class="n">nav_earliest_child</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ParentLayoutType</span> <span class="o">==</span> <span class="n">ImGuiLayoutType_Horizontal</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavMoveRequestForward</span> <span class="o">==</span> <span class="n">ImGuiNavForward_None</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// To do so we claim focus back, restore NavId and then process the movement request for yet another frame.</span>
            <span class="c1">// This involve a one-frame delay which isn&#39;t very problematic in this situation. We could remove it by scoring in advance for multiple window (probably not worth the hassle/cost)</span>
            <span class="k">const</span> <span class="n">ImGuiNavLayer</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">ImGuiNavLayer_Menu</span><span class="p">;</span>
            <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">NavLayerActiveMaskNext</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">layer</span><span class="p">));</span> <span class="c1">// Sanity check</span>
            <span class="n">FocusWindow</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
            <span class="n">SetNavIDWithRectRel</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">NavLastIds</span><span class="p">[</span><span class="n">layer</span><span class="p">],</span> <span class="n">layer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">NavRectRel</span><span class="p">[</span><span class="n">layer</span><span class="p">]);</span>
            <span class="n">g</span><span class="p">.</span><span class="n">NavLayer</span> <span class="o">=</span> <span class="n">layer</span><span class="p">;</span>
            <span class="n">g</span><span class="p">.</span><span class="n">NavDisableHighlight</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="c1">// Hide highlight for the current frame so we don&#39;t see the intermediary selection.</span>
            <span class="n">g</span><span class="p">.</span><span class="n">NavMoveRequestForward</span> <span class="o">=</span> <span class="n">ImGuiNavForward_ForwardQueued</span><span class="p">;</span>
            <span class="n">NavMoveRequestCancel</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiWindowFlags_MenuBar</span><span class="p">);</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">MenuBarAppending</span><span class="p">);</span>
    <span class="n">PopClipRect</span><span class="p">();</span>
    <span class="n">PopID</span><span class="p">();</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">MenuBarOffset</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">MenuBarRect</span><span class="p">().</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="c1">// Save horizontal position so next append can reuse it. This is kinda equivalent to a per-layer CursorPos.</span>
    <span class="n">g</span><span class="p">.</span><span class="n">GroupStack</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">EmitItem</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">EndGroup</span><span class="p">();</span> <span class="c1">// Restore position on layer 0</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LayoutType</span> <span class="o">=</span> <span class="n">ImGuiLayoutType_Vertical</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">NavLayerCurrent</span> <span class="o">=</span> <span class="n">ImGuiNavLayer_Main</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">MenuBarAppending</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// For the main menu bar, which cannot be moved, we honor g.Style.DisplaySafeAreaPadding to ensure text can be visible on a TV set.</span>
<span class="kt">bool</span> <span class="nf">ImGui::BeginMainMenuBar</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">g</span><span class="p">.</span><span class="n">NextWindowData</span><span class="p">.</span><span class="n">MenuBarOffsetMinVal</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">DisplaySafeAreaPadding</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">DisplaySafeAreaPadding</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
    <span class="n">SetNextWindowPos</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
    <span class="n">SetNextWindowSize</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">DisplaySize</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">NextWindowData</span><span class="p">.</span><span class="n">MenuBarOffsetMinVal</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">FontBaseSize</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
    <span class="n">PushStyleVar</span><span class="p">(</span><span class="n">ImGuiStyleVar_WindowRounding</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="n">PushStyleVar</span><span class="p">(</span><span class="n">ImGuiStyleVar_WindowMinSize</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
    <span class="n">ImGuiWindowFlags</span> <span class="n">window_flags</span> <span class="o">=</span> <span class="n">ImGuiWindowFlags_NoTitleBar</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_NoResize</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_NoMove</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_NoScrollbar</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_NoSavedSettings</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_MenuBar</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">is_open</span> <span class="o">=</span> <span class="n">Begin</span><span class="p">(</span><span class="s">&quot;##MainMenuBar&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">window_flags</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">BeginMenuBar</span><span class="p">();</span>
    <span class="n">PopStyleVar</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">g</span><span class="p">.</span><span class="n">NextWindowData</span><span class="p">.</span><span class="n">MenuBarOffsetMinVal</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_open</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">End</span><span class="p">();</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span> <span class="c1">//-V1020</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::EndMainMenuBar</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">EndMenuBar</span><span class="p">();</span>

    <span class="c1">// When the user has left the menu layer (typically: closed menus through activation of an item), we restore focus to the previous window</span>
    <span class="c1">// FIXME: With this strategy we won&#39;t be able to restore a NULL focus.</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span> <span class="o">==</span> <span class="n">g</span><span class="p">.</span><span class="n">NavWindow</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavLayer</span> <span class="o">==</span> <span class="n">ImGuiNavLayer_Main</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">NavAnyRequest</span><span class="p">)</span>
        <span class="n">FocusTopMostWindowUnderOne</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavWindow</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="n">End</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">ImGui::BeginMenu</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">enabled</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">menu_is_open</span> <span class="o">=</span> <span class="n">IsPopupOpen</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">ImGuiPopupFlags_None</span><span class="p">);</span>

    <span class="c1">// Sub-menus are ChildWindow so that mouse can be hovering across them (otherwise top-most popup menu would steal focus and not allow hovering on parent menu)</span>
    <span class="n">ImGuiWindowFlags</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">ImGuiWindowFlags_ChildMenu</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_AlwaysAutoResize</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_NoMove</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_NoTitleBar</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_NoSavedSettings</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_NoNavFocus</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiWindowFlags_Popup</span> <span class="o">|</span> <span class="n">ImGuiWindowFlags_ChildMenu</span><span class="p">))</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiWindowFlags_ChildWindow</span><span class="p">;</span>

    <span class="c1">// If a menu with same the ID was already submitted, we will append to it, matching the behavior of Begin().</span>
    <span class="c1">// We are relying on a O(N) search - so O(N log N) over the frame - which seems like the most efficient for the expected small amount of BeginMenu() calls per frame.</span>
    <span class="c1">// If somehow this is ever becoming a problem we can switch to use e.g. ImGuiStorage mapping key to last frame used.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">MenusIdSubmittedThisFrame</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">menu_is_open</span><span class="p">)</span>
            <span class="n">menu_is_open</span> <span class="o">=</span> <span class="n">BeginPopupEx</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span> <span class="c1">// menu_is_open can be &#39;false&#39; when the popup is completely clipped (e.g. zero size display)</span>
        <span class="k">else</span>
            <span class="n">g</span><span class="p">.</span><span class="n">NextWindowData</span><span class="p">.</span><span class="n">ClearFlags</span><span class="p">();</span>          <span class="c1">// we behave like Begin() and need to consume those values</span>
        <span class="k">return</span> <span class="n">menu_is_open</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Tag menu as used. Next time BeginMenu() with same ID is called it will append to existing menu</span>
    <span class="n">g</span><span class="p">.</span><span class="n">MenusIdSubmittedThisFrame</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

    <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">pressed</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">menuset_is_open</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiWindowFlags_Popup</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">OpenPopupStack</span><span class="p">.</span><span class="n">Size</span> <span class="o">&gt;</span> <span class="n">g</span><span class="p">.</span><span class="n">BeginPopupStack</span><span class="p">.</span><span class="n">Size</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">OpenPopupStack</span><span class="p">[</span><span class="n">g</span><span class="p">.</span><span class="n">BeginPopupStack</span><span class="p">.</span><span class="n">Size</span><span class="p">].</span><span class="n">OpenParentId</span> <span class="o">==</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">IDStack</span><span class="p">.</span><span class="n">back</span><span class="p">());</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">backed_nav_window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">NavWindow</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">menuset_is_open</span><span class="p">)</span>
        <span class="n">g</span><span class="p">.</span><span class="n">NavWindow</span> <span class="o">=</span> <span class="n">window</span><span class="p">;</span>  <span class="c1">// Odd hack to allow hovering across menus of a same menu-set (otherwise we wouldn&#39;t be able to hover parent)</span>

    <span class="c1">// The reference position stored in popup_pos will be used by Begin() to find a suitable position for the child menu,</span>
    <span class="c1">// However the final position is going to be different! It is chosen by FindBestWindowPosForPopup().</span>
    <span class="c1">// e.g. Menus tend to overlap each other horizontally to amplify relative Z-ordering.</span>
    <span class="n">ImVec2</span> <span class="n">popup_pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LayoutType</span> <span class="o">==</span> <span class="n">ImGuiLayoutType_Horizontal</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Menu inside an horizontal menu bar</span>
        <span class="c1">// Selectable extend their highlight by half ItemSpacing in each direction.</span>
        <span class="c1">// For ChildMenu, the popup position will be overwritten by the call to FindBestWindowPosForPopup() in Begin()</span>
        <span class="n">popup_pos</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="mf">1.0f</span> <span class="o">-</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">),</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">MenuBarHeight</span><span class="p">());</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">);</span>
        <span class="n">PushStyleVar</span><span class="p">(</span><span class="n">ImGuiStyleVar_ItemSpacing</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
        <span class="kt">float</span> <span class="n">w</span> <span class="o">=</span> <span class="n">label_size</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
        <span class="n">pressed</span> <span class="o">=</span> <span class="n">Selectable</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">menu_is_open</span><span class="p">,</span> <span class="n">ImGuiSelectableFlags_NoHoldingActiveID</span> <span class="o">|</span> <span class="n">ImGuiSelectableFlags_SelectOnClick</span> <span class="o">|</span> <span class="n">ImGuiSelectableFlags_DontClosePopups</span> <span class="o">|</span> <span class="p">(</span><span class="o">!</span><span class="n">enabled</span> <span class="o">?</span> <span class="nl">ImGuiSelectableFlags_Disabled</span> <span class="p">:</span> <span class="mi">0</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
        <span class="n">PopStyleVar</span><span class="p">();</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">-1.0f</span> <span class="o">+</span> <span class="mf">0.5f</span><span class="p">));</span> <span class="c1">// -1 spacing to compensate the spacing added when Selectable() did a SameLine(). It would also work to call SameLine() ourselves after the PopStyleVar().</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// Menu inside a menu</span>
        <span class="c1">// (In a typical menu window where all items are BeginMenu() or MenuItem() calls, extra_w will always be 0.0f.</span>
        <span class="c1">//  Only when they are other items sticking out we&#39;re going to add spacing, yet only register minimum width into the layout system.</span>
        <span class="n">popup_pos</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">style</span><span class="p">.</span><span class="n">WindowPadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
        <span class="kt">float</span> <span class="n">min_w</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">MenuColumns</span><span class="p">.</span><span class="n">DeclColumns</span><span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">1.20f</span><span class="p">));</span> <span class="c1">// Feedback to next frame</span>
        <span class="kt">float</span> <span class="n">extra_w</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="n">GetContentRegionAvail</span><span class="p">().</span><span class="n">x</span> <span class="o">-</span> <span class="n">min_w</span><span class="p">);</span>
        <span class="n">pressed</span> <span class="o">=</span> <span class="n">Selectable</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">menu_is_open</span><span class="p">,</span> <span class="n">ImGuiSelectableFlags_NoHoldingActiveID</span> <span class="o">|</span> <span class="n">ImGuiSelectableFlags_SelectOnClick</span> <span class="o">|</span> <span class="n">ImGuiSelectableFlags_DontClosePopups</span> <span class="o">|</span> <span class="n">ImGuiSelectableFlags_SpanAvailWidth</span> <span class="o">|</span> <span class="p">(</span><span class="o">!</span><span class="n">enabled</span> <span class="o">?</span> <span class="nl">ImGuiSelectableFlags_Disabled</span> <span class="p">:</span> <span class="mi">0</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">min_w</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
        <span class="n">ImU32</span> <span class="n">text_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">enabled</span> <span class="o">?</span> <span class="nl">ImGuiCol_Text</span> <span class="p">:</span> <span class="n">ImGuiCol_TextDisabled</span><span class="p">);</span>
        <span class="n">RenderArrow</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">MenuColumns</span><span class="p">.</span><span class="n">Pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">extra_w</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">0.30f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">),</span> <span class="n">text_col</span><span class="p">,</span> <span class="n">ImGuiDir_Right</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="kt">bool</span> <span class="n">hovered</span> <span class="o">=</span> <span class="n">enabled</span> <span class="o">&amp;&amp;</span> <span class="n">ItemHoverable</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemRect</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">menuset_is_open</span><span class="p">)</span>
        <span class="n">g</span><span class="p">.</span><span class="n">NavWindow</span> <span class="o">=</span> <span class="n">backed_nav_window</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">want_open</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">want_close</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LayoutType</span> <span class="o">==</span> <span class="n">ImGuiLayoutType_Vertical</span><span class="p">)</span> <span class="c1">// (window-&gt;Flags &amp; (ImGuiWindowFlags_Popup|ImGuiWindowFlags_ChildMenu))</span>
    <span class="p">{</span>
        <span class="c1">// Close menu when not hovering it anymore unless we are moving roughly in the direction of the menu</span>
        <span class="c1">// Implement http://bjk5.com/post/44698559168/breaking-down-amazons-mega-dropdown to avoid using timers, so menus feels more reactive.</span>
        <span class="kt">bool</span> <span class="n">moving_toward_other_child_menu</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

        <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">child_menu_window</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">BeginPopupStack</span><span class="p">.</span><span class="n">Size</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">OpenPopupStack</span><span class="p">.</span><span class="n">Size</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">OpenPopupStack</span><span class="p">[</span><span class="n">g</span><span class="p">.</span><span class="n">BeginPopupStack</span><span class="p">.</span><span class="n">Size</span><span class="p">].</span><span class="n">SourceWindow</span> <span class="o">==</span> <span class="n">window</span><span class="p">)</span> <span class="o">?</span> <span class="n">g</span><span class="p">.</span><span class="n">OpenPopupStack</span><span class="p">[</span><span class="n">g</span><span class="p">.</span><span class="n">BeginPopupStack</span><span class="p">.</span><span class="n">Size</span><span class="p">].</span><span class="nl">Window</span> <span class="p">:</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">HoveredWindow</span> <span class="o">==</span> <span class="n">window</span> <span class="o">&amp;&amp;</span> <span class="n">child_menu_window</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiWindowFlags_MenuBar</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// FIXME-DPI: Values should be derived from a master &quot;scale&quot; factor.</span>
            <span class="n">ImRect</span> <span class="n">next_window_rect</span> <span class="o">=</span> <span class="n">child_menu_window</span><span class="o">-&gt;</span><span class="n">Rect</span><span class="p">();</span>
            <span class="n">ImVec2</span> <span class="n">ta</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MousePos</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseDelta</span><span class="p">;</span>
            <span class="n">ImVec2</span> <span class="n">tb</span> <span class="o">=</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">child_menu_window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">?</span> <span class="n">next_window_rect</span><span class="p">.</span><span class="n">GetTL</span><span class="p">()</span> <span class="o">:</span> <span class="n">next_window_rect</span><span class="p">.</span><span class="n">GetTR</span><span class="p">();</span>
            <span class="n">ImVec2</span> <span class="n">tc</span> <span class="o">=</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">child_menu_window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">?</span> <span class="n">next_window_rect</span><span class="p">.</span><span class="n">GetBL</span><span class="p">()</span> <span class="o">:</span> <span class="n">next_window_rect</span><span class="p">.</span><span class="n">GetBR</span><span class="p">();</span>
            <span class="kt">float</span> <span class="n">extra</span> <span class="o">=</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">ImFabs</span><span class="p">(</span><span class="n">ta</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">tb</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.30f</span><span class="p">,</span> <span class="mf">5.0f</span><span class="p">,</span> <span class="mf">30.0f</span><span class="p">);</span>    <span class="c1">// add a bit of extra slack.</span>
            <span class="n">ta</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">child_menu_window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">?</span> <span class="mf">-0.5f</span> <span class="o">:</span> <span class="o">+</span><span class="mf">0.5f</span><span class="p">;</span> <span class="c1">// to avoid numerical issues</span>
            <span class="n">tb</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">ta</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ImMax</span><span class="p">((</span><span class="n">tb</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">extra</span><span class="p">)</span> <span class="o">-</span> <span class="n">ta</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mf">-100.0f</span><span class="p">);</span>                <span class="c1">// triangle is maximum 200 high to limit the slope and the bias toward large sub-menus // FIXME: Multiply by fb_scale?</span>
            <span class="n">tc</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">ta</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ImMin</span><span class="p">((</span><span class="n">tc</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">extra</span><span class="p">)</span> <span class="o">-</span> <span class="n">ta</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="o">+</span><span class="mf">100.0f</span><span class="p">);</span>
            <span class="n">moving_toward_other_child_menu</span> <span class="o">=</span> <span class="n">ImTriangleContainsPoint</span><span class="p">(</span><span class="n">ta</span><span class="p">,</span> <span class="n">tb</span><span class="p">,</span> <span class="n">tc</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MousePos</span><span class="p">);</span>
            <span class="c1">//GetForegroundDrawList()-&gt;AddTriangleFilled(ta, tb, tc, moving_within_opened_triangle ? IM_COL32(0,128,0,128) : IM_COL32(128,0,0,128)); // [DEBUG]</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">menu_is_open</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredWindow</span> <span class="o">==</span> <span class="n">window</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredIdPreviousFrame</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredIdPreviousFrame</span> <span class="o">!=</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">moving_toward_other_child_menu</span><span class="p">)</span>
            <span class="n">want_close</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">menu_is_open</span> <span class="o">&amp;&amp;</span> <span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="n">pressed</span><span class="p">)</span> <span class="c1">// Click to open</span>
            <span class="n">want_open</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">menu_is_open</span> <span class="o">&amp;&amp;</span> <span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">moving_toward_other_child_menu</span><span class="p">)</span> <span class="c1">// Hover to open</span>
            <span class="n">want_open</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavActivateId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">want_close</span> <span class="o">=</span> <span class="n">menu_is_open</span><span class="p">;</span>
            <span class="n">want_open</span> <span class="o">=</span> <span class="o">!</span><span class="n">menu_is_open</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavMoveRequest</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavMoveDir</span> <span class="o">==</span> <span class="n">ImGuiDir_Right</span><span class="p">)</span> <span class="c1">// Nav-Right to open</span>
        <span class="p">{</span>
            <span class="n">want_open</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="n">NavMoveRequestCancel</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// Menu bar</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">menu_is_open</span> <span class="o">&amp;&amp;</span> <span class="n">pressed</span> <span class="o">&amp;&amp;</span> <span class="n">menuset_is_open</span><span class="p">)</span> <span class="c1">// Click an open menu again to close it</span>
        <span class="p">{</span>
            <span class="n">want_close</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="n">want_open</span> <span class="o">=</span> <span class="n">menu_is_open</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pressed</span> <span class="o">||</span> <span class="p">(</span><span class="n">hovered</span> <span class="o">&amp;&amp;</span> <span class="n">menuset_is_open</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">menu_is_open</span><span class="p">))</span> <span class="c1">// First click to open, then hover to open others</span>
        <span class="p">{</span>
            <span class="n">want_open</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavMoveRequest</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavMoveDir</span> <span class="o">==</span> <span class="n">ImGuiDir_Down</span><span class="p">)</span> <span class="c1">// Nav-Down to open</span>
        <span class="p">{</span>
            <span class="n">want_open</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="n">NavMoveRequestCancel</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">enabled</span><span class="p">)</span> <span class="c1">// explicitly close if an open menu becomes disabled, facilitate users code a lot in pattern such as &#39;if (BeginMenu(&quot;options&quot;, has_object)) { ..use object.. }&#39;</span>
        <span class="n">want_close</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">want_close</span> <span class="o">&amp;&amp;</span> <span class="n">IsPopupOpen</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">ImGuiPopupFlags_None</span><span class="p">))</span>
        <span class="n">ClosePopupToLevel</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">BeginPopupStack</span><span class="p">.</span><span class="n">Size</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

    <span class="n">IMGUI_TEST_ENGINE_ITEM_INFO</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">|</span> <span class="n">ImGuiItemStatusFlags_Openable</span> <span class="o">|</span> <span class="p">(</span><span class="n">menu_is_open</span> <span class="o">?</span> <span class="nl">ImGuiItemStatusFlags_Opened</span> <span class="p">:</span> <span class="mi">0</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">menu_is_open</span> <span class="o">&amp;&amp;</span> <span class="n">want_open</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">OpenPopupStack</span><span class="p">.</span><span class="n">Size</span> <span class="o">&gt;</span> <span class="n">g</span><span class="p">.</span><span class="n">BeginPopupStack</span><span class="p">.</span><span class="n">Size</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Don&#39;t recycle same menu level in the same frame, first close the other menu and yield for a frame.</span>
        <span class="n">OpenPopup</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">menu_is_open</span> <span class="o">|=</span> <span class="n">want_open</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">want_open</span><span class="p">)</span>
        <span class="n">OpenPopup</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">menu_is_open</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SetNextWindowPos</span><span class="p">(</span><span class="n">popup_pos</span><span class="p">,</span> <span class="n">ImGuiCond_Always</span><span class="p">);</span>
        <span class="n">menu_is_open</span> <span class="o">=</span> <span class="n">BeginPopupEx</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span> <span class="c1">// menu_is_open can be &#39;false&#39; when the popup is completely clipped (e.g. zero size display)</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">g</span><span class="p">.</span><span class="n">NextWindowData</span><span class="p">.</span><span class="n">ClearFlags</span><span class="p">();</span> <span class="c1">// We behave like Begin() and need to consume those values</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">menu_is_open</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::EndMenu</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Nav: When a left move request _within our child menu_ failed, close ourselves (the _parent_ menu).</span>
    <span class="c1">// A menu doesn&#39;t close itself because EndMenuBar() wants the catch the last Left&lt;&gt;Right inputs.</span>
    <span class="c1">// However, it means that with the current code, a BeginMenu() from outside another menu or a menu-bar won&#39;t be closable with the Left direction.</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">NavWindow</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavWindow</span><span class="o">-&gt;</span><span class="n">ParentWindow</span> <span class="o">==</span> <span class="n">window</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavMoveDir</span> <span class="o">==</span> <span class="n">ImGuiDir_Left</span> <span class="o">&amp;&amp;</span> <span class="n">NavMoveRequestButNoResultYet</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LayoutType</span> <span class="o">==</span> <span class="n">ImGuiLayoutType_Vertical</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ClosePopupToLevel</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">BeginPopupStack</span><span class="p">.</span><span class="n">Size</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
        <span class="n">NavMoveRequestCancel</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">EndPopup</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">ImGui::MenuItem</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">shortcut</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">selected</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">enabled</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="n">ImVec2</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">;</span>
    <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

    <span class="c1">// We&#39;ve been using the equivalent of ImGuiSelectableFlags_SetNavIdOnHover on all Selectable() since early Nav system days (commit 43ee5d73),</span>
    <span class="c1">// but I am unsure whether this should be kept at all. For now moved it to be an opt-in feature used by menus only.</span>
    <span class="n">ImGuiSelectableFlags</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">ImGuiSelectableFlags_SelectOnRelease</span> <span class="o">|</span> <span class="n">ImGuiSelectableFlags_SetNavIdOnHover</span> <span class="o">|</span> <span class="p">(</span><span class="n">enabled</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">ImGuiSelectableFlags_Disabled</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">pressed</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LayoutType</span> <span class="o">==</span> <span class="n">ImGuiLayoutType_Horizontal</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Mimic the exact layout spacing of BeginMenu() to allow MenuItem() inside a menu bar, which is a little misleading but may be useful</span>
        <span class="c1">// Note that in this situation we render neither the shortcut neither the selected tick mark</span>
        <span class="kt">float</span> <span class="n">w</span> <span class="o">=</span> <span class="n">label_size</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">);</span>
        <span class="n">PushStyleVar</span><span class="p">(</span><span class="n">ImGuiStyleVar_ItemSpacing</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">,</span> <span class="n">style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
        <span class="n">pressed</span> <span class="o">=</span> <span class="n">Selectable</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
        <span class="n">PopStyleVar</span><span class="p">();</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">-1.0f</span> <span class="o">+</span> <span class="mf">0.5f</span><span class="p">));</span> <span class="c1">// -1 spacing to compensate the spacing added when Selectable() did a SameLine(). It would also work to call SameLine() ourselves after the PopStyleVar().</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// Menu item inside a vertical menu</span>
        <span class="c1">// (In a typical menu window where all items are BeginMenu() or MenuItem() calls, extra_w will always be 0.0f.</span>
        <span class="c1">//  Only when they are other items sticking out we&#39;re going to add spacing, yet only register minimum width into the layout system.</span>
        <span class="kt">float</span> <span class="n">shortcut_w</span> <span class="o">=</span> <span class="n">shortcut</span> <span class="o">?</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">shortcut</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">).</span><span class="nl">x</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">min_w</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">MenuColumns</span><span class="p">.</span><span class="n">DeclColumns</span><span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">shortcut_w</span><span class="p">,</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">1.20f</span><span class="p">));</span> <span class="c1">// Feedback for next frame</span>
        <span class="kt">float</span> <span class="n">extra_w</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="n">GetContentRegionAvail</span><span class="p">().</span><span class="n">x</span> <span class="o">-</span> <span class="n">min_w</span><span class="p">);</span>
        <span class="n">pressed</span> <span class="o">=</span> <span class="n">Selectable</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">ImGuiSelectableFlags_SpanAvailWidth</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">min_w</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">shortcut_w</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">PushStyleColor</span><span class="p">(</span><span class="n">ImGuiCol_Text</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">Colors</span><span class="p">[</span><span class="n">ImGuiCol_TextDisabled</span><span class="p">]);</span>
            <span class="n">RenderText</span><span class="p">(</span><span class="n">pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">MenuColumns</span><span class="p">.</span><span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">extra_w</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">),</span> <span class="n">shortcut</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
            <span class="n">PopStyleColor</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">selected</span><span class="p">)</span>
            <span class="n">RenderCheckMark</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">MenuColumns</span><span class="p">.</span><span class="n">Pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">extra_w</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">0.40f</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">0.134f</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">),</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">enabled</span> <span class="o">?</span> <span class="nl">ImGuiCol_Text</span> <span class="p">:</span> <span class="n">ImGuiCol_TextDisabled</span><span class="p">),</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span>  <span class="o">*</span> <span class="mf">0.866f</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">IMGUI_TEST_ENGINE_ITEM_INFO</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemId</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ItemFlags</span> <span class="o">|</span> <span class="n">ImGuiItemStatusFlags_Checkable</span> <span class="o">|</span> <span class="p">(</span><span class="n">selected</span> <span class="o">?</span> <span class="nl">ImGuiItemStatusFlags_Checked</span> <span class="p">:</span> <span class="mi">0</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">ImGui::MenuItem</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">shortcut</span><span class="p">,</span> <span class="kt">bool</span><span class="o">*</span> <span class="n">p_selected</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">enabled</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">MenuItem</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">shortcut</span><span class="p">,</span> <span class="n">p_selected</span> <span class="o">?</span> <span class="o">*</span><span class="nl">p_selected</span> <span class="p">:</span> <span class="nb">false</span><span class="p">,</span> <span class="n">enabled</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p_selected</span><span class="p">)</span>
            <span class="o">*</span><span class="n">p_selected</span> <span class="o">=</span> <span class="o">!*</span><span class="n">p_selected</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: BeginTabBar, EndTabBar, etc.</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - BeginTabBar()</span>
<span class="c1">// - BeginTabBarEx() [Internal]</span>
<span class="c1">// - EndTabBar()</span>
<span class="c1">// - TabBarLayout() [Internal]</span>
<span class="c1">// - TabBarCalcTabID() [Internal]</span>
<span class="c1">// - TabBarCalcMaxTabWidth() [Internal]</span>
<span class="c1">// - TabBarFindTabById() [Internal]</span>
<span class="c1">// - TabBarRemoveTab() [Internal]</span>
<span class="c1">// - TabBarCloseTab() [Internal]</span>
<span class="c1">// - TabBarScrollClamp() [Internal]</span>
<span class="c1">// - TabBarScrollToTab() [Internal]</span>
<span class="c1">// - TabBarQueueChangeTabOrder() [Internal]</span>
<span class="c1">// - TabBarScrollingButtons() [Internal]</span>
<span class="c1">// - TabBarTabListPopupButton() [Internal]</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="k">struct</span> <span class="nc">ImGuiTabBarSection</span>
<span class="p">{</span>
    <span class="kt">int</span>                 <span class="n">TabCount</span><span class="p">;</span>               <span class="c1">// Number of tabs in this section.</span>
    <span class="kt">float</span>               <span class="n">Width</span><span class="p">;</span>                  <span class="c1">// Sum of width of tabs in this section (after shrinking down)</span>
    <span class="kt">float</span>               <span class="n">Spacing</span><span class="p">;</span>                <span class="c1">// Horizontal spacing at the end of the section.</span>

    <span class="n">ImGuiTabBarSection</span><span class="p">()</span> <span class="p">{</span> <span class="n">memset</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">));</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">namespace</span> <span class="nn">ImGui</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">void</span>             <span class="nf">TabBarLayout</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">);</span>
    <span class="k">static</span> <span class="n">ImU32</span>            <span class="nf">TabBarCalcTabID</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">);</span>
    <span class="k">static</span> <span class="kt">float</span>            <span class="nf">TabBarCalcMaxTabWidth</span><span class="p">();</span>
    <span class="k">static</span> <span class="kt">float</span>            <span class="nf">TabBarScrollClamp</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scrolling</span><span class="p">);</span>
    <span class="k">static</span> <span class="kt">void</span>             <span class="nf">TabBarScrollToTab</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">,</span> <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab</span><span class="p">,</span> <span class="n">ImGuiTabBarSection</span><span class="o">*</span> <span class="n">sections</span><span class="p">);</span>
    <span class="k">static</span> <span class="n">ImGuiTabItem</span><span class="o">*</span>    <span class="nf">TabBarScrollingButtons</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">);</span>
    <span class="k">static</span> <span class="n">ImGuiTabItem</span><span class="o">*</span>    <span class="nf">TabBarTabListPopupButton</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">ImGuiTabBar</span><span class="o">::</span><span class="n">ImGuiTabBar</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">));</span>
    <span class="n">CurrFrameVisible</span> <span class="o">=</span> <span class="n">PrevFrameVisible</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="n">LastTabItemIdx</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">IMGUI_CDECL</span> <span class="n">TabItemComparerBySection</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImGuiTabItem</span><span class="o">*</span><span class="p">)</span><span class="n">lhs</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImGuiTabItem</span><span class="o">*</span><span class="p">)</span><span class="n">rhs</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">a_section</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Leading</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Trailing</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">b_section</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Leading</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Trailing</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a_section</span> <span class="o">!=</span> <span class="n">b_section</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a_section</span> <span class="o">-</span> <span class="n">b_section</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">IndexDuringLayout</span> <span class="o">-</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">IndexDuringLayout</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">IMGUI_CDECL</span> <span class="n">TabItemComparerByBeginOrder</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImGuiTabItem</span><span class="o">*</span><span class="p">)</span><span class="n">lhs</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImGuiTabItem</span><span class="o">*</span><span class="p">)</span><span class="n">rhs</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">BeginOrder</span> <span class="o">-</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">BeginOrder</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">GetTabBarFromTabBarRef</span><span class="p">(</span><span class="k">const</span> <span class="n">ImGuiPtrOrIndex</span><span class="o">&amp;</span> <span class="n">ref</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">ref</span><span class="p">.</span><span class="n">Ptr</span> <span class="o">?</span> <span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span><span class="p">)</span><span class="n">ref</span><span class="p">.</span><span class="nl">Ptr</span> <span class="p">:</span> <span class="n">g</span><span class="p">.</span><span class="n">TabBars</span><span class="p">.</span><span class="n">GetByIndex</span><span class="p">(</span><span class="n">ref</span><span class="p">.</span><span class="n">Index</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">ImGuiPtrOrIndex</span> <span class="n">GetTabBarRefFromTabBar</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TabBars</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ImGuiPtrOrIndex</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">TabBars</span><span class="p">.</span><span class="n">GetIndex</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">ImGuiPtrOrIndex</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span>    <span class="n">ImGui</span><span class="o">::</span><span class="n">BeginTabBar</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str_id</span><span class="p">,</span> <span class="n">ImGuiTabBarFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">str_id</span><span class="p">);</span>
    <span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">TabBars</span><span class="p">.</span><span class="n">GetOrAddByKey</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="n">ImRect</span> <span class="n">tab_bar_bb</span> <span class="o">=</span> <span class="n">ImRect</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WorkRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ID</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">BeginTabBarEx</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">tab_bar_bb</span><span class="p">,</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">ImGuiTabBarFlags_IsFocused</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span>    <span class="n">ImGui</span><span class="o">::</span><span class="n">BeginTabBarEx</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImRect</span><span class="o">&amp;</span> <span class="n">tab_bar_bb</span><span class="p">,</span> <span class="n">ImGuiTabBarFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_DockNode</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">PushOverrideID</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">);</span>

    <span class="c1">// Add to stack</span>
    <span class="n">g</span><span class="p">.</span><span class="n">CurrentTabBarStack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">GetTabBarRefFromTabBar</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">));</span>
    <span class="n">g</span><span class="p">.</span><span class="n">CurrentTabBar</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="p">;</span>

    <span class="c1">// Append with multiple BeginTabBar()/EndTabBar() pairs.</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BackupCursorPos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">CurrFrameVisible</span> <span class="o">==</span> <span class="n">g</span><span class="p">.</span><span class="n">FrameCount</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ItemSpacingY</span><span class="p">);</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BeginCount</span><span class="o">++</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Ensure correct ordering when toggling ImGuiTabBarFlags_Reorderable flag, or when a new tab was added while being not reorderable</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_Reorderable</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_Reorderable</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">TabsAddedNew</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_Reorderable</span><span class="p">)))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ImQsort</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Data</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Size</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ImGuiTabItem</span><span class="p">),</span> <span class="n">TabItemComparerByBeginOrder</span><span class="p">);</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">TabsAddedNew</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Flags</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_FittingPolicyMask_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiTabBarFlags_FittingPolicyDefault_</span><span class="p">;</span>

    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">=</span> <span class="n">flags</span><span class="p">;</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span> <span class="o">=</span> <span class="n">tab_bar_bb</span><span class="p">;</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">WantLayout</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="c1">// Layout will be done on the first call to ItemTab()</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">PrevFrameVisible</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">CurrFrameVisible</span><span class="p">;</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">CurrFrameVisible</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">FrameCount</span><span class="p">;</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">PrevTabsContentsHeight</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">CurrTabsContentsHeight</span><span class="p">;</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">CurrTabsContentsHeight</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ItemSpacingY</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">FramePadding</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">;</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">TabsActiveCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BeginCount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Set cursor pos in a way which only be used in the off-chance the user erroneously submits item before BeginTabItem(): items will overlap</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ItemSpacingY</span><span class="p">);</span>

    <span class="c1">// Draw separator</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_IsFocused</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiCol_TabActive</span> <span class="p">:</span> <span class="n">ImGuiCol_TabUnfocusedActive</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="mf">1.0f</span><span class="p">;</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">separator_min_x</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowPadding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">);</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">separator_max_x</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowPadding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">);</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddLine</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">separator_min_x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">separator_max_x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span>    <span class="n">ImGui</span><span class="o">::</span><span class="n">EndTabBar</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentTabBar</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IM_ASSERT_USER_ERROR</span><span class="p">(</span><span class="n">tab_bar</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Mismatched BeginTabBar()/EndTabBar()!&quot;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Fallback in case no TabItem have been submitted</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">WantLayout</span><span class="p">)</span>
        <span class="n">TabBarLayout</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">);</span>

    <span class="c1">// Restore the last visible height if no tab is visible, this reduce vertical flicker/movement when a tabs gets removed without calling SetTabItemClosed().</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">tab_bar_appearing</span> <span class="o">=</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">PrevFrameVisible</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">FrameCount</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">VisibleTabWasSubmitted</span> <span class="o">||</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">VisibleTabId</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">tab_bar_appearing</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">CurrTabsContentsHeight</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">CurrTabsContentsHeight</span><span class="p">);</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">CurrTabsContentsHeight</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">PrevTabsContentsHeight</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BeginCount</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BackupCursorPos</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_DockNode</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">PopID</span><span class="p">();</span>

    <span class="n">g</span><span class="p">.</span><span class="n">CurrentTabBarStack</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
    <span class="n">g</span><span class="p">.</span><span class="n">CurrentTabBar</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentTabBarStack</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">?</span> <span class="nb">NULL</span> <span class="o">:</span> <span class="n">GetTabBarFromTabBarRef</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">CurrentTabBarStack</span><span class="p">.</span><span class="n">back</span><span class="p">());</span>
<span class="p">}</span>

<span class="c1">// This is called only once a frame before by the first call to ItemTab()</span>
<span class="c1">// The reason we&#39;re not calling it in BeginTabBar() is to leave a chance to the user to call the SetTabItemClosed() functions.</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TabBarLayout</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">WantLayout</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Garbage collect by compacting list</span>
    <span class="c1">// Detect if we need to sort out tab list (e.g. in rare case where a tab changed section)</span>
    <span class="kt">int</span> <span class="n">tab_dst_n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">need_sort_by_section</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">ImGuiTabBarSection</span> <span class="n">sections</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span> <span class="c1">// Layout sections: Leading, Central, Trailing</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">tab_src_n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">tab_src_n</span> <span class="o">&lt;</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Size</span><span class="p">;</span> <span class="n">tab_src_n</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">[</span><span class="n">tab_src_n</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">LastFrameVisible</span> <span class="o">&lt;</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">PrevFrameVisible</span> <span class="o">||</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">WantClose</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Remove tab</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">VisibleTabId</span> <span class="o">==</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">)</span> <span class="p">{</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">VisibleTabId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">==</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">)</span> <span class="p">{</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">NextSelectedTabId</span> <span class="o">==</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">)</span> <span class="p">{</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">NextSelectedTabId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tab_dst_n</span> <span class="o">!=</span> <span class="n">tab_src_n</span><span class="p">)</span>
            <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">[</span><span class="n">tab_dst_n</span><span class="p">]</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">[</span><span class="n">tab_src_n</span><span class="p">];</span>

        <span class="n">tab</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">[</span><span class="n">tab_dst_n</span><span class="p">];</span>
        <span class="n">tab</span><span class="o">-&gt;</span><span class="n">IndexDuringLayout</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImS16</span><span class="p">)</span><span class="n">tab_dst_n</span><span class="p">;</span>

        <span class="c1">// We will need sorting if tabs have changed section (e.g. moved from one of Leading/Central/Trailing to another)</span>
        <span class="kt">int</span> <span class="n">curr_tab_section_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Leading</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Trailing</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tab_dst_n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">prev_tab</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">[</span><span class="n">tab_dst_n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
            <span class="kt">int</span> <span class="n">prev_tab_section_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">prev_tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Leading</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="p">(</span><span class="n">prev_tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Trailing</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">curr_tab_section_n</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">prev_tab_section_n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">need_sort_by_section</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">prev_tab_section_n</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">curr_tab_section_n</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">need_sort_by_section</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">sections</span><span class="p">[</span><span class="n">curr_tab_section_n</span><span class="p">].</span><span class="n">TabCount</span><span class="o">++</span><span class="p">;</span>
        <span class="n">tab_dst_n</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Size</span> <span class="o">!=</span> <span class="n">tab_dst_n</span><span class="p">)</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">tab_dst_n</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">need_sort_by_section</span><span class="p">)</span>
        <span class="n">ImQsort</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Data</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Size</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ImGuiTabItem</span><span class="p">),</span> <span class="n">TabItemComparerBySection</span><span class="p">);</span>

    <span class="c1">// Calculate spacing between sections</span>
    <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Spacing</span> <span class="o">=</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">TabCount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">sections</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">TabCount</span> <span class="o">+</span> <span class="n">sections</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">TabCount</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="n">sections</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">Spacing</span> <span class="o">=</span> <span class="n">sections</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">TabCount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sections</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">TabCount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">;</span>

    <span class="c1">// Setup next selected tab</span>
    <span class="n">ImGuiID</span> <span class="n">scroll_track_selected_tab_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">NextSelectedTabId</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">NextSelectedTabId</span><span class="p">;</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">NextSelectedTabId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">scroll_track_selected_tab_id</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Process order change request (we could probably process it when requested but it&#39;s just saner to do it in a single spot).</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ReorderRequestTabId</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">TabBarProcessReorder</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ReorderRequestTabId</span> <span class="o">==</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span><span class="p">)</span>
                <span class="n">scroll_track_selected_tab_id</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ReorderRequestTabId</span><span class="p">;</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ReorderRequestTabId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Tab List Popup (will alter tab_bar-&gt;BarRect and therefore the available width!)</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">tab_list_popup_button</span> <span class="o">=</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_TabListPopupButton</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_list_popup_button</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab_to_select</span> <span class="o">=</span> <span class="n">TabBarTabListPopupButton</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">))</span> <span class="c1">// NB: Will alter BarRect.Min.x!</span>
            <span class="n">scroll_track_selected_tab_id</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">=</span> <span class="n">tab_to_select</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">;</span>

    <span class="c1">// Leading/Trailing tabs will be shrink only if central one aren&#39;t visible anymore, so layout the shrink data as: leading, trailing, central</span>
    <span class="c1">// (whereas our tabs are stored as: leading, central, trailing)</span>
    <span class="kt">int</span> <span class="n">shrink_buffer_indexes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">TabCount</span> <span class="o">+</span> <span class="n">sections</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">TabCount</span><span class="p">,</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">TabCount</span> <span class="p">};</span>
    <span class="n">g</span><span class="p">.</span><span class="n">ShrinkWidthBuffer</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Size</span><span class="p">);</span>

    <span class="c1">// Compute ideal tabs widths + store them into shrink buffer</span>
    <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">most_recently_selected_tab</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">curr_section_n</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">found_selected_tab_id</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">tab_n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">tab_n</span> <span class="o">&lt;</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Size</span><span class="p">;</span> <span class="n">tab_n</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">[</span><span class="n">tab_n</span><span class="p">];</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">LastFrameVisible</span> <span class="o">&gt;=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">PrevFrameVisible</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">most_recently_selected_tab</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">most_recently_selected_tab</span><span class="o">-&gt;</span><span class="n">LastFrameSelected</span> <span class="o">&lt;</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">LastFrameSelected</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Button</span><span class="p">))</span>
            <span class="n">most_recently_selected_tab</span> <span class="o">=</span> <span class="n">tab</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">ID</span> <span class="o">==</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span><span class="p">)</span>
            <span class="n">found_selected_tab_id</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">scroll_track_selected_tab_id</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">NavJustMovedToId</span> <span class="o">==</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">)</span>
            <span class="n">scroll_track_selected_tab_id</span> <span class="o">=</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">;</span>

        <span class="c1">// Refresh tab width immediately, otherwise changes of style e.g. style.FramePadding.x would noticeably lag in the tab bar.</span>
        <span class="c1">// Additionally, when using TabBarAddTab() to manipulate tab bar order we occasionally insert new tabs that don&#39;t have a width yet,</span>
        <span class="c1">// and we cannot wait for the next BeginTabItem() call. We cannot compute this width within TabBarAddTab() because font size depends on the active window.</span>
        <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">tab_name</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">GetTabName</span><span class="p">(</span><span class="n">tab</span><span class="p">);</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">has_close_button</span> <span class="o">=</span> <span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_NoCloseButton</span><span class="p">)</span> <span class="o">?</span> <span class="nb">false</span> <span class="o">:</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ContentWidth</span> <span class="o">=</span> <span class="n">TabItemCalcSize</span><span class="p">(</span><span class="n">tab_name</span><span class="p">,</span> <span class="n">has_close_button</span><span class="p">).</span><span class="n">x</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">section_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Leading</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Trailing</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">ImGuiTabBarSection</span><span class="o">*</span> <span class="n">section</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sections</span><span class="p">[</span><span class="n">section_n</span><span class="p">];</span>
        <span class="n">section</span><span class="o">-&gt;</span><span class="n">Width</span> <span class="o">+=</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ContentWidth</span> <span class="o">+</span> <span class="p">(</span><span class="n">section_n</span> <span class="o">==</span> <span class="n">curr_section_n</span> <span class="o">?</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="n">curr_section_n</span> <span class="o">=</span> <span class="n">section_n</span><span class="p">;</span>

        <span class="c1">// Store data so we can build an array sorted by width if we need to shrink tabs down</span>
        <span class="kt">int</span> <span class="n">shrink_buffer_index</span> <span class="o">=</span> <span class="n">shrink_buffer_indexes</span><span class="p">[</span><span class="n">section_n</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="n">g</span><span class="p">.</span><span class="n">ShrinkWidthBuffer</span><span class="p">[</span><span class="n">shrink_buffer_index</span><span class="p">].</span><span class="n">Index</span> <span class="o">=</span> <span class="n">tab_n</span><span class="p">;</span>
        <span class="n">g</span><span class="p">.</span><span class="n">ShrinkWidthBuffer</span><span class="p">[</span><span class="n">shrink_buffer_index</span><span class="p">].</span><span class="n">Width</span> <span class="o">=</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ContentWidth</span><span class="p">;</span>

        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">ContentWidth</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="n">tab</span><span class="o">-&gt;</span><span class="n">Width</span> <span class="o">=</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ContentWidth</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Compute total ideal width (used for e.g. auto-resizing a window)</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">WidthAllTabsIdeal</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">section_n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">section_n</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">section_n</span><span class="o">++</span><span class="p">)</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">WidthAllTabsIdeal</span> <span class="o">+=</span> <span class="n">sections</span><span class="p">[</span><span class="n">section_n</span><span class="p">].</span><span class="n">Width</span> <span class="o">+</span> <span class="n">sections</span><span class="p">[</span><span class="n">section_n</span><span class="p">].</span><span class="n">Spacing</span><span class="p">;</span>

    <span class="c1">// Horizontal scrolling buttons</span>
    <span class="c1">// (note that TabBarScrollButtons() will alter BarRect.Max.x)</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">WidthAllTabsIdeal</span> <span class="o">&gt;</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_NoTabListScrollingButtons</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_FittingPolicyScroll</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">scroll_track_selected_tab</span> <span class="o">=</span> <span class="n">TabBarScrollingButtons</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">scroll_track_selected_tab_id</span> <span class="o">=</span> <span class="n">scroll_track_selected_tab</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">scroll_track_selected_tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Button</span><span class="p">))</span>
                <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">=</span> <span class="n">scroll_track_selected_tab_id</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="c1">// Shrink widths if full tabs don&#39;t fit in their allocated space</span>
    <span class="kt">float</span> <span class="n">section_0_w</span> <span class="o">=</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Width</span> <span class="o">+</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Spacing</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">section_1_w</span> <span class="o">=</span> <span class="n">sections</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">Width</span> <span class="o">+</span> <span class="n">sections</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">Spacing</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">section_2_w</span> <span class="o">=</span> <span class="n">sections</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">Width</span> <span class="o">+</span> <span class="n">sections</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">Spacing</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">central_section_is_visible</span> <span class="o">=</span> <span class="p">(</span><span class="n">section_0_w</span> <span class="o">+</span> <span class="n">section_2_w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">();</span>
    <span class="kt">float</span> <span class="n">width_excess</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">central_section_is_visible</span><span class="p">)</span>
        <span class="n">width_excess</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">section_1_w</span> <span class="o">-</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">()</span> <span class="o">-</span> <span class="n">section_0_w</span> <span class="o">-</span> <span class="n">section_2_w</span><span class="p">),</span> <span class="mf">0.0f</span><span class="p">);</span> <span class="c1">// Excess used to shrink central section</span>
    <span class="k">else</span>
        <span class="n">width_excess</span> <span class="o">=</span> <span class="p">(</span><span class="n">section_0_w</span> <span class="o">+</span> <span class="n">section_2_w</span><span class="p">)</span> <span class="o">-</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">();</span> <span class="c1">// Excess used to shrink leading/trailing section</span>

    <span class="c1">// With ImGuiTabBarFlags_FittingPolicyScroll policy, we will only shrink leading/trailing if the central section is not visible anymore</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">width_excess</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_FittingPolicyResizeDown</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">central_section_is_visible</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">shrink_data_count</span> <span class="o">=</span> <span class="p">(</span><span class="n">central_section_is_visible</span> <span class="o">?</span> <span class="n">sections</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nl">TabCount</span> <span class="p">:</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">TabCount</span> <span class="o">+</span> <span class="n">sections</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">TabCount</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">shrink_data_offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">central_section_is_visible</span> <span class="o">?</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">TabCount</span> <span class="o">+</span> <span class="n">sections</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nl">TabCount</span> <span class="p">:</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">ShrinkWidths</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ShrinkWidthBuffer</span><span class="p">.</span><span class="n">Data</span> <span class="o">+</span> <span class="n">shrink_data_offset</span><span class="p">,</span> <span class="n">shrink_data_count</span><span class="p">,</span> <span class="n">width_excess</span><span class="p">);</span>

        <span class="c1">// Apply shrunk values into tabs and sections</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">tab_n</span> <span class="o">=</span> <span class="n">shrink_data_offset</span><span class="p">;</span> <span class="n">tab_n</span> <span class="o">&lt;</span> <span class="n">shrink_data_offset</span> <span class="o">+</span> <span class="n">shrink_data_count</span><span class="p">;</span> <span class="n">tab_n</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">[</span><span class="n">g</span><span class="p">.</span><span class="n">ShrinkWidthBuffer</span><span class="p">[</span><span class="n">tab_n</span><span class="p">].</span><span class="n">Index</span><span class="p">];</span>
            <span class="kt">float</span> <span class="n">shrinked_width</span> <span class="o">=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ShrinkWidthBuffer</span><span class="p">[</span><span class="n">tab_n</span><span class="p">].</span><span class="n">Width</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">shrinked_width</span> <span class="o">&lt;</span> <span class="mf">0.0f</span><span class="p">)</span>
                <span class="k">continue</span><span class="p">;</span>

            <span class="kt">int</span> <span class="n">section_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Leading</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Trailing</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">sections</span><span class="p">[</span><span class="n">section_n</span><span class="p">].</span><span class="n">Width</span> <span class="o">-=</span> <span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Width</span> <span class="o">-</span> <span class="n">shrinked_width</span><span class="p">);</span>
            <span class="n">tab</span><span class="o">-&gt;</span><span class="n">Width</span> <span class="o">=</span> <span class="n">shrinked_width</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Layout all active tabs</span>
    <span class="kt">int</span> <span class="n">section_tab_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">tab_offset</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">WidthAllTabs</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">section_n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">section_n</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">section_n</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ImGuiTabBarSection</span><span class="o">*</span> <span class="n">section</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sections</span><span class="p">[</span><span class="n">section_n</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">section_n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">tab_offset</span> <span class="o">=</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">ImMax</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">()</span> <span class="o">-</span> <span class="n">section</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">),</span> <span class="n">tab_offset</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">tab_n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">tab_n</span> <span class="o">&lt;</span> <span class="n">section</span><span class="o">-&gt;</span><span class="n">TabCount</span><span class="p">;</span> <span class="n">tab_n</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">[</span><span class="n">section_tab_index</span> <span class="o">+</span> <span class="n">tab_n</span><span class="p">];</span>
            <span class="n">tab</span><span class="o">-&gt;</span><span class="n">Offset</span> <span class="o">=</span> <span class="n">tab_offset</span><span class="p">;</span>
            <span class="n">tab_offset</span> <span class="o">+=</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">Width</span> <span class="o">+</span> <span class="p">(</span><span class="n">tab_n</span> <span class="o">&lt;</span> <span class="n">section</span><span class="o">-&gt;</span><span class="n">TabCount</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">?</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">WidthAllTabs</span> <span class="o">+=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">section</span><span class="o">-&gt;</span><span class="n">Width</span> <span class="o">+</span> <span class="n">section</span><span class="o">-&gt;</span><span class="n">Spacing</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="n">tab_offset</span> <span class="o">+=</span> <span class="n">section</span><span class="o">-&gt;</span><span class="n">Spacing</span><span class="p">;</span>
        <span class="n">section_tab_index</span> <span class="o">+=</span> <span class="n">section</span><span class="o">-&gt;</span><span class="n">TabCount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// If we have lost the selected tab, select the next most recently active one</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">found_selected_tab_id</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">NextSelectedTabId</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">most_recently_selected_tab</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="n">scroll_track_selected_tab_id</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">=</span> <span class="n">most_recently_selected_tab</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">;</span>

    <span class="c1">// Lock in visible tab</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">VisibleTabId</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span><span class="p">;</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">VisibleTabWasSubmitted</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Update scrolling</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">scroll_track_selected_tab_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">scroll_track_selected_tab</span> <span class="o">=</span> <span class="n">TabBarFindTabByID</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">scroll_track_selected_tab_id</span><span class="p">))</span>
            <span class="n">TabBarScrollToTab</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">scroll_track_selected_tab</span><span class="p">,</span> <span class="n">sections</span><span class="p">);</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingAnim</span> <span class="o">=</span> <span class="n">TabBarScrollClamp</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingAnim</span><span class="p">);</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingTarget</span> <span class="o">=</span> <span class="n">TabBarScrollClamp</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingTarget</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingAnim</span> <span class="o">!=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingTarget</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Scrolling speed adjust itself so we can always reach our target in 1/3 seconds.</span>
        <span class="c1">// Teleport if we are aiming far off the visible line</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingSpeed</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingSpeed</span><span class="p">,</span> <span class="mf">70.0f</span> <span class="o">*</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">);</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingSpeed</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingSpeed</span><span class="p">,</span> <span class="n">ImFabs</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingTarget</span> <span class="o">-</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingAnim</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.3f</span><span class="p">);</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">teleport</span> <span class="o">=</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">PrevFrameVisible</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">FrameCount</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingTargetDistToVisibility</span> <span class="o">&gt;</span> <span class="mf">10.0f</span> <span class="o">*</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">);</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingAnim</span> <span class="o">=</span> <span class="n">teleport</span> <span class="o">?</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="nl">ScrollingTarget</span> <span class="p">:</span> <span class="n">ImLinearSweep</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingAnim</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingTarget</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">DeltaTime</span> <span class="o">*</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingSpeed</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingSpeed</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingRectMinX</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Width</span> <span class="o">+</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Spacing</span><span class="p">;</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingRectMaxX</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">sections</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">Width</span> <span class="o">-</span> <span class="n">sections</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">Spacing</span><span class="p">;</span>

    <span class="c1">// Clear name buffers</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_DockNode</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">TabsNames</span><span class="p">.</span><span class="n">Buf</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="c1">// Actual layout in host window (we don&#39;t do it in BeginTabBar() so as not to waste an extra frame)</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Min</span><span class="p">;</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">WidthAllTabsIdeal</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">GetHeight</span><span class="p">()),</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Dockables uses Name/ID in the global namespace. Non-dockable items use the ID stack.</span>
<span class="k">static</span> <span class="n">ImU32</span>   <span class="n">ImGui</span><span class="o">::</span><span class="n">TabBarCalcTabID</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_DockNode</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">ImHashStr</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
        <span class="n">KeepAliveID</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">id</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GImGui</span><span class="o">-&gt;</span><span class="n">CurrentWindow</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">float</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TabBarCalcMaxTabWidth</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">20.0f</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TabBarFindTabByID</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">,</span> <span class="n">ImGuiID</span> <span class="n">tab_id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Size</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ID</span> <span class="o">==</span> <span class="n">tab_id</span><span class="p">)</span>
                <span class="k">return</span> <span class="o">&amp;</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// The *TabId fields be already set by the docking system _before_ the actual TabItem was created, so we clear them regardless.</span>
<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TabBarRemoveTab</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">,</span> <span class="n">ImGuiID</span> <span class="n">tab_id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab</span> <span class="o">=</span> <span class="n">TabBarFindTabByID</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">tab_id</span><span class="p">))</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">tab</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">VisibleTabId</span> <span class="o">==</span> <span class="n">tab_id</span><span class="p">)</span>      <span class="p">{</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">VisibleTabId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">==</span> <span class="n">tab_id</span><span class="p">)</span>     <span class="p">{</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">NextSelectedTabId</span> <span class="o">==</span> <span class="n">tab_id</span><span class="p">)</span> <span class="p">{</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">NextSelectedTabId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Called on manual closure attempt</span>
<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TabBarCloseTab</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">,</span> <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Button</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_UnsavedDocument</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// This will remove a frame of lag for selecting another tab on closure.</span>
        <span class="c1">// However we don&#39;t run it in the case where the &#39;Unsaved&#39; flag is set, so user gets a chance to fully undo the closure</span>
        <span class="n">tab</span><span class="o">-&gt;</span><span class="n">WantClose</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">VisibleTabId</span> <span class="o">==</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">tab</span><span class="o">-&gt;</span><span class="n">LastFrameVisible</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
            <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">NextSelectedTabId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// Actually select before expecting closure attempt (on an UnsavedDocument tab user is expect to e.g. show a popup)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">VisibleTabId</span> <span class="o">!=</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">)</span>
            <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">NextSelectedTabId</span> <span class="o">=</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">float</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TabBarScrollClamp</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scrolling</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">scrolling</span> <span class="o">=</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">scrolling</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">WidthAllTabs</span> <span class="o">-</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">());</span>
    <span class="k">return</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">scrolling</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TabBarScrollToTab</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">,</span> <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab</span><span class="p">,</span> <span class="n">ImGuiTabBarSection</span><span class="o">*</span> <span class="n">sections</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiTabItemFlags_Leading</span> <span class="o">|</span> <span class="n">ImGuiTabItemFlags_Trailing</span><span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">margin</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">1.0f</span><span class="p">;</span> <span class="c1">// When to scroll to make Tab N+1 visible always make a bit of N visible to suggest more scrolling area (since we don&#39;t have a scrollbar)</span>
    <span class="kt">int</span> <span class="n">order</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">GetTabOrder</span><span class="p">(</span><span class="n">tab</span><span class="p">);</span>

    <span class="c1">// Scrolling happens only in the central section (leading/trailing sections are not scrolling)</span>
    <span class="c1">// FIXME: This is all confusing.</span>
    <span class="kt">float</span> <span class="n">scrollable_width</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">()</span> <span class="o">-</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Width</span> <span class="o">-</span> <span class="n">sections</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">Width</span> <span class="o">-</span> <span class="n">sections</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">Spacing</span><span class="p">;</span>

    <span class="c1">// We make all tabs positions all relative Sections[0].Width to make code simpler</span>
    <span class="kt">float</span> <span class="n">tab_x1</span> <span class="o">=</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">Offset</span> <span class="o">-</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Width</span> <span class="o">+</span> <span class="p">(</span><span class="n">order</span> <span class="o">&gt;</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">TabCount</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">?</span> <span class="o">-</span><span class="nl">margin</span> <span class="p">:</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">tab_x2</span> <span class="o">=</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">Offset</span> <span class="o">-</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Width</span> <span class="o">+</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">Width</span> <span class="o">+</span> <span class="p">(</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Size</span> <span class="o">-</span> <span class="n">sections</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">TabCount</span> <span class="o">?</span> <span class="nl">margin</span> <span class="p">:</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingTargetDistToVisibility</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingTarget</span> <span class="o">&gt;</span> <span class="n">tab_x1</span> <span class="o">||</span> <span class="p">(</span><span class="n">tab_x2</span> <span class="o">-</span> <span class="n">tab_x1</span> <span class="o">&gt;=</span> <span class="n">scrollable_width</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// Scroll to the left</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingTargetDistToVisibility</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingAnim</span> <span class="o">-</span> <span class="n">tab_x2</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingTarget</span> <span class="o">=</span> <span class="n">tab_x1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingTarget</span> <span class="o">&lt;</span> <span class="n">tab_x2</span> <span class="o">-</span> <span class="n">scrollable_width</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Scroll to the right</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingTargetDistToVisibility</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">((</span><span class="n">tab_x1</span> <span class="o">-</span> <span class="n">scrollable_width</span><span class="p">)</span> <span class="o">-</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingAnim</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingTarget</span> <span class="o">=</span> <span class="n">tab_x2</span> <span class="o">-</span> <span class="n">scrollable_width</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TabBarQueueReorder</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dir</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">dir</span> <span class="o">==</span> <span class="mi">-1</span> <span class="o">||</span> <span class="n">dir</span> <span class="o">==</span> <span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ReorderRequestTabId</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ReorderRequestTabId</span> <span class="o">=</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">;</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ReorderRequestDir</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImS8</span><span class="p">)</span><span class="n">dir</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TabBarProcessReorder</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab1</span> <span class="o">=</span> <span class="n">TabBarFindTabByID</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ReorderRequestTabId</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab1</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="p">(</span><span class="n">tab1</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_NoReorder</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">//IM_ASSERT(tab_bar-&gt;Flags &amp; ImGuiTabBarFlags_Reorderable); // &lt;- this may happen when using debug tools</span>
    <span class="kt">int</span> <span class="n">tab2_order</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">GetTabOrder</span><span class="p">(</span><span class="n">tab1</span><span class="p">)</span> <span class="o">+</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ReorderRequestDir</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab2_order</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">tab2_order</span> <span class="o">&gt;=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Size</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Reordered TabItem must share the same position flags than target</span>
    <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">[</span><span class="n">tab2_order</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab2</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_NoReorder</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">tab1</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiTabItemFlags_Leading</span> <span class="o">|</span> <span class="n">ImGuiTabItemFlags_Trailing</span><span class="p">))</span> <span class="o">!=</span> <span class="p">(</span><span class="n">tab2</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiTabItemFlags_Leading</span> <span class="o">|</span> <span class="n">ImGuiTabItemFlags_Trailing</span><span class="p">)))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiTabItem</span> <span class="n">item_tmp</span> <span class="o">=</span> <span class="o">*</span><span class="n">tab1</span><span class="p">;</span>
    <span class="o">*</span><span class="n">tab1</span> <span class="o">=</span> <span class="o">*</span><span class="n">tab2</span><span class="p">;</span>
    <span class="o">*</span><span class="n">tab2</span> <span class="o">=</span> <span class="n">item_tmp</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_SaveSettings</span><span class="p">)</span>
        <span class="n">MarkIniSettingsDirty</span><span class="p">();</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TabBarScrollingButtons</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">ImVec2</span> <span class="nf">arrow_button_size</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">-</span> <span class="mf">2.0f</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">scrolling_buttons_width</span> <span class="o">=</span> <span class="n">arrow_button_size</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">backup_cursor_pos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">;</span>
    <span class="c1">//window-&gt;DrawList-&gt;AddRect(ImVec2(tab_bar-&gt;BarRect.Max.x - scrolling_buttons_width, tab_bar-&gt;BarRect.Min.y), ImVec2(tab_bar-&gt;BarRect.Max.x, tab_bar-&gt;BarRect.Max.y), IM_COL32(255,0,0,255));</span>

    <span class="kt">int</span> <span class="n">select_dir</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">ImVec4</span> <span class="n">arrow_col</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">Colors</span><span class="p">[</span><span class="n">ImGuiCol_Text</span><span class="p">];</span>
    <span class="n">arrow_col</span><span class="p">.</span><span class="n">w</span> <span class="o">*=</span> <span class="mf">0.5f</span><span class="p">;</span>

    <span class="n">PushStyleColor</span><span class="p">(</span><span class="n">ImGuiCol_Text</span><span class="p">,</span> <span class="n">arrow_col</span><span class="p">);</span>
    <span class="n">PushStyleColor</span><span class="p">(</span><span class="n">ImGuiCol_Button</span><span class="p">,</span> <span class="n">ImVec4</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">backup_repeat_delay</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyRepeatDelay</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">backup_repeat_rate</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyRepeatRate</span><span class="p">;</span>
    <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyRepeatDelay</span> <span class="o">=</span> <span class="mf">0.250f</span><span class="p">;</span>
    <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyRepeatRate</span> <span class="o">=</span> <span class="mf">0.200f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">scrolling_buttons_width</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ArrowButtonEx</span><span class="p">(</span><span class="s">&quot;##&lt;&quot;</span><span class="p">,</span> <span class="n">ImGuiDir_Left</span><span class="p">,</span> <span class="n">arrow_button_size</span><span class="p">,</span> <span class="n">ImGuiButtonFlags_PressedOnClick</span> <span class="o">|</span> <span class="n">ImGuiButtonFlags_Repeat</span><span class="p">))</span>
        <span class="n">select_dir</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">arrow_button_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ArrowButtonEx</span><span class="p">(</span><span class="s">&quot;##&gt;&quot;</span><span class="p">,</span> <span class="n">ImGuiDir_Right</span><span class="p">,</span> <span class="n">arrow_button_size</span><span class="p">,</span> <span class="n">ImGuiButtonFlags_PressedOnClick</span> <span class="o">|</span> <span class="n">ImGuiButtonFlags_Repeat</span><span class="p">))</span>
        <span class="n">select_dir</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">PopStyleColor</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyRepeatRate</span> <span class="o">=</span> <span class="n">backup_repeat_rate</span><span class="p">;</span>
    <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">KeyRepeatDelay</span> <span class="o">=</span> <span class="n">backup_repeat_delay</span><span class="p">;</span>

    <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab_to_scroll_to</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">select_dir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab_item</span> <span class="o">=</span> <span class="n">TabBarFindTabByID</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">selected_order</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">GetTabOrder</span><span class="p">(</span><span class="n">tab_item</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">target_order</span> <span class="o">=</span> <span class="n">selected_order</span> <span class="o">+</span> <span class="n">select_dir</span><span class="p">;</span>

            <span class="c1">// Skip tab item buttons until another tab item is found or end is reached</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">tab_to_scroll_to</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// If we are at the end of the list, still scroll to make our tab visible</span>
                <span class="n">tab_to_scroll_to</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">[(</span><span class="n">target_order</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">target_order</span> <span class="o">&lt;</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Size</span><span class="p">)</span> <span class="o">?</span> <span class="nl">target_order</span> <span class="p">:</span> <span class="n">selected_order</span><span class="p">];</span>

                <span class="c1">// Cross through buttons</span>
                <span class="c1">// (even if first/last item is a button, return it so we can update the scroll)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">tab_to_scroll_to</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Button</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">target_order</span> <span class="o">+=</span> <span class="n">select_dir</span><span class="p">;</span>
                    <span class="n">selected_order</span> <span class="o">+=</span> <span class="n">select_dir</span><span class="p">;</span>
                    <span class="n">tab_to_scroll_to</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_order</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">target_order</span> <span class="o">&gt;=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Size</span><span class="p">)</span> <span class="o">?</span> <span class="nl">tab_to_scroll_to</span> <span class="p">:</span> <span class="nb">NULL</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">backup_cursor_pos</span><span class="p">;</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">scrolling_buttons_width</span> <span class="o">+</span> <span class="mf">1.0f</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">tab_to_scroll_to</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TabBarTabListPopupButton</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>

    <span class="c1">// We use g.Style.FramePadding.y to match the square ArrowButton size</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">tab_list_popup_button_width</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">backup_cursor_pos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">tab_list_popup_button_width</span><span class="p">;</span>

    <span class="n">ImVec4</span> <span class="n">arrow_col</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">Colors</span><span class="p">[</span><span class="n">ImGuiCol_Text</span><span class="p">];</span>
    <span class="n">arrow_col</span><span class="p">.</span><span class="n">w</span> <span class="o">*=</span> <span class="mf">0.5f</span><span class="p">;</span>
    <span class="n">PushStyleColor</span><span class="p">(</span><span class="n">ImGuiCol_Text</span><span class="p">,</span> <span class="n">arrow_col</span><span class="p">);</span>
    <span class="n">PushStyleColor</span><span class="p">(</span><span class="n">ImGuiCol_Button</span><span class="p">,</span> <span class="n">ImVec4</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
    <span class="kt">bool</span> <span class="n">open</span> <span class="o">=</span> <span class="n">BeginCombo</span><span class="p">(</span><span class="s">&quot;##v&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">ImGuiComboFlags_NoPreview</span> <span class="o">|</span> <span class="n">ImGuiComboFlags_HeightLargest</span><span class="p">);</span>
    <span class="n">PopStyleColor</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

    <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab_to_select</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">open</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">tab_n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">tab_n</span> <span class="o">&lt;</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Size</span><span class="p">;</span> <span class="n">tab_n</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">[</span><span class="n">tab_n</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Button</span><span class="p">)</span>
                <span class="k">continue</span><span class="p">;</span>

            <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">tab_name</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">GetTabName</span><span class="p">(</span><span class="n">tab</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Selectable</span><span class="p">(</span><span class="n">tab_name</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">==</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">))</span>
                <span class="n">tab_to_select</span> <span class="o">=</span> <span class="n">tab</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">EndCombo</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">backup_cursor_pos</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">tab_to_select</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: BeginTabItem, EndTabItem, etc.</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - BeginTabItem()</span>
<span class="c1">// - EndTabItem()</span>
<span class="c1">// - TabItemButton()</span>
<span class="c1">// - TabItemEx() [Internal]</span>
<span class="c1">// - SetTabItemClosed()</span>
<span class="c1">// - TabItemCalcSize() [Internal]</span>
<span class="c1">// - TabItemBackground() [Internal]</span>
<span class="c1">// - TabItemLabelAndCloseButton() [Internal]</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="kt">bool</span>    <span class="n">ImGui</span><span class="o">::</span><span class="n">BeginTabItem</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">bool</span><span class="o">*</span> <span class="n">p_open</span><span class="p">,</span> <span class="n">ImGuiTabItemFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentTabBar</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IM_ASSERT_USER_ERROR</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="s">&quot;Needs to be called between BeginTabBar() and EndTabBar()!&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Button</span><span class="p">));</span> <span class="c1">// BeginTabItem() Can&#39;t be used with button flags, use TabItemButton() instead!</span>

    <span class="kt">bool</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">TabItemEx</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">p_open</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_NoPushId</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">[</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">LastTabItemIdx</span><span class="p">];</span>
        <span class="n">PushOverrideID</span><span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">);</span> <span class="c1">// We already hashed &#39;label&#39; so push into the ID stack directly instead of doing another hash through PushID(label)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span>    <span class="n">ImGui</span><span class="o">::</span><span class="n">EndTabItem</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentTabBar</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IM_ASSERT_USER_ERROR</span><span class="p">(</span><span class="n">tab_bar</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Needs to be called between BeginTabBar() and EndTabBar()!&quot;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">LastTabItemIdx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">[</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">LastTabItemIdx</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_NoPushId</span><span class="p">))</span>
        <span class="n">PopID</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">bool</span>    <span class="n">ImGui</span><span class="o">::</span><span class="n">TabItemButton</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">ImGuiTabItemFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentTabBar</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IM_ASSERT_USER_ERROR</span><span class="p">(</span><span class="n">tab_bar</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Needs to be called between BeginTabBar() and EndTabBar()!&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">TabItemEx</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">ImGuiTabItemFlags_Button</span> <span class="o">|</span> <span class="n">ImGuiTabItemFlags_NoReorder</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span>    <span class="n">ImGui</span><span class="o">::</span><span class="n">TabItemEx</span><span class="p">(</span><span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">bool</span><span class="o">*</span> <span class="n">p_open</span><span class="p">,</span> <span class="n">ImGuiTabItemFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Layout whole tab bar if not already done</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">WantLayout</span><span class="p">)</span>
        <span class="n">TabBarLayout</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">);</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">ImGuiStyle</span><span class="o">&amp;</span> <span class="n">style</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">TabBarCalcTabID</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>

    <span class="c1">// If the user called us with *p_open == false, we early out and don&#39;t render.</span>
    <span class="c1">// We make a call to ItemAdd() so that attempts to use a contextual popup menu with an implicit ID won&#39;t use an older ID.</span>
    <span class="n">IMGUI_TEST_ENGINE_ITEM_INFO</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">LastItemStatusFlags</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p_open</span> <span class="o">&amp;&amp;</span> <span class="o">!*</span><span class="n">p_open</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">PushItemFlag</span><span class="p">(</span><span class="n">ImGuiItemFlags_NoNav</span> <span class="o">|</span> <span class="n">ImGuiItemFlags_NoNavDefaultFocus</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
        <span class="n">ItemAdd</span><span class="p">(</span><span class="n">ImRect</span><span class="p">(),</span> <span class="n">id</span><span class="p">);</span>
        <span class="n">PopItemFlag</span><span class="p">();</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">!</span><span class="n">p_open</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Button</span><span class="p">));</span>
    <span class="n">IM_ASSERT</span><span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiTabItemFlags_Leading</span> <span class="o">|</span> <span class="n">ImGuiTabItemFlags_Trailing</span><span class="p">))</span> <span class="o">!=</span> <span class="p">(</span><span class="n">ImGuiTabItemFlags_Leading</span> <span class="o">|</span> <span class="n">ImGuiTabItemFlags_Trailing</span><span class="p">));</span> <span class="c1">// Can&#39;t use both Leading and Trailing</span>

    <span class="c1">// Store into ImGuiTabItemFlags_NoCloseButton, also honor ImGuiTabItemFlags_NoCloseButton passed by user (although not documented)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_NoCloseButton</span><span class="p">)</span>
        <span class="n">p_open</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">p_open</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiTabItemFlags_NoCloseButton</span><span class="p">;</span>

    <span class="c1">// Calculate tab contents size</span>
    <span class="n">ImVec2</span> <span class="n">size</span> <span class="o">=</span> <span class="n">TabItemCalcSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">p_open</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="c1">// Acquire tab data</span>
    <span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab</span> <span class="o">=</span> <span class="n">TabBarFindTabByID</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">tab_is_new</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ImGuiTabItem</span><span class="p">());</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
        <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ID</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
        <span class="n">tab</span><span class="o">-&gt;</span><span class="n">Width</span> <span class="o">=</span> <span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">TabsAddedNew</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">tab_is_new</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">LastTabItemIdx</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImS16</span><span class="p">)</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">index_from_ptr</span><span class="p">(</span><span class="n">tab</span><span class="p">);</span>
    <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ContentWidth</span> <span class="o">=</span> <span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">tab</span><span class="o">-&gt;</span><span class="n">BeginOrder</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">TabsActiveCount</span><span class="o">++</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">bool</span> <span class="n">tab_bar_appearing</span> <span class="o">=</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">PrevFrameVisible</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">FrameCount</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">tab_bar_focused</span> <span class="o">=</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_IsFocused</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">tab_appearing</span> <span class="o">=</span> <span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">LastFrameVisible</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">FrameCount</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_tab_button</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Button</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">tab</span><span class="o">-&gt;</span><span class="n">LastFrameVisible</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">FrameCount</span><span class="p">;</span>
    <span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">=</span> <span class="n">flags</span><span class="p">;</span>

    <span class="c1">// Append name with zero-terminator</span>
    <span class="n">tab</span><span class="o">-&gt;</span><span class="n">NameOffset</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImS16</span><span class="p">)</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">TabsNames</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">TabsNames</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">label</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

    <span class="c1">// Update selected tab</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_appearing</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_AutoSelectNewTabs</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">NextSelectedTabId</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tab_bar_appearing</span> <span class="o">||</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_tab_button</span><span class="p">)</span>
                <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">NextSelectedTabId</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>  <span class="c1">// New tabs gets activated</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_SetSelected</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">!=</span> <span class="n">id</span><span class="p">))</span> <span class="c1">// SetSelected can only be passed on explicit tab bar</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_tab_button</span><span class="p">)</span>
            <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">NextSelectedTabId</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>

    <span class="c1">// Lock visibility</span>
    <span class="c1">// (Note: tab_contents_visible != tab_selected... because CTRL+TAB operations may preview some tabs without selecting them!)</span>
    <span class="kt">bool</span> <span class="n">tab_contents_visible</span> <span class="o">=</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">VisibleTabId</span> <span class="o">==</span> <span class="n">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_contents_visible</span><span class="p">)</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">VisibleTabWasSubmitted</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

    <span class="c1">// On the very first frame of a tab bar we let first tab contents be visible to minimize appearing glitches</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tab_contents_visible</span> <span class="o">&amp;&amp;</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">tab_bar_appearing</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Tabs</span><span class="p">.</span><span class="n">Size</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_AutoSelectNewTabs</span><span class="p">))</span>
            <span class="n">tab_contents_visible</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

    <span class="c1">// Note that tab_is_new is not necessarily the same as tab_appearing! When a tab bar stops being submitted</span>
    <span class="c1">// and then gets submitted again, the tabs will have &#39;tab_appearing=true&#39; but &#39;tab_is_new=false&#39;.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab_appearing</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">tab_bar_appearing</span> <span class="o">||</span> <span class="n">tab_is_new</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">PushItemFlag</span><span class="p">(</span><span class="n">ImGuiItemFlags_NoNav</span> <span class="o">|</span> <span class="n">ImGuiItemFlags_NoNavDefaultFocus</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
        <span class="n">ItemAdd</span><span class="p">(</span><span class="n">ImRect</span><span class="p">(),</span> <span class="n">id</span><span class="p">);</span>
        <span class="n">PopItemFlag</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">is_tab_button</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">tab_contents_visible</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
        <span class="n">tab</span><span class="o">-&gt;</span><span class="n">LastFrameSelected</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">FrameCount</span><span class="p">;</span>

    <span class="c1">// Backup current layout position</span>
    <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">backup_main_cursor_pos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">;</span>

    <span class="c1">// Layout</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_central_section</span> <span class="o">=</span> <span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ImGuiTabItemFlags_Leading</span> <span class="o">|</span> <span class="n">ImGuiTabItemFlags_Trailing</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_central_section</span><span class="p">)</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Offset</span> <span class="o">-</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingAnim</span><span class="p">),</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">BarRect</span><span class="p">.</span><span class="n">Min</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Offset</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="n">ImVec2</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">;</span>
    <span class="n">ImRect</span> <span class="nf">bb</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">size</span><span class="p">);</span>

    <span class="c1">// We don&#39;t have CPU clipping primitives to clip the CloseButton (until it becomes a texture), so need to add an extra draw call (temporary in the case of vertical animation)</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">want_clip_rect</span> <span class="o">=</span> <span class="n">is_central_section</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingRectMinX</span> <span class="o">||</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingRectMaxX</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">want_clip_rect</span><span class="p">)</span>
        <span class="n">PushClipRect</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">ImMax</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingRectMinX</span><span class="p">),</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">ScrollingRectMaxX</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="nb">true</span><span class="p">);</span>

    <span class="n">ImVec2</span> <span class="n">backup_cursor_max_pos</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorMaxPos</span><span class="p">;</span>
    <span class="n">ItemSize</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">GetSize</span><span class="p">(),</span> <span class="n">style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorMaxPos</span> <span class="o">=</span> <span class="n">backup_cursor_max_pos</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ItemAdd</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">want_clip_rect</span><span class="p">)</span>
            <span class="n">PopClipRect</span><span class="p">();</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">backup_main_cursor_pos</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">tab_contents_visible</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Click to Select a tab</span>
    <span class="n">ImGuiButtonFlags</span> <span class="n">button_flags</span> <span class="o">=</span> <span class="p">((</span><span class="n">is_tab_button</span> <span class="o">?</span> <span class="nl">ImGuiButtonFlags_PressedOnClickRelease</span> <span class="p">:</span> <span class="n">ImGuiButtonFlags_PressedOnClick</span><span class="p">)</span> <span class="o">|</span> <span class="n">ImGuiButtonFlags_AllowItemOverlap</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">DragDropActive</span><span class="p">)</span>
        <span class="n">button_flags</span> <span class="o">|=</span> <span class="n">ImGuiButtonFlags_PressedOnDragDropHold</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">hovered</span><span class="p">,</span> <span class="n">held</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">pressed</span> <span class="o">=</span> <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">,</span> <span class="n">button_flags</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pressed</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_tab_button</span><span class="p">)</span>
        <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">NextSelectedTabId</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
    <span class="n">hovered</span> <span class="o">|=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">HoveredId</span> <span class="o">==</span> <span class="n">id</span><span class="p">);</span>

    <span class="c1">// Allow the close button to overlap unless we are dragging (in which case we don&#39;t want any overlapping tabs to be hovered)</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">held</span><span class="p">)</span>
        <span class="n">SetItemAllowOverlap</span><span class="p">();</span>

    <span class="c1">// Drag and drop: re-order tabs</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">held</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">tab_appearing</span> <span class="o">&amp;&amp;</span> <span class="n">IsMouseDragging</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">DragDropActive</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_Reorderable</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// While moving a tab it will jump on the other side of the mouse, so we also test for MouseDelta.x</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.0f</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_Reorderable</span><span class="p">)</span>
                    <span class="n">TabBarQueueReorder</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">tab</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0f</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_Reorderable</span><span class="p">)</span>
                    <span class="n">TabBarQueueReorder</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">tab</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">    if (hovered &amp;&amp; g.HoveredIdNotActiveTimer &gt; 0.50f &amp;&amp; bb.GetWidth() &lt; tab-&gt;ContentWidth)</span>
<span class="c">    {</span>
<span class="c">        // Enlarge tab display when hovering</span>
<span class="c">        bb.Max.x = bb.Min.x + IM_FLOOR(ImLerp(bb.GetWidth(), tab-&gt;ContentWidth, ImSaturate((g.HoveredIdNotActiveTimer - 0.40f) * 6.0f)));</span>
<span class="c">        display_draw_list = GetForegroundDrawList(window);</span>
<span class="c">        TabItemBackground(display_draw_list, bb, flags, GetColorU32(ImGuiCol_TitleBgActive));</span>
<span class="c">    }</span>
<span class="cp">#endif</span>

    <span class="c1">// Render tab shape</span>
    <span class="n">ImDrawList</span><span class="o">*</span> <span class="n">display_draw_list</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ImU32</span> <span class="n">tab_col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">((</span><span class="n">held</span> <span class="o">||</span> <span class="n">hovered</span><span class="p">)</span> <span class="o">?</span> <span class="nl">ImGuiCol_TabHovered</span> <span class="p">:</span> <span class="n">tab_contents_visible</span> <span class="o">?</span> <span class="p">(</span><span class="n">tab_bar_focused</span> <span class="o">?</span> <span class="nl">ImGuiCol_TabActive</span> <span class="p">:</span> <span class="n">ImGuiCol_TabUnfocusedActive</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="n">tab_bar_focused</span> <span class="o">?</span> <span class="nl">ImGuiCol_Tab</span> <span class="p">:</span> <span class="n">ImGuiCol_TabUnfocused</span><span class="p">));</span>
    <span class="n">TabItemBackground</span><span class="p">(</span><span class="n">display_draw_list</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">tab_col</span><span class="p">);</span>
    <span class="n">RenderNavHighlight</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>

    <span class="c1">// Select with right mouse button. This is so the common idiom for context menu automatically highlight the current widget.</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">hovered_unblocked</span> <span class="o">=</span> <span class="n">IsItemHovered</span><span class="p">(</span><span class="n">ImGuiHoveredFlags_AllowWhenBlockedByPopup</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">hovered_unblocked</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">IsMouseClicked</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="n">IsMouseReleased</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_tab_button</span><span class="p">)</span>
            <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">NextSelectedTabId</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_NoCloseWithMiddleMouseButton</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">ImGuiTabItemFlags_NoCloseWithMiddleMouseButton</span><span class="p">;</span>

    <span class="c1">// Render tab label, process close button</span>
    <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">close_button_id</span> <span class="o">=</span> <span class="n">p_open</span> <span class="o">?</span> <span class="n">GetIDWithSeed</span><span class="p">(</span><span class="s">&quot;#CLOSE&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">just_closed</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">text_clipped</span><span class="p">;</span>
    <span class="n">TabItemLabelAndCloseButton</span><span class="p">(</span><span class="n">display_draw_list</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">FramePadding</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">close_button_id</span><span class="p">,</span> <span class="n">tab_contents_visible</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">just_closed</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">text_clipped</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">just_closed</span> <span class="o">&amp;&amp;</span> <span class="n">p_open</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="o">*</span><span class="n">p_open</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="n">TabBarCloseTab</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">tab</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Restore main window position so user can draw there</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">want_clip_rect</span><span class="p">)</span>
        <span class="n">PopClipRect</span><span class="p">();</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span> <span class="o">=</span> <span class="n">backup_main_cursor_pos</span><span class="p">;</span>

    <span class="c1">// Tooltip (FIXME: Won&#39;t work over the close button because ItemOverlap systems messes up with HoveredIdTimer)</span>
    <span class="c1">// We test IsItemHovered() to discard e.g. when another item is active or drag and drop over the tab bar (which g.HoveredId ignores)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">text_clipped</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredId</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">held</span> <span class="o">&amp;&amp;</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredIdNotActiveTimer</span> <span class="o">&gt;</span> <span class="mf">0.50f</span> <span class="o">&amp;&amp;</span> <span class="n">IsItemHovered</span><span class="p">())</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_NoTooltip</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">tab</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_NoTooltip</span><span class="p">))</span>
            <span class="n">SetTooltip</span><span class="p">(</span><span class="s">&quot;%.*s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">FindRenderedTextEnd</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">-</span> <span class="n">label</span><span class="p">),</span> <span class="n">label</span><span class="p">);</span>

    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="o">!</span><span class="n">is_tab_button</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="n">tab_bar</span><span class="o">-&gt;</span><span class="n">SelectedTabId</span> <span class="o">==</span> <span class="n">tab</span><span class="o">-&gt;</span><span class="n">ID</span> <span class="o">&amp;&amp;</span> <span class="n">is_tab_button</span><span class="p">));</span> <span class="c1">// TabItemButton should not be selected</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_tab_button</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pressed</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">tab_contents_visible</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// [Public] This is call is 100% optional but it allows to remove some one-frame glitches when a tab has been unexpectedly removed.</span>
<span class="c1">// To use it to need to call the function SetTabItemClosed() between BeginTabBar() and EndTabBar().</span>
<span class="c1">// Tabs closed by the close button will automatically be flagged to avoid this issue.</span>
<span class="kt">void</span>    <span class="n">ImGui</span><span class="o">::</span><span class="n">SetTabItemClosed</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">is_within_manual_tab_bar</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentTabBar</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">CurrentTabBar</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabBarFlags_DockNode</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_within_manual_tab_bar</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ImGuiTabBar</span><span class="o">*</span> <span class="n">tab_bar</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentTabBar</span><span class="p">;</span>
        <span class="n">ImGuiID</span> <span class="n">tab_id</span> <span class="o">=</span> <span class="n">TabBarCalcTabID</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ImGuiTabItem</span><span class="o">*</span> <span class="n">tab</span> <span class="o">=</span> <span class="n">TabBarFindTabByID</span><span class="p">(</span><span class="n">tab_bar</span><span class="p">,</span> <span class="n">tab_id</span><span class="p">))</span>
            <span class="n">tab</span><span class="o">-&gt;</span><span class="n">WantClose</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="c1">// Will be processed by next call to TabBarLayout()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">ImVec2</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TabItemCalcSize</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">has_close_button</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="n">ImVec2</span> <span class="n">size</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">label_size</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">has_close_button</span><span class="p">)</span>
        <span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemInnerSpacing</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">);</span> <span class="c1">// We use Y intentionally to fit the close button circle.</span>
    <span class="k">else</span>
        <span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">FramePadding</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mf">1.0f</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">ImMin</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">TabBarCalcMaxTabWidth</span><span class="p">()),</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TabItemBackground</span><span class="p">(</span><span class="n">ImDrawList</span><span class="o">*</span> <span class="n">draw_list</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImRect</span><span class="o">&amp;</span> <span class="n">bb</span><span class="p">,</span> <span class="n">ImGuiTabItemFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="n">ImU32</span> <span class="n">col</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// While rendering tabs, we trim 1 pixel off the top of our bounding box so they can fit within a regular frame height while looking &quot;detached&quot; from it.</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">width</span> <span class="o">=</span> <span class="n">bb</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">();</span>
    <span class="n">IM_UNUSED</span><span class="p">(</span><span class="n">flags</span><span class="p">);</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">width</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">rounding</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="n">ImMin</span><span class="p">((</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_Button</span><span class="p">)</span> <span class="o">?</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="nl">FrameRounding</span> <span class="p">:</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">TabRounding</span><span class="p">,</span> <span class="n">width</span> <span class="o">*</span> <span class="mf">0.5f</span> <span class="o">-</span> <span class="mf">1.0f</span><span class="p">));</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.0f</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="mf">1.0f</span><span class="p">;</span>
    <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PathLineTo</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span><span class="p">));</span>
    <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PathArcToFast</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">rounding</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">rounding</span><span class="p">),</span> <span class="n">rounding</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
    <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PathArcToFast</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">rounding</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">rounding</span><span class="p">),</span> <span class="n">rounding</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
    <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PathLineTo</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span><span class="p">));</span>
    <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PathFillConvex</span><span class="p">(</span><span class="n">col</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">TabBorderSize</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PathLineTo</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="n">y2</span><span class="p">));</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PathArcToFast</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">rounding</span> <span class="o">+</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">rounding</span> <span class="o">+</span> <span class="mf">0.5f</span><span class="p">),</span> <span class="n">rounding</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PathArcToFast</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">rounding</span> <span class="o">-</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">rounding</span> <span class="o">+</span> <span class="mf">0.5f</span><span class="p">),</span> <span class="n">rounding</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PathLineTo</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="n">y2</span><span class="p">));</span>
        <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PathStroke</span><span class="p">(</span><span class="n">GetColorU32</span><span class="p">(</span><span class="n">ImGuiCol_Border</span><span class="p">),</span> <span class="nb">false</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">TabBorderSize</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Render text label (with custom clipping) + Unsaved Document marker + Close Button logic</span>
<span class="c1">// We tend to lock style.FramePadding for a given tab-bar, hence the &#39;frame_padding&#39; parameter.</span>
<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">TabItemLabelAndCloseButton</span><span class="p">(</span><span class="n">ImDrawList</span><span class="o">*</span> <span class="n">draw_list</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImRect</span><span class="o">&amp;</span> <span class="n">bb</span><span class="p">,</span> <span class="n">ImGuiTabItemFlags</span> <span class="n">flags</span><span class="p">,</span> <span class="n">ImVec2</span> <span class="n">frame_padding</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">label</span><span class="p">,</span> <span class="n">ImGuiID</span> <span class="n">tab_id</span><span class="p">,</span> <span class="n">ImGuiID</span> <span class="n">close_button_id</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">is_contents_visible</span><span class="p">,</span> <span class="kt">bool</span><span class="o">*</span> <span class="n">out_just_closed</span><span class="p">,</span> <span class="kt">bool</span><span class="o">*</span> <span class="n">out_text_clipped</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImVec2</span> <span class="n">label_size</span> <span class="o">=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">out_just_closed</span><span class="p">)</span>
        <span class="o">*</span><span class="n">out_just_closed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">out_text_clipped</span><span class="p">)</span>
        <span class="o">*</span><span class="n">out_text_clipped</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">1.0f</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="c1">// In Style V2 we&#39;ll have full override of all colors per state (e.g. focused, selected)</span>
    <span class="c1">// But right now if you want to alter text color of tabs this is what you need to do.</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">    const float backup_alpha = g.Style.Alpha;</span>
<span class="c">    if (!is_contents_visible)</span>
<span class="c">        g.Style.Alpha *= 0.7f;</span>
<span class="cp">#endif</span>

    <span class="c1">// Render text label (with clipping + alpha gradient) + unsaved marker</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">TAB_UNSAVED_MARKER</span> <span class="o">=</span> <span class="s">&quot;*&quot;</span><span class="p">;</span>
    <span class="n">ImRect</span> <span class="nf">text_pixel_clip_bb</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">frame_padding</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">frame_padding</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">frame_padding</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_UnsavedDocument</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">text_pixel_clip_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">CalcTextSize</span><span class="p">(</span><span class="n">TAB_UNSAVED_MARKER</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">false</span><span class="p">).</span><span class="n">x</span><span class="p">;</span>
        <span class="n">ImVec2</span> <span class="nf">unsaved_marker_pos</span><span class="p">(</span><span class="n">ImMin</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">frame_padding</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">label_size</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">text_pixel_clip_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">frame_padding</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="o">-</span><span class="n">g</span><span class="p">.</span><span class="n">FontSize</span> <span class="o">*</span> <span class="mf">0.25f</span><span class="p">));</span>
        <span class="n">RenderTextClippedEx</span><span class="p">(</span><span class="n">draw_list</span><span class="p">,</span> <span class="n">unsaved_marker_pos</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span> <span class="o">-</span> <span class="n">frame_padding</span><span class="p">,</span> <span class="n">TAB_UNSAVED_MARKER</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">ImRect</span> <span class="n">text_ellipsis_clip_bb</span> <span class="o">=</span> <span class="n">text_pixel_clip_bb</span><span class="p">;</span>

    <span class="c1">// Return clipped state ignoring the close button</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">out_text_clipped</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="o">*</span><span class="n">out_text_clipped</span> <span class="o">=</span> <span class="p">(</span><span class="n">text_ellipsis_clip_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">label_size</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">text_pixel_clip_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
        <span class="c1">//draw_list-&gt;AddCircle(text_ellipsis_clip_bb.Min, 3.0f, *out_text_clipped ? IM_COL32(255, 0, 0, 255) : IM_COL32(0, 255, 0, 255));</span>
    <span class="p">}</span>

    <span class="c1">// Close Button</span>
    <span class="c1">// We are relying on a subtle and confusing distinction between &#39;hovered&#39; and &#39;g.HoveredId&#39; which happens because we are using ImGuiButtonFlags_AllowOverlapMode + SetItemAllowOverlap()</span>
    <span class="c1">//  &#39;hovered&#39; will be true when hovering the Tab but NOT when hovering the close button</span>
    <span class="c1">//  &#39;g.HoveredId==id&#39; will be true when hovering the Tab including when hovering the close button</span>
    <span class="c1">//  &#39;g.ActiveId==close_button_id&#39; will be true when we are holding on the close button, in which case both hovered booleans are false</span>
    <span class="kt">bool</span> <span class="n">close_button_pressed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">close_button_visible</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">close_button_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">is_contents_visible</span> <span class="o">||</span> <span class="n">bb</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">TabMinWidthForCloseButton</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">HoveredId</span> <span class="o">==</span> <span class="n">tab_id</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">HoveredId</span> <span class="o">==</span> <span class="n">close_button_id</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">tab_id</span> <span class="o">||</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">close_button_id</span><span class="p">)</span>
                <span class="n">close_button_visible</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">close_button_visible</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ImGuiLastItemDataBackup</span> <span class="n">last_item_backup</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">close_button_sz</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">FontSize</span><span class="p">;</span>
        <span class="n">PushStyleVar</span><span class="p">(</span><span class="n">ImGuiStyleVar_FramePadding</span><span class="p">,</span> <span class="n">frame_padding</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">CloseButton</span><span class="p">(</span><span class="n">close_button_id</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">frame_padding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">2.0f</span> <span class="o">-</span> <span class="n">close_button_sz</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">)))</span>
            <span class="n">close_button_pressed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">PopStyleVar</span><span class="p">();</span>
        <span class="n">last_item_backup</span><span class="p">.</span><span class="n">Restore</span><span class="p">();</span>

        <span class="c1">// Close with middle mouse button</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiTabItemFlags_NoCloseWithMiddleMouseButton</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">IsMouseClicked</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">close_button_pressed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

        <span class="n">text_pixel_clip_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">close_button_sz</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// FIXME: if FramePadding is noticeably large, ellipsis_max_x will be wrong here (e.g. #3497), maybe for consistency that parameter of RenderTextEllipsis() shouldn&#39;t exist..</span>
    <span class="kt">float</span> <span class="n">ellipsis_max_x</span> <span class="o">=</span> <span class="n">close_button_visible</span> <span class="o">?</span> <span class="n">text_pixel_clip_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="nl">x</span> <span class="p">:</span> <span class="n">bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="mf">1.0f</span><span class="p">;</span>
    <span class="n">RenderTextEllipsis</span><span class="p">(</span><span class="n">draw_list</span><span class="p">,</span> <span class="n">text_ellipsis_clip_bb</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">text_ellipsis_clip_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">text_pixel_clip_bb</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ellipsis_max_x</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">label_size</span><span class="p">);</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">    if (!is_contents_visible)</span>
<span class="c">        g.Style.Alpha = backup_alpha;</span>
<span class="cp">#endif</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">out_just_closed</span><span class="p">)</span>
        <span class="o">*</span><span class="n">out_just_closed</span> <span class="o">=</span> <span class="n">close_button_pressed</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// [SECTION] Widgets: Columns, BeginColumns, EndColumns, etc.</span>
<span class="c1">// In the current version, Columns are very weak. Needs to be replaced with a more full-featured system.</span>
<span class="c1">//-------------------------------------------------------------------------</span>
<span class="c1">// - SetWindowClipRectBeforeSetChannel() [Internal]</span>
<span class="c1">// - GetColumnIndex()</span>
<span class="c1">// - GetColumnCount()</span>
<span class="c1">// - GetColumnOffset()</span>
<span class="c1">// - GetColumnWidth()</span>
<span class="c1">// - SetColumnOffset()</span>
<span class="c1">// - SetColumnWidth()</span>
<span class="c1">// - PushColumnClipRect() [Internal]</span>
<span class="c1">// - PushColumnsBackground() [Internal]</span>
<span class="c1">// - PopColumnsBackground() [Internal]</span>
<span class="c1">// - FindOrCreateColumns() [Internal]</span>
<span class="c1">// - GetColumnsID() [Internal]</span>
<span class="c1">// - BeginColumns()</span>
<span class="c1">// - NextColumn()</span>
<span class="c1">// - EndColumns()</span>
<span class="c1">// - Columns()</span>
<span class="c1">//-------------------------------------------------------------------------</span>

<span class="c1">// [Internal] Small optimization to avoid calls to PopClipRect/SetCurrentChannel/PushClipRect in sequences,</span>
<span class="c1">// they would meddle many times with the underlying ImDrawCmd.</span>
<span class="c1">// Instead, we do a preemptive overwrite of clipping rectangle _without_ altering the command-buffer and let</span>
<span class="c1">// the subsequent single call to SetCurrentChannel() does it things once.</span>
<span class="kt">void</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">SetWindowClipRectBeforeSetChannel</span><span class="p">(</span><span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImRect</span><span class="o">&amp;</span> <span class="n">clip_rect</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImVec4</span> <span class="n">clip_rect_vec4</span> <span class="o">=</span> <span class="n">clip_rect</span><span class="p">.</span><span class="n">ToVec4</span><span class="p">();</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">ClipRect</span> <span class="o">=</span> <span class="n">clip_rect</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">_CmdHeader</span><span class="p">.</span><span class="n">ClipRect</span> <span class="o">=</span> <span class="n">clip_rect_vec4</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">_ClipRectStack</span><span class="p">.</span><span class="n">Data</span><span class="p">[</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">_ClipRectStack</span><span class="p">.</span><span class="n">Size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">clip_rect_vec4</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetColumnIndex</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindowRead</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span> <span class="o">?</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span><span class="o">-&gt;</span><span class="nl">Current</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetColumnsCount</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindowRead</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span> <span class="o">?</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span><span class="o">-&gt;</span><span class="nl">Count</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetColumnOffsetFromNorm</span><span class="p">(</span><span class="k">const</span> <span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span><span class="p">,</span> <span class="kt">float</span> <span class="n">offset_norm</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">offset_norm</span> <span class="o">*</span> <span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">OffMaxX</span> <span class="o">-</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">OffMinX</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetColumnNormFromOffset</span><span class="p">(</span><span class="k">const</span> <span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span><span class="p">,</span> <span class="kt">float</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">offset</span> <span class="o">/</span> <span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">OffMaxX</span> <span class="o">-</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">OffMinX</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">COLUMNS_HIT_RECT_HALF_WIDTH</span> <span class="o">=</span> <span class="mf">4.0f</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">float</span> <span class="nf">GetDraggedColumnOffset</span><span class="p">(</span><span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span><span class="p">,</span> <span class="kt">int</span> <span class="n">column_index</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Active (dragged) column always follow mouse. The reason we need this is that dragging a column to the right edge of an auto-resizing</span>
    <span class="c1">// window creates a feedback loop because we store normalized positions. So while dragging we enforce absolute positioning.</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">column_index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// We are not supposed to drag column 0.</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">ActiveId</span> <span class="o">==</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">ID</span> <span class="o">+</span> <span class="n">ImGuiID</span><span class="p">(</span><span class="n">column_index</span><span class="p">));</span>

    <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">ActiveIdClickOffset</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">COLUMNS_HIT_RECT_HALF_WIDTH</span> <span class="o">-</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetColumnOffset</span><span class="p">(</span><span class="n">column_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ColumnsMinSpacing</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiOldColumnFlags_NoPreserveWidths</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetColumnOffset</span><span class="p">(</span><span class="n">column_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ColumnsMinSpacing</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">ImGui::GetColumnOffset</span><span class="p">(</span><span class="kt">int</span> <span class="n">column_index</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindowRead</span><span class="p">();</span>
    <span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">columns</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.0f</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">column_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">column_index</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span><span class="p">;</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">column_index</span> <span class="o">&lt;</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">.</span><span class="n">Size</span><span class="p">);</span>

    <span class="k">const</span> <span class="kt">float</span> <span class="n">t</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">[</span><span class="n">column_index</span><span class="p">].</span><span class="n">OffsetNorm</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">x_offset</span> <span class="o">=</span> <span class="n">ImLerp</span><span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">OffMinX</span><span class="p">,</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">OffMaxX</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">x_offset</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">float</span> <span class="nf">GetColumnWidthEx</span><span class="p">(</span><span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span><span class="p">,</span> <span class="kt">int</span> <span class="n">column_index</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">before_resize</span> <span class="o">=</span> <span class="nb">false</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">column_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">column_index</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">offset_norm</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">before_resize</span><span class="p">)</span>
        <span class="n">offset_norm</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">[</span><span class="n">column_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">OffsetNormBeforeResize</span> <span class="o">-</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">[</span><span class="n">column_index</span><span class="p">].</span><span class="n">OffsetNormBeforeResize</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="n">offset_norm</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">[</span><span class="n">column_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">OffsetNorm</span> <span class="o">-</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">[</span><span class="n">column_index</span><span class="p">].</span><span class="n">OffsetNorm</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetColumnOffsetFromNorm</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">offset_norm</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">ImGui::GetColumnWidth</span><span class="p">(</span><span class="kt">int</span> <span class="n">column_index</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">columns</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GetContentRegionAvail</span><span class="p">().</span><span class="n">x</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">column_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">column_index</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">GetColumnOffsetFromNorm</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">[</span><span class="n">column_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">OffsetNorm</span> <span class="o">-</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">[</span><span class="n">column_index</span><span class="p">].</span><span class="n">OffsetNorm</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::SetColumnOffset</span><span class="p">(</span><span class="kt">int</span> <span class="n">column_index</span><span class="p">,</span> <span class="kt">float</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">CurrentWindow</span><span class="p">;</span>
    <span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span><span class="p">;</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">columns</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">column_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">column_index</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span><span class="p">;</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">column_index</span> <span class="o">&lt;</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">.</span><span class="n">Size</span><span class="p">);</span>

    <span class="k">const</span> <span class="kt">bool</span> <span class="n">preserve_width</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiOldColumnFlags_NoPreserveWidths</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">column_index</span> <span class="o">&lt;</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">width</span> <span class="o">=</span> <span class="n">preserve_width</span> <span class="o">?</span> <span class="n">GetColumnWidthEx</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">column_index</span><span class="p">,</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">IsBeingResized</span><span class="p">)</span> <span class="o">:</span> <span class="mf">0.0f</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiOldColumnFlags_NoForceWithinWindow</span><span class="p">))</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">OffMaxX</span> <span class="o">-</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ColumnsMinSpacing</span> <span class="o">*</span> <span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Count</span> <span class="o">-</span> <span class="n">column_index</span><span class="p">));</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">[</span><span class="n">column_index</span><span class="p">].</span><span class="n">OffsetNorm</span> <span class="o">=</span> <span class="n">GetColumnNormFromOffset</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">offset</span> <span class="o">-</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">OffMinX</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">preserve_width</span><span class="p">)</span>
        <span class="n">SetColumnOffset</span><span class="p">(</span><span class="n">column_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ColumnsMinSpacing</span><span class="p">,</span> <span class="n">width</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::SetColumnWidth</span><span class="p">(</span><span class="kt">int</span> <span class="n">column_index</span><span class="p">,</span> <span class="kt">float</span> <span class="n">width</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindowRead</span><span class="p">();</span>
    <span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span><span class="p">;</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">columns</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">column_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">column_index</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span><span class="p">;</span>
    <span class="n">SetColumnOffset</span><span class="p">(</span><span class="n">column_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">GetColumnOffset</span><span class="p">(</span><span class="n">column_index</span><span class="p">)</span> <span class="o">+</span> <span class="n">width</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::PushColumnClipRect</span><span class="p">(</span><span class="kt">int</span> <span class="n">column_index</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindowRead</span><span class="p">();</span>
    <span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">column_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">column_index</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span><span class="p">;</span>

    <span class="n">ImGuiOldColumnData</span><span class="o">*</span> <span class="n">column</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">[</span><span class="n">column_index</span><span class="p">];</span>
    <span class="n">PushClipRect</span><span class="p">(</span><span class="n">column</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">column</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Get into the columns background draw command (which is generally the same draw command as before we called BeginColumns)</span>
<span class="kt">void</span> <span class="nf">ImGui::PushColumnsBackground</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindowRead</span><span class="p">();</span>
    <span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="c1">// Optimization: avoid SetCurrentChannel() + PushClipRect()</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">HostBackupClipRect</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">;</span>
    <span class="n">SetWindowClipRectBeforeSetChannel</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">HostInitialClipRect</span><span class="p">);</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Splitter</span><span class="p">.</span><span class="n">SetCurrentChannel</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::PopColumnsBackground</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindowRead</span><span class="p">();</span>
    <span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="c1">// Optimization: avoid PopClipRect() + SetCurrentChannel()</span>
    <span class="n">SetWindowClipRectBeforeSetChannel</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">HostBackupClipRect</span><span class="p">);</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Splitter</span><span class="p">.</span><span class="n">SetCurrentChannel</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="nf">ImGui::FindOrCreateColumns</span><span class="p">(</span><span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span><span class="p">,</span> <span class="n">ImGuiID</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// We have few columns per window so for now we don&#39;t need bother much with turning this into a faster lookup.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ColumnsStorage</span><span class="p">.</span><span class="n">Size</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">ColumnsStorage</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ID</span> <span class="o">==</span> <span class="n">id</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">&amp;</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">ColumnsStorage</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>

    <span class="n">window</span><span class="o">-&gt;</span><span class="n">ColumnsStorage</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ImGuiOldColumns</span><span class="p">());</span>
    <span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">ColumnsStorage</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">ID</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">columns</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ImGuiID</span> <span class="nf">ImGui::GetColumnsID</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">columns_count</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>

    <span class="c1">// Differentiate column ID with an arbitrary prefix for cases where users name their columns set the same as another widget.</span>
    <span class="c1">// In addition, when an identifier isn&#39;t explicitly provided we include the number of columns in the hash to make it uniquer.</span>
    <span class="n">PushID</span><span class="p">(</span><span class="mh">0x11223347</span> <span class="o">+</span> <span class="p">(</span><span class="n">str_id</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">columns_count</span><span class="p">));</span>
    <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">(</span><span class="n">str_id</span> <span class="o">?</span> <span class="nl">str_id</span> <span class="p">:</span> <span class="s">&quot;columns&quot;</span><span class="p">);</span>
    <span class="n">PopID</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">id</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::BeginColumns</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">columns_count</span><span class="p">,</span> <span class="n">ImGuiOldColumnFlags</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>

    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">columns_count</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">);</span>   <span class="c1">// Nested columns are currently not supported</span>

    <span class="c1">// Acquire storage for the columns set</span>
    <span class="n">ImGuiID</span> <span class="n">id</span> <span class="o">=</span> <span class="n">GetColumnsID</span><span class="p">(</span><span class="n">str_id</span><span class="p">,</span> <span class="n">columns_count</span><span class="p">);</span>
    <span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">FindOrCreateColumns</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">ID</span> <span class="o">==</span> <span class="n">id</span><span class="p">);</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Count</span> <span class="o">=</span> <span class="n">columns_count</span><span class="p">;</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">=</span> <span class="n">flags</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span> <span class="o">=</span> <span class="n">columns</span><span class="p">;</span>

    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">HostCursorPosY</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">HostCursorMaxPosX</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorMaxPos</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">HostInitialClipRect</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">;</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">HostBackupParentWorkRect</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ParentWorkRect</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">ParentWorkRect</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WorkRect</span><span class="p">;</span>

    <span class="c1">// Set state for first column</span>
    <span class="c1">// We aim so that the right-most column will have the same clipping width as other after being clipped by parent ClipRect</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">column_padding</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">half_clip_extend_x</span> <span class="o">=</span> <span class="n">ImFloor</span><span class="p">(</span><span class="n">ImMax</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowPadding</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowBorderSize</span><span class="p">));</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">max_1</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WorkRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">column_padding</span> <span class="o">-</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">column_padding</span> <span class="o">-</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowPadding</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">max_2</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WorkRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">half_clip_extend_x</span><span class="p">;</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">OffMinX</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">Indent</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">column_padding</span> <span class="o">+</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">column_padding</span> <span class="o">-</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowPadding</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">OffMaxX</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">ImMin</span><span class="p">(</span><span class="n">max_1</span><span class="p">,</span> <span class="n">max_2</span><span class="p">)</span> <span class="o">-</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">OffMinX</span> <span class="o">+</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">LineMinY</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">LineMaxY</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

    <span class="c1">// Clear data if columns count changed</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">.</span><span class="n">Size</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">.</span><span class="n">Size</span> <span class="o">!=</span> <span class="n">columns_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="c1">// Initialize default widths</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">IsFirstFrame</span> <span class="o">=</span> <span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">.</span><span class="n">Size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">.</span><span class="n">Size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">columns_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">columns_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ImGuiOldColumnData</span> <span class="n">column</span><span class="p">;</span>
            <span class="n">column</span><span class="p">.</span><span class="n">OffsetNorm</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">columns_count</span><span class="p">;</span>
            <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">column</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">columns_count</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Compute clipping rectangle</span>
        <span class="n">ImGuiOldColumnData</span><span class="o">*</span> <span class="n">column</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="kt">float</span> <span class="n">clip_x1</span> <span class="o">=</span> <span class="n">IM_ROUND</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">GetColumnOffset</span><span class="p">(</span><span class="n">n</span><span class="p">));</span>
        <span class="kt">float</span> <span class="n">clip_x2</span> <span class="o">=</span> <span class="n">IM_ROUND</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">GetColumnOffset</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0f</span><span class="p">);</span>
        <span class="n">column</span><span class="o">-&gt;</span><span class="n">ClipRect</span> <span class="o">=</span> <span class="n">ImRect</span><span class="p">(</span><span class="n">clip_x1</span><span class="p">,</span> <span class="o">-</span><span class="n">FLT_MAX</span><span class="p">,</span> <span class="n">clip_x2</span><span class="p">,</span> <span class="o">+</span><span class="n">FLT_MAX</span><span class="p">);</span>
        <span class="n">column</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">.</span><span class="n">ClipWithFull</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Splitter</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Count</span><span class="p">);</span>
        <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Splitter</span><span class="p">.</span><span class="n">SetCurrentChannel</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">PushColumnClipRect</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// We don&#39;t generally store Indent.x inside ColumnsOffset because it may be manipulated by the user.</span>
    <span class="kt">float</span> <span class="n">offset_0</span> <span class="o">=</span> <span class="n">GetColumnOffset</span><span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">offset_1</span> <span class="o">=</span> <span class="n">GetColumnOffset</span><span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">width</span> <span class="o">=</span> <span class="n">offset_1</span> <span class="o">-</span> <span class="n">offset_0</span><span class="p">;</span>
    <span class="n">PushItemWidth</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.65f</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ColumnsOffset</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">column_padding</span> <span class="o">-</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowPadding</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">Indent</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ColumnsOffset</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">WorkRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">offset_1</span> <span class="o">-</span> <span class="n">column_padding</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::NextColumn</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span> <span class="o">||</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">Indent</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ColumnsOffset</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Next column</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span> <span class="o">==</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Count</span><span class="p">)</span>
        <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">PopItemWidth</span><span class="p">();</span>

    <span class="c1">// Optimization: avoid PopClipRect() + SetCurrentChannel() + PushClipRect()</span>
    <span class="c1">// (which would needlessly attempt to update commands in the wrong channel, then pop or overwrite them),</span>
    <span class="n">ImGuiOldColumnData</span><span class="o">*</span> <span class="n">column</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">[</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span><span class="p">];</span>
    <span class="n">SetWindowClipRectBeforeSetChannel</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">column</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">);</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Splitter</span><span class="p">.</span><span class="n">SetCurrentChannel</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">,</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

    <span class="k">const</span> <span class="kt">float</span> <span class="n">column_padding</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Style</span><span class="p">.</span><span class="n">ItemSpacing</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">LineMaxY</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">LineMaxY</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Columns 1+ ignore IndentX (by canceling it out)</span>
        <span class="c1">// FIXME-COLUMNS: Unnecessary, could be locked?</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ColumnsOffset</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">GetColumnOffset</span><span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span><span class="p">)</span> <span class="o">-</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">Indent</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">column_padding</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// New row/line: column 0 honor IndentX.</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ColumnsOffset</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">column_padding</span> <span class="o">-</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">WindowPadding</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="n">columns</span><span class="o">-&gt;</span><span class="n">LineMinY</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">LineMaxY</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">Indent</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ColumnsOffset</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">LineMinY</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineSize</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrLineTextBaseOffset</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>

    <span class="c1">// FIXME-COLUMNS: Share code with BeginColumns() - move code on columns setup.</span>
    <span class="kt">float</span> <span class="n">offset_0</span> <span class="o">=</span> <span class="n">GetColumnOffset</span><span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">offset_1</span> <span class="o">=</span> <span class="n">GetColumnOffset</span><span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Current</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">width</span> <span class="o">=</span> <span class="n">offset_1</span> <span class="o">-</span> <span class="n">offset_0</span><span class="p">;</span>
    <span class="n">PushItemWidth</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.65f</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">WorkRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">offset_1</span> <span class="o">-</span> <span class="n">column_padding</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::EndColumns</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ImGuiContext</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="o">*</span><span class="n">GImGui</span><span class="p">;</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span><span class="p">;</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">columns</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="n">PopItemWidth</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">PopClipRect</span><span class="p">();</span>
        <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Splitter</span><span class="p">.</span><span class="n">Merge</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="n">ImGuiOldColumnFlags</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Flags</span><span class="p">;</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">LineMaxY</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">LineMaxY</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">LineMaxY</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiOldColumnFlags_GrowParentContentsSize</span><span class="p">))</span>
        <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorMaxPos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">HostCursorMaxPosX</span><span class="p">;</span>  <span class="c1">// Restore cursor max pos, as columns don&#39;t grow parent</span>

    <span class="c1">// Draw columns borders and handle resize</span>
    <span class="c1">// The IsBeingResized flag ensure we preserve pre-resize columns width so back-and-forth are not lossy</span>
    <span class="kt">bool</span> <span class="n">is_being_resized</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiOldColumnFlags_NoBorder</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">SkipItems</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// We clip Y boundaries CPU side because very long triangles are mishandled by some GPU drivers.</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">HostCursorPosY</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ClipRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">dragging_column</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Count</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ImGuiOldColumnData</span><span class="o">*</span> <span class="n">column</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
            <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">GetColumnOffset</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
            <span class="k">const</span> <span class="n">ImGuiID</span> <span class="n">column_id</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">ID</span> <span class="o">+</span> <span class="n">ImGuiID</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">column_hit_hw</span> <span class="o">=</span> <span class="n">COLUMNS_HIT_RECT_HALF_WIDTH</span><span class="p">;</span>
            <span class="k">const</span> <span class="n">ImRect</span> <span class="n">column_hit_rect</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">column_hit_hw</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">column_hit_hw</span><span class="p">,</span> <span class="n">y2</span><span class="p">));</span>
            <span class="n">KeepAliveID</span><span class="p">(</span><span class="n">column_id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">IsClippedEx</span><span class="p">(</span><span class="n">column_hit_rect</span><span class="p">,</span> <span class="n">column_id</span><span class="p">,</span> <span class="nb">false</span><span class="p">))</span>
                <span class="k">continue</span><span class="p">;</span>

            <span class="kt">bool</span> <span class="n">hovered</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span> <span class="n">held</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ImGuiOldColumnFlags_NoResize</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">ButtonBehavior</span><span class="p">(</span><span class="n">column_hit_rect</span><span class="p">,</span> <span class="n">column_id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hovered</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">held</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">hovered</span> <span class="o">||</span> <span class="n">held</span><span class="p">)</span>
                    <span class="n">g</span><span class="p">.</span><span class="n">MouseCursor</span> <span class="o">=</span> <span class="n">ImGuiMouseCursor_ResizeEW</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">held</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">column</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">&amp;</span> <span class="n">ImGuiOldColumnFlags_NoResize</span><span class="p">))</span>
                    <span class="n">dragging_column</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// Draw column</span>
            <span class="k">const</span> <span class="n">ImU32</span> <span class="n">col</span> <span class="o">=</span> <span class="n">GetColorU32</span><span class="p">(</span><span class="n">held</span> <span class="o">?</span> <span class="nl">ImGuiCol_SeparatorActive</span> <span class="p">:</span> <span class="n">hovered</span> <span class="o">?</span> <span class="nl">ImGuiCol_SeparatorHovered</span> <span class="p">:</span> <span class="n">ImGuiCol_Separator</span><span class="p">);</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">xi</span> <span class="o">=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="n">window</span><span class="o">-&gt;</span><span class="n">DrawList</span><span class="o">-&gt;</span><span class="n">AddLine</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="mf">1.0f</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="n">col</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Apply dragging after drawing the column lines, so our rendered lines are in sync with how items were displayed during the frame.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dragging_column</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">columns</span><span class="o">-&gt;</span><span class="n">IsBeingResized</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
                    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">OffsetNormBeforeResize</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Columns</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">OffsetNorm</span><span class="p">;</span>
            <span class="n">columns</span><span class="o">-&gt;</span><span class="n">IsBeingResized</span> <span class="o">=</span> <span class="n">is_being_resized</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">GetDraggedColumnOffset</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">dragging_column</span><span class="p">);</span>
            <span class="n">SetColumnOffset</span><span class="p">(</span><span class="n">dragging_column</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">columns</span><span class="o">-&gt;</span><span class="n">IsBeingResized</span> <span class="o">=</span> <span class="n">is_being_resized</span><span class="p">;</span>

    <span class="n">window</span><span class="o">-&gt;</span><span class="n">WorkRect</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">ParentWorkRect</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">ParentWorkRect</span> <span class="o">=</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">HostBackupParentWorkRect</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ColumnsOffset</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CursorPos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">IM_FLOOR</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">Indent</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">ColumnsOffset</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ImGui::Columns</span><span class="p">(</span><span class="kt">int</span> <span class="n">columns_count</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">id</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">border</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ImGuiWindow</span><span class="o">*</span> <span class="n">window</span> <span class="o">=</span> <span class="n">GetCurrentWindow</span><span class="p">();</span>
    <span class="n">IM_ASSERT</span><span class="p">(</span><span class="n">columns_count</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">);</span>

    <span class="n">ImGuiOldColumnFlags</span> <span class="n">flags</span> <span class="o">=</span> <span class="p">(</span><span class="n">border</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">ImGuiOldColumnFlags_NoBorder</span><span class="p">);</span>
    <span class="c1">//flags |= ImGuiOldColumnFlags_NoPreserveWidths; // NB: Legacy behavior</span>
    <span class="n">ImGuiOldColumns</span><span class="o">*</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">DC</span><span class="p">.</span><span class="n">CurrentColumns</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">columns</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Count</span> <span class="o">==</span> <span class="n">columns_count</span> <span class="o">&amp;&amp;</span> <span class="n">columns</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">==</span> <span class="n">flags</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">columns</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="n">EndColumns</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">columns_count</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">BeginColumns</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">columns_count</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//-------------------------------------------------------------------------</span>

<span class="cp">#endif </span><span class="c1">// #ifndef IMGUI_DISABLE</span>
</pre></div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation index</a><ul>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/api/program_listing_file__home_runner_work_Legion-Engine.rythe-legacy_Legion-Engine.rythe-legacy_legion_engine_rendering_imgui_impl_imgui_widgets.cpp.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
  </body>
</html>